(function(n,r){typeof exports=="object"&&typeof module!="undefined"?module.exports=r():typeof define=="function"&&define.amd?define(r):(n=typeof globalThis!="undefined"?globalThis:n||self,n.Loca=r())})(this,function(){"use strict";var commonjsGlobal=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function getAugmentedNamespace(n){var r=n.default;if(typeof r=="function"){var a=function(){return r.apply(this,arguments)};a.prototype=r.prototype}else a={};return Object.defineProperty(a,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var o=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(a,i,o.get?o:{enumerable:!0,get:function(){return n[i]}})}),a}var lbsLocaLayers_umd_tmp$1={exports:{}},uaParser={exports:{}};function _instanceof$7(n,r){return r!=null&&typeof Symbol!="undefined"&&r[Symbol.hasInstance]?!!r[Symbol.hasInstance](n):n instanceof r}function _type_of$5(n){return n&&typeof Symbol!="undefined"&&n.constructor===Symbol?"symbol":typeof n}var hasRequiredUaParser;function requireUaParser(){return hasRequiredUaParser||(hasRequiredUaParser=1,function(n,r){(function(a,i){var o="0.7.36",s="",l="?",u="function",c="undefined",f="object",h="string",p="major",d="model",v="name",_="type",m="vendor",y="version",g="architecture",C="console",b="mobile",k="tablet",L="smarttv",F="wearable",W="embedded",j=350,Y="Amazon",N="Apple",$="ASUS",w="BlackBerry",E="Browser",A="Chrome",R="Edge",O="Firefox",P="Google",T="Huawei",M="LG",U="Microsoft",Q="Motorola",K="Opera",te="Samsung",ve="Sharp",de="Sony",be="Xiaomi",et="Zebra",qe="Facebook",Ne="Chromium OS",Ge="Mac OS",ft=function(ot,bt){var rt={};for(var Pt in ot)bt[Pt]&&bt[Pt].length%2===0?rt[Pt]=bt[Pt].concat(ot[Pt]):rt[Pt]=ot[Pt];return rt},Ze=function(ot){for(var bt={},rt=0;rt<ot.length;rt++)bt[ot[rt].toUpperCase()]=ot[rt];return bt},pt=function(ot,bt){return(typeof ot=="undefined"?"undefined":_type_of$5(ot))===h?dt(bt).indexOf(dt(ot))!==-1:!1},dt=function(ot){return ot.toLowerCase()},Ot=function(ot){return(typeof ot=="undefined"?"undefined":_type_of$5(ot))===h?ot.replace(/[^\d\.]/g,s).split(".")[0]:i},mt=function(ot,bt){if((typeof ot=="undefined"?"undefined":_type_of$5(ot))===h)return ot=ot.replace(/^\s\s*/,s),(typeof bt=="undefined"?"undefined":_type_of$5(bt))===c?ot:ot.substring(0,j)},at=function(ot,bt){for(var rt=0,Pt,st,$t,_t,it,Vt;rt<bt.length&&!it;){var mr=bt[rt],wr=bt[rt+1];for(Pt=st=0;Pt<mr.length&&!it&&mr[Pt];)if(it=mr[Pt++].exec(ot),it)for($t=0;$t<wr.length;$t++)Vt=it[++st],_t=wr[$t],(typeof _t=="undefined"?"undefined":_type_of$5(_t))===f&&_t.length>0?_t.length===2?_type_of$5(_t[1])==u?this[_t[0]]=_t[1].call(this,Vt):this[_t[0]]=_t[1]:_t.length===3?_type_of$5(_t[1])===u&&!(_t[1].exec&&_t[1].test)?this[_t[0]]=Vt?_t[1].call(this,Vt,_t[2]):i:this[_t[0]]=Vt?Vt.replace(_t[1],_t[2]):i:_t.length===4&&(this[_t[0]]=Vt?_t[3].call(this,Vt.replace(_t[1],_t[2])):i):this[_t]=Vt||i;rt+=2}},St=function(ot,bt){for(var rt in bt)if(_type_of$5(bt[rt])===f&&bt[rt].length>0){for(var Pt=0;Pt<bt[rt].length;Pt++)if(pt(bt[rt][Pt],ot))return rt===l?i:rt}else if(pt(bt[rt],ot))return rt===l?i:rt;return ot},Tt={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},Dt={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Lt={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[y,[v,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[y,[v,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[v,y],[/opios[\/ ]+([\w\.]+)/i],[y,[v,K+" Mini"]],[/\bopr\/([\w\.]+)/i],[y,[v,K]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[v,y],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[y,[v,"UC"+E]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[y,[v,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[y,[v,"WeChat"]],[/konqueror\/([\w\.]+)/i],[y,[v,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[y,[v,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[y,[v,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[v,/(.+)/,"$1 Secure "+E],y],[/\bfocus\/([\w\.]+)/i],[y,[v,O+" Focus"]],[/\bopt\/([\w\.]+)/i],[y,[v,K+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[y,[v,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[y,[v,"Dolphin"]],[/coast\/([\w\.]+)/i],[y,[v,K+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[y,[v,"MIUI "+E]],[/fxios\/([-\w\.]+)/i],[y,[v,O]],[/\bqihu|(qi?ho?o?|360)browser/i],[[v,"360 "+E]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[v,/(.+)/,"$1 "+E],y],[/(comodo_dragon)\/([\w\.]+)/i],[[v,/_/g," "],y],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[v,y],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[v],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[v,qe],y],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[v,y],[/\bgsa\/([\w\.]+) .*safari\//i],[y,[v,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[y,[v,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[y,[v,A+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[v,A+" WebView"],y],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[y,[v,"Android "+E]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[v,y],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[y,[v,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[y,v],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[v,[y,St,Tt]],[/(webkit|khtml)\/([\w\.]+)/i],[v,y],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[v,"Netscape"],y],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[y,[v,O+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[v,y],[/(cobalt)\/([\w\.]+)/i],[v,[y,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[g,"amd64"]],[/(ia32(?=;))/i],[[g,dt]],[/((?:i[346]|x)86)[;\)]/i],[[g,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[g,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[g,"armhf"]],[/windows (ce|mobile); ppc;/i],[[g,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[g,/ower/,s,dt]],[/(sun4\w)[;\)]/i],[[g,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[g,dt]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[d,[m,te],[_,k]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[d,[m,te],[_,b]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[d,[m,N],[_,b]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[d,[m,N],[_,k]],[/(macintosh);/i],[d,[m,N]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[d,[m,ve],[_,b]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[d,[m,T],[_,k]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[d,[m,T],[_,b]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[d,/_/g," "],[m,be],[_,b]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[d,/_/g," "],[m,be],[_,k]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[d,[m,"OPPO"],[_,b]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[d,[m,"Vivo"],[_,b]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[d,[m,"Realme"],[_,b]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[d,[m,Q],[_,b]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[d,[m,Q],[_,k]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[d,[m,M],[_,k]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[d,[m,M],[_,b]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[d,[m,"Lenovo"],[_,k]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[d,/_/g," "],[m,"Nokia"],[_,b]],[/(pixel c)\b/i],[d,[m,P],[_,k]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[d,[m,P],[_,b]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[d,[m,de],[_,b]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[d,"Xperia Tablet"],[m,de],[_,k]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[d,[m,"OnePlus"],[_,b]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[d,[m,Y],[_,k]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[d,/(.+)/g,"Fire Phone $1"],[m,Y],[_,b]],[/(playbook);[-\w\),; ]+(rim)/i],[d,m,[_,k]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[d,[m,w],[_,b]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[d,[m,$],[_,k]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[d,[m,$],[_,b]],[/(nexus 9)/i],[d,[m,"HTC"],[_,k]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[m,[d,/_/g," "],[_,b]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[d,[m,"Acer"],[_,k]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[d,[m,"Meizu"],[_,b]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[m,d,[_,b]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[m,d,[_,k]],[/(surface duo)/i],[d,[m,U],[_,k]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[d,[m,"Fairphone"],[_,b]],[/(u304aa)/i],[d,[m,"AT&T"],[_,b]],[/\bsie-(\w*)/i],[d,[m,"Siemens"],[_,b]],[/\b(rct\w+) b/i],[d,[m,"RCA"],[_,k]],[/\b(venue[\d ]{2,7}) b/i],[d,[m,"Dell"],[_,k]],[/\b(q(?:mv|ta)\w+) b/i],[d,[m,"Verizon"],[_,k]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[d,[m,"Barnes & Noble"],[_,k]],[/\b(tm\d{3}\w+) b/i],[d,[m,"NuVision"],[_,k]],[/\b(k88) b/i],[d,[m,"ZTE"],[_,k]],[/\b(nx\d{3}j) b/i],[d,[m,"ZTE"],[_,b]],[/\b(gen\d{3}) b.+49h/i],[d,[m,"Swiss"],[_,b]],[/\b(zur\d{3}) b/i],[d,[m,"Swiss"],[_,k]],[/\b((zeki)?tb.*\b) b/i],[d,[m,"Zeki"],[_,k]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[m,"Dragon Touch"],d,[_,k]],[/\b(ns-?\w{0,9}) b/i],[d,[m,"Insignia"],[_,k]],[/\b((nxa|next)-?\w{0,9}) b/i],[d,[m,"NextBook"],[_,k]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[m,"Voice"],d,[_,b]],[/\b(lvtel\-)?(v1[12]) b/i],[[m,"LvTel"],d,[_,b]],[/\b(ph-1) /i],[d,[m,"Essential"],[_,b]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[d,[m,"Envizen"],[_,k]],[/\b(trio[-\w\. ]+) b/i],[d,[m,"MachSpeed"],[_,k]],[/\btu_(1491) b/i],[d,[m,"Rotor"],[_,k]],[/(shield[\w ]+) b/i],[d,[m,"Nvidia"],[_,k]],[/(sprint) (\w+)/i],[m,d,[_,b]],[/(kin\.[onetw]{3})/i],[[d,/\./g," "],[m,U],[_,b]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[d,[m,et],[_,k]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[d,[m,et],[_,b]],[/smart-tv.+(samsung)/i],[m,[_,L]],[/hbbtv.+maple;(\d+)/i],[[d,/^/,"SmartTV"],[m,te],[_,L]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[m,M],[_,L]],[/(apple) ?tv/i],[m,[d,N+" TV"],[_,L]],[/crkey/i],[[d,A+"cast"],[m,P],[_,L]],[/droid.+aft(\w+)( bui|\))/i],[d,[m,Y],[_,L]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[d,[m,ve],[_,L]],[/(bravia[\w ]+)( bui|\))/i],[d,[m,de],[_,L]],[/(mitv-\w{5}) bui/i],[d,[m,be],[_,L]],[/Hbbtv.*(technisat) (.*);/i],[m,d,[_,L]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[m,mt],[d,mt],[_,L]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[_,L]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[m,d,[_,C]],[/droid.+; (shield) bui/i],[d,[m,"Nvidia"],[_,C]],[/(playstation [345portablevi]+)/i],[d,[m,de],[_,C]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[d,[m,U],[_,C]],[/((pebble))app/i],[m,d,[_,F]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[d,[m,N],[_,F]],[/droid.+; (glass) \d/i],[d,[m,P],[_,F]],[/droid.+; (wt63?0{2,3})\)/i],[d,[m,et],[_,F]],[/(quest( 2| pro)?)/i],[d,[m,qe],[_,F]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[m,[_,W]],[/(aeobc)\b/i],[d,[m,Y],[_,W]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[d,[_,b]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[d,[_,k]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[_,k]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[_,b]],[/(android[-\w\. ]{0,9});.+buil/i],[d,[m,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[y,[v,R+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[y,[v,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[v,y],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[y,v]],os:[[/microsoft (windows) (vista|xp)/i],[v,y],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[v,[y,St,Dt]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[v,"Windows"],[y,St,Dt]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[y,/_/g,"."],[v,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[v,Ge],[y,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[y,v],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[v,y],[/\(bb(10);/i],[y,[v,w]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[y,[v,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[y,[v,O+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[y,[v,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[y,[v,"watchOS"]],[/crkey\/([\d\.]+)/i],[y,[v,A+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[v,Ne],y],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[v,y],[/(sunos) ?([\w\.\d]*)/i],[[v,"Solaris"],y],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[v,y]]},Rt=function(ot,bt){if((typeof ot=="undefined"?"undefined":_type_of$5(ot))===f&&(bt=ot,ot=i),!_instanceof$7(this,Rt))return new Rt(ot,bt).getResult();var rt=(typeof a=="undefined"?"undefined":_type_of$5(a))!==c&&a.navigator?a.navigator:i,Pt=ot||(rt&&rt.userAgent?rt.userAgent:s),st=rt&&rt.userAgentData?rt.userAgentData:i,$t=bt?ft(Lt,bt):Lt,_t=rt&&rt.userAgent==Pt;return this.getBrowser=function(){var it={};return it[v]=i,it[y]=i,at.call(it,Pt,$t.browser),it[p]=Ot(it[y]),_t&&rt&&rt.brave&&_type_of$5(rt.brave.isBrave)==u&&(it[v]="Brave"),it},this.getCPU=function(){var it={};return it[g]=i,at.call(it,Pt,$t.cpu),it},this.getDevice=function(){var it={};return it[m]=i,it[d]=i,it[_]=i,at.call(it,Pt,$t.device),_t&&!it[_]&&st&&st.mobile&&(it[_]=b),_t&&it[d]=="Macintosh"&&rt&&_type_of$5(rt.standalone)!==c&&rt.maxTouchPoints&&rt.maxTouchPoints>2&&(it[d]="iPad",it[_]=k),it},this.getEngine=function(){var it={};return it[v]=i,it[y]=i,at.call(it,Pt,$t.engine),it},this.getOS=function(){var it={};return it[v]=i,it[y]=i,at.call(it,Pt,$t.os),_t&&!it[v]&&st&&st.platform!="Unknown"&&(it[v]=st.platform.replace(/chrome os/i,Ne).replace(/macos/i,Ge)),it},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Pt},this.setUA=function(it){return Pt=(typeof it=="undefined"?"undefined":_type_of$5(it))===h&&it.length>j?mt(it,j):it,this},this.setUA(Pt),this};Rt.VERSION=o,Rt.BROWSER=Ze([v,y,p]),Rt.CPU=Ze([g]),Rt.DEVICE=Ze([d,m,_,C,b,L,k,F,W]),Rt.ENGINE=Rt.OS=Ze([v,y]),n.exports&&(r=n.exports=Rt),r.UAParser=Rt;var It=(typeof a=="undefined"?"undefined":_type_of$5(a))!==c&&(a.jQuery||a.Zepto);if(It&&!It.ua){var Bt=new Rt;It.ua=Bt.getResult(),It.ua.get=function(){return Bt.getUA()},It.ua.set=function(Ft){Bt.setUA(Ft);var ot=Bt.getResult();for(var bt in ot)It.ua[bt]=ot[bt]}}})(typeof window=="object"?window:commonjsGlobal)}(uaParser,uaParser.exports)),uaParser.exports}var chito={exports:{}},core={},animation={},eventemitter={};function _instanceof$6(n,r){return r!=null&&typeof Symbol!="undefined"&&r[Symbol.hasInstance]?!!r[Symbol.hasInstance](n):n instanceof r}var hasRequiredEventemitter;function requireEventemitter(){return hasRequiredEventemitter||(hasRequiredEventemitter=1,function(n){var r=function(u,c){if(!_instanceof$6(u,c))throw new TypeError("Cannot call a class as a function")},a=function(u){for(var c=-1,f=arguments.length<=1?0:arguments.length-1;++c<f;){var h=arguments.length<=c+1?void 0:arguments[c+1];for(var p in h)h.hasOwnProperty(p)&&(u[p]=h[p])}return u};Object.defineProperty(n,"__esModule",{value:!0});var i=function(){var l=function(c,f){for(var h=0;h<f.length;h++){var p=f[h];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(c,p.key,p)}};return function(u,c,f){return c&&l(u.prototype,c),f&&l(u,f),u}}(),o=-1,s=function(){function l(){r(this,l),this.__events__={},this.__id__=++o}return i(l,[{key:"on",value:function(c,f,h){var p=this.__events__,d=p[c]=p[c]||[];h===this&&(h=void 0);for(var v=-1,_=d;++v<_;){var m=d[v],y=m.fn,g=m.ctx;if(y===f&&g===h)return this}var C={fn:f,ctx:h};return d.push(C),this}},{key:"once",value:function(c,f,h){function p(d){this.off(c,p),f.call(this,d)}return p.listener=f,this.on(c,p,h)}},{key:"off",value:function(c,f,h){var p=this.__events__;if(!c)return this.__events__={},this;if(!f)return delete p[c],this;var d=p[c];if(d)for(var v=d.length;--v>=0;){var _=d[v],m=_.fn,y=_.ctx;y===h&&(m===f||m===m.listener)&&(d.splice(v,1),m=function(){})}return this}},{key:"emit",value:function(c,f){var h=this.__events__[c];if(h)for(var p=a({},f,{target:this,type:c}),d=-1,v=h.length;++d<v;){var _=h[d],m=_.fn,y=_.ctx;m.call(y||this,p)}return this}},{key:"events",get:function(){return this.__events__}},{key:"id",get:function(){return this.__id__}}]),l}();n.default=s}(eventemitter)),eventemitter}var util={},hasRequiredUtil;function requireUtil(){return hasRequiredUtil||(hasRequiredUtil=1,function(n){var r=function(u,c){for(var f=u?c.length:0;f-- >0;){var h=c[f];u.splice(h,1)}return u},a=function(u,c){var f=[];if(!(u&&u.length))return f;if(typeof c=="function"){for(var h=-1,p=[],d=u.length;++h<d;){var v=u[h];c(v,h,u)&&(f.push(v),p.push(h))}r(u,p)}return f},i=function(u,c){for(var f in u)if(u.hasOwnProperty(f)){var h=u[f];c(h,f,u)}};Object.defineProperty(n,"__esModule",{value:!0});var o=function(){var l=function(c,f){var h=[],p=!0,d=!1,v=void 0;try{for(var _=c[Symbol.iterator](),m;!(p=(m=_.next()).done)&&(h.push(m.value),!(f&&h.length===f));p=!0);}catch(y){d=!0,v=y}finally{try{!p&&_.return&&_.return()}finally{if(d)throw v}}return h};return function(u,c){if(Array.isArray(u))return u;if(Symbol.iterator in Object(u))return l(u,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function s(l){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Array.isArray(l))return l;var c=u.type,f=c===void 0?"":c,h=u.range,p=h===void 0?[0,1]:h,d=u.min,v=d===void 0?Math.min.apply(Math,l):d,_=u.max,m=_===void 0?Math.max.apply(Math,l):_;f=f.toLowerCase();for(var y=[],g=m-v,C=-1,b=l.length;++C<b;){var k=l[C];k>m&&(k=m),k<v&&(k=v);var L=void 0;f!=="log"?L=(k-v)/g:L=Math.log10(k),y.push(L)}f==="log"&&(y=s(y));var F=o(p,2),W=F[0],j=F[1];if(W!==0||j!==1){for(var Y=-1,N=y.length,$=j-W,w=[];++Y<N;){var E=y[Y],A=$*E+W;w.push(A)}y=w}return y}n.default={remove:a,normalize:s,forInMap:i}}(util)),util}var animationframe={},hasRequiredAnimationframe;function requireAnimationframe(){if(hasRequiredAnimationframe)return animationframe;hasRequiredAnimationframe=1,Object.defineProperty(animationframe,"__esModule",{value:!0}),function(){if("performance"in window||(window.performance={}),Date.now=Date.now||function(){return new Date().getTime()},!("now"in window.performance)){var a=window.performance.timing&&window.performance.timing.navigationStart?window.performance.timing.navigationStart:Date.now();window.performance.now=function(){return Date.now()-a}}}();var n=function(){return typeof window!="undefined"&&(window.requestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)||function(a){setTimeout(a,16)}}(),r=function(){return typeof window!="undefined"&&(window.cancelAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame)||function(a){clearTimeout(a)}}();return animationframe.requestAnimationFrame=n,animationframe.cancelAnimationFrame=r,animationframe}var define={},hasRequiredDefine;function requireDefine(){if(hasRequiredDefine)return define;hasRequiredDefine=1,Object.defineProperty(define,"__esModule",{value:!0});var n={UPDATE:"update",START:"start",REPEAT:"repeat",REPEAT_COMPLETE:"repeatComplete",AFTER_UPDATE:"afterUpdate",COMPLETE:"complete",PAUSE:"pause",STOP:"stop",RESET:"reset"},r={DURATION:"duration",REPEAT:"repeat",DELAY:"delay",EASING:"easing",INTERVAL:"interval",YOYO:"yoyo",START:"startAt"},a={LINEAR:"Linear",QUADRATIC_IN:"QuadraticIn",QUADRATIC_OUT:"QuadraticOut",QUADRATIC_IN_OUT:"QuadraticInOut",CUBIC_IN:"CubicIn",CUBIC_OUT:"CubicOut",CUBIC_IN_OUT:"CubicInOut",QUARTIC_IN:"QuarticIn",QUARTIC_OUT:"QuarticOut",QUARTIC_IN_OUT:"QuarticInOut",QUINTIC_IN:"QuinticIn",QUINTIC_OUT:"QuinticOut",QUINTIC_IN_OUT:"QuinticInOut",SINUSOIDAL_IN:"SinusoidalIn",SINUSOIDAL_OUT:"SinusoidalOut",SINUSOIDAL_IN_OUT:"SinusoidalInOut",EXPONENTIAL_IN:"ExponentialIn",EXPONENTIAL_OUT:"ExponentialOut",EXPONENTIAL_IN_OUT:"ExponentialInOut",CIRCULAR_IN:"CircularIn",CIRCULAR_OUT:"CircularOut",CIRCULAR_IN_OUT:"CircularInOut",ELASTIC_IN:"ElasticIn",ELASTIC_OUT:"ElasticOut",ELASTIC_IN_OUT:"ElasticInOut",BACK_IN:"BackIn",BACK_OUT:"BackOut",BACK_IN_OUT:"BackInOut",BOUNCE_IN:"BounceIn",BOUNCE_OUT:"BounceOut",BOUNCE_IN_OUT:"BounceInOut"};return define.Ev=n,define.Attr=r,define.Easing=a,define}function _instanceof$5(n,r){return r!=null&&typeof Symbol!="undefined"&&r[Symbol.hasInstance]?!!r[Symbol.hasInstance](n):n instanceof r}function _type_of$4(n){return n&&typeof Symbol!="undefined"&&n.constructor===Symbol?"symbol":typeof n}var hasRequiredAnimation;function requireAnimation(){return hasRequiredAnimation||(hasRequiredAnimation=1,function(n){var r=function(y){return y&&y.__esModule?y:{default:y}},a=function(y,g){if(!_instanceof$5(y,g))throw new TypeError("Cannot call a class as a function")},i=function(y,g){if(!y)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g&&(typeof g=="object"||typeof g=="function")?g:y},o=function(y,g){if(typeof g!="function"&&g!==null)throw new TypeError("Super expression must either be null or a function, not "+(typeof g=="undefined"?"undefined":_type_of$4(g)));y.prototype=Object.create(g&&g.prototype,{constructor:{value:y,enumerable:!1,writable:!0,configurable:!0}}),g&&(Object.setPrototypeOf?Object.setPrototypeOf(y,g):y.__proto__=g)};Object.defineProperty(n,"__esModule",{value:!0});var s=function(){var m=function(g,C){for(var b=0;b<C.length;b++){var k=C[b];k.enumerable=k.enumerable||!1,k.configurable=!0,"value"in k&&(k.writable=!0),Object.defineProperty(g,k.key,k)}};return function(y,g,C){return g&&m(y.prototype,g),C&&m(y,C),y}}(),l=requireEventemitter(),u=r(l),c=requireUtil(),f=r(c),h=requireAnimationframe(),p=requireDefine(),d=f.default.remove,v=f.default.forInMap,_=function(m){o(y,m);function y(g){a(this,y);var C=i(this,(y.__proto__||Object.getPrototypeOf(y)).call(this));return C._options={},C._savedClipMap={},C._clips=[],C._clipMap={},C._options=g||{},C}return s(y,[{key:"_startAni",value:function(){var C=this,b=function k(L){C._timer=(0,h.requestAnimationFrame)(k),C._update(L)};this._timer=(0,h.requestAnimationFrame)(b)}},{key:"_stopAni",value:function(){var C=this._timer;return C?((0,h.cancelAnimationFrame)(C),this._timer=null,!0):!1}},{key:"_update",value:function(C){var b=this._clips;this.emit(p.Ev.UPDATE,{timestamp:C});for(var k=0;k<b.length;){var L=b[k],F=L.update(C);F?k++:this._rmClip(L)}this._clips=b,this.emit(p.Ev.AFTER_UPDATE),b.length===0&&(this._stopAni(),this.emit(p.Ev.COMPLETE))}},{key:"start",value:function(){var C=this._clips,b=C.length;if(this._timer||b===0)return this;this.emit(p.Ev.START);for(var k=-1;++k<b;){var L=C[k];L.start()}return this._startAni(),this}},{key:"stop",value:function(){return this._stop(!1),this}},{key:"pause",value:function(){return this._stop(!0),this}},{key:"reset",value:function(){this._stop(!1,!0,!1);var C=this._savedClipMap,b=[];return v(C,function(k){k.stop(!0),b.push(k)}),this._clips=b,this.emit(p.Ev.RESET),this}},{key:"_stop",value:function(C,b){var k=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;this._stopAni();var L=this._clips,F=L.length;if(F){for(var W=-1;++W<F;){var j=L[W];C?j.pause():j.stop(b)}k&&this.emit(C?p.Ev.PAUSE:p.Ev.STOP)}}},{key:"addClip",value:function(C){var b=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;Array.isArray(C)||(C=[C]);for(var k=-1,L=C.length;++k<L;){var F=C[k];this._hasSavedClip(F)||(this._addClip(F),this._addSavedClip(F),this._timer&&b&&F.start())}return this}},{key:"_addClip",value:function(C){var b=this._clips;b.indexOf(C)===-1&&(b.push(C),C._animation=this)}},{key:"_addSavedClip",value:function(C){var b=this._savedClipMap,k=C.id;b[k]!==C&&(b[k]=C,C._animation=this)}},{key:"removeClip",value:function(C){var b=this._savedClipMap;return C?(this._rmClip(C),this._rmSavedClip(C),C._animation=null):(v(b,function(k){k._animation=null}),this._clips=[],this._savedClipMap={}),this}},{key:"_rmClip",value:function(C){d(this._clips,function(b){return b===C})}},{key:"_rmSavedClip",value:function(C){this._hasSavedClip(C)&&delete this._savedClipMap[C.id]}},{key:"getClips",value:function(){return this._clips}},{key:"_hasSavedClip",value:function(C){var b=C.id,k=this._savedClipMap,L=k[b];return L&&L===C}},{key:"_hasClip",value:function(C){return this._clips.indexOf(C)!==-1}},{key:"destroy",value:function(){this.off(),this._stopAni(),this.removeClip()}}]),y}(u.default);_.Event=p.Ev,n.default=_}(animation)),animation}var clip={},easing={},hasRequiredEasing;function requireEasing(){return hasRequiredEasing||(hasRequiredEasing=1,function(n){Object.defineProperty(n,"__esModule",{value:!0});var r={Linear:function(i){return i},QuadraticIn:function(i){return i*i},QuadraticOut:function(i){return i*(2-i)},QuadraticInOut:function(i){return(i*=2)<1?.5*i*i:-.5*(--i*(i-2)-1)},CubicIn:function(i){return i*i*i},CubicOut:function(i){return--i*i*i+1},CubicInOut:function(i){return(i*=2)<1?.5*i*i*i:.5*((i-=2)*i*i+2)},QuarticIn:function(i){return i*i*i*i},QuarticOut:function(i){return 1- --i*i*i*i},QuarticInOut:function(i){return(i*=2)<1?.5*i*i*i*i:-.5*((i-=2)*i*i*i-2)},QuinticIn:function(i){return i*i*i*i*i},QuinticOut:function(i){return--i*i*i*i*i+1},QuinticInOut:function(i){return(i*=2)<1?.5*i*i*i*i*i:.5*((i-=2)*i*i*i*i+2)},SinusoidalIn:function(i){return 1-Math.cos(i*Math.PI/2)},SinusoidalOut:function(i){return Math.sin(i*Math.PI/2)},SinusoidalInOut:function(i){return .5*(1-Math.cos(Math.PI*i))},ExponentialIn:function(i){return i===0?0:Math.pow(1024,i-1)},ExponentialOut:function(i){return i===1?1:1-Math.pow(2,-10*i)},ExponentialInOut:function(i){return i===0?0:i===1?1:(i*=2)<1?.5*Math.pow(1024,i-1):.5*(-Math.pow(2,-10*(i-1))+2)},CircularIn:function(i){return 1-Math.sqrt(1-i*i)},CircularOut:function(i){return Math.sqrt(1- --i*i)},CircularInOut:function(i){return(i*=2)<1?-.5*(Math.sqrt(1-i*i)-1):.5*(Math.sqrt(1-(i-=2)*i)+1)},ElasticIn:function(i){var o,s=.1,l=.4;return i===0?0:i===1?1:(!s||s<1?(s=1,o=l/4):o=l*Math.asin(1/s)/(2*Math.PI),-(s*Math.pow(2,10*(i-=1))*Math.sin((i-o)*(2*Math.PI)/l)))},ElasticOut:function(i){var o,s=.1,l=.4;return i===0?0:i===1?1:(!s||s<1?(s=1,o=l/4):o=l*Math.asin(1/s)/(2*Math.PI),s*Math.pow(2,-10*i)*Math.sin((i-o)*(2*Math.PI)/l)+1)},ElasticInOut:function(i){var o,s=.1,l=.4;return i===0?0:i===1?1:(!s||s<1?(s=1,o=l/4):o=l*Math.asin(1/s)/(2*Math.PI),(i*=2)<1?-.5*(s*Math.pow(2,10*(i-=1))*Math.sin((i-o)*(2*Math.PI)/l)):s*Math.pow(2,-10*(i-=1))*Math.sin((i-o)*(2*Math.PI)/l)*.5+1)},BackIn:function(i){var o=1.70158;return i*i*((o+1)*i-o)},BackOut:function(i){var o=1.70158;return--i*i*((o+1)*i+o)+1},BackInOut:function(i){var o=2.5949095;return(i*=2)<1?.5*(i*i*((o+1)*i-o)):.5*((i-=2)*i*((o+1)*i+o)+2)},BounceIn:function(i){return 1-r.BounceOut(1-i)},BounceOut:function(i){return i<1/2.75?7.5625*i*i:i<2/2.75?7.5625*(i-=1.5/2.75)*i+.75:i<2.5/2.75?7.5625*(i-=2.25/2.75)*i+.9375:7.5625*(i-=2.625/2.75)*i+.984375},BounceInOut:function(i){return i<.5?r.BounceIn(i*2)*.5:r.BounceOut(i*2-1)*.5+.5}};n.default=r}(easing)),easing}var Interpolation={},hasRequiredInterpolation;function requireInterpolation(){return hasRequiredInterpolation||(hasRequiredInterpolation=1,function(n){Object.defineProperty(n,"__esModule",{value:!0});var r={Linear:function(i,o){var s=i.length-1,l=s*o,u=Math.floor(l),c=r.Utils.Linear;return o<0?c(i[0],i[1],l):o>1?c(i[s],i[s-1],s-l):c(i[u],i[u+1>s?s:u+1],l-u)},Bezier:function(i,o){for(var s=0,l=i.length-1,u=Math.pow,c=r.Utils.Bernstein,f=0;f<=l;f++)s+=u(1-o,l-f)*u(o,f)*i[f]*c(l,f);return s},CatmullRom:function(i,o){var s=i.length-1,l=s*o,u=Math.floor(l),c=r.Utils.CatmullRom;return i[0]===i[s]?(o<0&&(u=Math.floor(l=s*(1+o))),c(i[(u-1+s)%s],i[u],i[(u+1)%s],i[(u+2)%s],l-u)):o<0?i[0]-(c(i[0],i[0],i[1],i[1],-l)-i[0]):o>1?i[s]-(c(i[s],i[s],i[s-1],i[s-1],l-s)-i[s]):c(i[u?u-1:0],i[u],i[s<u+1?s:u+1],i[s<u+2?s:u+2],l-u)},Utils:{Linear:function(i,o,s){return(o-i)*s+i},Bernstein:function(i,o){var s=r.Utils.Factorial;return s(i)/s(o)/s(i-o)},Factorial:function(){var a=[1];return function(i){var o=1;if(a[i])return a[i];for(var s=i;s>1;s--)o*=s;return a[i]=o,o}}(),CatmullRom:function(i,o,s,l,u){var c=(s-i)*.5,f=(l-o)*.5,h=u*u,p=u*h;return(2*o-2*s+c+f)*p+(-3*o+3*s-2*c-f)*h+c*u+o}}};n.default=r}(Interpolation)),Interpolation}function _instanceof$4(n,r){return r!=null&&typeof Symbol!="undefined"&&r[Symbol.hasInstance]?!!r[Symbol.hasInstance](n):n instanceof r}function _type_of$3(n){return n&&typeof Symbol!="undefined"&&n.constructor===Symbol?"symbol":typeof n}var hasRequiredClip;function requireClip(){return hasRequiredClip||(hasRequiredClip=1,function(n){var r=function(m){return m&&m.__esModule?m:{default:m}},a=function(m,y){if(!_instanceof$4(m,y))throw new TypeError("Cannot call a class as a function")},i=function(m,y){if(!m)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y&&(typeof y=="object"||typeof y=="function")?y:m},o=function(m,y){if(typeof y!="function"&&y!==null)throw new TypeError("Super expression must either be null or a function, not "+(typeof y=="undefined"?"undefined":_type_of$3(y)));m.prototype=Object.create(y&&y.prototype,{constructor:{value:m,enumerable:!1,writable:!0,configurable:!0}}),y&&(Object.setPrototypeOf?Object.setPrototypeOf(m,y):m.__proto__=y)};Object.defineProperty(n,"__esModule",{value:!0});var s=function(){var _=function(y,g){for(var C=0;C<g.length;C++){var b=g[C];b.enumerable=b.enumerable||!1,b.configurable=!0,"value"in b&&(b.writable=!0),Object.defineProperty(y,b.key,b)}};return function(m,y,g){return y&&_(m.prototype,y),g&&_(m,g),m}}(),l=requireEventemitter(),u=r(l),c=requireEasing(),f=r(c),h=requireInterpolation(),p=r(h),d=requireDefine(),v=function(_){o(m,_),s(m,null,[{key:"registerPlugin",value:function(g){var C=g.type,b=this._plugins,k=b&&b[C];k||(this._plugins=b||{},this._plugins[C]=g)}}]);function m(y,g){a(this,m);var C=i(this,(m.__proto__||Object.getPrototypeOf(m)).call(this));return C._options={},C._attr={},C._startAt=0,C._stopped=!0,C._paused=!1,C._startTime=0,C._pauseStart=0,C._pauseTime=0,C._reversed=!1,C._chainClips=[],C._tracks=[],C._interpolation=p.default.Linear,C._options=y||{},C._attr=g,C._initOption(y),C._tracks=C._transform(g),C}return s(m,[{key:"_initOption",value:function(g){var C=g[d.Attr.EASING]||d.Easing.LINEAR;this._easing=f.default[C]?f.default[C]:C,this._delay=g[d.Attr.DELAY]||0;var b=g[d.Attr.DURATION];this._duration=typeof b=="undefined"?1e3:b,this._repeat_0=this._repeat=g[d.Attr.REPEAT]||1,this._interval=g[d.Attr.INTERVAL]||0,this._yoyo=g[d.Attr.YOYO]||!1,this._startAt=g[d.Attr.START]||0}},{key:"_transform",value:function(g){var C=this.constructor._plugins,b=[];for(var k in g)if(g.hasOwnProperty(k)){var L=g[k];for(var F in C){var W=C[F];if(W.test(L,k)){L=W.parse(L,k),L.__type__=W.type;break}}b.push({key:k,value:L})}return b}},{key:"start",value:function(g){var C=window.performance.now(),b=!1;if(this._paused)this._pauseTime+=C-this._pauseStart,this._paused=!1;else{if(!g&&!this._stopped)return this;b=!0,this._stopped=!1,this._startTime=C+this._delay}this.emit(d.Ev.START);var k=this._repeat;return k>1&&k===this._repeat_0&&b&&this.emit(d.Ev.REPEAT,{remain:0}),this}},{key:"stop",value:function(g){return this._stopped||(this._stopped=!0,this._paused=!1,this._pauseTime=0,this._pauseStart=0,this.emit(d.Ev.STOP),this.stopChain()),g&&(this._repeat=this._repeat_0),this}},{key:"pause",value:function(){return this._stopped||this._paused?this:(this._paused=!0,this._pauseStart=window.performance.now(),this.emit(d.Ev.PAUSE),this)}},{key:"update",value:function(g){if(this._stopped||this._paused||g&&g<this._startTime)return!0;var C=g-this._pauseTime,b=this._getProgress(C),k=b.progress,L=b.elapsed,F=this._updateAttr(k,L);return this.emit(d.Ev.UPDATE,{progress:k,keyframe:F,elapsed:L}),this._afterUpdate(C,L)}},{key:"_getProgress",value:function(g){var C=(g-this._startTime)/this._duration;C+=this._startAt,C=Math.min(C,1);var b=this._easing(this._reversed?1-C:C);return{progress:b,elapsed:C}}},{key:"_updateAttr",value:function(g,C){for(var b=this._tracks,k={},L=0,F=b.length;L<F;){var W=b[L++],j=W.key,Y=W.value,N=Y.__type__;if(N){var $=this.constructor._plugins[N];Y=$.valueOf(Y,g,C,j)}else Y=this._interpolation(Y,g);k[j]=Y}return k}},{key:"_afterUpdate",value:function(g,C){if(C===1){var b=this._repeat,k=this._repeat_0;if(b>1)return isFinite(b)&&b--,this._startTime=g+this._interval,this._startAt=0,this._yoyo&&(this._reversed=!this._reversed),this._repeat=b,this.emit(d.Ev.REPEAT_COMPLETE,{repeat:b}),this.emit(d.Ev.REPEAT,{remain:k-b}),!0;this._stopped=!0,this._pauseTime=0,this._pauseStart=0,this._repeat=k,k>1&&this.emit(d.Ev.REPEAT_COMPLETE,{repeat:0}),this.emit(d.Ev.COMPLETE);for(var L=-1,F=this._chainClips,W=F.length,j=this._animation;++L<W;){var Y=F[L];j&&j._addClip(Y),Y.start()}return!1}return!0}},{key:"chain",value:function(){for(var g=arguments.length,C=Array(g),b=0;b<g;b++)C[b]=arguments[b];return this._chainClips=C,this}},{key:"stopChain",value:function(){for(var g=-1,C=this._chainClips,b=C.length;++g<b;){var k=C[g];k.stop()}return this}},{key:"destroy",value:function(){this.off(),this._stopped=!0,this._paused=!1,this._startTime=0,this._pauseTime=0,this._pauseStart=0,this._chainClips=[];var g=this._animation;g&&g.removeClip(this),this._animation=null}}]),m}(u.default);v.Event=d.Ev,v.Attr=d.Attr,v.Easing=d.Easing,n.default=v}(clip)),clip}var hasRequiredCore;function requireCore(){return hasRequiredCore||(hasRequiredCore=1,function(n){var r=function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(n,"__esModule",{value:!0}),n.Clip=n.Animation=void 0;var a=requireAnimation(),i=r(a),o=requireClip(),s=r(o);n.default={Animation:i.default,Clip:s.default},n.Animation=i.default,n.Clip=s.default}(core)),core}var color$2={},color$1={},colorhelper={},csscolorparser={},hasRequiredCsscolorparser;function requireCsscolorparser(){var n=function(c){return c=Math.round(c),c<0?0:c>255?255:c},r=function(c){return c<0?0:c>1?1:c},a=function(c){return c[c.length-1]==="%"?n(parseFloat(c)/100*255):n(parseInt(c))},i=function(c){return c[c.length-1]==="%"?r(parseFloat(c)/100):r(parseFloat(c))},o=function(c,f,h){return h<0?h+=1:h>1&&(h-=1),h*6<1?c+(f-c)*h*6:h*2<1?f:h*3<2?c+(f-c)*(.6666666666666666-h)*6:c},s=function(c){var f=c.replace(/ /g,"").toLowerCase();if(f in l)return l[f].slice();if(f[0]==="#"){if(f.length===4){var h=parseInt(f.substr(1),16);return h>=0&&h<=4095?[(h&3840)>>4|(h&3840)>>8,h&240|(h&240)>>4,h&15|(h&15)<<4,1]:null}else if(f.length===7){var h=parseInt(f.substr(1),16);return h>=0&&h<=16777215?[(h&16711680)>>16,(h&65280)>>8,h&255,1]:null}return null}var p=f.indexOf("("),d=f.indexOf(")");if(p!==-1&&d+1===f.length){var v=f.substr(0,p),_=f.substr(p+1,d-(p+1)).split(","),m=1;switch(v){case"rgba":if(_.length!==4)return null;m=i(_.pop());case"rgb":return _.length!==3?null:[a(_[0]),a(_[1]),a(_[2]),m];case"hsla":if(_.length!==4)return null;m=i(_.pop());case"hsl":if(_.length!==3)return null;var y=(parseFloat(_[0])%360+360)%360/360,g=i(_[1]),C=i(_[2]),b=C<=.5?C*(g+1):C+g-C*g,k=C*2-b;return[n(o(k,b,y+.3333333333333333)*255),n(o(k,b,y)*255),n(o(k,b,y-.3333333333333333)*255),m];default:return null}}return null};if(hasRequiredCsscolorparser)return csscolorparser;hasRequiredCsscolorparser=1;var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};try{csscolorparser.parseCSSColor=s}catch(u){}return csscolorparser}var hasRequiredColorhelper;function requireColorhelper(){return hasRequiredColorhelper||(hasRequiredColorhelper=1,function(n){var r=function(h){return h&&h.__esModule?h:{default:h}},a=function(h){return h=Math.round(h),h<0?0:h>255?255:h},i=function(h){return h<0?0:h>1?1:h};Object.defineProperty(n,"__esModule",{value:!0});var o=function(){var f=function(p,d){var v=[],_=!0,m=!1,y=void 0;try{for(var g=p[Symbol.iterator](),C;!(_=(C=g.next()).done)&&(v.push(C.value),!(d&&v.length===d));_=!0);}catch(b){m=!0,y=b}finally{try{!_&&g.return&&g.return()}finally{if(m)throw y}}return v};return function(h,p){if(Array.isArray(h))return h;if(Symbol.iterator in Object(h))return f(h,p);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=requireCsscolorparser(),l=r(s),u=l.default.parseCSSColor,c={isColor:function(h){if(typeof h=="string")return!!(0,l.default)(h);if(Array.isArray(h)){for(var p=0,d=h.length;p<d;){var v=h[p++];if(typeof v=="string"){if(!u(v))return!1}else return!1}return!0}return!1},toColorIncrease:function(h){return[h[0]||0,h[1]||0,h[2]||0,h[3]||0]},toNormal:function(h){if(Array.isArray(h)){for(var p=[],d=0,v=h.length;d<v;){var _=h[d++];if(typeof _=="string"){var m=u(_);if(m)p.push(m);else return null}else return null}return p}else return typeof h=="string"?u(h):null},toNormalArray:function(h){if(Array.isArray(h)){for(var p=[],d=0,v=h.length;d<v;){var _=h[d++];if(typeof _=="string"){var m=u(_);if(m)p.push(m);else return null}else return null}return p}else return typeof h=="string"?[u(h)]:null},linearGradient:function(h){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:c.Utils.Linear,v=h.length-1,_=v*p,m=_>>0,y=d,g=function(F,W,j){var Y=o(F,4),N=Y[0],$=Y[1],w=Y[2],E=Y[3],A=o(W,4),R=A[0],O=A[1],P=A[2],T=A[3],M=[y(N,R,j)>>0,y($,O,j)>>0,y(w,P,j)>>0,y(E,T,j)];return M},C=h[m],b=h[m+1>v?v:m+1],k=_-m;return g(C,b,k)},mixColors:function(h,p){var d=this.toNormal(h);if(Array.isArray(p)&&d){var v=[a(d[0]+p[0]||0),a(d[1]+p[1]||0),a(d[2]+p[2]||0),i(d[3]+p[3]||0)],_=v[0],m=v[1],y=v[2],g=v[3],C=[_,m,y,g].join(",");return"rgba("+C+")"}else return h},toRGBA:function(h){if(h&&h.length>=3){var p=typeof h[3]=="undefined"?1:h[3],d=a(h[0]),v=a(h[1]),_=a(h[2]),m=i(p);return"rgba("+d+","+v+","+_+","+m+")"}else return"transparent"},Utils:{Linear:function(h,p,d){return(p-h)*d+h}}};n.default=c}(colorhelper)),colorhelper}var hasRequiredColor$1;function requireColor$1(){return hasRequiredColor$1||(hasRequiredColor$1=1,function(n){var r=function(c){return c&&c.__esModule?c:{default:c}};Object.defineProperty(n,"__esModule",{value:!0});var a=requireClip(),i=r(a),o=requireColorhelper(),s=r(o),l={type:"color",test:function(c,f){return s.default.isColor(c)},parse:function(c,f){return s.default.toNormalArray(c)},valueOf:function(c,f,h,p){var d=s.default.linearGradient(c,f);return d=s.default.toRGBA(d),d}};i.default.registerPlugin(l),n.default=l}(color$1)),color$1}var hasRequiredColor;function requireColor(){return hasRequiredColor||(hasRequiredColor=1,requireColor$1()),color$2}var coordinate2d$1={},coordinate2d={},vector={},hasRequiredVector;function requireVector(){return hasRequiredVector||(hasRequiredVector=1,function(n){Object.defineProperty(n,"__esModule",{value:!0});var r=typeof Float32Array=="undefined"?Array:Float32Array,a={create:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,l=new r(2);return l[0]=o,l[1]=s,l},copy:function(o,s){return o[0]=s[0],o[1]=s[1],o},clone:function(o){var s=new r(2);return s[0]=o[0],s[1]=o[1],s},set:function(o,s,l){return o[0]=s,o[1]=l,o},add:function(o,s,l){return o[0]=s[0]+l[0],o[1]=s[1]+l[1],o},scaleAndAdd:function(o,s,l,u){return o[0]=s[0]+l[0]*u,o[1]=s[1]+l[1]*u,o},sub:function(o,s,l){return o[0]=s[0]-l[0],o[1]=s[1]-l[1],o},length:function(o){return Math.sqrt(this.lengthSquare(o))},lengthSquare:function(o){return o[0]*o[0]+o[1]*o[1]},multiply:function(o,s,l){return o[0]=s[0]*l[0],o[1]=s[1]*l[1],o},divide:function(o,s,l){return o[0]=s[0]/l[0],o[1]=s[1]/l[1],o},dot:function(o,s){return o[0]*s[0]+o[1]*s[1]},scale:function(o,s,l){return o[0]=s[0]*l,o[1]=s[1]*l,o},normalize:function(o,s){var l=this.len(s);return l===0?(o[0]=0,o[1]=0):(o[0]=s[0]/l,o[1]=s[1]/l),o},distance:function(o,s){return Math.sqrt(this.distanceSquare(o,s))},distanceSquare:function(o,s){return(o[0]-s[0])*(o[0]-s[0])+(o[1]-s[1])*(o[1]-s[1])},negate:function(o,s){return o[0]=-s[0],o[1]=-s[1],o},lerp:function(o,s,l,u){return o[0]=s[0]+u*(l[0]-s[0]),o[1]=s[1]+u*(l[1]-s[1]),o},applyTransform:function(o,s,l){var u=s[0],c=s[1];return o[0]=l[0]*u+l[2]*c+l[4],o[1]=l[1]*u+l[3]*c+l[5],o},min:function(o,s,l){return o[0]=Math.min(s[0],l[0]),o[1]=Math.min(s[1],l[1]),o},max:function(o,s,l){return o[0]=Math.max(s[0],l[0]),o[1]=Math.max(s[1],l[1]),o},getAngle:function(o,s){var l=0,u=o[0]-s[0];return u!=0&&(l=Math.atan2(o[1]-s[1],o[0]-s[0])),l}};a.len=a.length,a.lenSquare=a.lengthSquare,a.dist=a.distance,a.distSquare=a.distanceSquare,n.default=a}(vector)),vector}var hasRequiredCoordinate2d$1;function requireCoordinate2d$1(){return hasRequiredCoordinate2d$1||(hasRequiredCoordinate2d$1=1,function(n){var r=function(h){return h&&h.__esModule?h:{default:h}},a=function(h){for(var p=0,d=h.length,v=0,_=[],m=[],y=0;p<d-1;){var g=h[p],C=h[p+1],b=u.default.distance(g,C);v+=b,y=u.default.getAngle(C,g),_.push(g),m.push({length:v,segmentLength:b,segment:[g.slice(),C.slice()],path:_.slice(),angle:y}),p++}return m.sum=v,m};Object.defineProperty(n,"__esModule",{value:!0});var i=function(){var f=function(p,d){var v=[],_=!0,m=!1,y=void 0;try{for(var g=p[Symbol.iterator](),C;!(_=(C=g.next()).done)&&(v.push(C.value),!(d&&v.length===d));_=!0);}catch(b){m=!0,y=b}finally{try{!_&&g.return&&g.return()}finally{if(m)throw y}}return v};return function(h,p){if(Array.isArray(h))return h;if(Symbol.iterator in Object(h))return f(h,p);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=requireClip(),s=r(o),l=requireVector(),u=r(l),c={type:"coordinate-2d",test:function(h,p){var d=!1;if(Array.isArray(h))for(var v=-1,_=h.length;++v<_;){var m=h[v];if(Array.isArray(m)){var y=i(m,2),g=y[0],C=y[1],b=[+g,+C];g=b[0],C=b[1],d=typeof g=="number"&&typeof C=="number"&&isFinite(g)&&isFinite(C)}}return d},parse:function(h,p){for(var d=[],v=-1,_=h.length;++v<_;){var m=h[v],y=i(m,2),g=y[0],C=y[1],b=[+g,+C];g=b[0],C=b[1],d.push([g,C])}var k=a(d);return k},valueOf:function(h,p,d,v){for(var _=h.sum,m=_*p,y=-1,g=h.length,C=h[0];++y<g;){var b=h[y];if(m<=b.length){C=b;break}}var k=i(C.segment,2),L=k[0],F=k[1],W=0;y==0?W=m:W=m-h[y-1].length;var j=W/C.segmentLength,Y=u.default.create(),N=u.default.create();return u.default.sub(Y,F,L),u.default.scaleAndAdd(N,L,Y,j),N.step=C,N}};s.default.registerPlugin(c),n.default=c}(coordinate2d)),coordinate2d}var hasRequiredCoordinate2d;function requireCoordinate2d(){return hasRequiredCoordinate2d||(hasRequiredCoordinate2d=1,requireCoordinate2d$1()),coordinate2d$1}var hasRequiredChito;function requireChito(){return hasRequiredChito||(hasRequiredChito=1,function(n){var r=requireCore(),a=r.Animation,i=r.Clip;requireColor(),requireCoordinate2d(),n.exports.default={Animation:a,Clip:i},n.exports.Animation=a,n.exports.Clip=i}(chito)),chito.exports}var bezier$1={};function _array_like_to_array$1(n,r){(r==null||r>n.length)&&(r=n.length);for(var a=0,i=new Array(r);a<r;a++)i[a]=n[a];return i}function _array_without_holes$1(n){if(Array.isArray(n))return _array_like_to_array$1(n)}function _class_call_check$1(n,r){if(!(n instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1(n,r){for(var a=0;a<r.length;a++){var i=r[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}function _create_class$1(n,r,a){return r&&_defineProperties$1(n.prototype,r),a&&_defineProperties$1(n,a),n}function _instanceof$3(n,r){return r!=null&&typeof Symbol!="undefined"&&r[Symbol.hasInstance]?!!r[Symbol.hasInstance](n):n instanceof r}function _iterable_to_array$1(n){if(typeof Symbol!="undefined"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function _non_iterable_spread$1(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _to_consumable_array$1(n){return _array_without_holes$1(n)||_iterable_to_array$1(n)||_unsupported_iterable_to_array$1(n)||_non_iterable_spread$1()}function _unsupported_iterable_to_array$1(n,r){if(!!n){if(typeof n=="string")return _array_like_to_array$1(n,r);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(a);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _array_like_to_array$1(n,r)}}var hasRequiredBezier;function requireBezier(){var n=function($){return $<0?-u(-$,.3333333333333333):u($,.3333333333333333)};if(hasRequiredBezier)return bezier$1;hasRequiredBezier=1,Object.defineProperty(bezier$1,"__esModule",{value:!0}),bezier$1.Bezier=void 0;var r=Math.abs,a=Math.cos,i=Math.sin,o=Math.acos,s=Math.atan2,l=Math.sqrt,u=Math.pow,c=Math.PI,f=2*c,h=c/2,p=1e-6,d=Number.MAX_SAFE_INTEGER||9007199254740991,v=Number.MIN_SAFE_INTEGER||-9007199254740991,_={x:0,y:0,z:0},m={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function($,w){var E=w($),A=E.x*E.x+E.y*E.y;return typeof E.z!="undefined"&&(A+=E.z*E.z),l(A)},compute:function($,w,E){if($===0)return w[0].t=0,w[0];var A=w.length-1;if($===1)return w[A].t=1,w[A];var R=1-$,O=w;if(A===0)return w[0].t=$,w[0];if(A===1){var P={x:R*O[0].x+$*O[1].x,y:R*O[0].y+$*O[1].y,t:$};return E&&(P.z=R*O[0].z+$*O[1].z),P}if(A<4){var T=R*R,M=$*$,U,Q,K,te=0;A===2?(O=[O[0],O[1],O[2],_],U=T,Q=R*$*2,K=M):A===3&&(U=T*R,Q=T*$*3,K=R*M*3,te=$*M);var ve={x:U*O[0].x+Q*O[1].x+K*O[2].x+te*O[3].x,y:U*O[0].y+Q*O[1].y+K*O[2].y+te*O[3].y,t:$};return E&&(ve.z=U*O[0].z+Q*O[1].z+K*O[2].z+te*O[3].z),ve}for(var de=JSON.parse(JSON.stringify(w));de.length>1;){for(var be=0;be<de.length-1;be++)de[be]={x:de[be].x+(de[be+1].x-de[be].x)*$,y:de[be].y+(de[be+1].y-de[be].y)*$},typeof de[be].z!="undefined"&&(de[be]=de[be].z+(de[be+1].z-de[be].z)*$);de.splice(de.length-1,1)}return de[0].t=$,de[0]},computeWithRatios:function($,w,E,A){var R=1-$,O=E,P=w,T=O[0],M=O[1],U=O[2],Q=O[3],K;if(T*=R,M*=$,P.length===2)return K=T+M,{x:(T*P[0].x+M*P[1].x)/K,y:(T*P[0].y+M*P[1].y)/K,z:A?(T*P[0].z+M*P[1].z)/K:!1,t:$};if(T*=R,M*=2*R,U*=$*$,P.length===3)return K=T+M+U,{x:(T*P[0].x+M*P[1].x+U*P[2].x)/K,y:(T*P[0].y+M*P[1].y+U*P[2].y)/K,z:A?(T*P[0].z+M*P[1].z+U*P[2].z)/K:!1,t:$};if(T*=R,M*=1.5*R,U*=3*R,Q*=$*$*$,P.length===4)return K=T+M+U+Q,{x:(T*P[0].x+M*P[1].x+U*P[2].x+Q*P[3].x)/K,y:(T*P[0].y+M*P[1].y+U*P[2].y+Q*P[3].y)/K,z:A?(T*P[0].z+M*P[1].z+U*P[2].z+Q*P[3].z)/K:!1,t:$}},derive:function($,w){for(var E=[],A=$,R=A.length,O=R-1;R>1;R--,O--){for(var P=[],T=0,M=void 0;T<O;T++)M={x:O*(A[T+1].x-A[T].x),y:O*(A[T+1].y-A[T].y)},w&&(M.z=O*(A[T+1].z-A[T].z)),P.push(M);E.push(P),A=P}return E},between:function($,w,E){return w<=$&&$<=E||m.approximately($,w)||m.approximately($,E)},approximately:function($,w,E){return r($-w)<=(E||p)},length:function($){for(var w=.5,E=m.Tvalues.length,A=0,R=0,O;R<E;R++)O=w*m.Tvalues[R]+w,A+=m.Cvalues[R]*m.arcfn(O,$);return w*A},map:function($,w,E,A,R){var O=E-w,P=R-A,T=$-w,M=T/O;return A+P*M},lerp:function($,w,E){var A={x:w.x+$*(E.x-w.x),y:w.y+$*(E.y-w.y)};return!!w.z&&!!E.z&&(A.z=w.z+$*(E.z-w.z)),A},pointToString:function($){var w=$.x+"/"+$.y;return typeof $.z!="undefined"&&(w+="/"+$.z),w},pointsToString:function($){return"["+$.map(m.pointToString).join(", ")+"]"},copy:function($){return JSON.parse(JSON.stringify($))},angle:function($,w,E){var A=w.x-$.x,R=w.y-$.y,O=E.x-$.x,P=E.y-$.y,T=A*P-R*O,M=A*O+R*P;return s(T,M)},round:function($,w){var E=""+$,A=E.indexOf(".");return parseFloat(E.substring(0,A+1+w))},dist:function($,w){var E=$.x-w.x,A=$.y-w.y;return l(E*E+A*A)},closest:function($,w){var E=u(2,63),A,R;return $.forEach(function(O,P){R=m.dist(w,O),R<E&&(E=R,A=P)}),{mdist:E,mpos:A}},abcratio:function($,w){if(w!==2&&w!==3)return!1;if(typeof $=="undefined")$=.5;else if($===0||$===1)return $;var E=u($,w)+u(1-$,w),A=E-1;return r(A/E)},projectionratio:function($,w){if(w!==2&&w!==3)return!1;if(typeof $=="undefined")$=.5;else if($===0||$===1)return $;var E=u(1-$,w),A=u($,w)+E;return E/A},lli8:function($,w,E,A,R,O,P,T){var M=($*A-w*E)*(R-P)-($-E)*(R*T-O*P),U=($*A-w*E)*(O-T)-(w-A)*(R*T-O*P),Q=($-E)*(O-T)-(w-A)*(R-P);return Q==0?!1:{x:M/Q,y:U/Q}},lli4:function($,w,E,A){var R=$.x,O=$.y,P=w.x,T=w.y,M=E.x,U=E.y,Q=A.x,K=A.y;return m.lli8(R,O,P,T,M,U,Q,K)},lli:function($,w){return m.lli4($,$.c,w,w.c)},makeline:function($,w){var E=$.x,A=$.y,R=w.x,O=w.y,P=(R-E)/3,T=(O-A)/3;return new Y(E,A,E+P,A+T,E+2*P,A+2*T,R,O)},findbbox:function($){var w=d,E=d,A=v,R=v;return $.forEach(function(O){var P=O.bbox();w>P.x.min&&(w=P.x.min),E>P.y.min&&(E=P.y.min),A<P.x.max&&(A=P.x.max),R<P.y.max&&(R=P.y.max)}),{x:{min:w,mid:(w+A)/2,max:A,size:A-w},y:{min:E,mid:(E+R)/2,max:R,size:R-E}}},shapeintersections:function($,w,E,A,R){if(!m.bboxoverlap(w,A))return[];var O=[],P=[$.startcap,$.forward,$.back,$.endcap],T=[E.startcap,E.forward,E.back,E.endcap];return P.forEach(function(M){M.virtual||T.forEach(function(U){if(!U.virtual){var Q=M.intersects(U,R);Q.length>0&&(Q.c1=M,Q.c2=U,Q.s1=$,Q.s2=E,O.push(Q))}})}),O},makeshape:function($,w,E){var A=w.points.length,R=$.points.length,O=m.makeline(w.points[A-1],$.points[0]),P=m.makeline($.points[R-1],w.points[0]),T={startcap:O,forward:$,back:w,endcap:P,bbox:m.findbbox([O,$,w,P])};return T.intersections=function(M){return m.shapeintersections(T,T.bbox,M,M.bbox,E)},T},getminmax:function($,w,E){if(!E)return{min:0,max:0};var A=d,R=v,O,P;E.indexOf(0)===-1&&(E=[0].concat(E)),E.indexOf(1)===-1&&E.push(1);for(var T=0,M=E.length;T<M;T++)O=E[T],P=$.get(O),P[w]<A&&(A=P[w]),P[w]>R&&(R=P[w]);return{min:A,mid:(A+R)/2,max:R,size:R-A}},align:function($,w){var E=w.p1.x,A=w.p1.y,R=-s(w.p2.y-A,w.p2.x-E),O=function(T){return{x:(T.x-E)*a(R)-(T.y-A)*i(R),y:(T.x-E)*i(R)+(T.y-A)*a(R)}};return $.map(O)},roots:function($,w){w=w||{p1:{x:0,y:0},p2:{x:1,y:0}};var E=$.length-1,A=m.align($,w),R=function(Vt){return 0<=Vt&&Vt<=1};if(E===2){var O=A[0].y,P=A[1].y,T=A[2].y,M=O-2*P+T;if(M!==0){var U=-l(P*P-O*T),Q=-O+P,K=-(U+Q)/M,te=-(-U+Q)/M;return[K,te].filter(R)}else if(P!==T&&M===0)return[(2*P-T)/(2*P-2*T)].filter(R);return[]}var ve=A[0].y,de=A[1].y,be=A[2].y,et=A[3].y,qe=-ve+3*de-3*be+et,Ne=3*ve-6*de+3*be,Ge=-3*ve+3*de,ft=ve;if(m.approximately(qe,0)){if(m.approximately(Ne,0))return m.approximately(Ge,0)?[]:[-ft/Ge].filter(R);var Ze=l(Ge*Ge-4*Ne*ft),pt=2*Ne;return[(Ze-Ge)/pt,(-Ge-Ze)/pt].filter(R)}Ne/=qe,Ge/=qe,ft/=qe;var dt=(3*Ge-Ne*Ne)/3,Ot=dt/3,mt=(2*Ne*Ne*Ne-9*Ne*Ge+27*ft)/27,at=mt/2,St=at*at+Ot*Ot*Ot,Tt,Dt,Lt,Rt,It;if(St<0){var Bt=-dt/3,Ft=Bt*Bt*Bt,ot=l(Ft),bt=-mt/(2*ot),rt=bt<-1?-1:bt>1?1:bt,Pt=o(rt),st=n(ot),$t=2*st;return Lt=$t*a(Pt/3)-Ne/3,Rt=$t*a((Pt+f)/3)-Ne/3,It=$t*a((Pt+2*f)/3)-Ne/3,[Lt,Rt,It].filter(R)}else{if(St===0)return Tt=at<0?n(-at):-n(at),Lt=2*Tt-Ne/3,Rt=-Tt-Ne/3,[Lt,Rt].filter(R);var _t=l(St);return Tt=n(-at+_t),Dt=n(at+_t),[Tt-Dt-Ne/3].filter(R)}},droots:function($){if($.length===3){var w=$[0],E=$[1],A=$[2],R=w-2*E+A;if(R!==0){var O=-l(E*E-w*A),P=-w+E,T=-(O+P)/R,M=-(-O+P)/R;return[T,M]}else if(E!==A&&R===0)return[(2*E-A)/(2*(E-A))];return[]}if($.length===2){var U=$[0],Q=$[1];return U!==Q?[U/(U-Q)]:[]}return[]},curvature:function($,w,E,A,R){var O,P,T,M,U=0,Q=0,K=m.compute($,w),te=m.compute($,E),ve=K.x*K.x+K.y*K.y;if(A?(O=l(u(K.y*te.z-te.y*K.z,2)+u(K.z*te.x-te.z*K.x,2)+u(K.x*te.y-te.x*K.y,2)),P=u(ve+K.z*K.z,3/2)):(O=K.x*te.y-K.y*te.x,P=u(ve,3/2)),O===0||P===0)return{k:0,r:0};if(U=O/P,Q=P/O,!R){var de=m.curvature($-.001,w,E,A,!0).k,be=m.curvature($+.001,w,E,A,!0).k;M=(be-U+(U-de))/2,T=(r(be-U)+r(U-de))/2}return{k:U,r:Q,dk:M,adk:T}},inflections:function($){if($.length<4)return[];var w=m.align($,{p1:$[0],p2:$.slice(-1)[0]}),E=w[2].x*w[1].y,A=w[3].x*w[1].y,R=w[1].x*w[2].y,O=w[3].x*w[2].y,P=18*(-3*E+2*A+3*R-O),T=18*(3*E-A-3*R),M=18*(R-E);if(m.approximately(P,0)){if(!m.approximately(T,0)){var U=-M/T;if(0<=U&&U<=1)return[U]}return[]}var Q=T*T-4*P*M,K=Math.sqrt(Q),te=2*P;return m.approximately(te,0)?[]:[(K-T)/te,-(T+K)/te].filter(function(ve){return 0<=ve&&ve<=1})},bboxoverlap:function($,w){for(var E=["x","y"],A=E.length,R=0,O,P,T,M;R<A;R++)if(O=E[R],P=$[O].mid,T=w[O].mid,M=($[O].size+w[O].size)/2,r(P-T)>=M)return!1;return!0},expandbox:function($,w){w.x.min<$.x.min&&($.x.min=w.x.min),w.y.min<$.y.min&&($.y.min=w.y.min),w.z&&w.z.min<$.z.min&&($.z.min=w.z.min),w.x.max>$.x.max&&($.x.max=w.x.max),w.y.max>$.y.max&&($.y.max=w.y.max),w.z&&w.z.max>$.z.max&&($.z.max=w.z.max),$.x.mid=($.x.min+$.x.max)/2,$.y.mid=($.y.min+$.y.max)/2,$.z&&($.z.mid=($.z.min+$.z.max)/2),$.x.size=$.x.max-$.x.min,$.y.size=$.y.max-$.y.min,$.z&&($.z.size=$.z.max-$.z.min)},pairiteration:function($,w,E){var A=$.bbox(),R=w.bbox(),O=1e5,P=E||.5;if(A.x.size+A.y.size<P&&R.x.size+R.y.size<P)return[(O*($._t1+$._t2)/2|0)/O+"/"+(O*(w._t1+w._t2)/2|0)/O];var T=$.split(.5),M=w.split(.5),U=[{left:T.left,right:M.left},{left:T.left,right:M.right},{left:T.right,right:M.right},{left:T.right,right:M.left}];U=U.filter(function(K){return m.bboxoverlap(K.left.bbox(),K.right.bbox())});var Q=[];return U.length===0||(U.forEach(function(K){Q=Q.concat(m.pairiteration(K.left,K.right,P))}),Q=Q.filter(function(K,te){return Q.indexOf(K)===te})),Q},getccenter:function($,w,E){var A=w.x-$.x,R=w.y-$.y,O=E.x-w.x,P=E.y-w.y,T=A*a(h)-R*i(h),M=A*i(h)+R*a(h),U=O*a(h)-P*i(h),Q=O*i(h)+P*a(h),K=($.x+w.x)/2,te=($.y+w.y)/2,ve=(w.x+E.x)/2,de=(w.y+E.y)/2,be=K+T,et=te+M,qe=ve+U,Ne=de+Q,Ge=m.lli8(K,te,be,et,ve,de,qe,Ne),ft=m.dist(Ge,$),Ze=s($.y-Ge.y,$.x-Ge.x),pt=s(w.y-Ge.y,w.x-Ge.x),dt=s(E.y-Ge.y,E.x-Ge.x),Ot;return Ze<dt?((Ze>pt||pt>dt)&&(Ze+=f),Ze>dt&&(Ot=dt,dt=Ze,Ze=Ot)):dt<pt&&pt<Ze?(Ot=dt,dt=Ze,Ze=Ot):dt+=f,Ge.s=Ze,Ge.e=dt,Ge.r=ft,Ge},numberSort:function($,w){return $-w}},y=function(){function N($){_class_call_check$1(this,N),this.curves=[],this._3d=!1,$&&(this.curves=$,this._3d=this.curves[0]._3d)}return _create_class$1(N,[{key:"valueOf",value:function(){return this.toString()}},{key:"toString",value:function(){return"["+this.curves.map(function(w){return m.pointsToString(w.points)}).join(", ")+"]"}},{key:"addCurve",value:function(w){this.curves.push(w),this._3d=this._3d||w._3d}},{key:"length",value:function(){return this.curves.map(function(w){return w.length()}).reduce(function(w,E){return w+E})}},{key:"curve",value:function(w){return this.curves[w]}},{key:"bbox",value:function(){for(var w=this.curves,E=w[0].bbox(),A=1;A<w.length;A++)m.expandbox(E,w[A].bbox());return E}},{key:"offset",value:function(w){var E=[];return this.curves.forEach(function(A){var R;(R=E).push.apply(R,_to_consumable_array$1(A.offset(w)))}),new N(E)}}]),N}(),g=Math.abs,C=Math.min,b=Math.max,k=Math.cos,L=Math.sin,F=Math.acos,W=Math.sqrt,j=Math.PI,Y=function(){function N($){_class_call_check$1(this,N);var w=$&&$.forEach?$:Array.from(arguments).slice(),E=!1;if(typeof w[0]=="object"){E=w.length;var A=[];w.forEach(function(de){["x","y","z"].forEach(function(be){typeof de[be]!="undefined"&&A.push(de[be])})}),w=A}var R=!1,O=w.length;if(E){if(E>4){if(arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");R=!0}}else if(O!==6&&O!==8&&O!==9&&O!==12&&arguments.length!==1)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");for(var P=this._3d=!R&&(O===9||O===12)||$&&$[0]&&typeof $[0].z!="undefined",T=this.points=[],M=0,U=P?3:2;M<O;M+=U){var Q={x:w[M],y:w[M+1]};P&&(Q.z=w[M+2]),T.push(Q)}var K=this.order=T.length-1,te=this.dims=["x","y"];P&&te.push("z"),this.dimlen=te.length;var ve=m.align(T,{p1:T[0],p2:T[K]});this._linear=!ve.some(function(de){return g(de.y)>1e-4}),this._lut=[],this._t1=0,this._t2=1,this.update()}return _create_class$1(N,[{key:"getUtils",value:function(){return N.getUtils()}},{key:"valueOf",value:function(){return this.toString()}},{key:"toString",value:function(){return m.pointsToString(this.points)}},{key:"toSVG",value:function(){if(this._3d)return!1;for(var w=this.points,E=w[0].x,A=w[0].y,R=["M",E,A,this.order===2?"Q":"C"],O=1,P=w.length;O<P;O++)R.push(w[O].x),R.push(w[O].y);return R.join(" ")}},{key:"setRatios",value:function(w){if(w.length!==this.points.length)throw new Error("incorrect number of ratio values");this.ratios=w,this._lut=[]}},{key:"verify",value:function(){var w=this.coordDigest();w!==this._print&&(this._print=w,this.update())}},{key:"coordDigest",value:function(){return this.points.map(function(w,E){return""+E+w.x+w.y+(w.z?w.z:0)}).join("")}},{key:"update",value:function(){this._lut=[],this.dpoints=m.derive(this.points,this._3d),this.computedirection()}},{key:"computedirection",value:function(){var w=this.points,E=m.angle(w[0],w[this.order],w[1]);this.clockwise=E>0}},{key:"length",value:function(){return m.length(this.derivative.bind(this))}},{key:"getABC",value:function(w,E){E=E||this.get(w);var A=this.points[0],R=this.points[this.order];return N.getABC(this.order,A,E,R,w)}},{key:"getLUT",value:function(w){if(this.verify(),w=w||100,this._lut.length===w)return this._lut;this._lut=[],w--;for(var E=0,A,R;E<w;E++)R=E/(w-1),A=this.compute(R),A.t=R,this._lut.push(A);return this._lut}},{key:"on",value:function(w,E){E=E||5;for(var A=this.getLUT(),R=[],O=0,P,T=0;O<A.length;O++)P=A[O],m.dist(P,w)<E&&(R.push(P),T+=O/A.length);return R.length?t/=R.length:!1}},{key:"project",value:function(w){var E=this.getLUT(),A=E.length-1,R=m.closest(E,w),O=R.mpos,P=(O-1)/A,T=(O+1)/A,M=.1/A,U=R.mdist,Q=P,K=Q,te;U+=1;for(var ve;Q<T+M;Q+=M)te=this.compute(Q),ve=m.dist(w,te),ve<U&&(U=ve,K=Q);return K=K<0?0:K>1?1:K,te=this.compute(K),te.t=K,te.d=U,te}},{key:"get",value:function(w){return this.compute(w)}},{key:"point",value:function(w){return this.points[w]}},{key:"compute",value:function(w){return this.ratios?m.computeWithRatios(w,this.points,this.ratios,this._3d):m.compute(w,this.points,this._3d,this.ratios)}},{key:"raise",value:function(){for(var w=this.points,E=[w[0]],A=w.length,R=1,O,P;R<A;R++)O=w[R],P=w[R-1],E[R]={x:(A-R)/A*O.x+R/A*P.x,y:(A-R)/A*O.y+R/A*P.y};return E[A]=w[A-1],new N(E)}},{key:"derivative",value:function(w){return m.compute(w,this.dpoints[0])}},{key:"dderivative",value:function(w){return m.compute(w,this.dpoints[1])}},{key:"align",value:function(){var w=this.points;return new N(m.align(w,{p1:w[0],p2:w[w.length-1]}))}},{key:"curvature",value:function(w){return m.curvature(w,this.dpoints[0],this.dpoints[1],this._3d)}},{key:"inflections",value:function(){return m.inflections(this.points)}},{key:"normal",value:function(w){return this._3d?this.__normal3(w):this.__normal2(w)}},{key:"__normal2",value:function(w){var E=this.derivative(w),A=W(E.x*E.x+E.y*E.y);return{x:-E.y/A,y:E.x/A}}},{key:"__normal3",value:function(w){var E=this.derivative(w),A=this.derivative(w+.01),R=W(E.x*E.x+E.y*E.y+E.z*E.z),O=W(A.x*A.x+A.y*A.y+A.z*A.z);E.x/=R,E.y/=R,E.z/=R,A.x/=O,A.y/=O,A.z/=O;var P={x:A.y*E.z-A.z*E.y,y:A.z*E.x-A.x*E.z,z:A.x*E.y-A.y*E.x},T=W(P.x*P.x+P.y*P.y+P.z*P.z);P.x/=T,P.y/=T,P.z/=T;var M=[P.x*P.x,P.x*P.y-P.z,P.x*P.z+P.y,P.x*P.y+P.z,P.y*P.y,P.y*P.z-P.x,P.x*P.z-P.y,P.y*P.z+P.x,P.z*P.z],U={x:M[0]*E.x+M[1]*E.y+M[2]*E.z,y:M[3]*E.x+M[4]*E.y+M[5]*E.z,z:M[6]*E.x+M[7]*E.y+M[8]*E.z};return U}},{key:"hull",value:function(w){var E=this.points,A=[],R=[],O=0;for(R[O++]=E[0],R[O++]=E[1],R[O++]=E[2],this.order===3&&(R[O++]=E[3]);E.length>1;){A=[];for(var P=0,T=void 0,M=E.length-1;P<M;P++)T=m.lerp(w,E[P],E[P+1]),R[O++]=T,A.push(T);E=A}return R}},{key:"split",value:function(w,E){if(w===0&&!!E)return this.split(E).left;if(E===1)return this.split(w).right;var A=this.hull(w),R={left:this.order===2?new N([A[0],A[3],A[5]]):new N([A[0],A[4],A[7],A[9]]),right:this.order===2?new N([A[5],A[4],A[2]]):new N([A[9],A[8],A[6],A[3]]),span:A};return R.left._t1=m.map(0,0,1,this._t1,this._t2),R.left._t2=m.map(w,0,1,this._t1,this._t2),R.right._t1=m.map(w,0,1,this._t1,this._t2),R.right._t2=m.map(1,0,1,this._t1,this._t2),E?(E=m.map(E,w,1,0,1),R.right.split(E).left):R}},{key:"extrema",value:function(){var w={},E=[];return this.dims.forEach(function(A){var R=function(T){return T[A]},O=this.dpoints[0].map(R);w[A]=m.droots(O),this.order===3&&(O=this.dpoints[1].map(R),w[A]=w[A].concat(m.droots(O))),w[A]=w[A].filter(function(P){return P>=0&&P<=1}),E=E.concat(w[A].sort(m.numberSort))}.bind(this)),w.values=E.sort(m.numberSort).filter(function(A,R){return E.indexOf(A)===R}),w}},{key:"bbox",value:function(){var w=this.extrema(),E={};return this.dims.forEach(function(A){E[A]=m.getminmax(this,A,w[A])}.bind(this)),E}},{key:"overlaps",value:function(w){var E=this.bbox(),A=w.bbox();return m.bboxoverlap(E,A)}},{key:"offset",value:function(w,E){if(typeof E!="undefined"){var A=this.get(w),R=this.normal(w),O={c:A,n:R,x:A.x+R.x*E,y:A.y+R.y*E};return this._3d&&(O.z=A.z+R.z*E),O}if(this._linear){var P=this.normal(0),T=this.points.map(function(M){var U={x:M.x+w*P.x,y:M.y+w*P.y};return M.z&&P.z&&(U.z=M.z+w*P.z),U});return[new N(T)]}return this.reduce().map(function(M){return M._linear?M.offset(w)[0]:M.scale(w)})}},{key:"simple",value:function(){if(this.order===3){var w=m.angle(this.points[0],this.points[3],this.points[1]),E=m.angle(this.points[0],this.points[3],this.points[2]);if(w>0&&E<0||w<0&&E>0)return!1}var A=this.normal(0),R=this.normal(1),O=A.x*R.x+A.y*R.y;return this._3d&&(O+=A.z*R.z),g(F(O))<j/3}},{key:"reduce",value:function(){var w,E=0,A=0,R=.01,O,P=[],T=[],M=this.extrema().values;for(M.indexOf(0)===-1&&(M=[0].concat(M)),M.indexOf(1)===-1&&M.push(1),E=M[0],w=1;w<M.length;w++)A=M[w],O=this.split(E,A),O._t1=E,O._t2=A,P.push(O),E=A;return P.forEach(function(U){for(E=0,A=0;A<=1;)for(A=E+R;A<=1+R;A+=R)if(O=U.split(E,A),!O.simple()){if(A-=R,g(E-A)<R)return[];O=U.split(E,A),O._t1=m.map(E,0,1,U._t1,U._t2),O._t2=m.map(A,0,1,U._t1,U._t2),T.push(O),E=A;break}E<1&&(O=U.split(E,1),O._t1=m.map(E,0,1,U._t1,U._t2),O._t2=U._t2,T.push(O))}),T}},{key:"scale",value:function(w){var E=this,A=this.order,R=!1;if(typeof w=="function"&&(R=w),R&&A===2)return this.raise().scale(R);var O=this.clockwise,P=R?R(0):w,T=R?R(1):w,M=[this.offset(0,10),this.offset(1,10)],U=this.points,Q=[],K=m.lli4(M[0],M[0].c,M[1],M[1].c);if(!K)throw new Error("cannot scale this curve. Try reducing it first.");return[0,1].forEach(function(te){var ve=Q[te*A]=m.copy(U[te*A]);ve.x+=(te?T:P)*M[te].n.x,ve.y+=(te?T:P)*M[te].n.y}),R?([0,1].forEach(function(te){if(!(A===2&&!!te)){var ve=U[te+1],de={x:ve.x-K.x,y:ve.y-K.y},be=R?R((te+1)/A):w;R&&!O&&(be=-be);var et=W(de.x*de.x+de.y*de.y);de.x/=et,de.y/=et,Q[te+1]={x:ve.x+be*de.x,y:ve.y+be*de.y}}}),new N(Q)):([0,1].forEach(function(te){if(!(A===2&&!!te)){var ve=Q[te*A],de=E.derivative(te),be={x:ve.x+de.x,y:ve.y+de.y};Q[te+1]=m.lli4(ve,be,K,U[te+1])}}),new N(Q))}},{key:"outline",value:function(w,E,A,R){var O=function(pt,dt,Ot,mt,at){return function(St){var Tt=mt/Ot,Dt=(mt+at)/Ot,Lt=dt-pt;return m.map(St,0,1,pt+Tt*Lt,pt+Dt*Lt)}};E=typeof E=="undefined"?w:E;var P=this.reduce(),T=P.length,M=[],U=[],Q,K=0,te=this.length(),ve=typeof A!="undefined"&&typeof R!="undefined";P.forEach(function(Ze){var pt=Ze.length();ve?(M.push(Ze.scale(O(w,A,te,K,pt))),U.push(Ze.scale(O(-E,-R,te,K,pt)))):(M.push(Ze.scale(w)),U.push(Ze.scale(-E))),K+=pt}),U=U.map(function(Ze){return Q=Ze.points,Q[3]?Ze.points=[Q[3],Q[2],Q[1],Q[0]]:Ze.points=[Q[2],Q[1],Q[0]],Ze}).reverse();var de=M[0].points[0],be=M[T-1].points[M[T-1].points.length-1],et=U[T-1].points[U[T-1].points.length-1],qe=U[0].points[0],Ne=m.makeline(et,de),Ge=m.makeline(be,qe),ft=[Ne].concat(M).concat([Ge]).concat(U);return new y(ft)}},{key:"outlineshapes",value:function(w,E,A){E=E||w;for(var R=this.outline(w,E).curves,O=[],P=1,T=R.length;P<T/2;P++){var M=m.makeshape(R[P],R[T-P],A);M.startcap.virtual=P>1,M.endcap.virtual=P<T/2-1,O.push(M)}return O}},{key:"intersects",value:function(w,E){return w?w.p1&&w.p2?this.lineIntersects(w):(_instanceof$3(w,N)&&(w=w.reduce()),this.curveintersects(this.reduce(),w,E)):this.selfintersects(E)}},{key:"lineIntersects",value:function(w){var E=this,A=C(w.p1.x,w.p2.x),R=C(w.p1.y,w.p2.y),O=b(w.p1.x,w.p2.x),P=b(w.p1.y,w.p2.y);return m.roots(this.points,w).filter(function(T){var M=E.get(T);return m.between(M.x,A,O)&&m.between(M.y,R,P)})}},{key:"selfintersects",value:function(w){for(var E=this.reduce(),A=E.length-2,R=[],O=0,P,T,M;O<A;O++){var U;T=E.slice(O,O+1),M=E.slice(O+2),P=this.curveintersects(T,M,w),(U=R).push.apply(U,_to_consumable_array$1(P))}return R}},{key:"curveintersects",value:function(w,E,A){var R=[];w.forEach(function(P){E.forEach(function(T){P.overlaps(T)&&R.push({left:P,right:T})})});var O=[];return R.forEach(function(P){var T=m.pairiteration(P.left,P.right,A);T.length>0&&(O=O.concat(T))}),O}},{key:"arcs",value:function(w){return w=w||.5,this._iterate(w,[])}},{key:"_error",value:function(w,E,A,R){var O=(R-A)/4,P=this.get(A+O),T=this.get(R-O),M=m.dist(w,E),U=m.dist(w,P),Q=m.dist(w,T);return g(U-M)+g(Q-M)}},{key:"_iterate",value:function(w,E){var A=0,R=1,O;do{O=0,R=1;var P=this.get(A),T=void 0,M=void 0,U=void 0,Q=void 0,K=!1,te=!1,ve=void 0,de=R,be=1;do{te=K,Q=U,de=(A+R)/2,T=this.get(de),M=this.get(R),U=m.getccenter(P,T,M),U.interval={start:A,end:R};var et=this._error(U,P,A,R);if(K=et<=w,ve=te&&!K,ve||(be=R),K){if(R>=1){if(U.interval.end=be=1,Q=U,R>1){var qe={x:U.x+U.r*k(U.e),y:U.y+U.r*L(U.e)};U.e+=m.angle({x:U.x,y:U.y},qe,this.get(1))}break}R=R+(R-A)/2}else R=de}while(!ve&&O++<100);if(O>=100)break;Q=Q||U,E.push(Q),A=be}while(R<1);return E}}],[{key:"quadraticFromPoints",value:function(w,E,A,R){if(typeof R=="undefined"&&(R=.5),R===0)return new N(E,E,A);if(R===1)return new N(w,E,E);var O=N.getABC(2,w,E,A,R);return new N(w,O.A,A)}},{key:"cubicFromPoints",value:function(w,E,A,R,O){typeof R=="undefined"&&(R=.5);var P=N.getABC(3,w,E,A,R);typeof O=="undefined"&&(O=m.dist(E,P.C));var T=O*(1-R)/R,M=m.dist(w,A),U=(A.x-w.x)/M,Q=(A.y-w.y)/M,K=O*U,te=O*Q,ve=T*U,de=T*Q,be={x:E.x-K,y:E.y-te},et={x:E.x+ve,y:E.y+de},qe=P.A,Ne={x:qe.x+(be.x-qe.x)/(1-R),y:qe.y+(be.y-qe.y)/(1-R)},Ge={x:qe.x+(et.x-qe.x)/R,y:qe.y+(et.y-qe.y)/R},ft={x:w.x+(Ne.x-w.x)/R,y:w.y+(Ne.y-w.y)/R},Ze={x:A.x+(Ge.x-A.x)/(1-R),y:A.y+(Ge.y-A.y)/(1-R)};return new N(w,ft,Ze,A)}},{key:"getUtils",value:function(){return m}},{key:"PolyBezier",get:function(){return y}},{key:"getABC",value:function(){var w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2,E=arguments.length>1?arguments[1]:void 0,A=arguments.length>2?arguments[2]:void 0,R=arguments.length>3?arguments[3]:void 0,O=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5,P=m.projectionratio(O,w),T=1-P,M={x:P*E.x+T*R.x,y:P*E.y+T*R.y},U=m.abcratio(O,w),Q={x:A.x+(A.x-M.x)/U,y:A.y+(A.y-M.y)/U};return{A:Q,B:A,C:M,S:E,E:R}}}]),N}();return bezier$1.Bezier=Y,bezier$1}var src,hasRequiredSrc;function requireSrc(){var n=function(y,g){return 1-3*g+3*y},r=function(y,g){return 3*g-6*y},a=function(y){return 3*y},i=function(y,g,C){return((n(g,C)*y+r(g,C))*y+a(g))*y},o=function(y,g,C){return 3*n(g,C)*y*y+2*r(g,C)*y+a(g)},s=function(y,g,C,b,k){var L,F,W=0;do F=g+(C-g)/2,L=i(F,b,k)-y,L>0?C=F:g=F;while(Math.abs(L)>h&&++W<p);return F},l=function(y,g,C,b){for(var k=0;k<c;++k){var L=o(g,C,b);if(L===0)return g;var F=i(g,C,b)-y;g-=F/L}return g},u=function(y){return y};if(hasRequiredSrc)return src;hasRequiredSrc=1;var c=4,f=.001,h=1e-7,p=10,d=11,v=1/(d-1),_=typeof Float32Array=="function";return src=function(y,g,C,b){var k=function(j){for(var Y=0,N=1,$=d-1;N!==$&&L[N]<=j;++N)Y+=v;--N;var w=(j-L[N])/(L[N+1]-L[N]),E=Y+w*v,A=o(E,y,C);return A>=f?l(j,E,y,C):A===0?E:s(j,Y,Y+v,y,C)};if(!(0<=y&&y<=1&&0<=C&&C<=1))throw new Error("bezier x values must be in [0, 1] range");if(y===g&&C===b)return u;for(var L=_?new Float32Array(d):new Array(d),F=0;F<d;++F)L[F]=i(F*v,y,C);return function(j){return j===0?0:j===1?1:i(k(j),g,b)}},src}var earcut={exports:{}},hasRequiredEarcut;function requireEarcut(){var n=function(P,T,M){M=M||2;var U=T&&T.length,Q=U?T[0]*M:P.length,K=r(P,0,Q,M,!0),te=[];if(!K||K.next===K.prev)return te;var ve,de,be,et,qe,Ne,Ge;if(U&&(K=u(P,T,K,M)),P.length>80*M){ve=be=P[0],de=et=P[1];for(var ft=M;ft<Q;ft+=M)qe=P[ft],Ne=P[ft+1],qe<ve&&(ve=qe),Ne<de&&(de=Ne),qe>be&&(be=qe),Ne>et&&(et=Ne);Ge=Math.max(be-ve,et-de),Ge=Ge!==0?32767/Ge:0}return R(K,te,M,ve,de,Ge,0),te},r=function(P,T,M,U,Q){var K,te;if(Q===A(P,T,M,U)>0)for(K=T;K<M;K+=U)te=$(K,P[K],P[K+1],te);else for(K=M-U;K>=T;K-=U)te=$(K,P[K],P[K+1],te);return te&&b(te,te.next)&&(w(te),te=te.next),te},a=function(P,T){if(!P)return P;T||(T=P);var M=P,U;do if(U=!1,!M.steiner&&(b(M,M.next)||C(M.prev,M,M.next)===0)){if(w(M),M=T=M.prev,M===M.next)break;U=!0}else M=M.next;while(U||M!==T);return T},i=function(P){var T=P.prev,M=P,U=P.next;if(C(T,M,U)>=0)return!1;for(var Q=T.x,K=M.x,te=U.x,ve=T.y,de=M.y,be=U.y,et=Q<K?Q<te?Q:te:K<te?K:te,qe=ve<de?ve<be?ve:be:de<be?de:be,Ne=Q>K?Q>te?Q:te:K>te?K:te,Ge=ve>de?ve>be?ve:be:de>be?de:be,ft=U.next;ft!==T;){if(ft.x>=et&&ft.x<=Ne&&ft.y>=qe&&ft.y<=Ge&&y(Q,ve,K,de,te,be,ft.x,ft.y)&&C(ft.prev,ft,ft.next)>=0)return!1;ft=ft.next}return!0},o=function(P,T,M,U){var Q=P.prev,K=P,te=P.next;if(C(Q,K,te)>=0)return!1;for(var ve=Q.x,de=K.x,be=te.x,et=Q.y,qe=K.y,Ne=te.y,Ge=ve<de?ve<be?ve:be:de<be?de:be,ft=et<qe?et<Ne?et:Ne:qe<Ne?qe:Ne,Ze=ve>de?ve>be?ve:be:de>be?de:be,pt=et>qe?et>Ne?et:Ne:qe>Ne?qe:Ne,dt=_(Ge,ft,T,M,U),Ot=_(Ze,pt,T,M,U),mt=P.prevZ,at=P.nextZ;mt&&mt.z>=dt&&at&&at.z<=Ot;){if(mt.x>=Ge&&mt.x<=Ze&&mt.y>=ft&&mt.y<=pt&&mt!==Q&&mt!==te&&y(ve,et,de,qe,be,Ne,mt.x,mt.y)&&C(mt.prev,mt,mt.next)>=0||(mt=mt.prevZ,at.x>=Ge&&at.x<=Ze&&at.y>=ft&&at.y<=pt&&at!==Q&&at!==te&&y(ve,et,de,qe,be,Ne,at.x,at.y)&&C(at.prev,at,at.next)>=0))return!1;at=at.nextZ}for(;mt&&mt.z>=dt;){if(mt.x>=Ge&&mt.x<=Ze&&mt.y>=ft&&mt.y<=pt&&mt!==Q&&mt!==te&&y(ve,et,de,qe,be,Ne,mt.x,mt.y)&&C(mt.prev,mt,mt.next)>=0)return!1;mt=mt.prevZ}for(;at&&at.z<=Ot;){if(at.x>=Ge&&at.x<=Ze&&at.y>=ft&&at.y<=pt&&at!==Q&&at!==te&&y(ve,et,de,qe,be,Ne,at.x,at.y)&&C(at.prev,at,at.next)>=0)return!1;at=at.nextZ}return!0},s=function(P,T,M){var U=P;do{var Q=U.prev,K=U.next.next;!b(Q,K)&&k(Q,U,U.next,K)&&j(Q,K)&&j(K,Q)&&(T.push(Q.i/M|0),T.push(U.i/M|0),T.push(K.i/M|0),w(U),w(U.next),U=P=K),U=U.next}while(U!==P);return a(U)},l=function(P,T,M,U,Q,K){var te=P;do{for(var ve=te.next.next;ve!==te.prev;){if(te.i!==ve.i&&g(te,ve)){var de=N(te,ve);te=a(te,te.next),de=a(de,de.next),R(te,T,M,U,Q,K,0),R(de,T,M,U,Q,K,0);return}ve=ve.next}te=te.next}while(te!==P)},u=function(P,T,M,U){var Q=[],K,te,ve,de,be;for(K=0,te=T.length;K<te;K++)ve=T[K]*U,de=K<te-1?T[K+1]*U:P.length,be=r(P,ve,de,U,!1),be===be.next&&(be.steiner=!0),Q.push(m(be));for(Q.sort(c),K=0;K<Q.length;K++)M=f(Q[K],M);return M},c=function(P,T){return P.x-T.x},f=function(P,T){var M=h(P,T);if(!M)return T;var U=N(M,P);return a(U,U.next),a(M,M.next)},h=function(P,T){var M=T,U=P.x,Q=P.y,K=-1/0,te;do{if(Q<=M.y&&Q>=M.next.y&&M.next.y!==M.y){var ve=M.x+(Q-M.y)*(M.next.x-M.x)/(M.next.y-M.y);if(ve<=U&&ve>K&&(K=ve,te=M.x<M.next.x?M:M.next,ve===U))return te}M=M.next}while(M!==T);if(!te)return null;var de=te,be=te.x,et=te.y,qe=1/0,Ne;M=te;do U>=M.x&&M.x>=be&&U!==M.x&&y(Q<et?U:K,Q,be,et,Q<et?K:U,Q,M.x,M.y)&&(Ne=Math.abs(Q-M.y)/(U-M.x),j(M,P)&&(Ne<qe||Ne===qe&&(M.x>te.x||M.x===te.x&&p(te,M)))&&(te=M,qe=Ne)),M=M.next;while(M!==de);return te},p=function(P,T){return C(P.prev,P,T.prev)<0&&C(T.next,P,P.next)<0},d=function(P,T,M,U){var Q=P;do Q.z===0&&(Q.z=_(Q.x,Q.y,T,M,U)),Q.prevZ=Q.prev,Q.nextZ=Q.next,Q=Q.next;while(Q!==P);Q.prevZ.nextZ=null,Q.prevZ=null,v(Q)},v=function(P){var T,M,U,Q,K,te,ve,de,be=1;do{for(M=P,P=null,K=null,te=0;M;){for(te++,U=M,ve=0,T=0;T<be&&(ve++,U=U.nextZ,!!U);T++);for(de=be;ve>0||de>0&&U;)ve!==0&&(de===0||!U||M.z<=U.z)?(Q=M,M=M.nextZ,ve--):(Q=U,U=U.nextZ,de--),K?K.nextZ=Q:P=Q,Q.prevZ=K,K=Q;M=U}K.nextZ=null,be*=2}while(te>1);return P},_=function(P,T,M,U,Q){return P=(P-M)*Q|0,T=(T-U)*Q|0,P=(P|P<<8)&16711935,P=(P|P<<4)&252645135,P=(P|P<<2)&858993459,P=(P|P<<1)&1431655765,T=(T|T<<8)&16711935,T=(T|T<<4)&252645135,T=(T|T<<2)&858993459,T=(T|T<<1)&1431655765,P|T<<1},m=function(P){var T=P,M=P;do(T.x<M.x||T.x===M.x&&T.y<M.y)&&(M=T),T=T.next;while(T!==P);return M},y=function(P,T,M,U,Q,K,te,ve){return(Q-te)*(T-ve)>=(P-te)*(K-ve)&&(P-te)*(U-ve)>=(M-te)*(T-ve)&&(M-te)*(K-ve)>=(Q-te)*(U-ve)},g=function(P,T){return P.next.i!==T.i&&P.prev.i!==T.i&&!W(P,T)&&(j(P,T)&&j(T,P)&&Y(P,T)&&(C(P.prev,P,T.prev)||C(P,T.prev,T))||b(P,T)&&C(P.prev,P,P.next)>0&&C(T.prev,T,T.next)>0)},C=function(P,T,M){return(T.y-P.y)*(M.x-T.x)-(T.x-P.x)*(M.y-T.y)},b=function(P,T){return P.x===T.x&&P.y===T.y},k=function(P,T,M,U){var Q=F(C(P,T,M)),K=F(C(P,T,U)),te=F(C(M,U,P)),ve=F(C(M,U,T));return!!(Q!==K&&te!==ve||Q===0&&L(P,M,T)||K===0&&L(P,U,T)||te===0&&L(M,P,U)||ve===0&&L(M,T,U))},L=function(P,T,M){return T.x<=Math.max(P.x,M.x)&&T.x>=Math.min(P.x,M.x)&&T.y<=Math.max(P.y,M.y)&&T.y>=Math.min(P.y,M.y)},F=function(P){return P>0?1:P<0?-1:0},W=function(P,T){var M=P;do{if(M.i!==P.i&&M.next.i!==P.i&&M.i!==T.i&&M.next.i!==T.i&&k(M,M.next,P,T))return!0;M=M.next}while(M!==P);return!1},j=function(P,T){return C(P.prev,P,P.next)<0?C(P,T,P.next)>=0&&C(P,P.prev,T)>=0:C(P,T,P.prev)<0||C(P,P.next,T)<0},Y=function(P,T){var M=P,U=!1,Q=(P.x+T.x)/2,K=(P.y+T.y)/2;do M.y>K!=M.next.y>K&&M.next.y!==M.y&&Q<(M.next.x-M.x)*(K-M.y)/(M.next.y-M.y)+M.x&&(U=!U),M=M.next;while(M!==P);return U},N=function(P,T){var M=new E(P.i,P.x,P.y),U=new E(T.i,T.x,T.y),Q=P.next,K=T.prev;return P.next=T,T.prev=P,M.next=Q,Q.prev=M,U.next=M,M.prev=U,K.next=U,U.prev=K,U},$=function(P,T,M,U){var Q=new E(P,T,M);return U?(Q.next=U.next,Q.prev=U,U.next.prev=Q,U.next=Q):(Q.prev=Q,Q.next=Q),Q},w=function(P){P.next.prev=P.prev,P.prev.next=P.next,P.prevZ&&(P.prevZ.nextZ=P.nextZ),P.nextZ&&(P.nextZ.prevZ=P.prevZ)},E=function(P,T,M){this.i=P,this.x=T,this.y=M,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1},A=function(P,T,M,U){for(var Q=0,K=T,te=M-U;K<M;K+=U)Q+=(P[te]-P[K])*(P[K+1]+P[te+1]),te=K;return Q};if(hasRequiredEarcut)return earcut.exports;hasRequiredEarcut=1,earcut.exports=n,earcut.exports.default=n;function R(O,P,T,M,U,Q,K){if(!!O){!K&&Q&&d(O,M,U,Q);for(var te=O,ve,de;O.prev!==O.next;){if(ve=O.prev,de=O.next,Q?o(O,M,U,Q):i(O)){P.push(ve.i/T|0),P.push(O.i/T|0),P.push(de.i/T|0),w(O),O=de.next,te=de.next;continue}if(O=de,O===te){K?K===1?(O=s(a(O),P,T),R(O,P,T,M,U,Q,2)):K===2&&l(O,P,T,M,U,Q):R(a(O),P,T,M,U,Q,1);break}}}}return n.deviation=function(O,P,T,M){var U=P&&P.length,Q=U?P[0]*T:O.length,K=Math.abs(A(O,0,Q,T));if(U)for(var te=0,ve=P.length;te<ve;te++){var de=P[te]*T,be=te<ve-1?P[te+1]*T:O.length;K-=Math.abs(A(O,de,be,T))}var et=0;for(te=0;te<M.length;te+=3){var qe=M[te]*T,Ne=M[te+1]*T,Ge=M[te+2]*T;et+=Math.abs((O[qe]-O[Ge])*(O[Ne+1]-O[qe+1])-(O[qe]-O[Ne])*(O[Ge+1]-O[qe+1]))}return K===0&&et===0?0:Math.abs((et-K)/K)},n.flatten=function(O){for(var P=O[0][0].length,T={vertices:[],holes:[],dimensions:P},M=0,U=0;U<O.length;U++){for(var Q=0;Q<O[U].length;Q++)for(var K=0;K<P;K++)T.vertices.push(O[U][Q][K]);U>0&&(M+=O[U-1].length,T.holes.push(M))}return T},earcut.exports}var regl={exports:{}};function _instanceof$2(n,r){return r!=null&&typeof Symbol!="undefined"&&r[Symbol.hasInstance]?!!r[Symbol.hasInstance](n):n instanceof r}function _type_of$2(n){return n&&typeof Symbol!="undefined"&&n.constructor===Symbol?"symbol":typeof n}var hasRequiredRegl;function requireRegl(){return hasRequiredRegl||(hasRequiredRegl=1,function(n,r){(function(a,i){n.exports=i()})(commonjsGlobal,function(){var a=function(S){return typeof atob!="undefined"?atob(S):"base64:"+S},i=function(S){var z=new Error("(regl) "+S);throw console.error(z),z},o=function(S,z){S||i(z)},s=function(S){return S?": "+S:""},l=function(S,z,X){S in z||i("unknown parameter ("+S+")"+s(X)+". possible values: "+Object.keys(z).join())},u=function(S,z){tr(S)||i("invalid parameter type"+s(z)+". must be a typed array")},c=function(S,z){switch(z){case"number":return typeof S=="number";case"object":return typeof S=="object";case"string":return typeof S=="string";case"boolean":return typeof S=="boolean";case"function":return typeof S=="function";case"undefined":return typeof S=="undefined";case"symbol":return(typeof S=="undefined"?"undefined":_type_of$2(S))==="symbol"}},f=function(S,z,X){c(S,z)||i("invalid parameter type"+s(X)+". expected "+z+", got "+(typeof S=="undefined"?"undefined":_type_of$2(S)))},h=function(S,z){S>=0&&(S|0)===S||i("invalid parameter type, ("+S+")"+s(z)+". must be a nonnegative integer")},p=function(S,z,X){z.indexOf(S)<0&&i("invalid value"+s(X)+". must be one of: "+z)},d=function(S){Object.keys(S).forEach(function(z){la.indexOf(z)<0&&i('invalid regl constructor argument "'+z+'". must be one of '+la)})},v=function(S,z){for(S=S+"";S.length<z;)S=" "+S;return S},_=function(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1},m=function(S,z){this.number=S,this.line=z,this.errors=[]},y=function(S,z,X){this.file=S,this.line=z,this.message=X},g=function(){var S=new Error,z=(S.stack||S).toString(),X=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(z);if(X)return X[1];var ce=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(z);return ce?ce[1]:"unknown"},C=function(){var S=new Error,z=(S.stack||S).toString(),X=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(z);if(X)return X[1];var ce=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(z);return ce?ce[1]:"unknown"},b=function(S,z){var X=S.split("\n"),ce=1,_e=0,he={unknown:new _,0:new _};he.unknown.name=he[0].name=z||g(),he.unknown.lines.push(new m(0,""));for(var Ce=0;Ce<X.length;++Ce){var Ee=X[Ce],Le=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Ee);if(Le)switch(Le[1]){case"line":var Oe=/(\d+)(\s+\d+)?/.exec(Le[2]);Oe&&(ce=Oe[1]|0,Oe[2]&&(_e=Oe[2]|0,_e in he||(he[_e]=new _)));break;case"define":var Ie=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Le[2]);Ie&&(he[_e].name=Ie[1]?a(Ie[2]):Ie[2]);break}he[_e].lines.push(new m(ce++,Ee))}return Object.keys(he).forEach(function(ke){var Te=he[ke];Te.lines.forEach(function(Re){Te.index[Re.number]=Re})}),he},k=function(S){var z=[];return S.split("\n").forEach(function(X){if(!(X.length<5)){var ce=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(X);ce?z.push(new y(ce[1]|0,ce[2]|0,ce[3].trim())):X.length>0&&z.push(new y("unknown",0,X))}}),z},L=function(S,z){z.forEach(function(X){var ce=S[X.file];if(ce){var _e=ce.index[X.line];if(_e){_e.errors.push(X),ce.hasErrors=!0;return}}S.unknown.hasErrors=!0,S.unknown.lines[0].errors.push(X)})},F=function(S,z,X,ce,_e){if(!S.getShaderParameter(z,S.COMPILE_STATUS)){var he=S.getShaderInfoLog(z),Ce=ce===S.FRAGMENT_SHADER?"fragment":"vertex";E(X,"string",Ce+" shader source must be a string",_e);var Ee=b(X,_e),Le=k(he);L(Ee,Le),Object.keys(Ee).forEach(function(Oe){var Ie=Ee[Oe];if(!Ie.hasErrors)return;var ke=[""],Te=[""];function Re($e,ue){ke.push($e),Te.push(ue||"")}Re("file number "+Oe+": "+Ie.name+"\n","color:red;text-decoration:underline;font-weight:bold"),Ie.lines.forEach(function($e){if($e.errors.length>0){Re(v($e.number,4)+"|  ","background-color:yellow; font-weight:bold"),Re($e.line+Lr,"color:red; background-color:yellow; font-weight:bold");var ue=0;$e.errors.forEach(function(le){var Pe=le.message,He=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Pe);if(He){var xe=He[1];switch(Pe=He[2],xe){case"assign":xe="=";break}ue=Math.max($e.line.indexOf(xe,ue),0)}else ue=0;Re(v("| ",6)),Re(v("^^^",ue+3)+Lr,"font-weight:bold"),Re(v("| ",6)),Re(Pe+Lr,"font-weight:bold")}),Re(v("| ",6)+Lr)}else Re(v($e.number,4)+"|  "),Re($e.line+Lr,"color:red")}),typeof document!="undefined"&&!window.chrome?(Te[0]=ke.join("%c"),console.log.apply(console,Te)):console.log(ke.join(""))}),o.raise("Error compiling "+Ce+" shader, "+Ee[0].name)}},W=function(S,z,X,ce,_e){if(!S.getProgramParameter(z,S.LINK_STATUS)){var he=S.getProgramInfoLog(z),Ce=b(X,_e),Ee=b(ce,_e),Le='Error linking program with vertex shader, "'+Ee[0].name+'", and fragment shader "'+Ce[0].name+'"';typeof document!="undefined"?console.log("%c"+Le+Lr+"%c"+he,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Le+Lr+he),o.raise(Le)}},j=function(S){S._commandRef=g()},Y=function(S,z,X,ce){j(S);function _e(Le){return Le?ce.id(Le):0}S._fragId=_e(S.static.frag),S._vertId=_e(S.static.vert);function he(Le,Oe){Object.keys(Oe).forEach(function(Ie){Le[ce.id(Ie)]=!0})}var Ce=S._uniformSet={};he(Ce,z.static),he(Ce,z.dynamic);var Ee=S._attributeSet={};he(Ee,X.static),he(Ee,X.dynamic),S._hasCount="count"in S.static||"count"in S.dynamic||"elements"in S.static||"elements"in S.dynamic},N=function(S,z){var X=C();i(S+" in command "+(z||g())+(X==="unknown"?"":" called from "+X))},$=function(S,z,X){S||N(z,X||g())},w=function(S,z,X,ce){S in z||N("unknown parameter ("+S+")"+s(X)+". possible values: "+Object.keys(z).join(),ce||g())},E=function(S,z,X,ce){c(S,z)||N("invalid parameter type"+s(X)+". expected "+z+", got "+(typeof S=="undefined"?"undefined":_type_of$2(S)),ce||g())},A=function(S){S()},R=function(S,z,X){S.texture?p(S.texture._texture.internalformat,z,"unsupported texture format for attachment"):p(S.renderbuffer._renderbuffer.format,X,"unsupported renderbuffer format for attachment")},O=function(S,z){return S===ha||S===fa||S===da?2:S===pa?4:ur[S]*z},P=function(S){return!(S&S-1)&&!!S},T=function(S,z,X){var ce,_e=z.width,he=z.height,Ce=z.channels;o(_e>0&&_e<=X.maxTextureSize&&he>0&&he<=X.maxTextureSize,"invalid texture shape"),(S.wrapS!==$n||S.wrapT!==$n)&&o(P(_e)&&P(he),"incompatible wrap mode for texture, both width and height must be power of 2"),z.mipmask===1?_e!==1&&he!==1&&o(S.minFilter!==ss&&S.minFilter!==us&&S.minFilter!==ls&&S.minFilter!==cs,"min filter requires mipmap"):(o(P(_e)&&P(he),"texture must be a square power of 2 to support mipmapping"),o(z.mipmask===(_e<<1)-1,"missing or incomplete mipmap data")),z.type===ca&&(X.extensions.indexOf("oes_texture_float_linear")<0&&o(S.minFilter===ua&&S.magFilter===ua,"filter not supported, must enable oes_texture_float_linear"),o(!S.genMipmaps,"mipmap generation not supported with float textures"));var Ee=z.images;for(ce=0;ce<16;++ce)if(Ee[ce]){var Le=_e>>ce,Oe=he>>ce;o(z.mipmask&1<<ce,"missing mipmap data");var Ie=Ee[ce];if(o(Ie.width===Le&&Ie.height===Oe,"invalid shape for mip images"),o(Ie.format===z.format&&Ie.internalformat===z.internalformat&&Ie.type===z.type,"incompatible type for mip image"),!Ie.compressed)if(Ie.data){var ke=Math.ceil(O(Ie.type,Ce)*Le/Ie.unpackAlignment)*Ie.unpackAlignment;o(Ie.data.byteLength===ke*Oe,"invalid data for image, buffer size is inconsistent with image format")}else Ie.element||Ie.copy}else S.genMipmaps||o((z.mipmask&1<<ce)===0,"extra mipmap data");z.compressed&&o(!S.genMipmaps,"mipmap generation for compressed images not supported")},M=function(S,z,X,ce){var _e=S.width,he=S.height,Ce=S.channels;o(_e>0&&_e<=ce.maxTextureSize&&he>0&&he<=ce.maxTextureSize,"invalid texture shape"),o(_e===he,"cube map must be square"),o(z.wrapS===$n&&z.wrapT===$n,"wrap mode not supported by cube map");for(var Ee=0;Ee<X.length;++Ee){var Le=X[Ee];o(Le.width===_e&&Le.height===he,"inconsistent cube map face shape"),z.genMipmaps&&(o(!Le.compressed,"can not generate mipmap for compressed textures"),o(Le.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Oe=Le.images,Ie=0;Ie<16;++Ie){var ke=Oe[Ie];if(ke){var Te=_e>>Ie,Re=he>>Ie;o(Le.mipmask&1<<Ie,"missing mipmap data"),o(ke.width===Te&&ke.height===Re,"invalid shape for mip images"),o(ke.format===S.format&&ke.internalformat===S.internalformat&&ke.type===S.type,"incompatible type for mip image"),ke.compressed||(ke.data?o(ke.data.byteLength===Te*Re*Math.max(O(ke.type,Ce),ke.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):ke.element||ke.copy)}}}},U=function(S,z){this.id=ys++,this.type=S,this.data=z},Q=function(S){return S.replace(/\\/g,"\\\\").replace(/"/g,'\\"')},K=function(S){return"["+sn(S).join("][")+"]"},te=function(S,z){return new U(S,K(z+""))},ve=function(S){return typeof S=="function"&&!S._reglType||_instanceof$2(S,U)},de=function(){var S={"":0},z=[""];return{id:function(ce){var _e=S[ce];return _e||(_e=S[ce]=z.length,z.push(ce),_e)},str:function(ce){return z[ce]}}},be=function(S,z,X){var ce=document.createElement("canvas");jt(ce.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),S.appendChild(ce),S===document.body&&(ce.style.position="absolute",jt(S.style,{margin:0,padding:0}));function _e(){var Ee=window.innerWidth,Le=window.innerHeight;if(S!==document.body){var Oe=ce.getBoundingClientRect();Ee=Oe.right-Oe.left,Le=Oe.bottom-Oe.top}ce.width=X*Ee,ce.height=X*Le}var he;S!==document.body&&typeof ResizeObserver=="function"?(he=new ResizeObserver(function(){setTimeout(_e)}),he.observe(S)):window.addEventListener("resize",_e,!1);function Ce(){he?he.disconnect():window.removeEventListener("resize",_e),S.removeChild(ce)}return _e(),{canvas:ce,onDestroy:Ce}},et=function(S,z){function X(ce){try{return S.getContext(ce,z)}catch(_e){return null}}return X("webgl")||X("experimental-webgl")||X("webgl-experimental")},qe=function(S){return typeof S.nodeName=="string"&&typeof S.appendChild=="function"&&typeof S.getBoundingClientRect=="function"},Ne=function(S){return typeof S.drawArrays=="function"||typeof S.drawElements=="function"},Ge=function(S){return typeof S=="string"?S.split():(D(Array.isArray(S),"invalid extension array"),S)},ft=function(S){return typeof S=="string"?(D(typeof document!="undefined","not supported outside of DOM"),document.querySelector(S)):S},Ze=function(S){var z=S||{},X,ce,_e,he,Ce={},Ee=[],Le=[],Oe=typeof window=="undefined"?1:window.devicePixelRatio,Ie=!1,ke=function(ue){ue&&D.raise(ue)},Te=function(){};if(typeof z=="string"?(D(typeof document!="undefined","selector queries only supported in DOM enviroments"),X=document.querySelector(z),D(X,"invalid query string for element")):typeof z=="object"?qe(z)?X=z:Ne(z)?(he=z,_e=he.canvas):(D.constructor(z),"gl"in z?he=z.gl:"canvas"in z?_e=ft(z.canvas):"container"in z&&(ce=ft(z.container)),"attributes"in z&&(Ce=z.attributes,D.type(Ce,"object","invalid context attributes")),"extensions"in z&&(Ee=Ge(z.extensions)),"optionalExtensions"in z&&(Le=Ge(z.optionalExtensions)),"onDone"in z&&(D.type(z.onDone,"function","invalid or missing onDone callback"),ke=z.onDone),"profile"in z&&(Ie=!!z.profile),"pixelRatio"in z&&(Oe=+z.pixelRatio,D(Oe>0,"invalid pixel ratio"))):D.raise("invalid arguments to regl"),X&&(X.nodeName.toLowerCase()==="canvas"?_e=X:ce=X),!he){if(!_e){D(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var Re=be(ce||document.body,ke,Oe);if(!Re)return null;_e=Re.canvas,Te=Re.onDestroy}Ce.premultipliedAlpha===void 0&&(Ce.premultipliedAlpha=!0),he=et(_e,Ce)}return he?{gl:he,canvas:_e,container:ce,extensions:Ee,optionalExtensions:Le,pixelRatio:Oe,profile:Ie,onDone:ke,onDestroy:Te}:(Te(),ke("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)},pt=function(S,z){var X={};function ce(Ce){D.type(Ce,"string","extension name must be string");var Ee=Ce.toLowerCase(),Le;try{Le=X[Ee]=S.getExtension(Ee)}catch(Oe){}return!!Le}for(var _e=0;_e<z.extensions.length;++_e){var he=z.extensions[_e];if(!ce(he))return z.onDestroy(),z.onDone('"'+he+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return z.optionalExtensions.forEach(ce),{extensions:X,restore:function(){Object.keys(X).forEach(function(Ee){if(X[Ee]&&!ce(Ee))throw new Error("(regl): error restoring extension "+Ee)})}}},dt=function(S,z){for(var X=Array(S),ce=0;ce<S;++ce)X[ce]=z(ce);return X},Ot=function(S){for(var z=16;z<=268435456;z*=16)if(S<=z)return z;return 0},mt=function(S){var z,X;return z=(S>65535)<<4,S>>>=z,X=(S>255)<<3,S>>>=X,z|=X,X=(S>15)<<2,S>>>=X,z|=X,X=(S>3)<<1,S>>>=X,z|=X,z|S>>1},at=function(){var S=dt(8,function(){return[]});function z(he){var Ce=Ot(he),Ee=S[mt(Ce)>>2];return Ee.length>0?Ee.pop():new ArrayBuffer(Ce)}function X(he){S[mt(he.byteLength)>>2].push(he)}function ce(he,Ce){var Ee=null;switch(he){case Cs:Ee=new Int8Array(z(Ce),0,Ce);break;case ws:Ee=new Uint8Array(z(Ce),0,Ce);break;case Ss:Ee=new Int16Array(z(2*Ce),0,Ce);break;case Ps:Ee=new Uint16Array(z(2*Ce),0,Ce);break;case As:Ee=new Int32Array(z(4*Ce),0,Ce);break;case Es:Ee=new Uint32Array(z(4*Ce),0,Ce);break;case $s:Ee=new Float32Array(z(4*Ce),0,Ce);break;default:return null}return Ee.length!==Ce?Ee.subarray(0,Ce):Ee}function _e(he){X(he.buffer)}return{alloc:z,free:X,allocType:ce,freeType:_e}},St=function(S){return!!S&&typeof S=="object"&&Array.isArray(S.shape)&&Array.isArray(S.stride)&&typeof S.offset=="number"&&S.shape.length===S.stride.length&&(Array.isArray(S.data)||tr(S.data))},Tt=function(S,z,X){for(var ce=0;ce<z;++ce)X[ce]=S[ce]},Dt=function(S,z,X,ce){for(var _e=0,he=0;he<z;++he)for(var Ce=S[he],Ee=0;Ee<X;++Ee)ce[_e++]=Ce[Ee]},Lt=function(S,z,X,ce,_e,he){for(var Ce=he,Ee=0;Ee<z;++Ee)for(var Le=S[Ee],Oe=0;Oe<X;++Oe)for(var Ie=Le[Oe],ke=0;ke<ce;++ke)_e[Ce++]=Ie[ke]},Rt=function(S,z,X,ce){var _e=1;if(z.length)for(var he=0;he<z.length;++he)_e*=z[he];else _e=0;var Ce=ce||Wt.allocType(X,_e);switch(z.length){case 0:break;case 1:Tt(S,z[0],Ce);break;case 2:Dt(S,z[0],z[1],Ce);break;case 3:Lt(S,z[0],z[1],z[2],Ce,0);break;default:ga(S,z,0,Ce,0)}return Ce},It=function(S){for(var z=[],X=S;X.length;X=X[0])z.push(X.length);return z},Bt=function(S){return ci[Object.prototype.toString.call(S)]|0},Ft=function(S,z){for(var X=0;X<z.length;++X)S[X]=z[X]},ot=function(S,z,X,ce,_e,he,Ce){for(var Ee=0,Le=0;Le<X;++Le)for(var Oe=0;Oe<ce;++Oe)S[Ee++]=z[_e*Le+he*Oe+Ce]},bt=function(S,z,X,ce){var _e=0,he={};function Ce(ue){this.id=_e++,this.buffer=S.createBuffer(),this.type=ue,this.usage=xa,this.byteLength=0,this.dimension=1,this.dtype=hi,this.persistentData=null,X.profile&&(this.stats={size:0})}Ce.prototype.bind=function(){S.bindBuffer(this.type,this.buffer)},Ce.prototype.destroy=function(){Te(this)};var Ee=[];function Le(ue,le){var Pe=Ee.pop();return Pe||(Pe=new Ce(ue)),Pe.bind(),ke(Pe,le,yl,0,1,!1),Pe}function Oe(ue){Ee.push(ue)}function Ie(ue,le,Pe){ue.byteLength=le.byteLength,S.bufferData(ue.type,le,Pe)}function ke(ue,le,Pe,He,xe,tt){var Qe;if(ue.usage=Pe,Array.isArray(le)){if(ue.dtype=He||di,le.length>0){var je;if(Array.isArray(le[0])){Qe=ba(le);for(var we=1,pe=1;pe<Qe.length;++pe)we*=Qe[pe];ue.dimension=we,je=fi(le,Qe,ue.dtype),Ie(ue,je,Pe),tt?ue.persistentData=je:Wt.freeType(je)}else if(typeof le[0]=="number"){ue.dimension=xe;var We=Wt.allocType(ue.dtype,le.length);Ft(We,le),Ie(ue,We,Pe),tt?ue.persistentData=We:Wt.freeType(We)}else tr(le[0])?(ue.dimension=le[0].length,ue.dtype=He||Bt(le[0])||di,je=fi(le,[le.length,le[0].length],ue.dtype),Ie(ue,je,Pe),tt?ue.persistentData=je:Wt.freeType(je)):D.raise("invalid buffer data")}}else if(tr(le))ue.dtype=He||Bt(le),ue.dimension=xe,Ie(ue,le,Pe),tt&&(ue.persistentData=new Uint8Array(new Uint8Array(le.buffer)));else if(St(le)){Qe=le.shape;var De=le.stride,Me=le.offset,Fe=0,Be=0,yt=0,vt=0;Qe.length===1?(Fe=Qe[0],Be=1,yt=De[0],vt=0):Qe.length===2?(Fe=Qe[0],Be=Qe[1],yt=De[0],vt=De[1]):D.raise("invalid shape"),ue.dtype=He||Bt(le.data)||di,ue.dimension=Be;var Ve=Wt.allocType(ue.dtype,Fe*Be);ot(Ve,le.data,Fe,Be,yt,vt,Me),Ie(ue,Ve,Pe),tt?ue.persistentData=Ve:Wt.freeType(Ve)}else _instanceof$2(le,ArrayBuffer)?(ue.dtype=hi,ue.dimension=xe,Ie(ue,le,Pe),tt&&(ue.persistentData=new Uint8Array(new Uint8Array(le)))):D.raise("invalid buffer data")}function Te(ue){z.bufferCount--,ce(ue);var le=ue.buffer;D(le,"buffer must not be deleted already"),S.deleteBuffer(le),ue.buffer=null,delete he[ue.id]}function Re(ue,le,Pe,He){z.bufferCount++;var xe=new Ce(le);he[xe.id]=xe;function tt(we){var pe=xa,We=null,De=0,Me=0,Fe=1;return Array.isArray(we)||tr(we)||St(we)||_instanceof$2(we,ArrayBuffer)?We=we:typeof we=="number"?De=we|0:we&&(D.type(we,"object","buffer arguments must be an object, a number or an array"),"data"in we&&(D(We===null||Array.isArray(We)||tr(We)||St(We),"invalid data for buffer"),We=we.data),"usage"in we&&(D.parameter(we.usage,Ln,"invalid buffer usage"),pe=Ln[we.usage]),"type"in we&&(D.parameter(we.type,Mr,"invalid buffer type"),Me=Mr[we.type]),"dimension"in we&&(D.type(we.dimension,"number","invalid dimension"),Fe=we.dimension|0),"length"in we&&(D.nni(De,"buffer length must be a nonnegative integer"),De=we.length|0)),xe.bind(),We?ke(xe,We,pe,Me,Fe,He):(De&&S.bufferData(xe.type,De,pe),xe.dtype=Me||hi,xe.usage=pe,xe.dimension=Fe,xe.byteLength=De),X.profile&&(xe.stats.size=xe.byteLength*Pr[xe.dtype]),tt}function Qe(we,pe){D(pe+we.byteLength<=xe.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+we.byteLength+" starting from offset "+pe+" to a buffer of size "+xe.byteLength),S.bufferSubData(xe.type,pe,we)}function je(we,pe){var We=(pe||0)|0,De;if(xe.bind(),tr(we)||_instanceof$2(we,ArrayBuffer))Qe(we,We);else if(Array.isArray(we)){if(we.length>0)if(typeof we[0]=="number"){var Me=Wt.allocType(xe.dtype,we.length);Ft(Me,we),Qe(Me,We),Wt.freeType(Me)}else if(Array.isArray(we[0])||tr(we[0])){De=ba(we);var Fe=fi(we,De,xe.dtype);Qe(Fe,We),Wt.freeType(Fe)}else D.raise("invalid buffer data")}else if(St(we)){De=we.shape;var Be=we.stride,yt=0,vt=0,Ve=0,Ue=0;De.length===1?(yt=De[0],vt=1,Ve=Be[0],Ue=0):De.length===2?(yt=De[0],vt=De[1],Ve=Be[0],Ue=Be[1]):D.raise("invalid shape");var lt=Array.isArray(we.data)?xe.dtype:Bt(we.data),gt=Wt.allocType(lt,yt*vt);ot(gt,we.data,yt,vt,Ve,Ue,we.offset),Qe(gt,We),Wt.freeType(gt)}else D.raise("invalid data for buffer subdata");return tt}return Pe||tt(ue),tt._reglType="buffer",tt._buffer=xe,tt.subdata=je,X.profile&&(tt.stats=xe.stats),tt.destroy=function(){Te(xe)},tt}function $e(){fr(he).forEach(function(ue){ue.buffer=S.createBuffer(),S.bindBuffer(ue.type,ue.buffer),S.bufferData(ue.type,ue.persistentData||ue.byteLength,ue.usage)})}return X.profile&&(z.getTotalBufferSize=function(){var ue=0;return Object.keys(he).forEach(function(le){ue+=he[le].stats.size}),ue}),{create:Re,createStream:Le,destroyStream:Oe,clear:function(){fr(he).forEach(Te),Ee.forEach(Te)},getBuffer:function(le){return le&&_instanceof$2(le._buffer,Ce)?le._buffer:null},restore:$e,_initBuffer:ke}},rt=function(S,z,X,ce){var _e={},he=0,Ce={uint8:Yr,uint16:Xr};z.oes_element_index_uint&&(Ce.uint32=Tr);function Ee($e){this.id=he++,_e[this.id]=this,this.buffer=$e,this.primType=cn,this.vertCount=0,this.type=0}Ee.prototype.bind=function(){this.buffer.bind()};var Le=[];function Oe($e){var ue=Le.pop();return ue||(ue=new Ee(X.create(null,pi,!0,!1)._buffer)),ke(ue,$e,$l,-1,-1,0,0),ue}function Ie($e){Le.push($e)}function ke($e,ue,le,Pe,He,xe,tt){$e.buffer.bind();var Qe;if(ue){var je=tt;!tt&&(!tr(ue)||St(ue)&&!tr(ue.data))&&(je=z.oes_element_index_uint?Tr:Xr),X._initBuffer($e.buffer,ue,le,je,3)}else S.bufferData(pi,xe,le),$e.buffer.dtype=Qe||Yr,$e.buffer.usage=le,$e.buffer.dimension=3,$e.buffer.byteLength=xe;if(Qe=tt,!tt){switch($e.buffer.dtype){case Yr:case El:Qe=Yr;break;case Xr:case Ca:Qe=Xr;break;case Tr:case wa:Qe=Tr;break;default:D.raise("unsupported type for element array")}$e.buffer.dtype=Qe}$e.type=Qe,D(Qe!==Tr||!!z.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var we=He;we<0&&(we=$e.buffer.byteLength,Qe===Xr?we>>=1:Qe===Tr&&(we>>=2)),$e.vertCount=we;var pe=Pe;if(Pe<0){pe=cn;var We=$e.buffer.dimension;We===1&&(pe=Pl),We===2&&(pe=Al),We===3&&(pe=cn)}$e.primType=pe}function Te($e){ce.elementsCount--,D($e.buffer!==null,"must not double destroy elements"),delete _e[$e.id],$e.buffer.destroy(),$e.buffer=null}function Re($e,ue){var le=X.create(null,pi,!0),Pe=new Ee(le._buffer);ce.elementsCount++;function He(xe){if(!xe)le(),Pe.primType=cn,Pe.vertCount=0,Pe.type=Yr;else if(typeof xe=="number")le(xe),Pe.primType=cn,Pe.vertCount=xe|0,Pe.type=Yr;else{var tt=null,Qe=kl,je=-1,we=-1,pe=0,We=0;Array.isArray(xe)||tr(xe)||St(xe)?tt=xe:(D.type(xe,"object","invalid arguments for elements"),"data"in xe&&(tt=xe.data,D(Array.isArray(tt)||tr(tt)||St(tt),"invalid data for element buffer")),"usage"in xe&&(D.parameter(xe.usage,Ln,"invalid element buffer usage"),Qe=Ln[xe.usage]),"primitive"in xe&&(D.parameter(xe.primitive,Ar,"invalid element buffer primitive"),je=Ar[xe.primitive]),"count"in xe&&(D(typeof xe.count=="number"&&xe.count>=0,"invalid vertex count for elements"),we=xe.count|0),"type"in xe&&(D.parameter(xe.type,Ce,"invalid buffer type"),We=Ce[xe.type]),"length"in xe?pe=xe.length|0:(pe=we,We===Xr||We===Ca?pe*=2:(We===Tr||We===wa)&&(pe*=4))),ke(Pe,tt,Qe,je,we,pe,We)}return He}return He($e),He._reglType="elements",He._elements=Pe,He.subdata=function(xe,tt){return le.subdata(xe,tt),He},He.destroy=function(){Te(Pe)},He}return{create:Re,createStream:Oe,destroyStream:Ie,getElements:function(ue){return typeof ue=="function"&&_instanceof$2(ue._elements,Ee)?ue._elements:null},clear:function(){fr(_e).forEach(Te)}}},Pt=function(S){for(var z=Wt.allocType(Ll,S.length),X=0;X<S.length;++X)if(isNaN(S[X]))z[X]=65535;else if(S[X]===1/0)z[X]=31744;else if(S[X]===-1/0)z[X]=64512;else{Sa[0]=S[X];var ce=Ol[0],_e=ce>>>31<<15,he=(ce<<1>>>24)-127,Ce=ce>>13&(1<<10)-1;if(he<-24)z[X]=_e;else if(he<-14){var Ee=-14-he;z[X]=_e+(Ce+1024>>Ee)}else he>15?z[X]=_e+31744:z[X]=_e+(he+15<<10)+Ce}return z},st=function(S){return Array.isArray(S)||tr(S)},$t=function(S){return"[object "+S+"]"},_t=function(S){return Array.isArray(S)&&(S.length===0||typeof S[0]=="number")},it=function(S){if(!Array.isArray(S))return!1;var z=S.length;return!(z===0||!st(S[0]))},Vt=function(S){return Object.prototype.toString.call(S)},mr=function(S){return Vt(S)===Ba},wr=function(S){return Vt(S)===Na},ii=function(S){return Vt(S)===Va},qr=function(S){return Vt(S)===Ga},Yo=function(S){return Vt(S)===Ua},Xo=function(S){return Vt(S)===ja},ai=function(S){if(!S)return!1;var z=Vt(S);return Jl.indexOf(z)>=0?!0:_t(S)||it(S)||St(S)},ra=function(S){return ci[Object.prototype.toString.call(S)]|0},Qo=function(S,z){var X=z.length;switch(S.type){case Zr:case Pi:case Ai:case hn:var ce=Wt.allocType(S.type,X);ce.set(z),S.data=ce;break;case Qr:S.data=Pt(z);break;default:D.raise("unsupported texture type, must specify a typed array")}},na=function(S,z){return Wt.allocType(S.type===Qr?hn:S.type,z)},ia=function(S,z){S.type===Qr?(S.data=Pt(z),Wt.freeType(z)):S.data=z},Zo=function(S,z,X,ce,_e,he){for(var Ce=S.width,Ee=S.height,Le=S.channels,Oe=Ce*Ee*Le,Ie=na(S,Oe),ke=0,Te=0;Te<Ee;++Te)for(var Re=0;Re<Ce;++Re)for(var $e=0;$e<Le;++$e)Ie[ke++]=z[X*Re+ce*Te+_e*$e+he];ia(S,Ie)},An=function(S,z,X,ce,_e,he){var Ce;if(typeof rr[S]!="undefined"?Ce=rr[S]:Ce=dr[S]*Kr[z],he&&(Ce*=6),_e){for(var Ee=0,Le=X;Le>=1;)Ee+=Ce*Le*Le,Le/=2;return Ee}else return Ce*X*ce},Ko=function(S,z,X,ce,_e,he,Ce){var Ee={"don't care":zn,"dont care":zn,nice:Hl,fast:ql},Le={repeat:Bl,clamp:Ei,mirror:Nl},Oe={nearest:$i,linear:Ul},Ie=jt({mipmap:Oi,"nearest mipmap nearest":ki,"linear mipmap nearest":za,"nearest mipmap linear":Fa,"linear mipmap linear":Oi},Oe),ke={none:0,browser:Da},Te={uint8:Zr,rgba4:Tl,rgb565:Il,"rgb5 a1":Rl},Re={alpha:mi,luminance:fn,"luminance alpha":Rn,rgb:Tn,rgba:Rr,rgba4:Aa,"rgb5 a1":_i,rgb565:Ea},$e={};z.ext_srgb&&(Re.srgb=gi,Re.srgba=bi),z.oes_texture_float&&(Te.float32=Te.float=hn),z.oes_texture_half_float&&(Te.float16=Te["half float"]=Qr),z.webgl_depth_texture&&(jt(Re,{depth:yi,"depth stencil":In}),jt(Te,{uint16:Pi,uint32:Ai,"depth stencil":zl})),z.webgl_compressed_texture_s3tc&&jt($e,{"rgb s3tc dxt1":xi,"rgba s3tc dxt1":Ci,"rgba s3tc dxt3":wi,"rgba s3tc dxt5":Si}),z.webgl_compressed_texture_atc&&jt($e,{"rgb atc":$a,"rgba atc explicit alpha":ka,"rgba atc interpolated alpha":Oa}),z.webgl_compressed_texture_pvrtc&&jt($e,{"rgb pvrtc 4bppv1":La,"rgb pvrtc 2bppv1":Ma,"rgba pvrtc 4bppv1":Ta,"rgba pvrtc 2bppv1":Ra}),z.webgl_compressed_texture_etc1&&($e["rgb etc1"]=Ia);var ue=Array.prototype.slice.call(S.getParameter(Ml));Object.keys($e).forEach(function(q){var fe=$e[q];ue.indexOf(fe)>=0&&(Re[q]=fe)});var le=Object.keys(Re);X.textureFormats=le;var Pe=[];Object.keys(Re).forEach(function(q){var fe=Re[q];Pe[fe]=q});var He=[];Object.keys(Te).forEach(function(q){var fe=Te[q];He[fe]=q});var xe=[];Object.keys(Oe).forEach(function(q){var fe=Oe[q];xe[fe]=q});var tt=[];Object.keys(Ie).forEach(function(q){var fe=Ie[q];tt[fe]=q});var Qe=[];Object.keys(Le).forEach(function(q){var fe=Le[q];Qe[fe]=q});var je=le.reduce(function(q,fe){var oe=Re[fe];return oe===fn||oe===mi||oe===fn||oe===Rn||oe===yi||oe===In||z.ext_srgb&&(oe===gi||oe===bi)?q[oe]=oe:oe===_i||fe.indexOf("rgba")>=0?q[oe]=Rr:q[oe]=Tn,q},{});function we(){this.internalformat=Rr,this.format=Rr,this.type=Zr,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Da,this.width=0,this.height=0,this.channels=0}function pe(q,fe){q.internalformat=fe.internalformat,q.format=fe.format,q.type=fe.type,q.compressed=fe.compressed,q.premultiplyAlpha=fe.premultiplyAlpha,q.flipY=fe.flipY,q.unpackAlignment=fe.unpackAlignment,q.colorSpace=fe.colorSpace,q.width=fe.width,q.height=fe.height,q.channels=fe.channels}function We(q,fe){if(!(typeof fe!="object"||!fe)){if("premultiplyAlpha"in fe&&(D.type(fe.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),q.premultiplyAlpha=fe.premultiplyAlpha),"flipY"in fe&&(D.type(fe.flipY,"boolean","invalid texture flip"),q.flipY=fe.flipY),"alignment"in fe&&(D.oneOf(fe.alignment,[1,2,4,8],"invalid texture unpack alignment"),q.unpackAlignment=fe.alignment),"colorSpace"in fe&&(D.parameter(fe.colorSpace,ke,"invalid colorSpace"),q.colorSpace=ke[fe.colorSpace]),"type"in fe){var oe=fe.type;D(z.oes_texture_float||!(oe==="float"||oe==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),D(z.oes_texture_half_float||!(oe==="half float"||oe==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),D(z.webgl_depth_texture||!(oe==="uint16"||oe==="uint32"||oe==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),D.parameter(oe,Te,"invalid texture type"),q.type=Te[oe]}var Ye=q.width,wt=q.height,B=q.channels,I=!1;"shape"in fe?(D(Array.isArray(fe.shape)&&fe.shape.length>=2,"shape must be an array"),Ye=fe.shape[0],wt=fe.shape[1],fe.shape.length===3&&(B=fe.shape[2],D(B>0&&B<=4,"invalid number of channels"),I=!0),D(Ye>=0&&Ye<=X.maxTextureSize,"invalid width"),D(wt>=0&&wt<=X.maxTextureSize,"invalid height")):("radius"in fe&&(Ye=wt=fe.radius,D(Ye>=0&&Ye<=X.maxTextureSize,"invalid radius")),"width"in fe&&(Ye=fe.width,D(Ye>=0&&Ye<=X.maxTextureSize,"invalid width")),"height"in fe&&(wt=fe.height,D(wt>=0&&wt<=X.maxTextureSize,"invalid height")),"channels"in fe&&(B=fe.channels,D(B>0&&B<=4,"invalid number of channels"),I=!0)),q.width=Ye|0,q.height=wt|0,q.channels=B|0;var Z=!1;if("format"in fe){var ne=fe.format;D(z.webgl_depth_texture||!(ne==="depth"||ne==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),D.parameter(ne,Re,"invalid texture format");var ie=q.internalformat=Re[ne];q.format=je[ie],ne in Te&&("type"in fe||(q.type=Te[ne])),ne in $e&&(q.compressed=!0),Z=!0}!I&&Z?q.channels=dr[q.format]:I&&!Z?q.channels!==Fn[q.format]&&(q.format=q.internalformat=Fn[q.channels]):Z&&I&&D(q.channels===dr[q.format],"number of channels inconsistent with specified format")}}function De(q){S.pixelStorei(Xl,q.flipY),S.pixelStorei(Ql,q.premultiplyAlpha),S.pixelStorei(Zl,q.colorSpace),S.pixelStorei(Yl,q.unpackAlignment)}function Me(){we.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Fe(q,fe){var oe=null;if(ai(fe)?oe=fe:fe&&(D.type(fe,"object","invalid pixel data type"),We(q,fe),"x"in fe&&(q.xOffset=fe.x|0),"y"in fe&&(q.yOffset=fe.y|0),ai(fe.data)&&(oe=fe.data)),D(!q.compressed||_instanceof$2(oe,Uint8Array),"compressed texture data must be stored in a uint8array"),fe.copy){D(!oe,"can not specify copy and data field for the same texture");var Ye=_e.viewportWidth,wt=_e.viewportHeight;q.width=q.width||Ye-q.xOffset,q.height=q.height||wt-q.yOffset,q.needsCopy=!0,D(q.xOffset>=0&&q.xOffset<Ye&&q.yOffset>=0&&q.yOffset<wt&&q.width>0&&q.width<=Ye&&q.height>0&&q.height<=wt,"copy texture read out of bounds")}else if(!oe)q.width=q.width||1,q.height=q.height||1,q.channels=q.channels||4;else if(tr(oe))q.channels=q.channels||4,q.data=oe,!("type"in fe)&&q.type===Zr&&(q.type=ra(oe));else if(_t(oe))q.channels=q.channels||4,Qo(q,oe),q.alignment=1,q.needsFree=!0;else if(St(oe)){var B=oe.data;!Array.isArray(B)&&q.type===Zr&&(q.type=ra(B));var I=oe.shape,Z=oe.stride,ne,ie,ee,J,re,V;I.length===3?(ee=I[2],V=Z[2]):(D(I.length===2,"invalid ndarray pixel data, must be 2 or 3D"),ee=1,V=1),ne=I[0],ie=I[1],J=Z[0],re=Z[1],q.alignment=1,q.width=ne,q.height=ie,q.channels=ee,q.format=q.internalformat=Fn[ee],q.needsFree=!0,Zo(q,B,J,re,V,oe.offset)}else if(mr(oe)||wr(oe)||ii(oe))mr(oe)||wr(oe)?q.element=oe:q.element=oe.canvas,q.width=q.element.width,q.height=q.element.height,q.channels=4;else if(qr(oe))q.element=oe,q.width=oe.width,q.height=oe.height,q.channels=4;else if(Yo(oe))q.element=oe,q.width=oe.naturalWidth,q.height=oe.naturalHeight,q.channels=4;else if(Xo(oe))q.element=oe,q.width=oe.videoWidth,q.height=oe.videoHeight,q.channels=4;else if(it(oe)){var H=q.width||oe[0].length,G=q.height||oe.length,se=q.channels;st(oe[0][0])?se=se||oe[0][0].length:se=se||1;for(var ae=On.shape(oe),ye=1,Se=0;Se<ae.length;++Se)ye*=ae[Se];var ze=na(q,ye);On.flatten(oe,ae,"",ze),ia(q,ze),q.alignment=1,q.width=H,q.height=G,q.channels=se,q.format=q.internalformat=Fn[se],q.needsFree=!0}q.type===hn?D(X.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):q.type===Qr&&D(X.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Be(q,fe,oe){var Ye=q.element,wt=q.data,B=q.internalformat,I=q.format,Z=q.type,ne=q.width,ie=q.height;De(q),Ye?S.texImage2D(fe,oe,I,I,Z,Ye):q.compressed?S.compressedTexImage2D(fe,oe,B,ne,ie,0,wt):q.needsCopy?(ce(),S.copyTexImage2D(fe,oe,I,q.xOffset,q.yOffset,ne,ie,0)):S.texImage2D(fe,oe,I,ne,ie,0,I,Z,wt||null)}function yt(q,fe,oe,Ye,wt){var B=q.element,I=q.data,Z=q.internalformat,ne=q.format,ie=q.type,ee=q.width,J=q.height;De(q),B?S.texSubImage2D(fe,wt,oe,Ye,ne,ie,B):q.compressed?S.compressedTexSubImage2D(fe,wt,oe,Ye,Z,ee,J,I):q.needsCopy?(ce(),S.copyTexSubImage2D(fe,wt,oe,Ye,q.xOffset,q.yOffset,ee,J)):S.texSubImage2D(fe,wt,oe,Ye,ee,J,ne,ie,I)}var vt=[];function Ve(){return vt.pop()||new Me}function Ue(q){q.needsFree&&Wt.freeType(q.data),Me.call(q),vt.push(q)}function lt(){we.call(this),this.genMipmaps=!1,this.mipmapHint=zn,this.mipmask=0,this.images=Array(16)}function gt(q,fe,oe){var Ye=q.images[0]=Ve();q.mipmask=1,Ye.width=q.width=fe,Ye.height=q.height=oe,Ye.channels=q.channels=4}function At(q,fe){var oe=null;if(ai(fe))oe=q.images[0]=Ve(),pe(oe,q),Fe(oe,fe),q.mipmask=1;else if(We(q,fe),Array.isArray(fe.mipmap))for(var Ye=fe.mipmap,wt=0;wt<Ye.length;++wt)oe=q.images[wt]=Ve(),pe(oe,q),oe.width>>=wt,oe.height>>=wt,Fe(oe,Ye[wt]),q.mipmask|=1<<wt;else oe=q.images[0]=Ve(),pe(oe,q),Fe(oe,fe),q.mipmask=1;pe(q,q.images[0]),q.compressed&&(q.internalformat===xi||q.internalformat===Ci||q.internalformat===wi||q.internalformat===Si)&&D(q.width%4===0&&q.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Gt(q,fe){for(var oe=q.images,Ye=0;Ye<oe.length;++Ye){if(!oe[Ye])return;Be(oe[Ye],fe,Ye)}}var Ut=[];function Et(){var q=Ut.pop()||new lt;we.call(q),q.mipmask=0;for(var fe=0;fe<16;++fe)q.images[fe]=null;return q}function Xt(q){for(var fe=q.images,oe=0;oe<fe.length;++oe)fe[oe]&&Ue(fe[oe]),fe[oe]=null;Ut.push(q)}function Nt(){this.minFilter=$i,this.magFilter=$i,this.wrapS=Ei,this.wrapT=Ei,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=zn}function Yt(q,fe){if("min"in fe){var oe=fe.min;D.parameter(oe,Ie),q.minFilter=Ie[oe],Kl.indexOf(q.minFilter)>=0&&!("faces"in fe)&&(q.genMipmaps=!0)}if("mag"in fe){var Ye=fe.mag;D.parameter(Ye,Oe),q.magFilter=Oe[Ye]}var wt=q.wrapS,B=q.wrapT;if("wrap"in fe){var I=fe.wrap;typeof I=="string"?(D.parameter(I,Le),wt=B=Le[I]):Array.isArray(I)&&(D.parameter(I[0],Le),D.parameter(I[1],Le),wt=Le[I[0]],B=Le[I[1]])}else{if("wrapS"in fe){var Z=fe.wrapS;D.parameter(Z,Le),wt=Le[Z]}if("wrapT"in fe){var ne=fe.wrapT;D.parameter(ne,Le),B=Le[ne]}}if(q.wrapS=wt,q.wrapT=B,"anisotropic"in fe){var ie=fe.anisotropic;D(typeof ie=="number"&&ie>=1&&ie<=X.maxAnisotropic,"aniso samples must be between 1 and "),q.anisotropic=fe.anisotropic}if("mipmap"in fe){var ee=!1;switch(_type_of$2(fe.mipmap)){case"string":D.parameter(fe.mipmap,Ee,"invalid mipmap hint"),q.mipmapHint=Ee[fe.mipmap],q.genMipmaps=!0,ee=!0;break;case"boolean":ee=q.genMipmaps=fe.mipmap;break;case"object":D(Array.isArray(fe.mipmap),"invalid mipmap type"),q.genMipmaps=!1,ee=!0;break;default:D.raise("invalid mipmap type")}ee&&!("min"in fe)&&(q.minFilter=ki)}}function Qt(q,fe){S.texParameteri(fe,Gl,q.minFilter),S.texParameteri(fe,Vl,q.magFilter),S.texParameteri(fe,Fl,q.wrapS),S.texParameteri(fe,Dl,q.wrapT),z.ext_texture_filter_anisotropic&&S.texParameteri(fe,Wl,q.anisotropic),q.genMipmaps&&(S.hint(jl,q.mipmapHint),S.generateMipmap(fe))}var Zt=0,Jt={},nr=X.maxTextureUnits,qt=Array(nr).map(function(){return null});function Ct(q){we.call(this),this.mipmask=0,this.internalformat=Rr,this.id=Zt++,this.refCount=1,this.target=q,this.texture=S.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Nt,Ce.profile&&(this.stats={size:0})}function ir(q){S.activeTexture(dn),S.bindTexture(q.target,q.texture)}function Mt(){var q=qt[0];q?S.bindTexture(q.target,q.texture):S.bindTexture(_r,null)}function ut(q){var fe=q.texture;D(fe,"must not double destroy texture");var oe=q.unit,Ye=q.target;oe>=0&&(S.activeTexture(dn+oe),S.bindTexture(Ye,null),qt[oe]=null),S.deleteTexture(fe),q.texture=null,q.params=null,q.pixels=null,q.refCount=0,delete Jt[q.id],he.textureCount--}jt(Ct.prototype,{bind:function(){var fe=this;fe.bindCount+=1;var oe=fe.unit;if(oe<0){for(var Ye=0;Ye<nr;++Ye){var wt=qt[Ye];if(wt){if(wt.bindCount>0)continue;wt.unit=-1}qt[Ye]=fe,oe=Ye;break}oe>=nr&&D.raise("insufficient number of texture units"),Ce.profile&&he.maxTextureUnits<oe+1&&(he.maxTextureUnits=oe+1),fe.unit=oe,S.activeTexture(dn+oe),S.bindTexture(fe.target,fe.texture)}return oe},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ut(this)}});function xt(q,fe){var oe=new Ct(_r);Jt[oe.id]=oe,he.textureCount++;function Ye(I,Z){var ne=oe.texInfo;Nt.call(ne);var ie=Et();return typeof I=="number"?typeof Z=="number"?gt(ie,I|0,Z|0):gt(ie,I|0,I|0):I?(D.type(I,"object","invalid arguments to regl.texture"),Yt(ne,I),At(ie,I)):gt(ie,1,1),ne.genMipmaps&&(ie.mipmask=(ie.width<<1)-1),oe.mipmask=ie.mipmask,pe(oe,ie),D.texture2D(ne,ie,X),oe.internalformat=ie.internalformat,Ye.width=ie.width,Ye.height=ie.height,ir(oe),Gt(ie,_r),Qt(ne,_r),Mt(),Xt(ie),Ce.profile&&(oe.stats.size=An(oe.internalformat,oe.type,ie.width,ie.height,ne.genMipmaps,!1)),Ye.format=Pe[oe.internalformat],Ye.type=He[oe.type],Ye.mag=xe[ne.magFilter],Ye.min=tt[ne.minFilter],Ye.wrapS=Qe[ne.wrapS],Ye.wrapT=Qe[ne.wrapT],Ye}function wt(I,Z,ne,ie){D(!!I,"must specify image data");var ee=Z|0,J=ne|0,re=ie|0,V=Ve();return pe(V,oe),V.width=0,V.height=0,Fe(V,I),V.width=V.width||(oe.width>>re)-ee,V.height=V.height||(oe.height>>re)-J,D(oe.type===V.type&&oe.format===V.format&&oe.internalformat===V.internalformat,"incompatible format for texture.subimage"),D(ee>=0&&J>=0&&ee+V.width<=oe.width&&J+V.height<=oe.height,"texture.subimage write out of bounds"),D(oe.mipmask&1<<re,"missing mipmap data"),D(V.data||V.element||V.needsCopy,"missing image data"),ir(oe),yt(V,_r,ee,J,re),Mt(),Ue(V),Ye}function B(I,Z){var ne=I|0,ie=Z|0||ne;if(ne===oe.width&&ie===oe.height)return Ye;Ye.width=oe.width=ne,Ye.height=oe.height=ie,ir(oe);for(var ee=0;oe.mipmask>>ee;++ee){var J=ne>>ee,re=ie>>ee;if(!J||!re)break;S.texImage2D(_r,ee,oe.format,J,re,0,oe.format,oe.type,null)}return Mt(),Ce.profile&&(oe.stats.size=An(oe.internalformat,oe.type,ne,ie,!1,!1)),Ye}return Ye(q,fe),Ye.subimage=wt,Ye.resize=B,Ye._reglType="texture2d",Ye._texture=oe,Ce.profile&&(Ye.stats=oe.stats),Ye.destroy=function(){oe.decRef()},Ye}function kt(q,fe,oe,Ye,wt,B){var I=new Ct(vi);Jt[I.id]=I,he.cubeCount++;var Z=new Array(6);function ne(J,re,V,H,G,se){var ae,ye=I.texInfo;for(Nt.call(ye),ae=0;ae<6;++ae)Z[ae]=Et();if(typeof J=="number"||!J){var Se=J|0||1;for(ae=0;ae<6;++ae)gt(Z[ae],Se,Se)}else if(typeof J=="object")if(re)At(Z[0],J),At(Z[1],re),At(Z[2],V),At(Z[3],H),At(Z[4],G),At(Z[5],se);else if(Yt(ye,J),We(I,J),"faces"in J){var ze=J.faces;for(D(Array.isArray(ze)&&ze.length===6,"cube faces must be a length 6 array"),ae=0;ae<6;++ae)D(typeof ze[ae]=="object"&&!!ze[ae],"invalid input for cube map face"),pe(Z[ae],I),At(Z[ae],ze[ae])}else for(ae=0;ae<6;++ae)At(Z[ae],J);else D.raise("invalid arguments to cube map");for(pe(I,Z[0]),D.optional(function(){X.npotTextureCube||D(Pa(I.width)&&Pa(I.height),"your browser does not support non power or two texture dimensions")}),ye.genMipmaps?I.mipmask=(Z[0].width<<1)-1:I.mipmask=Z[0].mipmask,D.textureCube(I,ye,Z,X),I.internalformat=Z[0].internalformat,ne.width=Z[0].width,ne.height=Z[0].height,ir(I),ae=0;ae<6;++ae)Gt(Z[ae],Mn+ae);for(Qt(ye,vi),Mt(),Ce.profile&&(I.stats.size=An(I.internalformat,I.type,ne.width,ne.height,ye.genMipmaps,!0)),ne.format=Pe[I.internalformat],ne.type=He[I.type],ne.mag=xe[ye.magFilter],ne.min=tt[ye.minFilter],ne.wrapS=Qe[ye.wrapS],ne.wrapT=Qe[ye.wrapT],ae=0;ae<6;++ae)Xt(Z[ae]);return ne}function ie(J,re,V,H,G){D(!!re,"must specify image data"),D(typeof J=="number"&&J===(J|0)&&J>=0&&J<6,"invalid face");var se=V|0,ae=H|0,ye=G|0,Se=Ve();return pe(Se,I),Se.width=0,Se.height=0,Fe(Se,re),Se.width=Se.width||(I.width>>ye)-se,Se.height=Se.height||(I.height>>ye)-ae,D(I.type===Se.type&&I.format===Se.format&&I.internalformat===Se.internalformat,"incompatible format for texture.subimage"),D(se>=0&&ae>=0&&se+Se.width<=I.width&&ae+Se.height<=I.height,"texture.subimage write out of bounds"),D(I.mipmask&1<<ye,"missing mipmap data"),D(Se.data||Se.element||Se.needsCopy,"missing image data"),ir(I),yt(Se,Mn+J,se,ae,ye),Mt(),Ue(Se),ne}function ee(J){var re=J|0;if(re!==I.width){ne.width=I.width=re,ne.height=I.height=re,ir(I);for(var V=0;V<6;++V)for(var H=0;I.mipmask>>H;++H)S.texImage2D(Mn+V,H,I.format,re>>H,re>>H,0,I.format,I.type,null);return Mt(),Ce.profile&&(I.stats.size=An(I.internalformat,I.type,ne.width,ne.height,!1,!0)),ne}}return ne(q,fe,oe,Ye,wt,B),ne.subimage=ie,ne.resize=ee,ne._reglType="textureCube",ne._texture=I,Ce.profile&&(ne.stats=I.stats),ne.destroy=function(){I.decRef()},ne}function er(){for(var q=0;q<nr;++q)S.activeTexture(dn+q),S.bindTexture(_r,null),qt[q]=null;fr(Jt).forEach(ut),he.cubeCount=0,he.textureCount=0}Ce.profile&&(he.getTotalTextureSize=function(){var q=0;return Object.keys(Jt).forEach(function(fe){q+=Jt[fe].stats.size}),q});function or(){for(var q=0;q<nr;++q){var fe=qt[q];fe&&(fe.bindCount=0,fe.unit=-1,qt[q]=null)}fr(Jt).forEach(function(oe){oe.texture=S.createTexture(),S.bindTexture(oe.target,oe.texture);for(var Ye=0;Ye<32;++Ye)if((oe.mipmask&1<<Ye)!==0)if(oe.target===_r)S.texImage2D(_r,Ye,oe.internalformat,oe.width>>Ye,oe.height>>Ye,0,oe.internalformat,oe.type,null);else for(var wt=0;wt<6;++wt)S.texImage2D(Mn+wt,Ye,oe.internalformat,oe.width>>Ye,oe.height>>Ye,0,oe.internalformat,oe.type,null);Qt(oe.texInfo,oe.target)})}function Vr(){for(var q=0;q<nr;++q){var fe=qt[q];fe&&(fe.bindCount=0,fe.unit=-1,qt[q]=null),S.activeTexture(dn+q),S.bindTexture(_r,null),S.bindTexture(vi,null)}}return{create2D:xt,createCube:kt,clear:er,getTexture:function(fe){return null},restore:or,refresh:Vr}},aa=function(S,z,X){return vr[S]*z*X},Jo=function(S,z,X,ce,_e,he){var Ce={cur:null,next:null,dirty:!1,setFBO:null},Ee=["rgba"],Le=["rgba4","rgb565","rgb5 a1"];z.ext_srgb&&Le.push("srgba"),z.ext_color_buffer_half_float&&Le.push("rgba16f","rgb16f"),z.webgl_color_buffer_float&&Le.push("rgba32f");var Oe=["uint8"];z.oes_texture_half_float&&Oe.push("half float","float16"),z.oes_texture_float&&Oe.push("float","float32");function Ie(Me,Fe,Be){this.target=Me,this.texture=Fe,this.renderbuffer=Be;var yt=0,vt=0;Fe?(yt=Fe.width,vt=Fe.height):Be&&(yt=Be.width,vt=Be.height),this.width=yt,this.height=vt}function ke(Me){Me&&(Me.texture&&Me.texture._texture.decRef(),Me.renderbuffer&&Me.renderbuffer._renderbuffer.decRef())}function Te(Me,Fe,Be){if(!!Me)if(Me.texture){var yt=Me.texture._texture,vt=Math.max(1,yt.width),Ve=Math.max(1,yt.height);D(vt===Fe&&Ve===Be,"inconsistent width/height for supplied texture"),yt.refCount+=1}else{var Ue=Me.renderbuffer._renderbuffer;D(Ue.width===Fe&&Ue.height===Be,"inconsistent width/height for renderbuffer"),Ue.refCount+=1}}function Re(Me,Fe){Fe&&(Fe.texture?S.framebufferTexture2D(br,Me,Fe.target,Fe.texture._texture.texture,0):S.framebufferRenderbuffer(br,Me,Li,Fe.renderbuffer._renderbuffer.renderbuffer))}function $e(Me){var Fe=Ir,Be=null,yt=null,vt=Me;typeof Me=="object"&&(vt=Me.data,"target"in Me&&(Fe=Me.target|0)),D.type(vt,"function","invalid attachment data");var Ve=vt._reglType;return Ve==="texture2d"?(Be=vt,D(Fe===Ir)):Ve==="textureCube"?(Be=vt,D(Fe>=Bn&&Fe<Bn+6,"invalid cube map target")):Ve==="renderbuffer"?(yt=vt,Fe=Li):D.raise("invalid regl object for attachment"),new Ie(Fe,Be,yt)}function ue(Me,Fe,Be,yt,vt){if(Be){var Ve=ce.create2D({width:Me,height:Fe,format:yt,type:vt});return Ve._texture.refCount=0,new Ie(Ir,Ve,null)}else{var Ue=_e.create({width:Me,height:Fe,format:yt});return Ue._renderbuffer.refCount=0,new Ie(Li,null,Ue)}}function le(Me){return Me&&(Me.texture||Me.renderbuffer)}function Pe(Me,Fe,Be){Me&&(Me.texture?Me.texture.resize(Fe,Be):Me.renderbuffer&&Me.renderbuffer.resize(Fe,Be),Me.width=Fe,Me.height=Be)}var He=0,xe={};function tt(){this.id=He++,xe[this.id]=this,this.framebuffer=S.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Qe(Me){Me.colorAttachments.forEach(ke),ke(Me.depthAttachment),ke(Me.stencilAttachment),ke(Me.depthStencilAttachment)}function je(Me){var Fe=Me.framebuffer;D(Fe,"must not double destroy framebuffer"),S.deleteFramebuffer(Fe),Me.framebuffer=null,he.framebufferCount--,delete xe[Me.id]}function we(Me){var Fe;S.bindFramebuffer(br,Me.framebuffer);var Be=Me.colorAttachments;for(Fe=0;Fe<Be.length;++Fe)Re(eo+Fe,Be[Fe]);for(Fe=Be.length;Fe<X.maxColorAttachments;++Fe)S.framebufferTexture2D(br,eo+Fe,Ir,null,0);S.framebufferTexture2D(br,no,Ir,null,0),S.framebufferTexture2D(br,to,Ir,null,0),S.framebufferTexture2D(br,ro,Ir,null,0),Re(to,Me.depthAttachment),Re(ro,Me.stencilAttachment),Re(no,Me.depthStencilAttachment);var yt=S.checkFramebufferStatus(br);!S.isContextLost()&&yt!==io&&D.raise("framebuffer configuration not supported, status = "+Jr[yt]),S.bindFramebuffer(br,Ce.next?Ce.next.framebuffer:null),Ce.cur=Ce.next,S.getError()}function pe(Me,Fe){var Be=new tt;he.framebufferCount++;function yt(Ve,Ue){var lt;D(Ce.next!==Be,"can not update framebuffer which is currently in use");var gt=0,At=0,Gt=!0,Ut=!0,Et=null,Xt=!0,Nt="rgba",Yt="uint8",Qt=1,Zt=null,Jt=null,nr=null,qt=!1;if(typeof Ve=="number")gt=Ve|0,At=Ue|0||gt;else if(!Ve)gt=At=1;else{D.type(Ve,"object","invalid arguments for framebuffer");var Ct=Ve;if("shape"in Ct){var ir=Ct.shape;D(Array.isArray(ir)&&ir.length>=2,"invalid shape for framebuffer"),gt=ir[0],At=ir[1]}else"radius"in Ct&&(gt=At=Ct.radius),"width"in Ct&&(gt=Ct.width),"height"in Ct&&(At=Ct.height);("color"in Ct||"colors"in Ct)&&(Et=Ct.color||Ct.colors,Array.isArray(Et)&&D(Et.length===1||z.webgl_draw_buffers,"multiple render targets not supported")),Et||("colorCount"in Ct&&(Qt=Ct.colorCount|0,D(Qt>0,"invalid color buffer count")),"colorTexture"in Ct&&(Xt=!!Ct.colorTexture,Nt="rgba4"),"colorType"in Ct&&(Yt=Ct.colorType,Xt?(D(z.oes_texture_float||!(Yt==="float"||Yt==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),D(z.oes_texture_half_float||!(Yt==="half float"||Yt==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Yt==="half float"||Yt==="float16"?(D(z.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Nt="rgba16f"):(Yt==="float"||Yt==="float32")&&(D(z.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Nt="rgba32f"),D.oneOf(Yt,Oe,"invalid color type")),"colorFormat"in Ct&&(Nt=Ct.colorFormat,Ee.indexOf(Nt)>=0?Xt=!0:Le.indexOf(Nt)>=0?Xt=!1:D.optional(function(){Xt?D.oneOf(Ct.colorFormat,Ee,"invalid color format for texture"):D.oneOf(Ct.colorFormat,Le,"invalid color format for renderbuffer")}))),("depthTexture"in Ct||"depthStencilTexture"in Ct)&&(qt=!!(Ct.depthTexture||Ct.depthStencilTexture),D(!qt||z.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Ct&&(typeof Ct.depth=="boolean"?Gt=Ct.depth:(Zt=Ct.depth,Ut=!1)),"stencil"in Ct&&(typeof Ct.stencil=="boolean"?Ut=Ct.stencil:(Jt=Ct.stencil,Gt=!1)),"depthStencil"in Ct&&(typeof Ct.depthStencil=="boolean"?Gt=Ut=Ct.depthStencil:(nr=Ct.depthStencil,Gt=!1,Ut=!1))}var Mt=null,ut=null,xt=null,kt=null;if(Array.isArray(Et))Mt=Et.map($e);else if(Et)Mt=[$e(Et)];else for(Mt=new Array(Qt),lt=0;lt<Qt;++lt)Mt[lt]=ue(gt,At,Xt,Nt,Yt);D(z.webgl_draw_buffers||Mt.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),D(Mt.length<=X.maxColorAttachments,"too many color attachments, not supported"),gt=gt||Mt[0].width,At=At||Mt[0].height,Zt?ut=$e(Zt):Gt&&!Ut&&(ut=ue(gt,At,qt,"depth","uint32")),Jt?xt=$e(Jt):Ut&&!Gt&&(xt=ue(gt,At,!1,"stencil","uint8")),nr?kt=$e(nr):!Zt&&!Jt&&Ut&&Gt&&(kt=ue(gt,At,qt,"depth stencil","depth stencil")),D(!!Zt+!!Jt+!!nr<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var er=null;for(lt=0;lt<Mt.length;++lt)if(Te(Mt[lt],gt,At),D(!Mt[lt]||Mt[lt].texture&&uu.indexOf(Mt[lt].texture._texture.format)>=0||Mt[lt].renderbuffer&&gu.indexOf(Mt[lt].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+lt+" is invalid"),Mt[lt]&&Mt[lt].texture){var or=Mi[Mt[lt].texture._texture.format]*Nn[Mt[lt].texture._texture.type];er===null?er=or:D(er===or,"all color attachments much have the same number of bits per pixel.")}return Te(ut,gt,At),D(!ut||ut.texture&&ut.texture._texture.format===lu||ut.renderbuffer&&ut.renderbuffer._renderbuffer.format===du,"invalid depth attachment for framebuffer object"),Te(xt,gt,At),D(!xt||xt.renderbuffer&&xt.renderbuffer._renderbuffer.format===pu,"invalid stencil attachment for framebuffer object"),Te(kt,gt,At),D(!kt||kt.texture&&kt.texture._texture.format===so||kt.renderbuffer&&kt.renderbuffer._renderbuffer.format===so,"invalid depth-stencil attachment for framebuffer object"),Qe(Be),Be.width=gt,Be.height=At,Be.colorAttachments=Mt,Be.depthAttachment=ut,Be.stencilAttachment=xt,Be.depthStencilAttachment=kt,yt.color=Mt.map(le),yt.depth=le(ut),yt.stencil=le(xt),yt.depthStencil=le(kt),yt.width=Be.width,yt.height=Be.height,we(Be),yt}function vt(Ve,Ue){D(Ce.next!==Be,"can not resize a framebuffer which is currently in use");var lt=Math.max(Ve|0,1),gt=Math.max(Ue|0||lt,1);if(lt===Be.width&&gt===Be.height)return yt;for(var At=Be.colorAttachments,Gt=0;Gt<At.length;++Gt)Pe(At[Gt],lt,gt);return Pe(Be.depthAttachment,lt,gt),Pe(Be.stencilAttachment,lt,gt),Pe(Be.depthStencilAttachment,lt,gt),Be.width=yt.width=lt,Be.height=yt.height=gt,we(Be),yt}return yt(Me,Fe),jt(yt,{resize:vt,_reglType:"framebuffer",_framebuffer:Be,destroy:function(){je(Be),Qe(Be)},use:function(Ue){Ce.setFBO({framebuffer:yt},Ue)}})}function We(Me){var Fe=Array(6);function Be(vt){var Ve;D(Fe.indexOf(Ce.next)<0,"can not update framebuffer which is currently in use");var Ue={color:null},lt=0,gt=null,At="rgba",Gt="uint8",Ut=1;if(typeof vt=="number")lt=vt|0;else if(!vt)lt=1;else{D.type(vt,"object","invalid arguments for framebuffer");var Et=vt;if("shape"in Et){var Xt=Et.shape;D(Array.isArray(Xt)&&Xt.length>=2,"invalid shape for framebuffer"),D(Xt[0]===Xt[1],"cube framebuffer must be square"),lt=Xt[0]}else"radius"in Et&&(lt=Et.radius|0),"width"in Et?(lt=Et.width|0,"height"in Et&&D(Et.height===lt,"must be square")):"height"in Et&&(lt=Et.height|0);("color"in Et||"colors"in Et)&&(gt=Et.color||Et.colors,Array.isArray(gt)&&D(gt.length===1||z.webgl_draw_buffers,"multiple render targets not supported")),gt||("colorCount"in Et&&(Ut=Et.colorCount|0,D(Ut>0,"invalid color buffer count")),"colorType"in Et&&(D.oneOf(Et.colorType,Oe,"invalid color type"),Gt=Et.colorType),"colorFormat"in Et&&(At=Et.colorFormat,D.oneOf(Et.colorFormat,Ee,"invalid color format for texture"))),"depth"in Et&&(Ue.depth=Et.depth),"stencil"in Et&&(Ue.stencil=Et.stencil),"depthStencil"in Et&&(Ue.depthStencil=Et.depthStencil)}var Nt;if(gt)if(Array.isArray(gt))for(Nt=[],Ve=0;Ve<gt.length;++Ve)Nt[Ve]=gt[Ve];else Nt=[gt];else{Nt=Array(Ut);var Yt={radius:lt,format:At,type:Gt};for(Ve=0;Ve<Ut;++Ve)Nt[Ve]=ce.createCube(Yt)}for(Ue.color=Array(Nt.length),Ve=0;Ve<Nt.length;++Ve){var Qt=Nt[Ve];D(typeof Qt=="function"&&Qt._reglType==="textureCube","invalid cube map"),lt=lt||Qt.width,D(Qt.width===lt&&Qt.height===lt,"invalid cube map shape"),Ue.color[Ve]={target:Bn,data:Nt[Ve]}}for(Ve=0;Ve<6;++Ve){for(var Zt=0;Zt<Nt.length;++Zt)Ue.color[Zt].target=Bn+Ve;Ve>0&&(Ue.depth=Fe[0].depth,Ue.stencil=Fe[0].stencil,Ue.depthStencil=Fe[0].depthStencil),Fe[Ve]?Fe[Ve](Ue):Fe[Ve]=pe(Ue)}return jt(Be,{width:lt,height:lt,color:Nt})}function yt(vt){var Ve,Ue=vt|0;if(D(Ue>0&&Ue<=X.maxCubeMapSize,"invalid radius for cube fbo"),Ue===Be.width)return Be;var lt=Be.color;for(Ve=0;Ve<lt.length;++Ve)lt[Ve].resize(Ue);for(Ve=0;Ve<6;++Ve)Fe[Ve].resize(Ue);return Be.width=Be.height=Ue,Be}return Be(Me),jt(Be,{faces:Fe,resize:yt,_reglType:"framebufferCube",destroy:function(){Fe.forEach(function(Ve){Ve.destroy()})}})}function De(){Ce.cur=null,Ce.next=null,Ce.dirty=!0,fr(xe).forEach(function(Me){Me.framebuffer=S.createFramebuffer(),we(Me)})}return jt(Ce,{getFramebuffer:function(Fe){if(typeof Fe=="function"&&Fe._reglType==="framebuffer"){var Be=Fe._framebuffer;if(_instanceof$2(Be,tt))return Be}return null},create:pe,createCube:We,clear:function(){fr(xe).forEach(je)},restore:De})},oi=function(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=bu,this.offset=0,this.stride=0,this.divisor=0},es=function(S,z,X,ce,_e,he,Ce){for(var Ee=X.maxAttributes,Le=new Array(Ee),Oe=0;Oe<Ee;++Oe)Le[Oe]=new oi;var Ie=0,ke={},Te={Record:oi,scope:{},state:Le,currentVAO:null,targetVAO:null,restore:$e()?Qe:function(){},createVAO:je,getVAO:le,destroyBuffer:Re,setVAO:$e()?Pe:He,clear:$e()?xe:function(){}};function Re(we){for(var pe=0;pe<Le.length;++pe){var We=Le[pe];We.buffer===we&&(S.disableVertexAttribArray(pe),We.buffer=null)}}function $e(){return z.oes_vertex_array_object}function ue(){return z.angle_instanced_arrays}function le(we){return typeof we=="function"&&we._vao?we._vao:null}function Pe(we){if(we!==Te.currentVAO){var pe=$e();we?pe.bindVertexArrayOES(we.vao):pe.bindVertexArrayOES(null),Te.currentVAO=we}}function He(we){if(we!==Te.currentVAO){if(we)we.bindAttrs();else{for(var pe=ue(),We=0;We<Le.length;++We){var De=Le[We];De.buffer?(S.enableVertexAttribArray(We),De.buffer.bind(),S.vertexAttribPointer(We,De.size,De.type,De.normalized,De.stride,De.offfset),pe&&De.divisor&&pe.vertexAttribDivisorANGLE(We,De.divisor)):(S.disableVertexAttribArray(We),S.vertexAttrib4f(We,De.x,De.y,De.z,De.w))}Ce.elements?S.bindBuffer(Vn,Ce.elements.buffer.buffer):S.bindBuffer(Vn,null)}Te.currentVAO=we}}function xe(){fr(ke).forEach(function(we){we.destroy()})}function tt(){this.id=++Ie,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var we=$e();we?this.vao=we.createVertexArrayOES():this.vao=null,ke[this.id]=this,this.buffers=[]}tt.prototype.bindAttrs=function(){for(var we=ue(),pe=this.attributes,We=0;We<pe.length;++We){var De=pe[We];De.buffer?(S.enableVertexAttribArray(We),S.bindBuffer(lo,De.buffer.buffer),S.vertexAttribPointer(We,De.size,De.type,De.normalized,De.stride,De.offset),we&&De.divisor&&we.vertexAttribDivisorANGLE(We,De.divisor)):(S.disableVertexAttribArray(We),S.vertexAttrib4f(We,De.x,De.y,De.z,De.w))}for(var Me=pe.length;Me<Ee;++Me)S.disableVertexAttribArray(Me);var Fe=he.getElements(this.elements);Fe?S.bindBuffer(Vn,Fe.buffer.buffer):S.bindBuffer(Vn,null)},tt.prototype.refresh=function(){var we=$e();we&&(we.bindVertexArrayOES(this.vao),this.bindAttrs(),Te.currentVAO=null,we.bindVertexArrayOES(null))},tt.prototype.destroy=function(){if(this.vao){var we=$e();this===Te.currentVAO&&(Te.currentVAO=null,we.bindVertexArrayOES(null)),we.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),ke[this.id]&&(delete ke[this.id],ce.vaoCount-=1)};function Qe(){var we=$e();we&&fr(ke).forEach(function(pe){pe.refresh()})}function je(we){var pe=new tt;ce.vaoCount+=1;function We(De){var Me;if(Array.isArray(De))Me=De,pe.elements&&pe.ownsElements&&pe.elements.destroy(),pe.elements=null,pe.ownsElements=!1,pe.offset=0,pe.count=0,pe.instances=-1,pe.primitive=4;else{if(D(typeof De=="object","invalid arguments for create vao"),D("attributes"in De,"must specify attributes for vao"),De.elements){var Fe=De.elements;pe.ownsElements?typeof Fe=="function"&&Fe._reglType==="elements"?(pe.elements.destroy(),pe.ownsElements=!1):(pe.elements(Fe),pe.ownsElements=!1):he.getElements(De.elements)?(pe.elements=De.elements,pe.ownsElements=!1):(pe.elements=he.create(De.elements),pe.ownsElements=!0)}else pe.elements=null,pe.ownsElements=!1;Me=De.attributes,pe.offset=0,pe.count=-1,pe.instances=-1,pe.primitive=4,pe.elements&&(pe.count=pe.elements._elements.vertCount,pe.primitive=pe.elements._elements.primType),"offset"in De&&(pe.offset=De.offset|0),"count"in De&&(pe.count=De.count|0),"instances"in De&&(pe.instances=De.instances|0),"primitive"in De&&(D(De.primitive in Ar,"bad primitive type: "+De.primitive),pe.primitive=Ar[De.primitive]),D.optional(function(){for(var Gt=Object.keys(De),Ut=0;Ut<Gt.length;++Ut)D(uo.indexOf(Gt[Ut])>=0,'invalid option for vao: "'+Gt[Ut]+'" valid options are '+uo)}),D(Array.isArray(Me),"attributes must be an array")}D(Me.length<Ee,"too many attributes"),D(Me.length>0,"must specify at least one attribute");var Be={},yt=pe.attributes;yt.length=Me.length;for(var vt=0;vt<Me.length;++vt){var Ve=Me[vt],Ue=yt[vt]=new oi,lt=Ve.data||Ve;if(Array.isArray(lt)||tr(lt)||St(lt)){var gt;pe.buffers[vt]&&(gt=pe.buffers[vt],tr(lt)&&gt._buffer.byteLength>=lt.byteLength?gt.subdata(lt):(gt.destroy(),pe.buffers[vt]=null)),pe.buffers[vt]||(gt=pe.buffers[vt]=_e.create(Ve,lo,!1,!0)),Ue.buffer=_e.getBuffer(gt),Ue.size=Ue.buffer.dimension|0,Ue.normalized=!1,Ue.type=Ue.buffer.dtype,Ue.offset=0,Ue.stride=0,Ue.divisor=0,Ue.state=1,Be[vt]=1}else _e.getBuffer(Ve)?(Ue.buffer=_e.getBuffer(Ve),Ue.size=Ue.buffer.dimension|0,Ue.normalized=!1,Ue.type=Ue.buffer.dtype,Ue.offset=0,Ue.stride=0,Ue.divisor=0,Ue.state=1):_e.getBuffer(Ve.buffer)?(Ue.buffer=_e.getBuffer(Ve.buffer),Ue.size=(+Ve.size||Ue.buffer.dimension)|0,Ue.normalized=!!Ve.normalized||!1,"type"in Ve?(D.parameter(Ve.type,Mr,"invalid buffer type"),Ue.type=Mr[Ve.type]):Ue.type=Ue.buffer.dtype,Ue.offset=(Ve.offset||0)|0,Ue.stride=(Ve.stride||0)|0,Ue.divisor=(Ve.divisor||0)|0,Ue.state=1,D(Ue.size>=1&&Ue.size<=4,"size must be between 1 and 4"),D(Ue.offset>=0,"invalid offset"),D(Ue.stride>=0&&Ue.stride<=255,"stride must be between 0 and 255"),D(Ue.divisor>=0,"divisor must be positive"),D(!Ue.divisor||!!z.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Ve?(D(vt>0,"first attribute must not be a constant"),Ue.x=+Ve.x||0,Ue.y=+Ve.y||0,Ue.z=+Ve.z||0,Ue.w=+Ve.w||0,Ue.state=2):D(!1,"invalid attribute spec for location "+vt)}for(var At=0;At<pe.buffers.length;++At)!Be[At]&&pe.buffers[At]&&(pe.buffers[At].destroy(),pe.buffers[At]=null);return pe.refresh(),We}return We.destroy=function(){for(var De=0;De<pe.buffers.length;++De)pe.buffers[De]&&pe.buffers[De].destroy();pe.buffers.length=0,pe.ownsElements&&(pe.elements.destroy(),pe.elements=null,pe.ownsElements=!1),pe.destroy()},We._vao=pe,We._reglType="vao",We(we)}return Te},ts=function(S,z,X,ce){var _e={},he={};function Ce(ue,le,Pe,He){this.name=ue,this.id=le,this.location=Pe,this.info=He}function Ee(ue,le){for(var Pe=0;Pe<ue.length;++Pe)if(ue[Pe].id===le.id){ue[Pe].location=le.location;return}ue.push(le)}function Le(ue,le,Pe){var He=ue===co?_e:he,xe=He[le];if(!xe){var tt=z.str(le);xe=S.createShader(ue),S.shaderSource(xe,tt),S.compileShader(xe),D.shaderError(S,xe,tt,ue,Pe),He[le]=xe}return xe}var Oe={},Ie=[],ke=0;function Te(ue,le){this.id=ke++,this.fragId=ue,this.vertId=le,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,ce.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Re(ue,le,Pe){var He,xe,tt=Le(co,ue.fragId),Qe=Le(xu,ue.vertId),je=ue.program=S.createProgram();if(S.attachShader(je,tt),S.attachShader(je,Qe),Pe)for(He=0;He<Pe.length;++He){var we=Pe[He];S.bindAttribLocation(je,we[0],we[1])}S.linkProgram(je),D.linkError(S,je,z.str(ue.fragId),z.str(ue.vertId),le);var pe=S.getProgramParameter(je,Cu);ce.profile&&(ue.stats.uniformsCount=pe);var We=ue.uniforms;for(He=0;He<pe;++He)if(xe=S.getActiveUniform(je,He),xe){if(xe.size>1)for(var De=0;De<xe.size;++De){var Me=xe.name.replace("[0]","["+De+"]");Ee(We,new Ce(Me,z.id(Me),S.getUniformLocation(je,Me),xe))}var Fe=xe.name;xe.size>1&&(Fe=Fe.replace("[0]","")),Ee(We,new Ce(Fe,z.id(Fe),S.getUniformLocation(je,Fe),xe))}var Be=S.getProgramParameter(je,wu);ce.profile&&(ue.stats.attributesCount=Be);var yt=ue.attributes;for(He=0;He<Be;++He)xe=S.getActiveAttrib(je,He),xe&&Ee(yt,new Ce(xe.name,z.id(xe.name),S.getAttribLocation(je,xe.name),xe))}ce.profile&&(X.getMaxUniformsCount=function(){var ue=0;return Ie.forEach(function(le){le.stats.uniformsCount>ue&&(ue=le.stats.uniformsCount)}),ue},X.getMaxAttributesCount=function(){var ue=0;return Ie.forEach(function(le){le.stats.attributesCount>ue&&(ue=le.stats.attributesCount)}),ue});function $e(){_e={},he={};for(var ue=0;ue<Ie.length;++ue)Re(Ie[ue],null,Ie[ue].attributes.map(function(le){return[le.location,le.name]}))}return{clear:function(){var le=S.deleteShader.bind(S);fr(_e).forEach(le),_e={},fr(he).forEach(le),he={},Ie.forEach(function(Pe){S.deleteProgram(Pe.program)}),Ie.length=0,Oe={},X.shaderCount=0},program:function(le,Pe,He,xe){D.command(le>=0,"missing vertex shader",He),D.command(Pe>=0,"missing fragment shader",He);var tt=Oe[Pe];tt||(tt=Oe[Pe]={});var Qe=tt[le];if(Qe&&(Qe.refCount++,!xe))return Qe;var je=new Te(Pe,le);return X.shaderCount++,Re(je,He,xe),Qe||(tt[le]=je),Ie.push(je),jt(je,{destroy:function(){if(je.refCount--,je.refCount<=0){S.deleteProgram(je.program);var pe=Ie.indexOf(je);Ie.splice(pe,1),X.shaderCount--}tt[je.vertId].refCount<=0&&(S.deleteShader(he[je.vertId]),delete he[je.vertId],delete Oe[je.fragId][je.vertId]),Object.keys(Oe[je.fragId]).length||(S.deleteShader(_e[je.fragId]),delete _e[je.fragId],delete Oe[je.fragId])}})},restore:$e,shader:Le,frag:-1,vert:-1}},rs=function(S,z,X,ce,_e,he,Ce){function Ee(Ie){var ke;z.next===null?(D(_e.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),ke=pn):(D(z.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),ke=z.next.colorAttachments[0].texture._texture.type,D.optional(function(){he.oes_texture_float?(D(ke===pn||ke===Gn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),ke===Gn&&D(Ce.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):D(ke===pn,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var Te=0,Re=0,$e=ce.framebufferWidth,ue=ce.framebufferHeight,le=null;tr(Ie)?le=Ie:Ie&&(D.type(Ie,"object","invalid arguments to regl.read()"),Te=Ie.x|0,Re=Ie.y|0,D(Te>=0&&Te<ce.framebufferWidth,"invalid x offset for regl.read"),D(Re>=0&&Re<ce.framebufferHeight,"invalid y offset for regl.read"),$e=(Ie.width||ce.framebufferWidth-Te)|0,ue=(Ie.height||ce.framebufferHeight-Re)|0,le=Ie.data||null),le&&(ke===pn?D(_instanceof$2(le,Uint8Array),"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):ke===Gn&&D(_instanceof$2(le,Float32Array),"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),D($e>0&&$e+Te<=ce.framebufferWidth,"invalid width for read pixels"),D(ue>0&&ue+Re<=ce.framebufferHeight,"invalid height for read pixels"),X();var Pe=$e*ue*4;return le||(ke===pn?le=new Uint8Array(Pe):ke===Gn&&(le=le||new Float32Array(Pe))),D.isTypedArray(le,"data buffer for regl.read() must be a typedarray"),D(le.byteLength>=Pe,"data buffer for regl.read() too small"),S.pixelStorei(Pu,4),S.readPixels(Te,Re,$e,ue,Su,ke,le),le}function Le(Ie){var ke;return z.setFBO({framebuffer:Ie.framebuffer},function(){ke=Ee(Ie)}),ke}function Oe(Ie){return!Ie||!("framebuffer"in Ie)?Ee(Ie):Le(Ie)}return Oe},Hr=function(S){return Array.prototype.slice.call(S)},Wr=function(S){return Hr(S).join("")},ns=function(){var S=0,z=[],X=[];function ce(ke){for(var Te=0;Te<X.length;++Te)if(X[Te]===ke)return z[Te];var Re="g"+S++;return z.push(Re),X.push(ke),Re}function _e(){var ke=[];function Te(){ke.push.apply(ke,Hr(arguments))}var Re=[];function $e(){var ue="v"+S++;return Re.push(ue),arguments.length>0&&(ke.push(ue,"="),ke.push.apply(ke,Hr(arguments)),ke.push(";")),ue}return jt(Te,{def:$e,toString:function(){return Wr([Re.length>0?"var "+Re.join(",")+";":"",Wr(ke)])}})}function he(){var ke=_e(),Te=_e(),Re=ke.toString,$e=Te.toString;function ue(le,Pe){Te(le,Pe,"=",ke.def(le,Pe),";")}return jt(function(){ke.apply(ke,Hr(arguments))},{def:ke.def,entry:ke,exit:Te,save:ue,set:function(Pe,He,xe){ue(Pe,He),ke(Pe,He,"=",xe,";")},toString:function(){return Re()+$e()}})}function Ce(){var ke=Wr(arguments),Te=he(),Re=he(),$e=Te.toString,ue=Re.toString;return jt(Te,{then:function(){return Te.apply(Te,Hr(arguments)),this},else:function(){return Re.apply(Re,Hr(arguments)),this},toString:function(){var Pe=ue();return Pe&&(Pe="else{"+Pe+"}"),Wr(["if(",ke,"){",$e(),"}",Pe])}})}var Ee=_e(),Le={};function Oe(ke,Te){var Re=[];function $e(){var xe="a"+Re.length;return Re.push(xe),xe}Te=Te||0;for(var ue=0;ue<Te;++ue)$e();var le=he(),Pe=le.toString,He=Le[ke]=jt(le,{arg:$e,toString:function(){return Wr(["function(",Re.join(),"){",Pe(),"}"])}});return He}function Ie(){var ke=['"use strict";',Ee,"return {"];Object.keys(Le).forEach(function($e){ke.push('"',$e,'":',Le[$e].toString(),",")}),ke.push("}");var Te=Wr(ke).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n"),Re=Function.apply(null,z.concat(Te));return Re.apply(null,X)}return{global:Ee,link:ce,block:_e,proc:Oe,scope:he,cond:Ce,compile:Ie}},En=function(S){return Array.isArray(S)||tr(S)||St(S)},oa=function(S){return S.sort(function(z,X){return z===xr?-1:X===xr?1:z<X?-1:1})},Kt=function(S,z,X,ce){this.thisDep=S,this.contextDep=z,this.propDep=X,this.append=ce},Sr=function(S){return S&&!(S.thisDep||S.contextDep||S.propDep)},Ht=function(S){return new Kt(!1,!1,!1,S)},sr=function(S,z){var X=S.type;if(X===Ri){var ce=S.data.length;return new Kt(!0,ce>=1,ce>=2,z)}else if(X===Un){var _e=S.data;return new Kt(_e.thisDep,_e.contextDep,_e.propDep,z)}else{if(X===ho)return new Kt(!1,!1,!1,z);if(X===po){for(var he=!1,Ce=!1,Ee=!1,Le=0;Le<S.data.length;++Le){var Oe=S.data[Le];if(Oe.type===Ii)Ee=!0;else if(Oe.type===zi)Ce=!0;else if(Oe.type===Fi)he=!0;else if(Oe.type===Ri){he=!0;var Ie=Oe.data;Ie>=1&&(Ce=!0),Ie>=2&&(Ee=!0)}else Oe.type===Un&&(he=he||Oe.data.thisDep,Ce=Ce||Oe.data.contextDep,Ee=Ee||Oe.data.propDep)}return new Kt(he,Ce,Ee,z)}else return new Kt(X===Fi,X===zi,X===Ii,z)}},is=function(S,z,X,ce,_e,he,Ce,Ee,Le,Oe,Ie,ke,Te,Re,$e){var ue=Oe.Record,le={add:32774,subtract:32778,"reverse subtract":32779};X.ext_blend_minmax&&(le.min=Vu,le.max=Gu);var Pe=X.angle_instanced_arrays,He=X.webgl_draw_buffers,xe=X.oes_vertex_array_object,tt={dirty:!0,profile:$e.profile},Qe={},je=[],we={},pe={};function We(B){return B.replace(".","_")}function De(B,I,Z){var ne=We(B);je.push(B),Qe[ne]=tt[ne]=!!Z,we[ne]=I}function Me(B,I,Z){var ne=We(B);je.push(B),Array.isArray(Z)?(tt[ne]=Z.slice(),Qe[ne]=Z.slice()):tt[ne]=Qe[ne]=Z,pe[ne]=I}De(vo,Ru),De(mo,Tu),Me(_o,"blendColor",[0,0,0,0]),Me(Di,"blendEquationSeparate",[Fo,Fo]),Me(Bi,"blendFuncSeparate",[zo,Io,zo,Io]),De(yo,zu,!0),Me(go,"depthFunc",ju),Me(bo,"depthRange",[0,1]),Me(xo,"depthMask",!0),Me(Ni,Ni,[!0,!0,!0,!0]),De(Co,Mu),Me(wo,"cullFace",Nr),Me(Vi,Vi,ea),Me(Gi,Gi,1),De(So,Du),Me(Ui,"polygonOffset",[0,0]),De(Po,Bu),De(Ao,Nu),Me(ji,"sampleCoverage",[1,!1]),De(Eo,Iu),Me($o,"stencilMask",-1),Me(qi,"stencilFunc",[Uu,0,-1]),Me(Hi,"stencilOpSeparate",[Pn,$r,$r,$r]),Me(vn,"stencilOpSeparate",[Nr,$r,$r,$r]),De(ko,Fu),Me(jn,"scissor",[0,0,S.drawingBufferWidth,S.drawingBufferHeight]),Me(xr,xr,[0,0,S.drawingBufferWidth,S.drawingBufferHeight]);var Fe={gl:S,context:Te,strings:z,next:Qe,current:tt,draw:ke,elements:he,buffer:_e,shader:Ie,attributes:Oe.state,vao:Oe,uniforms:Le,framebuffer:Ee,extensions:X,timer:Re,isBufferArgs:En},Be={primTypes:Ar,compareFuncs:on,blendFuncs:yr,blendEquations:le,stencilOps:kr,glTypes:Mr,orientationType:ta};D.optional(function(){Fe.isArrayLike=st}),He&&(Be.backBuffer=[Nr],Be.drawBuffer=dt(ce.maxDrawbuffers,function(B){return B===0?[0]:dt(B,function(I){return qu+I})}));var yt=0;function vt(){var B=ns(),I=B.link,Z=B.global;B.id=yt++,B.batchId="0";var ne=I(Fe),ie=B.shared={props:"a0"};Object.keys(Fe).forEach(function(H){ie[H]=Z.def(ne,".",H)}),D.optional(function(){B.CHECK=I(D),B.commandStr=D.guessCommand(),B.command=I(B.commandStr),B.assert=function(H,G,se){H("if(!(",G,"))",this.CHECK,".commandRaise(",I(se),",",this.command,");")},Be.invalidBlendCombinations=Bo});var ee=B.next={},J=B.current={};Object.keys(pe).forEach(function(H){Array.isArray(tt[H])&&(ee[H]=Z.def(ie.next,".",H),J[H]=Z.def(ie.current,".",H))});var re=B.constants={};Object.keys(Be).forEach(function(H){re[H]=Z.def(JSON.stringify(Be[H]))}),B.invoke=function(H,G){switch(G.type){case Ri:var se=["this",ie.context,ie.props,B.batchId];return H.def(I(G.data),".call(",se.slice(0,Math.max(G.data.length+1,4)),")");case Ii:return H.def(ie.props,G.data);case zi:return H.def(ie.context,G.data);case Fi:return H.def("this",G.data);case Un:return G.data.append(B,H),G.data.ref;case ho:return G.data.toString();case po:return G.data.map(function(ae){return B.invoke(H,ae)})}},B.attribCache={};var V={};return B.scopeAttrib=function(H){var G=z.id(H);if(G in V)return V[G];var se=Oe.scope[G];se||(se=Oe.scope[G]=new ue);var ae=V[G]=I(se);return ae},B}function Ve(B){var I=B.static,Z=B.dynamic,ne;if(mn in I){var ie=!!I[mn];ne=Ht(function(J,re){return ie}),ne.enable=ie}else if(mn in Z){var ee=Z[mn];ne=sr(ee,function(J,re){return J.invoke(re,ee)})}return ne}function Ue(B,I){var Z=B.static,ne=B.dynamic;if(zr in Z){var ie=Z[zr];return ie?(ie=Ee.getFramebuffer(ie),D.command(ie,"invalid framebuffer object"),Ht(function(J,re){var V=J.link(ie),H=J.shared;re.set(H.framebuffer,".next",V);var G=H.context;return re.set(G,"."+rn,V+".width"),re.set(G,"."+nn,V+".height"),V})):Ht(function(J,re){var V=J.shared;re.set(V.framebuffer,".next","null");var H=V.context;return re.set(H,"."+rn,H+"."+Lo),re.set(H,"."+nn,H+"."+Mo),"null"})}else if(zr in ne){var ee=ne[zr];return sr(ee,function(J,re){var V=J.invoke(re,ee),H=J.shared,G=H.framebuffer,se=re.def(G,".getFramebuffer(",V,")");D.optional(function(){J.assert(re,"!"+V+"||"+se,"invalid framebuffer object")}),re.set(G,".next",se);var ae=H.context;return re.set(ae,"."+rn,se+"?"+se+".width:"+ae+"."+Lo),re.set(ae,"."+nn,se+"?"+se+".height:"+ae+"."+Mo),se})}else return null}function lt(B,I,Z){var ne=B.static,ie=B.dynamic;function ee(V){if(V in ne){var H=ne[V];D.commandType(H,"object","invalid "+V,Z.commandStr);var G=!0,se=H.x|0,ae=H.y|0,ye,Se;return"width"in H?(ye=H.width|0,D.command(ye>=0,"invalid "+V,Z.commandStr)):G=!1,"height"in H?(Se=H.height|0,D.command(Se>=0,"invalid "+V,Z.commandStr)):G=!1,new Kt(!G&&I&&I.thisDep,!G&&I&&I.contextDep,!G&&I&&I.propDep,function(nt,Xe){var Ae=nt.shared.context,me=ye;"width"in H||(me=Xe.def(Ae,".",rn,"-",se));var Je=Se;return"height"in H||(Je=Xe.def(Ae,".",nn,"-",ae)),[se,ae,me,Je]})}else if(V in ie){var ze=ie[V],ht=sr(ze,function(nt,Xe){var Ae=nt.invoke(Xe,ze);D.optional(function(){nt.assert(Xe,Ae+"&&typeof "+Ae+'==="object"',"invalid "+V)});var me=nt.shared.context,Je=Xe.def(Ae,".x|0"),Ke=Xe.def(Ae,".y|0"),ct=Xe.def('"width" in ',Ae,"?",Ae,".width|0:","(",me,".",rn,"-",Je,")"),zt=Xe.def('"height" in ',Ae,"?",Ae,".height|0:","(",me,".",nn,"-",Ke,")");return D.optional(function(){nt.assert(Xe,ct+">=0&&"+zt+">=0","invalid "+V)}),[Je,Ke,ct,zt]});return I&&(ht.thisDep=ht.thisDep||I.thisDep,ht.contextDep=ht.contextDep||I.contextDep,ht.propDep=ht.propDep||I.propDep),ht}else return I?new Kt(I.thisDep,I.contextDep,I.propDep,function(nt,Xe){var Ae=nt.shared.context;return[0,0,Xe.def(Ae,".",rn),Xe.def(Ae,".",nn)]}):null}var J=ee(xr);if(J){var re=J;J=new Kt(J.thisDep,J.contextDep,J.propDep,function(V,H){var G=re.append(V,H),se=V.shared.context;return H.set(se,"."+Au,G[2]),H.set(se,"."+Eu,G[3]),G})}return{viewport:J,scissor_box:ee(jn)}}function gt(B,I){var Z=B.static,ne=typeof Z[yn]=="string"&&typeof Z[_n]=="string";if(ne){if(Object.keys(I.dynamic).length>0)return null;var ie=I.static,ee=Object.keys(ie);if(ee.length>0&&typeof ie[ee[0]]=="number"){for(var J=[],re=0;re<ee.length;++re)D(typeof ie[ee[re]]=="number","must specify all vertex attribute locations when using vaos"),J.push([ie[ee[re]]|0,ee[re]]);return J}}return null}function At(B,I,Z){var ne=B.static,ie=B.dynamic;function ee(G){if(G in ne){var se=z.id(ne[G]);D.optional(function(){Ie.shader(No[G],se,D.guessCommand())});var ae=Ht(function(){return se});return ae.id=se,ae}else if(G in ie){var ye=ie[G];return sr(ye,function(Se,ze){var ht=Se.invoke(ze,ye),nt=ze.def(Se.shared.strings,".id(",ht,")");return D.optional(function(){ze(Se.shared.shader,".shader(",No[G],",",nt,",",Se.command,");")}),nt})}return null}var J=ee(yn),re=ee(_n),V=null,H;return Sr(J)&&Sr(re)?(V=Ie.program(re.id,J.id,null,Z),H=Ht(function(G,se){return G.link(V)})):H=new Kt(J&&J.thisDep||re&&re.thisDep,J&&J.contextDep||re&&re.contextDep,J&&J.propDep||re&&re.propDep,function(G,se){var ae=G.shared.shader,ye;J?ye=J.append(G,se):ye=se.def(ae,".",yn);var Se;re?Se=re.append(G,se):Se=se.def(ae,".",_n);var ze=ae+".program("+Se+","+ye;return D.optional(function(){ze+=","+G.command}),se.def(ze+")")}),{frag:J,vert:re,progVar:H,program:V}}function Gt(B,I){var Z=B.static,ne=B.dynamic,ie={},ee=!1;function J(){if(gn in Z){var Xe=Z[gn];return Xe!==null&&Oe.getVAO(Xe)===null&&(Xe=Oe.createVAO(Xe)),ee=!0,ie.vao=Xe,Ht(function(me){var Je=Oe.getVAO(Xe);return Je?me.link(Je):"null"})}else if(gn in ne){ee=!0;var Ae=ne[gn];return sr(Ae,function(me,Je){var Ke=me.invoke(Je,Ae);return Je.def(me.shared.vao+".getVAO("+Ke+")")})}return null}var re=J(),V=!1;function H(){if(Fr in Z){var Xe=Z[Fr];if(ie.elements=Xe,En(Xe)){var Ae=ie.elements=he.create(Xe,!0);Xe=he.getElements(Ae),V=!0}else Xe&&(Xe=he.getElements(Xe),V=!0,D.command(Xe,"invalid elements",I.commandStr));var me=Ht(function(Ke,ct){if(Xe){var zt=Ke.link(Xe);return Ke.ELEMENTS=zt,zt}return Ke.ELEMENTS=null,null});return me.value=Xe,me}else if(Fr in ne){V=!0;var Je=ne[Fr];return sr(Je,function(Ke,ct){var zt=Ke.shared,ar=zt.isBufferArgs,Gr=zt.elements,Cr=Ke.invoke(ct,Je),gr=ct.def("null"),Or=ct.def(ar,"(",Cr,")"),Ur=Ke.cond(Or).then(gr,"=",Gr,".createStream(",Cr,");").else(gr,"=",Gr,".getElements(",Cr,");");return D.optional(function(){Ke.assert(Ur.else,"!"+Cr+"||"+gr,"invalid elements")}),ct.entry(Ur),ct.exit(Ke.cond(Or).then(Gr,".destroyStream(",gr,");")),Ke.ELEMENTS=gr,gr})}else if(ee)return new Kt(re.thisDep,re.contextDep,re.propDep,function(Ke,ct){return ct.def(Ke.shared.vao+".currentVAO?"+Ke.shared.elements+".getElements("+Ke.shared.vao+".currentVAO.elements):null")});return null}var G=H();function se(){if(Dr in Z){var Xe=Z[Dr];return ie.primitive=Xe,D.commandParameter(Xe,Ar,"invalid primitve",I.commandStr),Ht(function(me,Je){return Ar[Xe]})}else if(Dr in ne){var Ae=ne[Dr];return sr(Ae,function(me,Je){var Ke=me.constants.primTypes,ct=me.invoke(Je,Ae);return D.optional(function(){me.assert(Je,ct+" in "+Ke,"invalid primitive, must be one of "+Object.keys(Ar))}),Je.def(Ke,"[",ct,"]")})}else{if(V)return Sr(G)?G.value?Ht(function(me,Je){return Je.def(me.ELEMENTS,".primType")}):Ht(function(){return Ji}):new Kt(G.thisDep,G.contextDep,G.propDep,function(me,Je){var Ke=me.ELEMENTS;return Je.def(Ke,"?",Ke,".primType:",Ji)});if(ee)return new Kt(re.thisDep,re.contextDep,re.propDep,function(me,Je){return Je.def(me.shared.vao+".currentVAO?"+me.shared.vao+".currentVAO.primitive:"+Ji)})}return null}function ae(Xe,Ae){if(Xe in Z){var me=Z[Xe]|0;return Ae?ie.offset=me:ie.instances=me,D.command(!Ae||me>=0,"invalid "+Xe,I.commandStr),Ht(function(Ke,ct){return Ae&&(Ke.OFFSET=me),me})}else if(Xe in ne){var Je=ne[Xe];return sr(Je,function(Ke,ct){var zt=Ke.invoke(ct,Je);return Ae&&(Ke.OFFSET=zt,D.optional(function(){Ke.assert(ct,zt+">=0","invalid "+Xe)})),zt})}else if(Ae){if(V)return Ht(function(Ke,ct){return Ke.OFFSET=0,0});if(ee)return new Kt(re.thisDep,re.contextDep,re.propDep,function(Ke,ct){return ct.def(Ke.shared.vao+".currentVAO?"+Ke.shared.vao+".currentVAO.offset:0")})}else if(ee)return new Kt(re.thisDep,re.contextDep,re.propDep,function(Ke,ct){return ct.def(Ke.shared.vao+".currentVAO?"+Ke.shared.vao+".currentVAO.instances:-1")});return null}var ye=ae(qn,!0);function Se(){if(Br in Z){var Xe=Z[Br]|0;return ie.count=Xe,D.command(typeof Xe=="number"&&Xe>=0,"invalid vertex count",I.commandStr),Ht(function(){return Xe})}else if(Br in ne){var Ae=ne[Br];return sr(Ae,function(ct,zt){var ar=ct.invoke(zt,Ae);return D.optional(function(){ct.assert(zt,"typeof "+ar+'==="number"&&'+ar+">=0&&"+ar+"===("+ar+"|0)","invalid vertex count")}),ar})}else if(V)if(Sr(G)){if(G)return ye?new Kt(ye.thisDep,ye.contextDep,ye.propDep,function(ct,zt){var ar=zt.def(ct.ELEMENTS,".vertCount-",ct.OFFSET);return D.optional(function(){ct.assert(zt,ar+">=0","invalid vertex offset/element buffer too small")}),ar}):Ht(function(ct,zt){return zt.def(ct.ELEMENTS,".vertCount")});var me=Ht(function(){return-1});return D.optional(function(){me.MISSING=!0}),me}else{var Je=new Kt(G.thisDep||ye.thisDep,G.contextDep||ye.contextDep,G.propDep||ye.propDep,function(ct,zt){var ar=ct.ELEMENTS;return ct.OFFSET?zt.def(ar,"?",ar,".vertCount-",ct.OFFSET,":-1"):zt.def(ar,"?",ar,".vertCount:-1")});return D.optional(function(){Je.DYNAMIC=!0}),Je}else if(ee){var Ke=new Kt(re.thisDep,re.contextDep,re.propDep,function(ct,zt){return zt.def(ct.shared.vao,".currentVAO?",ct.shared.vao,".currentVAO.count:-1")});return Ke}return null}var ze=se(),ht=Se(),nt=ae(Hn,!1);return{elements:G,primitive:ze,count:ht,instances:nt,offset:ye,vao:re,vaoActive:ee,elementsActive:V,static:ie}}function Ut(B,I){var Z=B.static,ne=B.dynamic,ie={};return je.forEach(function(ee){var J=We(ee);function re(V,H){if(ee in Z){var G=V(Z[ee]);ie[J]=Ht(function(){return G})}else if(ee in ne){var se=ne[ee];ie[J]=sr(se,function(ae,ye){return H(ae,ye,ae.invoke(ye,se))})}}switch(ee){case Co:case mo:case vo:case Eo:case yo:case ko:case So:case Po:case Ao:case xo:return re(function(V){return D.commandType(V,"boolean",ee,I.commandStr),V},function(V,H,G){return D.optional(function(){V.assert(H,"typeof "+G+'==="boolean"',"invalid flag "+ee,V.commandStr)}),G});case go:return re(function(V){return D.commandParameter(V,on,"invalid "+ee,I.commandStr),on[V]},function(V,H,G){var se=V.constants.compareFuncs;return D.optional(function(){V.assert(H,G+" in "+se,"invalid "+ee+", must be one of "+Object.keys(on))}),H.def(se,"[",G,"]")});case bo:return re(function(V){return D.command(st(V)&&V.length===2&&typeof V[0]=="number"&&typeof V[1]=="number"&&V[0]<=V[1],"depth range is 2d array",I.commandStr),V},function(V,H,G){D.optional(function(){V.assert(H,V.shared.isArrayLike+"("+G+")&&"+G+".length===2&&typeof "+G+'[0]==="number"&&typeof '+G+'[1]==="number"&&'+G+"[0]<="+G+"[1]","depth range must be a 2d array")});var se=H.def("+",G,"[0]"),ae=H.def("+",G,"[1]");return[se,ae]});case Bi:return re(function(V){D.commandType(V,"object","blend.func",I.commandStr);var H="srcRGB"in V?V.srcRGB:V.src,G="srcAlpha"in V?V.srcAlpha:V.src,se="dstRGB"in V?V.dstRGB:V.dst,ae="dstAlpha"in V?V.dstAlpha:V.dst;return D.commandParameter(H,yr,J+".srcRGB",I.commandStr),D.commandParameter(G,yr,J+".srcAlpha",I.commandStr),D.commandParameter(se,yr,J+".dstRGB",I.commandStr),D.commandParameter(ae,yr,J+".dstAlpha",I.commandStr),D.command(Bo.indexOf(H+", "+se)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+H+", "+se+")",I.commandStr),[yr[H],yr[se],yr[G],yr[ae]]},function(V,H,G){var se=V.constants.blendFuncs;D.optional(function(){V.assert(H,G+"&&typeof "+G+'==="object"',"invalid blend func, must be an object")});function ae(Ae,me){var Je=H.def('"',Ae,me,'" in ',G,"?",G,".",Ae,me,":",G,".",Ae);return D.optional(function(){V.assert(H,Je+" in "+se,"invalid "+ee+"."+Ae+me+", must be one of "+Object.keys(yr))}),Je}var ye=ae("src","RGB"),Se=ae("dst","RGB");D.optional(function(){var Ae=V.constants.invalidBlendCombinations;V.assert(H,Ae+".indexOf("+ye+'+", "+'+Se+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var ze=H.def(se,"[",ye,"]"),ht=H.def(se,"[",ae("src","Alpha"),"]"),nt=H.def(se,"[",Se,"]"),Xe=H.def(se,"[",ae("dst","Alpha"),"]");return[ze,nt,ht,Xe]});case Di:return re(function(V){if(typeof V=="string")return D.commandParameter(V,le,"invalid "+ee,I.commandStr),[le[V],le[V]];if(typeof V=="object")return D.commandParameter(V.rgb,le,ee+".rgb",I.commandStr),D.commandParameter(V.alpha,le,ee+".alpha",I.commandStr),[le[V.rgb],le[V.alpha]];D.commandRaise("invalid blend.equation",I.commandStr)},function(V,H,G){var se=V.constants.blendEquations,ae=H.def(),ye=H.def(),Se=V.cond("typeof ",G,'==="string"');return D.optional(function(){function ze(ht,nt,Xe){V.assert(ht,Xe+" in "+se,"invalid "+nt+", must be one of "+Object.keys(le))}ze(Se.then,ee,G),V.assert(Se.else,G+"&&typeof "+G+'==="object"',"invalid "+ee),ze(Se.else,ee+".rgb",G+".rgb"),ze(Se.else,ee+".alpha",G+".alpha")}),Se.then(ae,"=",ye,"=",se,"[",G,"];"),Se.else(ae,"=",se,"[",G,".rgb];",ye,"=",se,"[",G,".alpha];"),H(Se),[ae,ye]});case _o:return re(function(V){return D.command(st(V)&&V.length===4,"blend.color must be a 4d array",I.commandStr),dt(4,function(H){return+V[H]})},function(V,H,G){return D.optional(function(){V.assert(H,V.shared.isArrayLike+"("+G+")&&"+G+".length===4","blend.color must be a 4d array")}),dt(4,function(se){return H.def("+",G,"[",se,"]")})});case $o:return re(function(V){return D.commandType(V,"number",J,I.commandStr),V|0},function(V,H,G){return D.optional(function(){V.assert(H,"typeof "+G+'==="number"',"invalid stencil.mask")}),H.def(G,"|0")});case qi:return re(function(V){D.commandType(V,"object",J,I.commandStr);var H=V.cmp||"keep",G=V.ref||0,se="mask"in V?V.mask:-1;return D.commandParameter(H,on,ee+".cmp",I.commandStr),D.commandType(G,"number",ee+".ref",I.commandStr),D.commandType(se,"number",ee+".mask",I.commandStr),[on[H],G,se]},function(V,H,G){var se=V.constants.compareFuncs;D.optional(function(){function ze(){V.assert(H,Array.prototype.join.call(arguments,""),"invalid stencil.func")}ze(G+"&&typeof ",G,'==="object"'),ze('!("cmp" in ',G,")||(",G,".cmp in ",se,")")});var ae=H.def('"cmp" in ',G,"?",se,"[",G,".cmp]",":",$r),ye=H.def(G,".ref|0"),Se=H.def('"mask" in ',G,"?",G,".mask|0:-1");return[ae,ye,Se]});case Hi:case vn:return re(function(V){D.commandType(V,"object",J,I.commandStr);var H=V.fail||"keep",G=V.zfail||"keep",se=V.zpass||"keep";return D.commandParameter(H,kr,ee+".fail",I.commandStr),D.commandParameter(G,kr,ee+".zfail",I.commandStr),D.commandParameter(se,kr,ee+".zpass",I.commandStr),[ee===vn?Nr:Pn,kr[H],kr[G],kr[se]]},function(V,H,G){var se=V.constants.stencilOps;D.optional(function(){V.assert(H,G+"&&typeof "+G+'==="object"',"invalid "+ee)});function ae(ye){return D.optional(function(){V.assert(H,'!("'+ye+'" in '+G+")||("+G+"."+ye+" in "+se+")","invalid "+ee+"."+ye+", must be one of "+Object.keys(kr))}),H.def('"',ye,'" in ',G,"?",se,"[",G,".",ye,"]:",$r)}return[ee===vn?Nr:Pn,ae("fail"),ae("zfail"),ae("zpass")]});case Ui:return re(function(V){D.commandType(V,"object",J,I.commandStr);var H=V.factor|0,G=V.units|0;return D.commandType(H,"number",J+".factor",I.commandStr),D.commandType(G,"number",J+".units",I.commandStr),[H,G]},function(V,H,G){D.optional(function(){V.assert(H,G+"&&typeof "+G+'==="object"',"invalid "+ee)});var se=H.def(G,".factor|0"),ae=H.def(G,".units|0");return[se,ae]});case wo:return re(function(V){var H=0;return V==="front"?H=Pn:V==="back"&&(H=Nr),D.command(!!H,J,I.commandStr),H},function(V,H,G){return D.optional(function(){V.assert(H,G+'==="front"||'+G+'==="back"',"invalid cull.face")}),H.def(G,'==="front"?',Pn,":",Nr)});case Gi:return re(function(V){return D.command(typeof V=="number"&&V>=ce.lineWidthDims[0]&&V<=ce.lineWidthDims[1],"invalid line width, must be a positive number between "+ce.lineWidthDims[0]+" and "+ce.lineWidthDims[1],I.commandStr),V},function(V,H,G){return D.optional(function(){V.assert(H,"typeof "+G+'==="number"&&'+G+">="+ce.lineWidthDims[0]+"&&"+G+"<="+ce.lineWidthDims[1],"invalid line width")}),G});case Vi:return re(function(V){return D.commandParameter(V,ta,J,I.commandStr),ta[V]},function(V,H,G){return D.optional(function(){V.assert(H,G+'==="cw"||'+G+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),H.def(G+'==="cw"?'+Ro+":"+ea)});case Ni:return re(function(V){return D.command(st(V)&&V.length===4,"color.mask must be length 4 array",I.commandStr),V.map(function(H){return!!H})},function(V,H,G){return D.optional(function(){V.assert(H,V.shared.isArrayLike+"("+G+")&&"+G+".length===4","invalid color.mask")}),dt(4,function(se){return"!!"+G+"["+se+"]"})});case ji:return re(function(V){D.command(typeof V=="object"&&V,J,I.commandStr);var H="value"in V?V.value:1,G=!!V.invert;return D.command(typeof H=="number"&&H>=0&&H<=1,"sample.coverage.value must be a number between 0 and 1",I.commandStr),[H,G]},function(V,H,G){D.optional(function(){V.assert(H,G+"&&typeof "+G+'==="object"',"invalid sample.coverage")});var se=H.def('"value" in ',G,"?+",G,".value:1"),ae=H.def("!!",G,".invert");return[se,ae]})}}),ie}function Et(B,I){var Z=B.static,ne=B.dynamic,ie={};return Object.keys(Z).forEach(function(ee){var J=Z[ee],re;if(typeof J=="number"||typeof J=="boolean")re=Ht(function(){return J});else if(typeof J=="function"){var V=J._reglType;V==="texture2d"||V==="textureCube"?re=Ht(function(H){return H.link(J)}):V==="framebuffer"||V==="framebufferCube"?(D.command(J.color.length>0,'missing color attachment for framebuffer sent to uniform "'+ee+'"',I.commandStr),re=Ht(function(H){return H.link(J.color[0])})):D.commandRaise('invalid data for uniform "'+ee+'"',I.commandStr)}else st(J)?re=Ht(function(H){var G=H.global.def("[",dt(J.length,function(se){return D.command(typeof J[se]=="number"||typeof J[se]=="boolean","invalid uniform "+ee,H.commandStr),J[se]}),"]");return G}):D.commandRaise('invalid or missing data for uniform "'+ee+'"',I.commandStr);re.value=J,ie[ee]=re}),Object.keys(ne).forEach(function(ee){var J=ne[ee];ie[ee]=sr(J,function(re,V){return re.invoke(V,J)})}),ie}function Xt(B,I){var Z=B.static,ne=B.dynamic,ie={};return Object.keys(Z).forEach(function(ee){var J=Z[ee],re=z.id(ee),V=new ue;if(En(J))V.state=tn,V.buffer=_e.getBuffer(_e.create(J,an,!1,!0)),V.type=0;else{var H=_e.getBuffer(J);if(H)V.state=tn,V.buffer=H,V.type=0;else if(D.command(typeof J=="object"&&J,"invalid data for attribute "+ee,I.commandStr),"constant"in J){var G=J.constant;V.buffer="null",V.state=Ti,typeof G=="number"?V.x=G:(D.command(st(G)&&G.length>0&&G.length<=4,"invalid constant for attribute "+ee,I.commandStr),en.forEach(function(nt,Xe){Xe<G.length&&(V[nt]=G[Xe])}))}else{En(J.buffer)?H=_e.getBuffer(_e.create(J.buffer,an,!1,!0)):H=_e.getBuffer(J.buffer),D.command(!!H,'missing buffer for attribute "'+ee+'"',I.commandStr);var se=J.offset|0;D.command(se>=0,'invalid offset for attribute "'+ee+'"',I.commandStr);var ae=J.stride|0;D.command(ae>=0&&ae<256,'invalid stride for attribute "'+ee+'", must be integer betweeen [0, 255]',I.commandStr);var ye=J.size|0;D.command(!("size"in J)||ye>0&&ye<=4,'invalid size for attribute "'+ee+'", must be 1,2,3,4',I.commandStr);var Se=!!J.normalized,ze=0;"type"in J&&(D.commandParameter(J.type,Mr,"invalid type for attribute "+ee,I.commandStr),ze=Mr[J.type]);var ht=J.divisor|0;D.optional(function(){"divisor"in J&&(D.command(ht===0||Pe,'cannot specify divisor for attribute "'+ee+'", instancing not supported',I.commandStr),D.command(ht>=0,'invalid divisor for attribute "'+ee+'"',I.commandStr));var nt=I.commandStr,Xe=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(J).forEach(function(Ae){D.command(Xe.indexOf(Ae)>=0,'unknown parameter "'+Ae+'" for attribute pointer "'+ee+'" (valid parameters are '+Xe+")",nt)})}),V.buffer=H,V.state=tn,V.size=ye,V.normalized=Se,V.type=ze||H.dtype,V.offset=se,V.stride=ae,V.divisor=ht}}ie[ee]=Ht(function(nt,Xe){var Ae=nt.attribCache;if(re in Ae)return Ae[re];var me={isStream:!1};return Object.keys(V).forEach(function(Je){me[Je]=V[Je]}),V.buffer&&(me.buffer=nt.link(V.buffer),me.type=me.type||me.buffer+".dtype"),Ae[re]=me,me})}),Object.keys(ne).forEach(function(ee){var J=ne[ee];function re(V,H){var G=V.invoke(H,J),se=V.shared,ae=V.constants,ye=se.isBufferArgs,Se=se.buffer;D.optional(function(){V.assert(H,G+"&&(typeof "+G+'==="object"||typeof '+G+'==="function")&&('+ye+"("+G+")||"+Se+".getBuffer("+G+")||"+Se+".getBuffer("+G+".buffer)||"+ye+"("+G+'.buffer)||("constant" in '+G+"&&(typeof "+G+'.constant==="number"||'+se.isArrayLike+"("+G+".constant))))",'invalid dynamic attribute "'+ee+'"')});var ze={isStream:H.def(!1)},ht=new ue;ht.state=tn,Object.keys(ht).forEach(function(me){ze[me]=H.def(""+ht[me])});var nt=ze.buffer,Xe=ze.type;H("if(",ye,"(",G,")){",ze.isStream,"=true;",nt,"=",Se,".createStream(",an,",",G,");",Xe,"=",nt,".dtype;","}else{",nt,"=",Se,".getBuffer(",G,");","if(",nt,"){",Xe,"=",nt,".dtype;",'}else if("constant" in ',G,"){",ze.state,"=",Ti,";","if(typeof "+G+'.constant === "number"){',ze[en[0]],"=",G,".constant;",en.slice(1).map(function(me){return ze[me]}).join("="),"=0;","}else{",en.map(function(me,Je){return ze[me]+"="+G+".constant.length>"+Je+"?"+G+".constant["+Je+"]:0;"}).join(""),"}}else{","if(",ye,"(",G,".buffer)){",nt,"=",Se,".createStream(",an,",",G,".buffer);","}else{",nt,"=",Se,".getBuffer(",G,".buffer);","}",Xe,'="type" in ',G,"?",ae.glTypes,"[",G,".type]:",nt,".dtype;",ze.normalized,"=!!",G,".normalized;");function Ae(me){H(ze[me],"=",G,".",me,"|0;")}return Ae("size"),Ae("offset"),Ae("stride"),Ae("divisor"),H("}}"),H.exit("if(",ze.isStream,"){",Se,".destroyStream(",nt,");","}"),ze}ie[ee]=sr(J,re)}),ie}function Nt(B){var I=B.static,Z=B.dynamic,ne={};return Object.keys(I).forEach(function(ie){var ee=I[ie];ne[ie]=Ht(function(J,re){return typeof ee=="number"||typeof ee=="boolean"?""+ee:J.link(ee)})}),Object.keys(Z).forEach(function(ie){var ee=Z[ie];ne[ie]=sr(ee,function(J,re){return J.invoke(re,ee)})}),ne}function Yt(B,I,Z,ne,ie){var ee=B.static,J=B.dynamic;D.optional(function(){var Ae=[zr,_n,yn,Fr,Dr,qn,Br,Hn,mn,gn].concat(je);function me(Je){Object.keys(Je).forEach(function(Ke){D.command(Ae.indexOf(Ke)>=0,'unknown parameter "'+Ke+'"',ie.commandStr)})}me(ee),me(J)});var re=gt(B,I),V=Ue(B),H=lt(B,V,ie),G=Gt(B,ie),se=Ut(B,ie),ae=At(B,ie,re);function ye(Ae){var me=H[Ae];me&&(se[Ae]=me)}ye(xr),ye(We(jn));var Se=Object.keys(se).length>0,ze={framebuffer:V,draw:G,shader:ae,state:se,dirty:Se,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(ze.profile=Ve(B),ze.uniforms=Et(Z,ie),ze.drawVAO=ze.scopeVAO=G.vao,!ze.drawVAO&&ae.program&&!re&&X.angle_instanced_arrays&&G.static.elements){var ht=!0,nt=ae.program.attributes.map(function(Ae){var me=I.static[Ae];return ht=ht&&!!me,me});if(ht&&nt.length>0){var Xe=Oe.getVAO(Oe.createVAO({attributes:nt,elements:G.static.elements}));ze.drawVAO=new Kt(null,null,null,function(Ae,me){return Ae.link(Xe)}),ze.useVAO=!0}}return re?ze.useVAO=!0:ze.attributes=Xt(I,ie),ze.context=Nt(ne),ze}function Qt(B,I,Z){var ne=B.shared,ie=ne.context,ee=B.scope();Object.keys(Z).forEach(function(J){I.save(ie,"."+J);var re=Z[J],V=re.append(B,I);Array.isArray(V)?ee(ie,".",J,"=[",V.join(),"];"):ee(ie,".",J,"=",V,";")}),I(ee)}function Zt(B,I,Z,ne){var ie=B.shared,ee=ie.gl,J=ie.framebuffer,re;He&&(re=I.def(ie.extensions,".webgl_draw_buffers"));var V=B.constants,H=V.drawBuffer,G=V.backBuffer,se;Z?se=Z.append(B,I):se=I.def(J,".next"),ne||I("if(",se,"!==",J,".cur){"),I("if(",se,"){",ee,".bindFramebuffer(",Do,",",se,".framebuffer);"),He&&I(re,".drawBuffersWEBGL(",H,"[",se,".colorAttachments.length]);"),I("}else{",ee,".bindFramebuffer(",Do,",null);"),He&&I(re,".drawBuffersWEBGL(",G,");"),I("}",J,".cur=",se,";"),ne||I("}")}function Jt(B,I,Z){var ne=B.shared,ie=ne.gl,ee=B.current,J=B.next,re=ne.current,V=ne.next,H=B.cond(re,".dirty");je.forEach(function(G){var se=We(G);if(!(se in Z.state)){var ae,ye;if(se in J){ae=J[se],ye=ee[se];var Se=dt(tt[se].length,function(ht){return H.def(ae,"[",ht,"]")});H(B.cond(Se.map(function(ht,nt){return ht+"!=="+ye+"["+nt+"]"}).join("||")).then(ie,".",pe[se],"(",Se,");",Se.map(function(ht,nt){return ye+"["+nt+"]="+ht}).join(";"),";"))}else{ae=H.def(V,".",se);var ze=B.cond(ae,"!==",re,".",se);H(ze),se in we?ze(B.cond(ae).then(ie,".enable(",we[se],");").else(ie,".disable(",we[se],");"),re,".",se,"=",ae,";"):ze(ie,".",pe[se],"(",ae,");",re,".",se,"=",ae,";")}}}),Object.keys(Z.state).length===0&&H(re,".dirty=false;"),I(H)}function nr(B,I,Z,ne){var ie=B.shared,ee=B.current,J=ie.current,re=ie.gl;oa(Object.keys(Z)).forEach(function(V){var H=Z[V];if(!(ne&&!ne(H))){var G=H.append(B,I);if(we[V]){var se=we[V];Sr(H)?G?I(re,".enable(",se,");"):I(re,".disable(",se,");"):I(B.cond(G).then(re,".enable(",se,");").else(re,".disable(",se,");")),I(J,".",V,"=",G,";")}else if(st(G)){var ae=ee[V];I(re,".",pe[V],"(",G,");",G.map(function(ye,Se){return ae+"["+Se+"]="+ye}).join(";"),";")}else I(re,".",pe[V],"(",G,");",J,".",V,"=",G,";")}})}function qt(B,I){Pe&&(B.instancing=I.def(B.shared.extensions,".angle_instanced_arrays"))}function Ct(B,I,Z,ne,ie){var ee=B.shared,J=B.stats,re=ee.current,V=ee.timer,H=Z.profile;function G(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var se,ae;function ye(Ae){se=I.def(),Ae(se,"=",G(),";"),typeof ie=="string"?Ae(J,".count+=",ie,";"):Ae(J,".count++;"),Re&&(ne?(ae=I.def(),Ae(ae,"=",V,".getNumPendingQueries();")):Ae(V,".beginQuery(",J,");"))}function Se(Ae){Ae(J,".cpuTime+=",G(),"-",se,";"),Re&&(ne?Ae(V,".pushScopeStats(",ae,",",V,".getNumPendingQueries(),",J,");"):Ae(V,".endQuery();"))}function ze(Ae){var me=I.def(re,".profile");I(re,".profile=",Ae,";"),I.exit(re,".profile=",me,";")}var ht;if(H){if(Sr(H)){H.enable?(ye(I),Se(I.exit),ze("true")):ze("false");return}ht=H.append(B,I),ze(ht)}else ht=I.def(re,".profile");var nt=B.block();ye(nt),I("if(",ht,"){",nt,"}");var Xe=B.block();Se(Xe),I.exit("if(",ht,"){",Xe,"}")}function ir(B,I,Z,ne,ie){var ee=B.shared;function J(V){switch(V){case Wn:case Qn:case Jn:return 2;case Yn:case Zn:case ei:return 3;case Xn:case Kn:case ti:return 4;default:return 1}}function re(V,H,G){var se=ee.gl,ae=I.def(V,".location"),ye=I.def(ee.attributes,"[",ae,"]"),Se=G.state,ze=G.buffer,ht=[G.x,G.y,G.z,G.w],nt=["buffer","normalized","offset","stride"];function Xe(){I("if(!",ye,".buffer){",se,".enableVertexAttribArray(",ae,");}");var me=G.type,Je;if(G.size?Je=I.def(G.size,"||",H):Je=H,I("if(",ye,".type!==",me,"||",ye,".size!==",Je,"||",nt.map(function(ct){return ye+"."+ct+"!=="+G[ct]}).join("||"),"){",se,".bindBuffer(",an,",",ze,".buffer);",se,".vertexAttribPointer(",[ae,Je,me,G.normalized,G.stride,G.offset],");",ye,".type=",me,";",ye,".size=",Je,";",nt.map(function(ct){return ye+"."+ct+"="+G[ct]+";"}).join(""),"}"),Pe){var Ke=G.divisor;I("if(",ye,".divisor!==",Ke,"){",B.instancing,".vertexAttribDivisorANGLE(",[ae,Ke],");",ye,".divisor=",Ke,";}")}}function Ae(){I("if(",ye,".buffer){",se,".disableVertexAttribArray(",ae,");",ye,".buffer=null;","}if(",en.map(function(me,Je){return ye+"."+me+"!=="+ht[Je]}).join("||"),"){",se,".vertexAttrib4f(",ae,",",ht,");",en.map(function(me,Je){return ye+"."+me+"="+ht[Je]+";"}).join(""),"}")}Se===tn?Xe():Se===Ti?Ae():(I("if(",Se,"===",tn,"){"),Xe(),I("}else{"),Ae(),I("}"))}ne.forEach(function(V){var H=V.name,G=Z.attributes[H],se;if(G){if(!ie(G))return;se=G.append(B,I)}else{if(!ie(Vo))return;var ae=B.scopeAttrib(H);D.optional(function(){B.assert(I,ae+".state","missing attribute "+H)}),se={},Object.keys(new ue).forEach(function(ye){se[ye]=I.def(ae,".",ye)})}re(B.link(V),J(V.info.type),se)})}function Mt(B,I,Z,ne,ie,ee){for(var J=B.shared,re=J.gl,V={},H,G=0;G<ne.length;++G){var se=ne[G],ae=se.name,ye=se.info.type,Se=se.info.size,ze=Z.uniforms[ae];if(Se>1){if(!ze)continue;var ht=ae.replace("[0]","");if(V[ht])continue;V[ht]=1}var nt=B.link(se),Xe=nt+".location",Ae;if(ze){if(!ie(ze))continue;if(Sr(ze)){var me=ze.value;if(D.command(me!==null&&typeof me!="undefined",'missing uniform "'+ae+'"',B.commandStr),ye===wn||ye===Sn){D.command(typeof me=="function"&&(ye===wn&&(me._reglType==="texture2d"||me._reglType==="framebuffer")||ye===Sn&&(me._reglType==="textureCube"||me._reglType==="framebufferCube")),"invalid texture for uniform "+ae,B.commandStr);var Je=B.link(me._texture||me.color[0]._texture);I(re,".uniform1i(",Xe,",",Je+".bind());"),I.exit(Je,".unbind();")}else if(ye===bn||ye===xn||ye===Cn){D.optional(function(){D.command(st(me),"invalid matrix for uniform "+ae,B.commandStr),D.command(ye===bn&&me.length===4||ye===xn&&me.length===9||ye===Cn&&me.length===16,"invalid length for matrix uniform "+ae,B.commandStr)});var Ke=B.global.def("new Float32Array(["+Array.prototype.slice.call(me)+"])"),ct=2;ye===xn?ct=3:ye===Cn&&(ct=4),I(re,".uniformMatrix",ct,"fv(",Xe,",false,",Ke,");")}else{switch(ye){case Qi:Se===1?D.commandType(me,"number","uniform "+ae,B.commandStr):D.command(st(me)&&me.length===Se,"uniform "+ae,B.commandStr),H="1f";break;case Wn:D.command(st(me)&&me.length&&me.length%2===0&&me.length<=Se*2,"uniform "+ae,B.commandStr),H="2f";break;case Yn:D.command(st(me)&&me.length&&me.length%3===0&&me.length<=Se*3,"uniform "+ae,B.commandStr),H="3f";break;case Xn:D.command(st(me)&&me.length&&me.length%4===0&&me.length<=Se*4,"uniform "+ae,B.commandStr),H="4f";break;case Ki:Se===1?D.commandType(me,"boolean","uniform "+ae,B.commandStr):D.command(st(me)&&me.length===Se,"uniform "+ae,B.commandStr),H="1i";break;case Zi:Se===1?D.commandType(me,"number","uniform "+ae,B.commandStr):D.command(st(me)&&me.length===Se,"uniform "+ae,B.commandStr),H="1i";break;case Jn:D.command(st(me)&&me.length&&me.length%2===0&&me.length<=Se*2,"uniform "+ae,B.commandStr),H="2i";break;case Qn:D.command(st(me)&&me.length&&me.length%2===0&&me.length<=Se*2,"uniform "+ae,B.commandStr),H="2i";break;case ei:D.command(st(me)&&me.length&&me.length%3===0&&me.length<=Se*3,"uniform "+ae,B.commandStr),H="3i";break;case Zn:D.command(st(me)&&me.length&&me.length%3===0&&me.length<=Se*3,"uniform "+ae,B.commandStr),H="3i";break;case ti:D.command(st(me)&&me.length&&me.length%4===0&&me.length<=Se*4,"uniform "+ae,B.commandStr),H="4i";break;case Kn:D.command(st(me)&&me.length&&me.length%4===0&&me.length<=Se*4,"uniform "+ae,B.commandStr),H="4i";break}Se>1?(H+="v",me=B.global.def("["+Array.prototype.slice.call(me)+"]")):me=st(me)?Array.prototype.slice.call(me):me,I(re,".uniform",H,"(",Xe,",",me,");")}continue}else Ae=ze.append(B,I)}else{if(!ie(Vo))continue;Ae=I.def(J.uniforms,"[",z.id(ae),"]")}ye===wn?(D(!Array.isArray(Ae),"must specify a scalar prop for textures"),I("if(",Ae,"&&",Ae,'._reglType==="framebuffer"){',Ae,"=",Ae,".color[0];","}")):ye===Sn&&(D(!Array.isArray(Ae),"must specify a scalar prop for cube maps"),I("if(",Ae,"&&",Ae,'._reglType==="framebufferCube"){',Ae,"=",Ae,".color[0];","}")),D.optional(function(){function hr(lr,ri){B.assert(I,lr,'bad data or missing for uniform "'+ae+'".  '+ri)}function jr(lr,ri){ri===1&&D(!Array.isArray(Ae),"must not specify an array type for uniform"),hr("Array.isArray("+Ae+") && typeof "+Ae+'[0]===" '+lr+'" || typeof '+Ae+'==="'+lr+'"',"invalid type, expected "+lr)}function pr(lr,ri,ni){Array.isArray(Ae)?D(Ae.length&&Ae.length%lr===0&&Ae.length<=lr*ni,"must have length of "+(ni===1?"":"n * ")+lr):hr(J.isArrayLike+"("+Ae+")&&"+Ae+".length && "+Ae+".length % "+lr+" === 0 && "+Ae+".length<="+lr*ni,"invalid vector, should have length of "+(ni===1?"":"n * ")+lr,B.commandStr)}function Wo(lr){D(!Array.isArray(Ae),"must not specify a value type"),hr("typeof "+Ae+'==="function"&&'+Ae+'._reglType==="texture'+(lr===To?"2d":"Cube")+'"',"invalid texture type",B.commandStr)}switch(ye){case Zi:jr("number",Se);break;case Qn:pr(2,"number",Se);break;case Zn:pr(3,"number",Se);break;case Kn:pr(4,"number",Se);break;case Qi:jr("number",Se);break;case Wn:pr(2,"number",Se);break;case Yn:pr(3,"number",Se);break;case Xn:pr(4,"number",Se);break;case Ki:jr("boolean",Se);break;case Jn:pr(2,"boolean",Se);break;case ei:pr(3,"boolean",Se);break;case ti:pr(4,"boolean",Se);break;case bn:pr(4,"number",Se);break;case xn:pr(9,"number",Se);break;case Cn:pr(16,"number",Se);break;case wn:Wo(To);break;case Sn:Wo(Lu);break}});var zt=1;switch(ye){case wn:case Sn:var ar=I.def(Ae,"._texture");I(re,".uniform1i(",Xe,",",ar,".bind());"),I.exit(ar,".unbind();");continue;case Zi:case Ki:H="1i";break;case Qn:case Jn:H="2i",zt=2;break;case Zn:case ei:H="3i",zt=3;break;case Kn:case ti:H="4i",zt=4;break;case Qi:H="1f";break;case Wn:H="2f",zt=2;break;case Yn:H="3f",zt=3;break;case Xn:H="4f",zt=4;break;case bn:H="Matrix2fv";break;case xn:H="Matrix3fv";break;case Cn:H="Matrix4fv";break}if(H.indexOf("Matrix")===-1&&Se>1&&(H+="v",zt=1),H.charAt(0)==="M"){I(re,".uniform",H,"(",Xe,",");var Gr=Math.pow(ye-bn+2,2),Cr=B.global.def("new Float32Array(",Gr,")");Array.isArray(Ae)?I("false,(",dt(Gr,function(hr){return Cr+"["+hr+"]="+Ae[hr]}),",",Cr,")"):I("false,(Array.isArray(",Ae,")||",Ae," instanceof Float32Array)?",Ae,":(",dt(Gr,function(hr){return Cr+"["+hr+"]="+Ae+"["+hr+"]"}),",",Cr,")"),I(");")}else if(zt>1){for(var gr=[],Or=[],Ur=0;Ur<zt;++Ur)Array.isArray(Ae)?Or.push(Ae[Ur]):Or.push(I.def(Ae+"["+Ur+"]")),ee&&gr.push(I.def());ee&&I("if(!",B.batchId,"||",gr.map(function(hr,jr){return hr+"!=="+Or[jr]}).join("||"),"){",gr.map(function(hr,jr){return hr+"="+Or[jr]+";"}).join("")),I(re,".uniform",H,"(",Xe,",",Or.join(","),");"),ee&&I("}")}else{if(D(!Array.isArray(Ae),"uniform value must not be an array"),ee){var Ho=I.def();I("if(!",B.batchId,"||",Ho,"!==",Ae,"){",Ho,"=",Ae,";")}I(re,".uniform",H,"(",Xe,",",Ae,");"),ee&&I("}")}}}function ut(B,I,Z,ne){var ie=B.shared,ee=ie.gl,J=ie.draw,re=ne.draw;function V(){var Je=re.elements,Ke,ct=I;return Je?((Je.contextDep&&ne.contextDynamic||Je.propDep)&&(ct=Z),Ke=Je.append(B,ct),re.elementsActive&&ct("if("+Ke+")"+ee+".bindBuffer("+Xi+","+Ke+".buffer.buffer);")):(Ke=ct.def(),ct(Ke,"=",J,".",Fr,";","if(",Ke,"){",ee,".bindBuffer(",Xi,",",Ke,".buffer.buffer);}","else if(",ie.vao,".currentVAO){",Ke,"=",B.shared.elements+".getElements("+ie.vao,".currentVAO.elements);",xe?"":"if("+Ke+")"+ee+".bindBuffer("+Xi+","+Ke+".buffer.buffer);","}")),Ke}function H(){var Je=re.count,Ke,ct=I;return Je?((Je.contextDep&&ne.contextDynamic||Je.propDep)&&(ct=Z),Ke=Je.append(B,ct),D.optional(function(){Je.MISSING&&B.assert(I,"false","missing vertex count"),Je.DYNAMIC&&B.assert(ct,Ke+">=0","missing vertex count")})):(Ke=ct.def(J,".",Br),D.optional(function(){B.assert(ct,Ke+">=0","missing vertex count")})),Ke}var G=V();function se(Je){var Ke=re[Je];return Ke?Ke.contextDep&&ne.contextDynamic||Ke.propDep?Ke.append(B,Z):Ke.append(B,I):I.def(J,".",Je)}var ae=se(Dr),ye=se(qn),Se=H();if(typeof Se=="number"){if(Se===0)return}else Z("if(",Se,"){"),Z.exit("}");var ze,ht;Pe&&(ze=se(Hn),ht=B.instancing);var nt=G+".type",Xe=re.elements&&Sr(re.elements)&&!re.vaoActive;function Ae(){function Je(){Z(ht,".drawElementsInstancedANGLE(",[ae,Se,nt,ye+"<<(("+nt+"-"+fo+")>>1)",ze],");")}function Ke(){Z(ht,".drawArraysInstancedANGLE(",[ae,ye,Se,ze],");")}G&&G!=="null"?Xe?Je():(Z("if(",G,"){"),Je(),Z("}else{"),Ke(),Z("}")):Ke()}function me(){function Je(){Z(ee+".drawElements("+[ae,Se,nt,ye+"<<(("+nt+"-"+fo+")>>1)"]+");")}function Ke(){Z(ee+".drawArrays("+[ae,ye,Se]+");")}G&&G!=="null"?Xe?Je():(Z("if(",G,"){"),Je(),Z("}else{"),Ke(),Z("}")):Ke()}Pe&&(typeof ze!="number"||ze>=0)?typeof ze=="string"?(Z("if(",ze,">0){"),Ae(),Z("}else if(",ze,"<0){"),me(),Z("}")):Ae():me()}function xt(B,I,Z,ne,ie){var ee=vt(),J=ee.proc("body",ie);return D.optional(function(){ee.commandStr=I.commandStr,ee.command=ee.link(I.commandStr)}),Pe&&(ee.instancing=J.def(ee.shared.extensions,".angle_instanced_arrays")),B(ee,J,Z,ne),ee.compile().body}function kt(B,I,Z,ne){qt(B,I),Z.useVAO?Z.drawVAO?I(B.shared.vao,".setVAO(",Z.drawVAO.append(B,I),");"):I(B.shared.vao,".setVAO(",B.shared.vao,".targetVAO);"):(I(B.shared.vao,".setVAO(null);"),ir(B,I,Z,ne.attributes,function(){return!0})),Mt(B,I,Z,ne.uniforms,function(){return!0},!1),ut(B,I,I,Z)}function er(B,I){var Z=B.proc("draw",1);qt(B,Z),Qt(B,Z,I.context),Zt(B,Z,I.framebuffer),Jt(B,Z,I),nr(B,Z,I.state),Ct(B,Z,I,!1,!0);var ne=I.shader.progVar.append(B,Z);if(Z(B.shared.gl,".useProgram(",ne,".program);"),I.shader.program)kt(B,Z,I,I.shader.program);else{Z(B.shared.vao,".setVAO(null);");var ie=B.global.def("{}"),ee=Z.def(ne,".id"),J=Z.def(ie,"[",ee,"]");Z(B.cond(J).then(J,".call(this,a0);").else(J,"=",ie,"[",ee,"]=",B.link(function(re){return xt(kt,B,I,re,1)}),"(",ne,");",J,".call(this,a0);"))}Object.keys(I.state).length>0&&Z(B.shared.current,".dirty=true;"),B.shared.vao&&Z(B.shared.vao,".setVAO(null);")}function or(B,I,Z,ne){B.batchId="a1",qt(B,I);function ie(){return!0}ir(B,I,Z,ne.attributes,ie),Mt(B,I,Z,ne.uniforms,ie,!1),ut(B,I,I,Z)}function Vr(B,I,Z,ne){qt(B,I);var ie=Z.contextDep,ee=I.def(),J="a0",re="a1",V=I.def();B.shared.props=V,B.batchId=ee;var H=B.scope(),G=B.scope();I(H.entry,"for(",ee,"=0;",ee,"<",re,";++",ee,"){",V,"=",J,"[",ee,"];",G,"}",H.exit);function se(nt){return nt.contextDep&&ie||nt.propDep}function ae(nt){return!se(nt)}if(Z.needsContext&&Qt(B,G,Z.context),Z.needsFramebuffer&&Zt(B,G,Z.framebuffer),nr(B,G,Z.state,se),Z.profile&&se(Z.profile)&&Ct(B,G,Z,!1,!0),ne)Z.useVAO?Z.drawVAO?se(Z.drawVAO)?G(B.shared.vao,".setVAO(",Z.drawVAO.append(B,G),");"):H(B.shared.vao,".setVAO(",Z.drawVAO.append(B,H),");"):H(B.shared.vao,".setVAO(",B.shared.vao,".targetVAO);"):(H(B.shared.vao,".setVAO(null);"),ir(B,H,Z,ne.attributes,ae),ir(B,G,Z,ne.attributes,se)),Mt(B,H,Z,ne.uniforms,ae,!1),Mt(B,G,Z,ne.uniforms,se,!0),ut(B,H,G,Z);else{var ye=B.global.def("{}"),Se=Z.shader.progVar.append(B,G),ze=G.def(Se,".id"),ht=G.def(ye,"[",ze,"]");G(B.shared.gl,".useProgram(",Se,".program);","if(!",ht,"){",ht,"=",ye,"[",ze,"]=",B.link(function(nt){return xt(or,B,Z,nt,2)}),"(",Se,");}",ht,".call(this,a0[",ee,"],",ee,");")}}function q(B,I){var Z=B.proc("batch",2);B.batchId="0",qt(B,Z);var ne=!1,ie=!0;Object.keys(I.context).forEach(function(ye){ne=ne||I.context[ye].propDep}),ne||(Qt(B,Z,I.context),ie=!1);var ee=I.framebuffer,J=!1;ee?(ee.propDep?ne=J=!0:ee.contextDep&&ne&&(J=!0),J||Zt(B,Z,ee)):Zt(B,Z,null),I.state.viewport&&I.state.viewport.propDep&&(ne=!0);function re(ye){return ye.contextDep&&ne||ye.propDep}Jt(B,Z,I),nr(B,Z,I.state,function(ye){return!re(ye)}),(!I.profile||!re(I.profile))&&Ct(B,Z,I,!1,"a1"),I.contextDep=ne,I.needsContext=ie,I.needsFramebuffer=J;var V=I.shader.progVar;if(V.contextDep&&ne||V.propDep)Vr(B,Z,I,null);else{var H=V.append(B,Z);if(Z(B.shared.gl,".useProgram(",H,".program);"),I.shader.program)Vr(B,Z,I,I.shader.program);else{Z(B.shared.vao,".setVAO(null);");var G=B.global.def("{}"),se=Z.def(H,".id"),ae=Z.def(G,"[",se,"]");Z(B.cond(ae).then(ae,".call(this,a0,a1);").else(ae,"=",G,"[",se,"]=",B.link(function(ye){return xt(Vr,B,I,ye,2)}),"(",H,");",ae,".call(this,a0,a1);"))}}Object.keys(I.state).length>0&&Z(B.shared.current,".dirty=true;"),B.shared.vao&&Z(B.shared.vao,".setVAO(null);")}function fe(B,I){var Z=B.proc("scope",3);B.batchId="a2";var ne=B.shared,ie=ne.current;Qt(B,Z,I.context),I.framebuffer&&I.framebuffer.append(B,Z),oa(Object.keys(I.state)).forEach(function(J){var re=I.state[J],V=re.append(B,Z);st(V)?V.forEach(function(H,G){Z.set(B.next[J],"["+G+"]",H)}):Z.set(ne.next,"."+J,V)}),Ct(B,Z,I,!0,!0),[Fr,qn,Br,Hn,Dr].forEach(function(J){var re=I.draw[J];!re||Z.set(ne.draw,"."+J,""+re.append(B,Z))}),Object.keys(I.uniforms).forEach(function(J){var re=I.uniforms[J].append(B,Z);Array.isArray(re)&&(re="["+re.join()+"]"),Z.set(ne.uniforms,"["+z.id(J)+"]",re)}),Object.keys(I.attributes).forEach(function(J){var re=I.attributes[J].append(B,Z),V=B.scopeAttrib(J);Object.keys(new ue).forEach(function(H){Z.set(V,"."+H,re[H])})}),I.scopeVAO&&Z.set(ne.vao,".targetVAO",I.scopeVAO.append(B,Z));function ee(J){var re=I.shader[J];re&&Z.set(ne.shader,"."+J,re.append(B,Z))}ee(_n),ee(yn),Object.keys(I.state).length>0&&(Z(ie,".dirty=true;"),Z.exit(ie,".dirty=true;")),Z("a1(",B.shared.context,",a0,",B.batchId,");")}function oe(B){if(!(typeof B!="object"||st(B))){for(var I=Object.keys(B),Z=0;Z<I.length;++Z)if(cr.isDynamic(B[I[Z]]))return!0;return!1}}function Ye(B,I,Z){var ne=I.static[Z];if(!ne||!oe(ne))return;var ie=B.global,ee=Object.keys(ne),J=!1,re=!1,V=!1,H=B.global.def("{}");ee.forEach(function(se){var ae=ne[se];if(cr.isDynamic(ae)){typeof ae=="function"&&(ae=ne[se]=cr.unbox(ae));var ye=sr(ae,null);J=J||ye.thisDep,V=V||ye.propDep,re=re||ye.contextDep}else{switch(ie(H,".",se,"="),typeof ae=="undefined"?"undefined":_type_of$2(ae)){case"number":ie(ae);break;case"string":ie('"',ae,'"');break;case"object":Array.isArray(ae)&&ie("[",ae.join(),"]");break;default:ie(B.link(ae));break}ie(";")}});function G(se,ae){ee.forEach(function(ye){var Se=ne[ye];if(!!cr.isDynamic(Se)){var ze=se.invoke(ae,Se);ae(H,".",ye,"=",ze,";")}})}I.dynamic[Z]=new cr.DynamicVariable(Un,{thisDep:J,contextDep:re,propDep:V,ref:H,append:G}),delete I.static[Z]}function wt(B,I,Z,ne,ie){var ee=vt();ee.stats=ee.link(ie),Object.keys(I.static).forEach(function(re){Ye(ee,I,re)}),$u.forEach(function(re){Ye(ee,B,re)});var J=Yt(B,I,Z,ne,ee);return er(ee,J),fe(ee,J),q(ee,J),jt(ee.compile(),{destroy:function(){J.shader.program.destroy()}})}return{next:Qe,current:tt,procs:function(){var B=vt(),I=B.proc("poll"),Z=B.proc("refresh"),ne=B.block();I(ne),Z(ne);var ie=B.shared,ee=ie.gl,J=ie.next,re=ie.current;ne(re,".dirty=false;"),Zt(B,I),Zt(B,Z,null,!0);var V;Pe&&(V=B.link(Pe)),X.oes_vertex_array_object&&Z(B.link(X.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var H=0;H<ce.maxAttributes;++H){var G=Z.def(ie.attributes,"[",H,"]"),se=B.cond(G,".buffer");se.then(ee,".enableVertexAttribArray(",H,");",ee,".bindBuffer(",an,",",G,".buffer.buffer);",ee,".vertexAttribPointer(",H,",",G,".size,",G,".type,",G,".normalized,",G,".stride,",G,".offset);").else(ee,".disableVertexAttribArray(",H,");",ee,".vertexAttrib4f(",H,",",G,".x,",G,".y,",G,".z,",G,".w);",G,".buffer=null;"),Z(se),Pe&&Z(V,".vertexAttribDivisorANGLE(",H,",",G,".divisor);")}return Z(B.shared.vao,".currentVAO=null;",B.shared.vao,".setVAO(",B.shared.vao,".targetVAO);"),Object.keys(we).forEach(function(ae){var ye=we[ae],Se=ne.def(J,".",ae),ze=B.block();ze("if(",Se,"){",ee,".enable(",ye,")}else{",ee,".disable(",ye,")}",re,".",ae,"=",Se,";"),Z(ze),I("if(",Se,"!==",re,".",ae,"){",ze,"}")}),Object.keys(pe).forEach(function(ae){var ye=pe[ae],Se=tt[ae],ze,ht,nt=B.block();if(nt(ee,".",ye,"("),st(Se)){var Xe=Se.length;ze=B.global.def(J,".",ae),ht=B.global.def(re,".",ae),nt(dt(Xe,function(Ae){return ze+"["+Ae+"]"}),");",dt(Xe,function(Ae){return ht+"["+Ae+"]="+ze+"["+Ae+"];"}).join("")),I("if(",dt(Xe,function(Ae){return ze+"["+Ae+"]!=="+ht+"["+Ae+"]"}).join("||"),"){",nt,"}")}else ze=ne.def(J,".",ae),ht=ne.def(re,".",ae),nt(ze,");",re,".",ae,"=",ze,";"),I("if(",ze,"!==",ht,"){",nt,"}");Z(nt)}),B.compile()}(),compile:wt}},as=function(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}},sa=function(S,z){for(var X=0;X<S.length;++X)if(S[X]===z)return X;return-1},os=function(S){var z=Ze(S);if(!z)return null;var X=z.gl,ce=X.getContextAttributes(),_e=X.isContextLost(),he=pt(X,z);if(!he)return null;var Ce=de(),Ee=as(),Le=he.extensions,Oe=Yu(X,Le),Ie=ma(),ke=X.drawingBufferWidth,Te=X.drawingBufferHeight,Re={tick:0,time:0,viewportWidth:ke,viewportHeight:Te,framebufferWidth:ke,framebufferHeight:Te,drawingBufferWidth:ke,drawingBufferHeight:Te,pixelRatio:z.pixelRatio},$e={},ue={elements:null,primitive:4,count:-1,offset:0,instances:-1},le=sl(X,Le),Pe=bt(X,Ee,z,tt),He=rt(X,Le,Pe,Ee),xe=es(X,Le,le,Ee,Pe,He,ue);function tt(ut){return xe.destroyBuffer(ut)}var Qe=ts(X,Ce,Ee,z),je=Ko(X,Le,le,function(){We.procs.poll()},Re,Ee,z),we=eu(X,Le,le,Ee,z),pe=Jo(X,Le,le,je,we,Ee),We=is(X,Ce,Le,le,Pe,He,je,pe,$e,xe,Qe,ue,Re,Oe,z),De=rs(X,pe,We.procs.poll,Re,ce,Le,le),Me=We.next,Fe=X.canvas,Be=[],yt=[],vt=[],Ve=[z.onDestroy],Ue=null;function lt(){if(Be.length===0){Oe&&Oe.update(),Ue=null;return}Ue=si.next(lt),nr();for(var ut=Be.length-1;ut>=0;--ut){var xt=Be[ut];xt&&xt(Re,null,0)}X.flush(),Oe&&Oe.update()}function gt(){!Ue&&Be.length>0&&(Ue=si.next(lt))}function At(){Ue&&(si.cancel(lt),Ue=null)}function Gt(ut){ut.preventDefault(),_e=!0,At(),yt.forEach(function(xt){xt()})}function Ut(ut){X.getError(),_e=!1,he.restore(),Qe.restore(),Pe.restore(),je.restore(),we.restore(),pe.restore(),xe.restore(),Oe&&Oe.restore(),We.procs.refresh(),gt(),vt.forEach(function(xt){xt()})}Fe&&(Fe.addEventListener(Uo,Gt,!1),Fe.addEventListener(jo,Ut,!1));function Et(){Be.length=0,At(),Fe&&(Fe.removeEventListener(Uo,Gt),Fe.removeEventListener(jo,Ut)),Qe.clear(),pe.clear(),we.clear(),xe.clear(),je.clear(),He.clear(),Pe.clear(),Oe&&Oe.clear(),Ve.forEach(function(ut){ut()})}function Xt(ut){D(!!ut,"invalid args to regl({...})"),D.type(ut,"object","invalid args to regl({...})");function xt(ie){var ee=jt({},ie);delete ee.uniforms,delete ee.attributes,delete ee.context,delete ee.vao,"stencil"in ee&&ee.stencil.op&&(ee.stencil.opBack=ee.stencil.opFront=ee.stencil.op,delete ee.stencil.op);function J(re){if(re in ee){var V=ee[re];delete ee[re],Object.keys(V).forEach(function(H){ee[re+"."+H]=V[H]})}}return J("blend"),J("depth"),J("cull"),J("stencil"),J("polygonOffset"),J("scissor"),J("sample"),"vao"in ie&&(ee.vao=ie.vao),ee}function kt(ie,ee){var J={},re={};return Object.keys(ie).forEach(function(V){var H=ie[V];if(cr.isDynamic(H)){re[V]=cr.unbox(H,V);return}else if(ee&&Array.isArray(H)){for(var G=0;G<H.length;++G)if(cr.isDynamic(H[G])){re[V]=cr.unbox(H,V);return}}J[V]=H}),{dynamic:re,static:J}}var er=kt(ut.context||{},!0),or=kt(ut.uniforms||{},!0),Vr=kt(ut.attributes||{},!1),q=kt(xt(ut),!1),fe={gpuTime:0,cpuTime:0,count:0},oe=We.compile(q,Vr,or,er,fe),Ye=oe.draw,wt=oe.batch,B=oe.scope,I=[];function Z(ie){for(;I.length<ie;)I.push(null);return I}function ne(ie,ee){var J;if(_e&&D.raise("context lost"),typeof ie=="function")return B.call(this,null,ie,0);if(typeof ee=="function")if(typeof ie=="number")for(J=0;J<ie;++J)B.call(this,null,ee,J);else if(Array.isArray(ie))for(J=0;J<ie.length;++J)B.call(this,ie[J],ee,J);else return B.call(this,ie,ee,0);else if(typeof ie=="number"){if(ie>0)return wt.call(this,Z(ie|0),ie|0)}else if(Array.isArray(ie)){if(ie.length)return wt.call(this,ie,ie.length)}else return Ye.call(this,ie)}return jt(ne,{stats:fe,destroy:function(){oe.destroy()}})}var Nt=pe.setFBO=Xt({framebuffer:cr.define.call(null,qo,"framebuffer")});function Yt(ut,xt){var kt=0;We.procs.poll();var er=xt.color;er&&(X.clearColor(+er[0]||0,+er[1]||0,+er[2]||0,+er[3]||0),kt|=Xu),"depth"in xt&&(X.clearDepth(+xt.depth),kt|=Qu),"stencil"in xt&&(X.clearStencil(xt.stencil|0),kt|=Zu),D(!!kt,"called regl.clear with no buffer specified"),X.clear(kt)}function Qt(ut){if(D(typeof ut=="object"&&ut,"regl.clear() takes an object as input"),"framebuffer"in ut)if(ut.framebuffer&&ut.framebuffer_reglType==="framebufferCube")for(var xt=0;xt<6;++xt)Nt(jt({framebuffer:ut.framebuffer.faces[xt]},ut),Yt);else Nt(ut,Yt);else Yt(null,ut)}function Zt(ut){D.type(ut,"function","regl.frame() callback must be a function"),Be.push(ut);function xt(){var kt=sa(Be,ut);D(kt>=0,"cannot cancel a frame twice");function er(){var or=sa(Be,er);Be[or]=Be[Be.length-1],Be.length-=1,Be.length<=0&&At()}Be[kt]=er}return gt(),{cancel:xt}}function Jt(){var ut=Me.viewport,xt=Me.scissor_box;ut[0]=ut[1]=xt[0]=xt[1]=0,Re.viewportWidth=Re.framebufferWidth=Re.drawingBufferWidth=ut[2]=xt[2]=X.drawingBufferWidth,Re.viewportHeight=Re.framebufferHeight=Re.drawingBufferHeight=ut[3]=xt[3]=X.drawingBufferHeight}function nr(){Re.tick+=1,Re.time=Ct(),Jt(),We.procs.poll()}function qt(){je.refresh(),Jt(),We.procs.refresh(),Oe&&Oe.update()}function Ct(){return(ma()-Ie)/1e3}qt();function ir(ut,xt){D.type(xt,"function","listener callback must be a function");var kt;switch(ut){case"frame":return Zt(xt);case"lost":kt=yt;break;case"restore":kt=vt;break;case"destroy":kt=Ve;break;default:D.raise("invalid event, must be one of frame,lost,restore,destroy")}return kt.push(xt),{cancel:function(){for(var or=0;or<kt.length;++or)if(kt[or]===xt){kt[or]=kt[kt.length-1],kt.pop();return}}}}var Mt=jt(Xt,{clear:Qt,prop:cr.define.bind(null,qo),context:cr.define.bind(null,Ju),this:cr.define.bind(null,ec),draw:Xt({}),buffer:function(xt){return Pe.create(xt,Ku,!1,!1)},elements:function(xt){return He.create(xt,!1)},texture:je.create2D,cube:je.createCube,renderbuffer:we.create,framebuffer:pe.create,framebufferCube:pe.createCube,vao:xe.createVAO,attributes:ce,frame:Zt,on:ir,limits:le,hasExtension:function(xt){return le.extensions.indexOf(xt.toLowerCase())>=0},read:De,destroy:Et,_gl:X,_refresh:qt,poll:function(){nr(),Oe&&Oe.update()},now:Ct,stats:Ee});return z.onDone(null,Mt),Mt},tr=function(S){return _instanceof$2(S,Uint8Array)||_instanceof$2(S,Uint16Array)||_instanceof$2(S,Uint32Array)||_instanceof$2(S,Int8Array)||_instanceof$2(S,Int16Array)||_instanceof$2(S,Int32Array)||_instanceof$2(S,Float32Array)||_instanceof$2(S,Float64Array)||_instanceof$2(S,Uint8ClampedArray)},jt=function(S,z){for(var X=Object.keys(z),ce=0;ce<X.length;++ce)S[X[ce]]=z[X[ce]];return S},Lr="\n",la=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"],$n=33071,ua=9728,ss=9984,ls=9985,us=9986,cs=9987,fs=5120,hs=5121,ds=5122,ps=5123,vs=5124,ms=5125,ca=5126,fa=32819,ha=32820,da=33635,pa=34042,_s=36193,ur={};ur[fs]=ur[hs]=1,ur[ds]=ur[ps]=ur[_s]=ur[da]=ur[fa]=ur[ha]=2,ur[vs]=ur[ms]=ur[ca]=ur[pa]=4;var D=jt(o,{optional:A,raise:i,commandRaise:N,command:$,parameter:l,commandParameter:w,constructor:d,type:f,commandType:E,isTypedArray:u,nni:h,oneOf:p,shaderError:F,linkError:W,callSite:C,saveCommandRef:j,saveDrawInfo:Y,framebufferFormat:R,guessCommand:g,texture2D:T,textureCube:M}),ys=0,gs=0,bs=5,xs=6;function sn(ge){if(ge.length===0)return[];var S=ge.charAt(0),z=ge.charAt(ge.length-1);if(ge.length>1&&S===z&&(S==='"'||S==="'"))return['"'+Q(ge.substr(1,ge.length-2))+'"'];var X=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(ge);if(X)return sn(ge.substr(0,X.index)).concat(sn(X[1])).concat(sn(ge.substr(X.index+X[0].length)));var ce=ge.split(".");if(ce.length===1)return['"'+Q(ge)+'"'];for(var _e=[],he=0;he<ce.length;++he)_e=_e.concat(sn(ce[he]));return _e}function va(ge,S){if(typeof ge=="function")return new U(gs,ge);if(typeof ge=="number"||typeof ge=="boolean")return new U(bs,ge);if(Array.isArray(ge))return new U(xs,ge.map(function(z,X){return va(z,S+"["+X+"]")}));if(_instanceof$2(ge,U))return ge;D(!1,"invalid option type in uniform "+S)}var cr={DynamicVariable:U,define:te,isDynamic:ve,unbox:va,accessor:K},si={next:typeof requestAnimationFrame=="function"?function(ge){return requestAnimationFrame(ge)}:function(ge){return setTimeout(ge,16)},cancel:typeof cancelAnimationFrame=="function"?function(ge){return cancelAnimationFrame(ge)}:clearTimeout},ma=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date},Cs=5120,ws=5121,Ss=5122,Ps=5123,As=5124,Es=5125,$s=5126,Wt=at();Wt.zero=at();var ks=3408,Os=3410,Ls=3411,Ms=3412,Ts=3413,Rs=3414,Is=3415,zs=33901,Fs=33902,Ds=3379,Bs=3386,Ns=34921,Vs=36347,Gs=36348,Us=35661,js=35660,qs=34930,Hs=36349,Ws=34076,Ys=34024,Xs=7936,Qs=7937,Zs=7938,Ks=35724,Js=34047,el=36063,tl=34852,kn=3553,_a=34067,rl=34069,nl=33984,un=6408,li=5126,ya=5121,ui=36160,il=36053,al=36064,ol=16384,sl=function(S,z){var X=1;z.ext_texture_filter_anisotropic&&(X=S.getParameter(Js));var ce=1,_e=1;z.webgl_draw_buffers&&(ce=S.getParameter(tl),_e=S.getParameter(el));var he=!!z.oes_texture_float;if(he){var Ce=S.createTexture();S.bindTexture(kn,Ce),S.texImage2D(kn,0,un,1,1,0,un,li,null);var Ee=S.createFramebuffer();if(S.bindFramebuffer(ui,Ee),S.framebufferTexture2D(ui,al,kn,Ce,0),S.bindTexture(kn,null),S.checkFramebufferStatus(ui)!==il)he=!1;else{S.viewport(0,0,1,1),S.clearColor(1,0,0,1),S.clear(ol);var Le=Wt.allocType(li,4);S.readPixels(0,0,1,1,un,li,Le),S.getError()?he=!1:(S.deleteFramebuffer(Ee),S.deleteTexture(Ce),he=Le[0]===1),Wt.freeType(Le)}}var Oe=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Ie=!0;if(!Oe){var ke=S.createTexture(),Te=Wt.allocType(ya,36);S.activeTexture(nl),S.bindTexture(_a,ke),S.texImage2D(rl,0,un,3,3,0,un,ya,Te),Wt.freeType(Te),S.bindTexture(_a,null),S.deleteTexture(ke),Ie=!S.getError()}return{colorBits:[S.getParameter(Os),S.getParameter(Ls),S.getParameter(Ms),S.getParameter(Ts)],depthBits:S.getParameter(Rs),stencilBits:S.getParameter(Is),subpixelBits:S.getParameter(ks),extensions:Object.keys(z).filter(function(Re){return!!z[Re]}),maxAnisotropic:X,maxDrawbuffers:ce,maxColorAttachments:_e,pointSizeDims:S.getParameter(zs),lineWidthDims:S.getParameter(Fs),maxViewportDims:S.getParameter(Bs),maxCombinedTextureUnits:S.getParameter(Us),maxCubeMapSize:S.getParameter(Ws),maxRenderbufferSize:S.getParameter(Ys),maxTextureUnits:S.getParameter(qs),maxTextureSize:S.getParameter(Ds),maxAttributes:S.getParameter(Ns),maxVertexUniforms:S.getParameter(Vs),maxVertexTextureUnits:S.getParameter(js),maxVaryingVectors:S.getParameter(Gs),maxFragmentUniforms:S.getParameter(Hs),glsl:S.getParameter(Ks),renderer:S.getParameter(Qs),vendor:S.getParameter(Xs),version:S.getParameter(Zs),readFloat:he,npotTextureCube:Ie}},fr=function(S){return Object.keys(S).map(function(z){return S[z]})},On={shape:It,flatten:Rt};function ga(ge,S,z,X,ce){for(var _e=1,he=z+1;he<S.length;++he)_e*=S[he];var Ce=S[z];if(S.length-z===4){var Ee=S[z+1],Le=S[z+2],Oe=S[z+3];for(he=0;he<Ce;++he)Lt(ge[he],Ee,Le,Oe,X,ce),ce+=_e}else for(he=0;he<Ce;++he)ga(ge[he],S,z+1,X,ce),ce+=_e}var ci={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},ll=5120,ul=5122,cl=5124,fl=5121,hl=5123,dl=5125,pl=5126,vl=5126,Mr={int8:ll,int16:ul,int32:cl,uint8:fl,uint16:hl,uint32:dl,float:pl,float32:vl},ml=35048,_l=35040,Ln={dynamic:ml,stream:_l,static:35044},fi=On.flatten,ba=On.shape,xa=35044,yl=35040,hi=5121,di=5126,Pr=[];Pr[5120]=1,Pr[5122]=2,Pr[5124]=4,Pr[5121]=1,Pr[5123]=2,Pr[5125]=4,Pr[5126]=4;var gl=0,bl=0,xl=1,Cl=1,wl=4,Sl=4,Ar={points:gl,point:bl,lines:xl,line:Cl,triangles:wl,triangle:Sl,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Pl=0,Al=1,cn=4,El=5120,Yr=5121,Ca=5122,Xr=5123,wa=5124,Tr=5125,pi=34963,$l=35040,kl=35044,Sa=new Float32Array(1),Ol=new Uint32Array(Sa.buffer),Ll=5123,Pa=function(S){return!(S&S-1)&&!!S},Ml=34467,_r=3553,vi=34067,Mn=34069,Rr=6408,mi=6406,Tn=6407,fn=6409,Rn=6410,Aa=32854,_i=32855,Ea=36194,Tl=32819,Rl=32820,Il=33635,zl=34042,yi=6402,In=34041,gi=35904,bi=35906,Qr=36193,xi=33776,Ci=33777,wi=33778,Si=33779,$a=35986,ka=35987,Oa=34798,La=35840,Ma=35841,Ta=35842,Ra=35843,Ia=36196,Zr=5121,Pi=5123,Ai=5125,hn=5126,Fl=10242,Dl=10243,Bl=10497,Ei=33071,Nl=33648,Vl=10240,Gl=10241,$i=9728,Ul=9729,ki=9984,za=9985,Fa=9986,Oi=9987,jl=33170,zn=4352,ql=4353,Hl=4354,Wl=34046,Yl=3317,Xl=37440,Ql=37441,Zl=37443,Da=37444,dn=33984,Kl=[ki,Fa,za,Oi],Fn=[0,fn,Rn,Tn,Rr],dr={};dr[fn]=dr[mi]=dr[yi]=1,dr[In]=dr[Rn]=2,dr[Tn]=dr[gi]=3,dr[Rr]=dr[bi]=4;var Ba=$t("HTMLCanvasElement"),Na=$t("OffscreenCanvas"),Va=$t("CanvasRenderingContext2D"),Ga=$t("ImageBitmap"),Ua=$t("HTMLImageElement"),ja=$t("HTMLVideoElement"),Jl=Object.keys(ci).concat([Ba,Na,Va,Ga,Ua,ja]),Kr=[];Kr[Zr]=1,Kr[hn]=4,Kr[Qr]=2,Kr[Pi]=2,Kr[Ai]=4;var rr=[];rr[Aa]=2,rr[_i]=2,rr[Ea]=2,rr[In]=4,rr[xi]=.5,rr[Ci]=.5,rr[wi]=1,rr[Si]=1,rr[$a]=.5,rr[ka]=1,rr[Oa]=1,rr[La]=.5,rr[Ma]=.25,rr[Ta]=.5,rr[Ra]=.25,rr[Ia]=.5;var Er=36161,Dn=32854,qa=32855,Ha=36194,Wa=33189,Ya=36168,Xa=34041,Qa=35907,Za=34836,Ka=34842,Ja=34843,vr=[];vr[Dn]=2,vr[qa]=2,vr[Ha]=2,vr[Wa]=2,vr[Ya]=1,vr[Xa]=4,vr[Qa]=4,vr[Za]=16,vr[Ka]=8,vr[Ja]=6;var eu=function(S,z,X,ce,_e){var he=function($e){this.id=ke++,this.refCount=1,this.renderbuffer=$e,this.format=Dn,this.width=0,this.height=0,_e.profile&&(this.stats={size:0})},Ce=function($e){var ue=$e.renderbuffer;D(ue,"must not double destroy renderbuffer"),S.bindRenderbuffer(Er,null),S.deleteRenderbuffer(ue),$e.renderbuffer=null,$e.refCount=0,delete Te[$e.id],ce.renderbufferCount--},Ee=function($e,ue){var le=new he(S.createRenderbuffer());Te[le.id]=le,ce.renderbufferCount++;function Pe(xe,tt){var Qe=0,je=0,we=Dn;if(typeof xe=="object"&&xe){var pe=xe;if("shape"in pe){var We=pe.shape;D(Array.isArray(We)&&We.length>=2,"invalid renderbuffer shape"),Qe=We[0]|0,je=We[1]|0}else"radius"in pe&&(Qe=je=pe.radius|0),"width"in pe&&(Qe=pe.width|0),"height"in pe&&(je=pe.height|0);"format"in pe&&(D.parameter(pe.format,Oe,"invalid renderbuffer format"),we=Oe[pe.format])}else typeof xe=="number"?(Qe=xe|0,typeof tt=="number"?je=tt|0:je=Qe):xe?D.raise("invalid arguments to renderbuffer constructor"):Qe=je=1;if(D(Qe>0&&je>0&&Qe<=X.maxRenderbufferSize&&je<=X.maxRenderbufferSize,"invalid renderbuffer size"),!(Qe===le.width&&je===le.height&&we===le.format))return Pe.width=le.width=Qe,Pe.height=le.height=je,le.format=we,S.bindRenderbuffer(Er,le.renderbuffer),S.renderbufferStorage(Er,we,Qe,je),D(S.getError()===0,"invalid render buffer format"),_e.profile&&(le.stats.size=aa(le.format,le.width,le.height)),Pe.format=Ie[le.format],Pe}function He(xe,tt){var Qe=xe|0,je=tt|0||Qe;return Qe===le.width&&je===le.height||(D(Qe>0&&je>0&&Qe<=X.maxRenderbufferSize&&je<=X.maxRenderbufferSize,"invalid renderbuffer size"),Pe.width=le.width=Qe,Pe.height=le.height=je,S.bindRenderbuffer(Er,le.renderbuffer),S.renderbufferStorage(Er,le.format,Qe,je),D(S.getError()===0,"invalid render buffer format"),_e.profile&&(le.stats.size=aa(le.format,le.width,le.height))),Pe}return Pe($e,ue),Pe.resize=He,Pe._reglType="renderbuffer",Pe._renderbuffer=le,_e.profile&&(Pe.stats=le.stats),Pe.destroy=function(){le.decRef()},Pe},Le=function(){fr(Te).forEach(function($e){$e.renderbuffer=S.createRenderbuffer(),S.bindRenderbuffer(Er,$e.renderbuffer),S.renderbufferStorage(Er,$e.format,$e.width,$e.height)}),S.bindRenderbuffer(Er,null)},Oe={rgba4:Dn,rgb565:Ha,"rgb5 a1":qa,depth:Wa,stencil:Ya,"depth stencil":Xa};z.ext_srgb&&(Oe.srgba=Qa),z.ext_color_buffer_half_float&&(Oe.rgba16f=Ka,Oe.rgb16f=Ja),z.webgl_color_buffer_float&&(Oe.rgba32f=Za);var Ie=[];Object.keys(Oe).forEach(function(Re){var $e=Oe[Re];Ie[$e]=Re});var ke=0,Te={};return he.prototype.decRef=function(){--this.refCount<=0&&Ce(this)},_e.profile&&(ce.getTotalRenderbufferSize=function(){var Re=0;return Object.keys(Te).forEach(function($e){Re+=Te[$e].stats.size}),Re}),{create:Ee,clear:function(){fr(Te).forEach(Ce)},restore:Le}},br=36160,Li=36161,Ir=3553,Bn=34069,eo=36064,to=36096,ro=36128,no=33306,io=36053,tu=36054,ru=36055,nu=36057,iu=36061,au=36193,ou=5121,su=5126,ao=6407,oo=6408,lu=6402,uu=[ao,oo],Mi=[];Mi[oo]=4,Mi[ao]=3;var Nn=[];Nn[ou]=1,Nn[su]=4,Nn[au]=2;var cu=32854,fu=32855,hu=36194,du=33189,pu=36168,so=34041,vu=35907,mu=34836,_u=34842,yu=34843,gu=[cu,fu,hu,vu,_u,yu,mu],Jr={};Jr[io]="complete",Jr[tu]="incomplete attachment",Jr[nu]="incomplete dimensions",Jr[ru]="incomplete, missing attachment",Jr[iu]="unsupported";var bu=5126,lo=34962,Vn=34963,uo=["attributes","elements","offset","count","primitive","instances"],co=35632,xu=35633,Cu=35718,wu=35721,Su=6408,pn=5121,Pu=3333,Gn=5126,en="xyzw".split(""),fo=5121,tn=1,Ti=2,Ri=0,Ii=1,zi=2,Fi=3,Un=4,ho=5,po=6,vo="dither",mo="blend.enable",_o="blend.color",Di="blend.equation",Bi="blend.func",yo="depth.enable",go="depth.func",bo="depth.range",xo="depth.mask",Ni="colorMask",Co="cull.enable",wo="cull.face",Vi="frontFace",Gi="lineWidth",So="polygonOffset.enable",Ui="polygonOffset.offset",Po="sample.alpha",Ao="sample.enable",ji="sample.coverage",Eo="stencil.enable",$o="stencil.mask",qi="stencil.func",Hi="stencil.opFront",vn="stencil.opBack",ko="scissor.enable",jn="scissor.box",xr="viewport",mn="profile",zr="framebuffer",_n="vert",yn="frag",Fr="elements",Dr="primitive",Br="count",qn="offset",Hn="instances",gn="vao",Wi="Width",Yi="Height",rn=zr+Wi,nn=zr+Yi,Au=xr+Wi,Eu=xr+Yi,Oo="drawingBuffer",Lo=Oo+Wi,Mo=Oo+Yi,$u=[Bi,Di,qi,Hi,vn,ji,xr,jn,Ui],an=34962,Xi=34963,ku=35632,Ou=35633,To=3553,Lu=34067,Mu=2884,Tu=3042,Ru=3024,Iu=2960,zu=2929,Fu=3089,Du=32823,Bu=32926,Nu=32928,Qi=5126,Wn=35664,Yn=35665,Xn=35666,Zi=5124,Qn=35667,Zn=35668,Kn=35669,Ki=35670,Jn=35671,ei=35672,ti=35673,bn=35674,xn=35675,Cn=35676,wn=35678,Sn=35680,Ji=4,Pn=1028,Nr=1029,Ro=2304,ea=2305,Vu=32775,Gu=32776,Uu=519,$r=7680,Io=0,zo=1,Fo=32774,ju=513,Do=36160,qu=36064,yr={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Bo=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],on={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},kr={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},No={frag:ku,vert:Ou},ta={cw:Ro,ccw:ea},Vo=new Kt(!1,!1,!1,function(){}),Hu=34918,Wu=34919,Go=35007,Yu=function(S,z){var X=function(){return ke.pop()||z.ext_disjoint_timer_query.createQueryEXT()},ce=function(He){ke.push(He)},_e=function(He){var xe=X();z.ext_disjoint_timer_query.beginQueryEXT(Go,xe),Te.push(xe),Oe(Te.length-1,Te.length,He)},he=function(){z.ext_disjoint_timer_query.endQueryEXT(Go)},Ce=function(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null},Ee=function(){return Re.pop()||new Ce},Le=function(He){Re.push(He)},Oe=function(He,xe,tt){var Qe=Ee();Qe.startQueryIndex=He,Qe.endQueryIndex=xe,Qe.sum=0,Qe.stats=tt,$e.push(Qe)},Ie=function(){var He,xe,tt=Te.length;if(tt!==0){le.length=Math.max(le.length,tt+1),ue.length=Math.max(ue.length,tt+1),ue[0]=0,le[0]=0;var Qe=0;for(He=0,xe=0;xe<Te.length;++xe){var je=Te[xe];z.ext_disjoint_timer_query.getQueryObjectEXT(je,Wu)?(Qe+=z.ext_disjoint_timer_query.getQueryObjectEXT(je,Hu),ce(je)):Te[He++]=je,ue[xe+1]=Qe,le[xe+1]=He}for(Te.length=He,He=0,xe=0;xe<$e.length;++xe){var we=$e[xe],pe=we.startQueryIndex,We=we.endQueryIndex;we.sum+=ue[We]-ue[pe];var De=le[pe],Me=le[We];Me===De?(we.stats.gpuTime+=we.sum/1e6,Le(we)):(we.startQueryIndex=De,we.endQueryIndex=Me,$e[He++]=we)}$e.length=He}};if(!z.ext_disjoint_timer_query)return null;var ke=[],Te=[],Re=[],$e=[],ue=[],le=[];return{beginQuery:_e,endQuery:he,pushScopeStats:Oe,update:Ie,getNumPendingQueries:function(){return Te.length},clear:function(){ke.push.apply(ke,Te);for(var He=0;He<ke.length;He++)z.ext_disjoint_timer_query.deleteQueryEXT(ke[He]);Te.length=0,ke.length=0},restore:function(){Te.length=0,ke.length=0}}},Xu=16384,Qu=256,Zu=1024,Ku=34962,Uo="webglcontextlost",jo="webglcontextrestored",qo=1,Ju=2,ec=3;return os})}(regl)),regl.exports}var EPSILON=1e-6,ARRAY_TYPE=typeof Float32Array!="undefined"?Float32Array:Array,RANDOM=Math.random;function setMatrixArrayType(n){ARRAY_TYPE=n}var degree=Math.PI/180;function toRadian(n){return n*degree}function equals$9(n,r){return Math.abs(n-r)<=EPSILON*Math.max(1,Math.abs(n),Math.abs(r))}Math.hypot||(Math.hypot=function(){for(var n=0,r=arguments.length;r--;)n+=arguments[r]*arguments[r];return Math.sqrt(n)});var common=Object.freeze({__proto__:null,EPSILON:EPSILON,get ARRAY_TYPE(){return ARRAY_TYPE},RANDOM:RANDOM,setMatrixArrayType:setMatrixArrayType,toRadian:toRadian,equals:equals$9});function create$8(){var n=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n}function clone$8(n){var r=new ARRAY_TYPE(4);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r}function copy$8(n,r){return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n}function identity$5(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n}function fromValues$8(n,r,a,i){var o=new ARRAY_TYPE(4);return o[0]=n,o[1]=r,o[2]=a,o[3]=i,o}function set$8(n,r,a,i,o){return n[0]=r,n[1]=a,n[2]=i,n[3]=o,n}function transpose$2(n,r){if(n===r){var a=r[1];n[1]=r[2],n[2]=a}else n[0]=r[0],n[1]=r[2],n[2]=r[1],n[3]=r[3];return n}function invert$5(n,r){var a=r[0],i=r[1],o=r[2],s=r[3],l=a*s-o*i;return l?(l=1/l,n[0]=s*l,n[1]=-i*l,n[2]=-o*l,n[3]=a*l,n):null}function adjoint$2(n,r){var a=r[0];return n[0]=r[3],n[1]=-r[1],n[2]=-r[2],n[3]=a,n}function determinant$3(n){return n[0]*n[3]-n[2]*n[1]}function multiply$8(n,r,a){var i=r[0],o=r[1],s=r[2],l=r[3],u=a[0],c=a[1],f=a[2],h=a[3];return n[0]=i*u+s*c,n[1]=o*u+l*c,n[2]=i*f+s*h,n[3]=o*f+l*h,n}function rotate$4(n,r,a){var i=r[0],o=r[1],s=r[2],l=r[3],u=Math.sin(a),c=Math.cos(a);return n[0]=i*c+s*u,n[1]=o*c+l*u,n[2]=i*-u+s*c,n[3]=o*-u+l*c,n}function scale$8(n,r,a){var i=r[0],o=r[1],s=r[2],l=r[3],u=a[0],c=a[1];return n[0]=i*u,n[1]=o*u,n[2]=s*c,n[3]=l*c,n}function fromRotation$4(n,r){var a=Math.sin(r),i=Math.cos(r);return n[0]=i,n[1]=a,n[2]=-a,n[3]=i,n}function fromScaling$3(n,r){return n[0]=r[0],n[1]=0,n[2]=0,n[3]=r[1],n}function str$8(n){return"mat2("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"}function frob$3(n){return Math.hypot(n[0],n[1],n[2],n[3])}function LDU(n,r,a,i){return n[2]=i[2]/i[0],a[0]=i[0],a[1]=i[1],a[3]=i[3]-n[2]*a[1],[n,r,a]}function add$8(n,r,a){return n[0]=r[0]+a[0],n[1]=r[1]+a[1],n[2]=r[2]+a[2],n[3]=r[3]+a[3],n}function subtract$6(n,r,a){return n[0]=r[0]-a[0],n[1]=r[1]-a[1],n[2]=r[2]-a[2],n[3]=r[3]-a[3],n}function exactEquals$8(n,r){return n[0]===r[0]&&n[1]===r[1]&&n[2]===r[2]&&n[3]===r[3]}function equals$8(n,r){var a=n[0],i=n[1],o=n[2],s=n[3],l=r[0],u=r[1],c=r[2],f=r[3];return Math.abs(a-l)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(i-u)<=EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-c)<=EPSILON*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(s-f)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(f))}function multiplyScalar$3(n,r,a){return n[0]=r[0]*a,n[1]=r[1]*a,n[2]=r[2]*a,n[3]=r[3]*a,n}function multiplyScalarAndAdd$3(n,r,a,i){return n[0]=r[0]+a[0]*i,n[1]=r[1]+a[1]*i,n[2]=r[2]+a[2]*i,n[3]=r[3]+a[3]*i,n}var mul$8=multiply$8,sub$6=subtract$6,mat2=Object.freeze({__proto__:null,create:create$8,clone:clone$8,copy:copy$8,identity:identity$5,fromValues:fromValues$8,set:set$8,transpose:transpose$2,invert:invert$5,adjoint:adjoint$2,determinant:determinant$3,multiply:multiply$8,rotate:rotate$4,scale:scale$8,fromRotation:fromRotation$4,fromScaling:fromScaling$3,str:str$8,frob:frob$3,LDU:LDU,add:add$8,subtract:subtract$6,exactEquals:exactEquals$8,equals:equals$8,multiplyScalar:multiplyScalar$3,multiplyScalarAndAdd:multiplyScalarAndAdd$3,mul:mul$8,sub:sub$6});function create$7(){var n=new ARRAY_TYPE(6);return ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0,n[4]=0,n[5]=0),n[0]=1,n[3]=1,n}function clone$7(n){var r=new ARRAY_TYPE(6);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r}function copy$7(n,r){return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n}function identity$4(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n[4]=0,n[5]=0,n}function fromValues$7(n,r,a,i,o,s){var l=new ARRAY_TYPE(6);return l[0]=n,l[1]=r,l[2]=a,l[3]=i,l[4]=o,l[5]=s,l}function set$7(n,r,a,i,o,s,l){return n[0]=r,n[1]=a,n[2]=i,n[3]=o,n[4]=s,n[5]=l,n}function invert$4(n,r){var a=r[0],i=r[1],o=r[2],s=r[3],l=r[4],u=r[5],c=a*s-i*o;return c?(c=1/c,n[0]=s*c,n[1]=-i*c,n[2]=-o*c,n[3]=a*c,n[4]=(o*u-s*l)*c,n[5]=(i*l-a*u)*c,n):null}function determinant$2(n){return n[0]*n[3]-n[1]*n[2]}function multiply$7(n,r,a){var i=r[0],o=r[1],s=r[2],l=r[3],u=r[4],c=r[5],f=a[0],h=a[1],p=a[2],d=a[3],v=a[4],_=a[5];return n[0]=i*f+s*h,n[1]=o*f+l*h,n[2]=i*p+s*d,n[3]=o*p+l*d,n[4]=i*v+s*_+u,n[5]=o*v+l*_+c,n}function rotate$3(n,r,a){var i=r[0],o=r[1],s=r[2],l=r[3],u=r[4],c=r[5],f=Math.sin(a),h=Math.cos(a);return n[0]=i*h+s*f,n[1]=o*h+l*f,n[2]=i*-f+s*h,n[3]=o*-f+l*h,n[4]=u,n[5]=c,n}function scale$7(n,r,a){var i=r[0],o=r[1],s=r[2],l=r[3],u=r[4],c=r[5],f=a[0],h=a[1];return n[0]=i*f,n[1]=o*f,n[2]=s*h,n[3]=l*h,n[4]=u,n[5]=c,n}function translate$3(n,r,a){var i=r[0],o=r[1],s=r[2],l=r[3],u=r[4],c=r[5],f=a[0],h=a[1];return n[0]=i,n[1]=o,n[2]=s,n[3]=l,n[4]=i*f+s*h+u,n[5]=o*f+l*h+c,n}function fromRotation$3(n,r){var a=Math.sin(r),i=Math.cos(r);return n[0]=i,n[1]=a,n[2]=-a,n[3]=i,n[4]=0,n[5]=0,n}function fromScaling$2(n,r){return n[0]=r[0],n[1]=0,n[2]=0,n[3]=r[1],n[4]=0,n[5]=0,n}function fromTranslation$3(n,r){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n[4]=r[0],n[5]=r[1],n}function str$7(n){return"mat2d("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+")"}function frob$2(n){return Math.hypot(n[0],n[1],n[2],n[3],n[4],n[5],1)}function add$7(n,r,a){return n[0]=r[0]+a[0],n[1]=r[1]+a[1],n[2]=r[2]+a[2],n[3]=r[3]+a[3],n[4]=r[4]+a[4],n[5]=r[5]+a[5],n}function subtract$5(n,r,a){return n[0]=r[0]-a[0],n[1]=r[1]-a[1],n[2]=r[2]-a[2],n[3]=r[3]-a[3],n[4]=r[4]-a[4],n[5]=r[5]-a[5],n}function multiplyScalar$2(n,r,a){return n[0]=r[0]*a,n[1]=r[1]*a,n[2]=r[2]*a,n[3]=r[3]*a,n[4]=r[4]*a,n[5]=r[5]*a,n}function multiplyScalarAndAdd$2(n,r,a,i){return n[0]=r[0]+a[0]*i,n[1]=r[1]+a[1]*i,n[2]=r[2]+a[2]*i,n[3]=r[3]+a[3]*i,n[4]=r[4]+a[4]*i,n[5]=r[5]+a[5]*i,n}function exactEquals$7(n,r){return n[0]===r[0]&&n[1]===r[1]&&n[2]===r[2]&&n[3]===r[3]&&n[4]===r[4]&&n[5]===r[5]}function equals$7(n,r){var a=n[0],i=n[1],o=n[2],s=n[3],l=n[4],u=n[5],c=r[0],f=r[1],h=r[2],p=r[3],d=r[4],v=r[5];return Math.abs(a-c)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(i-f)<=EPSILON*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(o-h)<=EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(s-p)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(l-d)<=EPSILON*Math.max(1,Math.abs(l),Math.abs(d))&&Math.abs(u-v)<=EPSILON*Math.max(1,Math.abs(u),Math.abs(v))}var mul$7=multiply$7,sub$5=subtract$5,mat2d=Object.freeze({__proto__:null,create:create$7,clone:clone$7,copy:copy$7,identity:identity$4,fromValues:fromValues$7,set:set$7,invert:invert$4,determinant:determinant$2,multiply:multiply$7,rotate:rotate$3,scale:scale$7,translate:translate$3,fromRotation:fromRotation$3,fromScaling:fromScaling$2,fromTranslation:fromTranslation$3,str:str$7,frob:frob$2,add:add$7,subtract:subtract$5,multiplyScalar:multiplyScalar$2,multiplyScalarAndAdd:multiplyScalarAndAdd$2,exactEquals:exactEquals$7,equals:equals$7,mul:mul$7,sub:sub$5});function create$6(){var n=new ARRAY_TYPE(9);return ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function fromMat4$1(n,r){return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[4],n[4]=r[5],n[5]=r[6],n[6]=r[8],n[7]=r[9],n[8]=r[10],n}function clone$6(n){var r=new ARRAY_TYPE(9);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r}function copy$6(n,r){return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n}function fromValues$6(n,r,a,i,o,s,l,u,c){var f=new ARRAY_TYPE(9);return f[0]=n,f[1]=r,f[2]=a,f[3]=i,f[4]=o,f[5]=s,f[6]=l,f[7]=u,f[8]=c,f}function set$6(n,r,a,i,o,s,l,u,c,f){return n[0]=r,n[1]=a,n[2]=i,n[3]=o,n[4]=s,n[5]=l,n[6]=u,n[7]=c,n[8]=f,n}function identity$3(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n}function transpose$1(n,r){if(n===r){var a=r[1],i=r[2],o=r[5];n[1]=r[3],n[2]=r[6],n[3]=a,n[5]=r[7],n[6]=i,n[7]=o}else n[0]=r[0],n[1]=r[3],n[2]=r[6],n[3]=r[1],n[4]=r[4],n[5]=r[7],n[6]=r[2],n[7]=r[5],n[8]=r[8];return n}function invert$3(n,r){var a=r[0],i=r[1],o=r[2],s=r[3],l=r[4],u=r[5],c=r[6],f=r[7],h=r[8],p=h*l-u*f,d=-h*s+u*c,v=f*s-l*c,_=a*p+i*d+o*v;return _?(_=1/_,n[0]=p*_,n[1]=(-h*i+o*f)*_,n[2]=(u*i-o*l)*_,n[3]=d*_,n[4]=(h*a-o*c)*_,n[5]=(-u*a+o*s)*_,n[6]=v*_,n[7]=(-f*a+i*c)*_,n[8]=(l*a-i*s)*_,n):null}function adjoint$1(n,r){var a=r[0],i=r[1],o=r[2],s=r[3],l=r[4],u=r[5],c=r[6],f=r[7],h=r[8];return n[0]=l*h-u*f,n[1]=o*f-i*h,n[2]=i*u-o*l,n[3]=u*c-s*h,n[4]=a*h-o*c,n[5]=o*s-a*u,n[6]=s*f-l*c,n[7]=i*c-a*f,n[8]=a*l-i*s,n}function determinant$1(n){var r=n[0],a=n[1],i=n[2],o=n[3],s=n[4],l=n[5],u=n[6],c=n[7],f=n[8];return r*(f*s-l*c)+a*(-f*o+l*u)+i*(c*o-s*u)}function multiply$6(n,r,a){var i=r[0],o=r[1],s=r[2],l=r[3],u=r[4],c=r[5],f=r[6],h=r[7],p=r[8],d=a[0],v=a[1],_=a[2],m=a[3],y=a[4],g=a[5],C=a[6],b=a[7],k=a[8];return n[0]=d*i+v*l+_*f,n[1]=d*o+v*u+_*h,n[2]=d*s+v*c+_*p,n[3]=m*i+y*l+g*f,n[4]=m*o+y*u+g*h,n[5]=m*s+y*c+g*p,n[6]=C*i+b*l+k*f,n[7]=C*o+b*u+k*h,n[8]=C*s+b*c+k*p,n}function translate$2(n,r,a){var i=r[0],o=r[1],s=r[2],l=r[3],u=r[4],c=r[5],f=r[6],h=r[7],p=r[8],d=a[0],v=a[1];return n[0]=i,n[1]=o,n[2]=s,n[3]=l,n[4]=u,n[5]=c,n[6]=d*i+v*l+f,n[7]=d*o+v*u+h,n[8]=d*s+v*c+p,n}function rotate$2(n,r,a){var i=r[0],o=r[1],s=r[2],l=r[3],u=r[4],c=r[5],f=r[6],h=r[7],p=r[8],d=Math.sin(a),v=Math.cos(a);return n[0]=v*i+d*l,n[1]=v*o+d*u,n[2]=v*s+d*c,n[3]=v*l-d*i,n[4]=v*u-d*o,n[5]=v*c-d*s,n[6]=f,n[7]=h,n[8]=p,n}function scale$6(n,r,a){var i=a[0],o=a[1];return n[0]=i*r[0],n[1]=i*r[1],n[2]=i*r[2],n[3]=o*r[3],n[4]=o*r[4],n[5]=o*r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n}function fromTranslation$2(n,r){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=r[0],n[7]=r[1],n[8]=1,n}function fromRotation$2(n,r){var a=Math.sin(r),i=Math.cos(r);return n[0]=i,n[1]=a,n[2]=0,n[3]=-a,n[4]=i,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n}function fromScaling$1(n,r){return n[0]=r[0],n[1]=0,n[2]=0,n[3]=0,n[4]=r[1],n[5]=0,n[6]=0,n[7]=0,n[8]=1,n}function fromMat2d(n,r){return n[0]=r[0],n[1]=r[1],n[2]=0,n[3]=r[2],n[4]=r[3],n[5]=0,n[6]=r[4],n[7]=r[5],n[8]=1,n}function fromQuat$1(n,r){var a=r[0],i=r[1],o=r[2],s=r[3],l=a+a,u=i+i,c=o+o,f=a*l,h=i*l,p=i*u,d=o*l,v=o*u,_=o*c,m=s*l,y=s*u,g=s*c;return n[0]=1-p-_,n[3]=h-g,n[6]=d+y,n[1]=h+g,n[4]=1-f-_,n[7]=v-m,n[2]=d-y,n[5]=v+m,n[8]=1-f-p,n}function normalFromMat4(n,r){var a=r[0],i=r[1],o=r[2],s=r[3],l=r[4],u=r[5],c=r[6],f=r[7],h=r[8],p=r[9],d=r[10],v=r[11],_=r[12],m=r[13],y=r[14],g=r[15],C=a*u-i*l,b=a*c-o*l,k=a*f-s*l,L=i*c-o*u,F=i*f-s*u,W=o*f-s*c,j=h*m-p*_,Y=h*y-d*_,N=h*g-v*_,$=p*y-d*m,w=p*g-v*m,E=d*g-v*y,A=C*E-b*w+k*$+L*N-F*Y+W*j;return A?(A=1/A,n[0]=(u*E-c*w+f*$)*A,n[1]=(c*N-l*E-f*Y)*A,n[2]=(l*w-u*N+f*j)*A,n[3]=(o*w-i*E-s*$)*A,n[4]=(a*E-o*N+s*Y)*A,n[5]=(i*N-a*w-s*j)*A,n[6]=(m*W-y*F+g*L)*A,n[7]=(y*k-_*W-g*b)*A,n[8]=(_*F-m*k+g*C)*A,n):null}function projection(n,r,a){return n[0]=2/r,n[1]=0,n[2]=0,n[3]=0,n[4]=-2/a,n[5]=0,n[6]=-1,n[7]=1,n[8]=1,n}function str$6(n){return"mat3("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+", "+n[6]+", "+n[7]+", "+n[8]+")"}function frob$1(n){return Math.hypot(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8])}function add$6(n,r,a){return n[0]=r[0]+a[0],n[1]=r[1]+a[1],n[2]=r[2]+a[2],n[3]=r[3]+a[3],n[4]=r[4]+a[4],n[5]=r[5]+a[5],n[6]=r[6]+a[6],n[7]=r[7]+a[7],n[8]=r[8]+a[8],n}function subtract$4(n,r,a){return n[0]=r[0]-a[0],n[1]=r[1]-a[1],n[2]=r[2]-a[2],n[3]=r[3]-a[3],n[4]=r[4]-a[4],n[5]=r[5]-a[5],n[6]=r[6]-a[6],n[7]=r[7]-a[7],n[8]=r[8]-a[8],n}function multiplyScalar$1(n,r,a){return n[0]=r[0]*a,n[1]=r[1]*a,n[2]=r[2]*a,n[3]=r[3]*a,n[4]=r[4]*a,n[5]=r[5]*a,n[6]=r[6]*a,n[7]=r[7]*a,n[8]=r[8]*a,n}function multiplyScalarAndAdd$1(n,r,a,i){return n[0]=r[0]+a[0]*i,n[1]=r[1]+a[1]*i,n[2]=r[2]+a[2]*i,n[3]=r[3]+a[3]*i,n[4]=r[4]+a[4]*i,n[5]=r[5]+a[5]*i,n[6]=r[6]+a[6]*i,n[7]=r[7]+a[7]*i,n[8]=r[8]+a[8]*i,n}function exactEquals$6(n,r){return n[0]===r[0]&&n[1]===r[1]&&n[2]===r[2]&&n[3]===r[3]&&n[4]===r[4]&&n[5]===r[5]&&n[6]===r[6]&&n[7]===r[7]&&n[8]===r[8]}function equals$6(n,r){var a=n[0],i=n[1],o=n[2],s=n[3],l=n[4],u=n[5],c=n[6],f=n[7],h=n[8],p=r[0],d=r[1],v=r[2],_=r[3],m=r[4],y=r[5],g=r[6],C=r[7],b=r[8];return Math.abs(a-p)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(i-d)<=EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(o-v)<=EPSILON*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(s-_)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(l-m)<=EPSILON*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(u-y)<=EPSILON*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(c-g)<=EPSILON*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(f-C)<=EPSILON*Math.max(1,Math.abs(f),Math.abs(C))&&Math.abs(h-b)<=EPSILON*Math.max(1,Math.abs(h),Math.abs(b))}var mul$6=multiply$6,sub$4=subtract$4,mat3=Object.freeze({__proto__:null,create:create$6,fromMat4:fromMat4$1,clone:clone$6,copy:copy$6,fromValues:fromValues$6,set:set$6,identity:identity$3,transpose:transpose$1,invert:invert$3,adjoint:adjoint$1,determinant:determinant$1,multiply:multiply$6,translate:translate$2,rotate:rotate$2,scale:scale$6,fromTranslation:fromTranslation$2,fromRotation:fromRotation$2,fromScaling:fromScaling$1,fromMat2d:fromMat2d,fromQuat:fromQuat$1,normalFromMat4:normalFromMat4,projection:projection,str:str$6,frob:frob$1,add:add$6,subtract:subtract$4,multiplyScalar:multiplyScalar$1,multiplyScalarAndAdd:multiplyScalarAndAdd$1,exactEquals:exactEquals$6,equals:equals$6,mul:mul$6,sub:sub$4});function create$5(){var n=new ARRAY_TYPE(16);return ARRAY_TYPE!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function clone$5(n){var r=new ARRAY_TYPE(16);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=n[11],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15],r}function copy$5(n,r){return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],n}function fromValues$5(n,r,a,i,o,s,l,u,c,f,h,p,d,v,_,m){var y=new ARRAY_TYPE(16);return y[0]=n,y[1]=r,y[2]=a,y[3]=i,y[4]=o,y[5]=s,y[6]=l,y[7]=u,y[8]=c,y[9]=f,y[10]=h,y[11]=p,y[12]=d,y[13]=v,y[14]=_,y[15]=m,y}function set$5(n,r,a,i,o,s,l,u,c,f,h,p,d,v,_,m,y){return n[0]=r,n[1]=a,n[2]=i,n[3]=o,n[4]=s,n[5]=l,n[6]=u,n[7]=c,n[8]=f,n[9]=h,n[10]=p,n[11]=d,n[12]=v,n[13]=_,n[14]=m,n[15]=y,n}function identity$2(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function transpose(n,r){if(n===r){var a=r[1],i=r[2],o=r[3],s=r[6],l=r[7],u=r[11];n[1]=r[4],n[2]=r[8],n[3]=r[12],n[4]=a,n[6]=r[9],n[7]=r[13],n[8]=i,n[9]=s,n[11]=r[14],n[12]=o,n[13]=l,n[14]=u}else n[0]=r[0],n[1]=r[4],n[2]=r[8],n[3]=r[12],n[4]=r[1],n[5]=r[5],n[6]=r[9],n[7]=r[13],n[8]=r[2],n[9]=r[6],n[10]=r[10],n[11]=r[14],n[12]=r[3],n[13]=r[7],n[14]=r[11],n[15]=r[15];return n}function invert$2(n,r){var a=r[0],i=r[1],o=r[2],s=r[3],l=r[4],u=r[5],c=r[6],f=r[7],h=r[8],p=r[9],d=r[10],v=r[11],_=r[12],m=r[13],y=r[14],g=r[15],C=a*u-i*l,b=a*c-o*l,k=a*f-s*l,L=i*c-o*u,F=i*f-s*u,W=o*f-s*c,j=h*m-p*_,Y=h*y-d*_,N=h*g-v*_,$=p*y-d*m,w=p*g-v*m,E=d*g-v*y,A=C*E-b*w+k*$+L*N-F*Y+W*j;return A?(A=1/A,n[0]=(u*E-c*w+f*$)*A,n[1]=(o*w-i*E-s*$)*A,n[2]=(m*W-y*F+g*L)*A,n[3]=(d*F-p*W-v*L)*A,n[4]=(c*N-l*E-f*Y)*A,n[5]=(a*E-o*N+s*Y)*A,n[6]=(y*k-_*W-g*b)*A,n[7]=(h*W-d*k+v*b)*A,n[8]=(l*w-u*N+f*j)*A,n[9]=(i*N-a*w-s*j)*A,n[10]=(_*F-m*k+g*C)*A,n[11]=(p*k-h*F-v*C)*A,n[12]=(u*Y-l*$-c*j)*A,n[13]=(a*$-i*Y+o*j)*A,n[14]=(m*b-_*L-y*C)*A,n[15]=(h*L-p*b+d*C)*A,n):null}function adjoint(n,r){var a=r[0],i=r[1],o=r[2],s=r[3],l=r[4],u=r[5],c=r[6],f=r[7],h=r[8],p=r[9],d=r[10],v=r[11],_=r[12],m=r[13],y=r[14],g=r[15];return n[0]=u*(d*g-v*y)-p*(c*g-f*y)+m*(c*v-f*d),n[1]=-(i*(d*g-v*y)-p*(o*g-s*y)+m*(o*v-s*d)),n[2]=i*(c*g-f*y)-u*(o*g-s*y)+m*(o*f-s*c),n[3]=-(i*(c*v-f*d)-u*(o*v-s*d)+p*(o*f-s*c)),n[4]=-(l*(d*g-v*y)-h*(c*g-f*y)+_*(c*v-f*d)),n[5]=a*(d*g-v*y)-h*(o*g-s*y)+_*(o*v-s*d),n[6]=-(a*(c*g-f*y)-l*(o*g-s*y)+_*(o*f-s*c)),n[7]=a*(c*v-f*d)-l*(o*v-s*d)+h*(o*f-s*c),n[8]=l*(p*g-v*m)-h*(u*g-f*m)+_*(u*v-f*p),n[9]=-(a*(p*g-v*m)-h*(i*g-s*m)+_*(i*v-s*p)),n[10]=a*(u*g-f*m)-l*(i*g-s*m)+_*(i*f-s*u),n[11]=-(a*(u*v-f*p)-l*(i*v-s*p)+h*(i*f-s*u)),n[12]=-(l*(p*y-d*m)-h*(u*y-c*m)+_*(u*d-c*p)),n[13]=a*(p*y-d*m)-h*(i*y-o*m)+_*(i*d-o*p),n[14]=-(a*(u*y-c*m)-l*(i*y-o*m)+_*(i*c-o*u)),n[15]=a*(u*d-c*p)-l*(i*d-o*p)+h*(i*c-o*u),n}function determinant(n){var r=n[0],a=n[1],i=n[2],o=n[3],s=n[4],l=n[5],u=n[6],c=n[7],f=n[8],h=n[9],p=n[10],d=n[11],v=n[12],_=n[13],m=n[14],y=n[15],g=r*l-a*s,C=r*u-i*s,b=r*c-o*s,k=a*u-i*l,L=a*c-o*l,F=i*c-o*u,W=f*_-h*v,j=f*m-p*v,Y=f*y-d*v,N=h*m-p*_,$=h*y-d*_,w=p*y-d*m;return g*w-C*$+b*N+k*Y-L*j+F*W}function multiply$5(n,r,a){var i=r[0],o=r[1],s=r[2],l=r[3],u=r[4],c=r[5],f=r[6],h=r[7],p=r[8],d=r[9],v=r[10],_=r[11],m=r[12],y=r[13],g=r[14],C=r[15],b=a[0],k=a[1],L=a[2],F=a[3];return n[0]=b*i+k*u+L*p+F*m,n[1]=b*o+k*c+L*d+F*y,n[2]=b*s+k*f+L*v+F*g,n[3]=b*l+k*h+L*_+F*C,b=a[4],k=a[5],L=a[6],F=a[7],n[4]=b*i+k*u+L*p+F*m,n[5]=b*o+k*c+L*d+F*y,n[6]=b*s+k*f+L*v+F*g,n[7]=b*l+k*h+L*_+F*C,b=a[8],k=a[9],L=a[10],F=a[11],n[8]=b*i+k*u+L*p+F*m,n[9]=b*o+k*c+L*d+F*y,n[10]=b*s+k*f+L*v+F*g,n[11]=b*l+k*h+L*_+F*C,b=a[12],k=a[13],L=a[14],F=a[15],n[12]=b*i+k*u+L*p+F*m,n[13]=b*o+k*c+L*d+F*y,n[14]=b*s+k*f+L*v+F*g,n[15]=b*l+k*h+L*_+F*C,n}function translate$1(n,r,a){var i=a[0],o=a[1],s=a[2],l,u,c,f,h,p,d,v,_,m,y,g;return r===n?(n[12]=r[0]*i+r[4]*o+r[8]*s+r[12],n[13]=r[1]*i+r[5]*o+r[9]*s+r[13],n[14]=r[2]*i+r[6]*o+r[10]*s+r[14],n[15]=r[3]*i+r[7]*o+r[11]*s+r[15]):(l=r[0],u=r[1],c=r[2],f=r[3],h=r[4],p=r[5],d=r[6],v=r[7],_=r[8],m=r[9],y=r[10],g=r[11],n[0]=l,n[1]=u,n[2]=c,n[3]=f,n[4]=h,n[5]=p,n[6]=d,n[7]=v,n[8]=_,n[9]=m,n[10]=y,n[11]=g,n[12]=l*i+h*o+_*s+r[12],n[13]=u*i+p*o+m*s+r[13],n[14]=c*i+d*o+y*s+r[14],n[15]=f*i+v*o+g*s+r[15]),n}function scale$5(n,r,a){var i=a[0],o=a[1],s=a[2];return n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[3]=r[3]*i,n[4]=r[4]*o,n[5]=r[5]*o,n[6]=r[6]*o,n[7]=r[7]*o,n[8]=r[8]*s,n[9]=r[9]*s,n[10]=r[10]*s,n[11]=r[11]*s,n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],n}function rotate$1(n,r,a,i){var o=i[0],s=i[1],l=i[2],u=Math.hypot(o,s,l),c,f,h,p,d,v,_,m,y,g,C,b,k,L,F,W,j,Y,N,$,w,E,A,R;return u<EPSILON?null:(u=1/u,o*=u,s*=u,l*=u,c=Math.sin(a),f=Math.cos(a),h=1-f,p=r[0],d=r[1],v=r[2],_=r[3],m=r[4],y=r[5],g=r[6],C=r[7],b=r[8],k=r[9],L=r[10],F=r[11],W=o*o*h+f,j=s*o*h+l*c,Y=l*o*h-s*c,N=o*s*h-l*c,$=s*s*h+f,w=l*s*h+o*c,E=o*l*h+s*c,A=s*l*h-o*c,R=l*l*h+f,n[0]=p*W+m*j+b*Y,n[1]=d*W+y*j+k*Y,n[2]=v*W+g*j+L*Y,n[3]=_*W+C*j+F*Y,n[4]=p*N+m*$+b*w,n[5]=d*N+y*$+k*w,n[6]=v*N+g*$+L*w,n[7]=_*N+C*$+F*w,n[8]=p*E+m*A+b*R,n[9]=d*E+y*A+k*R,n[10]=v*E+g*A+L*R,n[11]=_*E+C*A+F*R,r!==n&&(n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15]),n)}function rotateX$3(n,r,a){var i=Math.sin(a),o=Math.cos(a),s=r[4],l=r[5],u=r[6],c=r[7],f=r[8],h=r[9],p=r[10],d=r[11];return r!==n&&(n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15]),n[4]=s*o+f*i,n[5]=l*o+h*i,n[6]=u*o+p*i,n[7]=c*o+d*i,n[8]=f*o-s*i,n[9]=h*o-l*i,n[10]=p*o-u*i,n[11]=d*o-c*i,n}function rotateY$3(n,r,a){var i=Math.sin(a),o=Math.cos(a),s=r[0],l=r[1],u=r[2],c=r[3],f=r[8],h=r[9],p=r[10],d=r[11];return r!==n&&(n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15]),n[0]=s*o-f*i,n[1]=l*o-h*i,n[2]=u*o-p*i,n[3]=c*o-d*i,n[8]=s*i+f*o,n[9]=l*i+h*o,n[10]=u*i+p*o,n[11]=c*i+d*o,n}function rotateZ$3(n,r,a){var i=Math.sin(a),o=Math.cos(a),s=r[0],l=r[1],u=r[2],c=r[3],f=r[4],h=r[5],p=r[6],d=r[7];return r!==n&&(n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15]),n[0]=s*o+f*i,n[1]=l*o+h*i,n[2]=u*o+p*i,n[3]=c*o+d*i,n[4]=f*o-s*i,n[5]=h*o-l*i,n[6]=p*o-u*i,n[7]=d*o-c*i,n}function fromTranslation$1(n,r){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=r[0],n[13]=r[1],n[14]=r[2],n[15]=1,n}function fromScaling(n,r){return n[0]=r[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=r[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=r[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function fromRotation$1(n,r,a){var i=a[0],o=a[1],s=a[2],l=Math.hypot(i,o,s),u,c,f;return l<EPSILON?null:(l=1/l,i*=l,o*=l,s*=l,u=Math.sin(r),c=Math.cos(r),f=1-c,n[0]=i*i*f+c,n[1]=o*i*f+s*u,n[2]=s*i*f-o*u,n[3]=0,n[4]=i*o*f-s*u,n[5]=o*o*f+c,n[6]=s*o*f+i*u,n[7]=0,n[8]=i*s*f+o*u,n[9]=o*s*f-i*u,n[10]=s*s*f+c,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}function fromXRotation(n,r){var a=Math.sin(r),i=Math.cos(r);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=i,n[6]=a,n[7]=0,n[8]=0,n[9]=-a,n[10]=i,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function fromYRotation(n,r){var a=Math.sin(r),i=Math.cos(r);return n[0]=i,n[1]=0,n[2]=-a,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=a,n[9]=0,n[10]=i,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function fromZRotation(n,r){var a=Math.sin(r),i=Math.cos(r);return n[0]=i,n[1]=a,n[2]=0,n[3]=0,n[4]=-a,n[5]=i,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function fromRotationTranslation$1(n,r,a){var i=r[0],o=r[1],s=r[2],l=r[3],u=i+i,c=o+o,f=s+s,h=i*u,p=i*c,d=i*f,v=o*c,_=o*f,m=s*f,y=l*u,g=l*c,C=l*f;return n[0]=1-(v+m),n[1]=p+C,n[2]=d-g,n[3]=0,n[4]=p-C,n[5]=1-(h+m),n[6]=_+y,n[7]=0,n[8]=d+g,n[9]=_-y,n[10]=1-(h+v),n[11]=0,n[12]=a[0],n[13]=a[1],n[14]=a[2],n[15]=1,n}function fromQuat2(n,r){var a=new ARRAY_TYPE(3),i=-r[0],o=-r[1],s=-r[2],l=r[3],u=r[4],c=r[5],f=r[6],h=r[7],p=i*i+o*o+s*s+l*l;return p>0?(a[0]=(u*l+h*i+c*s-f*o)*2/p,a[1]=(c*l+h*o+f*i-u*s)*2/p,a[2]=(f*l+h*s+u*o-c*i)*2/p):(a[0]=(u*l+h*i+c*s-f*o)*2,a[1]=(c*l+h*o+f*i-u*s)*2,a[2]=(f*l+h*s+u*o-c*i)*2),fromRotationTranslation$1(n,r,a),n}function getTranslation$1(n,r){return n[0]=r[12],n[1]=r[13],n[2]=r[14],n}function getScaling(n,r){var a=r[0],i=r[1],o=r[2],s=r[4],l=r[5],u=r[6],c=r[8],f=r[9],h=r[10];return n[0]=Math.hypot(a,i,o),n[1]=Math.hypot(s,l,u),n[2]=Math.hypot(c,f,h),n}function getRotation(n,r){var a=new ARRAY_TYPE(3);getScaling(a,r);var i=1/a[0],o=1/a[1],s=1/a[2],l=r[0]*i,u=r[1]*o,c=r[2]*s,f=r[4]*i,h=r[5]*o,p=r[6]*s,d=r[8]*i,v=r[9]*o,_=r[10]*s,m=l+h+_,y=0;return m>0?(y=Math.sqrt(m+1)*2,n[3]=.25*y,n[0]=(p-v)/y,n[1]=(d-c)/y,n[2]=(u-f)/y):l>h&&l>_?(y=Math.sqrt(1+l-h-_)*2,n[3]=(p-v)/y,n[0]=.25*y,n[1]=(u+f)/y,n[2]=(d+c)/y):h>_?(y=Math.sqrt(1+h-l-_)*2,n[3]=(d-c)/y,n[0]=(u+f)/y,n[1]=.25*y,n[2]=(p+v)/y):(y=Math.sqrt(1+_-l-h)*2,n[3]=(u-f)/y,n[0]=(d+c)/y,n[1]=(p+v)/y,n[2]=.25*y),n}function fromRotationTranslationScale(n,r,a,i){var o=r[0],s=r[1],l=r[2],u=r[3],c=o+o,f=s+s,h=l+l,p=o*c,d=o*f,v=o*h,_=s*f,m=s*h,y=l*h,g=u*c,C=u*f,b=u*h,k=i[0],L=i[1],F=i[2];return n[0]=(1-(_+y))*k,n[1]=(d+b)*k,n[2]=(v-C)*k,n[3]=0,n[4]=(d-b)*L,n[5]=(1-(p+y))*L,n[6]=(m+g)*L,n[7]=0,n[8]=(v+C)*F,n[9]=(m-g)*F,n[10]=(1-(p+_))*F,n[11]=0,n[12]=a[0],n[13]=a[1],n[14]=a[2],n[15]=1,n}function fromRotationTranslationScaleOrigin(n,r,a,i,o){var s=r[0],l=r[1],u=r[2],c=r[3],f=s+s,h=l+l,p=u+u,d=s*f,v=s*h,_=s*p,m=l*h,y=l*p,g=u*p,C=c*f,b=c*h,k=c*p,L=i[0],F=i[1],W=i[2],j=o[0],Y=o[1],N=o[2],$=(1-(m+g))*L,w=(v+k)*L,E=(_-b)*L,A=(v-k)*F,R=(1-(d+g))*F,O=(y+C)*F,P=(_+b)*W,T=(y-C)*W,M=(1-(d+m))*W;return n[0]=$,n[1]=w,n[2]=E,n[3]=0,n[4]=A,n[5]=R,n[6]=O,n[7]=0,n[8]=P,n[9]=T,n[10]=M,n[11]=0,n[12]=a[0]+j-($*j+A*Y+P*N),n[13]=a[1]+Y-(w*j+R*Y+T*N),n[14]=a[2]+N-(E*j+O*Y+M*N),n[15]=1,n}function fromQuat(n,r){var a=r[0],i=r[1],o=r[2],s=r[3],l=a+a,u=i+i,c=o+o,f=a*l,h=i*l,p=i*u,d=o*l,v=o*u,_=o*c,m=s*l,y=s*u,g=s*c;return n[0]=1-p-_,n[1]=h+g,n[2]=d-y,n[3]=0,n[4]=h-g,n[5]=1-f-_,n[6]=v+m,n[7]=0,n[8]=d+y,n[9]=v-m,n[10]=1-f-p,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function frustum(n,r,a,i,o,s,l){var u=1/(a-r),c=1/(o-i),f=1/(s-l);return n[0]=s*2*u,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=s*2*c,n[6]=0,n[7]=0,n[8]=(a+r)*u,n[9]=(o+i)*c,n[10]=(l+s)*f,n[11]=-1,n[12]=0,n[13]=0,n[14]=l*s*2*f,n[15]=0,n}function perspectiveNO(n,r,a,i,o){var s=1/Math.tan(r/2),l;return n[0]=s/a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=s,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,o!=null&&o!==1/0?(l=1/(i-o),n[10]=(o+i)*l,n[14]=2*o*i*l):(n[10]=-1,n[14]=-2*i),n}var perspective=perspectiveNO;function perspectiveZO(n,r,a,i,o){var s=1/Math.tan(r/2),l;return n[0]=s/a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=s,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,o!=null&&o!==1/0?(l=1/(i-o),n[10]=o*l,n[14]=o*i*l):(n[10]=-1,n[14]=-i),n}function perspectiveFromFieldOfView(n,r,a,i){var o=Math.tan(r.upDegrees*Math.PI/180),s=Math.tan(r.downDegrees*Math.PI/180),l=Math.tan(r.leftDegrees*Math.PI/180),u=Math.tan(r.rightDegrees*Math.PI/180),c=2/(l+u),f=2/(o+s);return n[0]=c,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=f,n[6]=0,n[7]=0,n[8]=-((l-u)*c*.5),n[9]=(o-s)*f*.5,n[10]=i/(a-i),n[11]=-1,n[12]=0,n[13]=0,n[14]=i*a/(a-i),n[15]=0,n}function orthoNO(n,r,a,i,o,s,l){var u=1/(r-a),c=1/(i-o),f=1/(s-l);return n[0]=-2*u,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*c,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*f,n[11]=0,n[12]=(r+a)*u,n[13]=(o+i)*c,n[14]=(l+s)*f,n[15]=1,n}var ortho=orthoNO;function orthoZO(n,r,a,i,o,s,l){var u=1/(r-a),c=1/(i-o),f=1/(s-l);return n[0]=-2*u,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*c,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=f,n[11]=0,n[12]=(r+a)*u,n[13]=(o+i)*c,n[14]=s*f,n[15]=1,n}function lookAt(n,r,a,i){var o,s,l,u,c,f,h,p,d,v,_=r[0],m=r[1],y=r[2],g=i[0],C=i[1],b=i[2],k=a[0],L=a[1],F=a[2];return Math.abs(_-k)<EPSILON&&Math.abs(m-L)<EPSILON&&Math.abs(y-F)<EPSILON?identity$2(n):(h=_-k,p=m-L,d=y-F,v=1/Math.hypot(h,p,d),h*=v,p*=v,d*=v,o=C*d-b*p,s=b*h-g*d,l=g*p-C*h,v=Math.hypot(o,s,l),v?(v=1/v,o*=v,s*=v,l*=v):(o=0,s=0,l=0),u=p*l-d*s,c=d*o-h*l,f=h*s-p*o,v=Math.hypot(u,c,f),v?(v=1/v,u*=v,c*=v,f*=v):(u=0,c=0,f=0),n[0]=o,n[1]=u,n[2]=h,n[3]=0,n[4]=s,n[5]=c,n[6]=p,n[7]=0,n[8]=l,n[9]=f,n[10]=d,n[11]=0,n[12]=-(o*_+s*m+l*y),n[13]=-(u*_+c*m+f*y),n[14]=-(h*_+p*m+d*y),n[15]=1,n)}function targetTo(n,r,a,i){var o=r[0],s=r[1],l=r[2],u=i[0],c=i[1],f=i[2],h=o-a[0],p=s-a[1],d=l-a[2],v=h*h+p*p+d*d;v>0&&(v=1/Math.sqrt(v),h*=v,p*=v,d*=v);var _=c*d-f*p,m=f*h-u*d,y=u*p-c*h;return v=_*_+m*m+y*y,v>0&&(v=1/Math.sqrt(v),_*=v,m*=v,y*=v),n[0]=_,n[1]=m,n[2]=y,n[3]=0,n[4]=p*y-d*m,n[5]=d*_-h*y,n[6]=h*m-p*_,n[7]=0,n[8]=h,n[9]=p,n[10]=d,n[11]=0,n[12]=o,n[13]=s,n[14]=l,n[15]=1,n}function str$5(n){return"mat4("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+", "+n[6]+", "+n[7]+", "+n[8]+", "+n[9]+", "+n[10]+", "+n[11]+", "+n[12]+", "+n[13]+", "+n[14]+", "+n[15]+")"}function frob(n){return Math.hypot(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15])}function add$5(n,r,a){return n[0]=r[0]+a[0],n[1]=r[1]+a[1],n[2]=r[2]+a[2],n[3]=r[3]+a[3],n[4]=r[4]+a[4],n[5]=r[5]+a[5],n[6]=r[6]+a[6],n[7]=r[7]+a[7],n[8]=r[8]+a[8],n[9]=r[9]+a[9],n[10]=r[10]+a[10],n[11]=r[11]+a[11],n[12]=r[12]+a[12],n[13]=r[13]+a[13],n[14]=r[14]+a[14],n[15]=r[15]+a[15],n}function subtract$3(n,r,a){return n[0]=r[0]-a[0],n[1]=r[1]-a[1],n[2]=r[2]-a[2],n[3]=r[3]-a[3],n[4]=r[4]-a[4],n[5]=r[5]-a[5],n[6]=r[6]-a[6],n[7]=r[7]-a[7],n[8]=r[8]-a[8],n[9]=r[9]-a[9],n[10]=r[10]-a[10],n[11]=r[11]-a[11],n[12]=r[12]-a[12],n[13]=r[13]-a[13],n[14]=r[14]-a[14],n[15]=r[15]-a[15],n}function multiplyScalar(n,r,a){return n[0]=r[0]*a,n[1]=r[1]*a,n[2]=r[2]*a,n[3]=r[3]*a,n[4]=r[4]*a,n[5]=r[5]*a,n[6]=r[6]*a,n[7]=r[7]*a,n[8]=r[8]*a,n[9]=r[9]*a,n[10]=r[10]*a,n[11]=r[11]*a,n[12]=r[12]*a,n[13]=r[13]*a,n[14]=r[14]*a,n[15]=r[15]*a,n}function multiplyScalarAndAdd(n,r,a,i){return n[0]=r[0]+a[0]*i,n[1]=r[1]+a[1]*i,n[2]=r[2]+a[2]*i,n[3]=r[3]+a[3]*i,n[4]=r[4]+a[4]*i,n[5]=r[5]+a[5]*i,n[6]=r[6]+a[6]*i,n[7]=r[7]+a[7]*i,n[8]=r[8]+a[8]*i,n[9]=r[9]+a[9]*i,n[10]=r[10]+a[10]*i,n[11]=r[11]+a[11]*i,n[12]=r[12]+a[12]*i,n[13]=r[13]+a[13]*i,n[14]=r[14]+a[14]*i,n[15]=r[15]+a[15]*i,n}function exactEquals$5(n,r){return n[0]===r[0]&&n[1]===r[1]&&n[2]===r[2]&&n[3]===r[3]&&n[4]===r[4]&&n[5]===r[5]&&n[6]===r[6]&&n[7]===r[7]&&n[8]===r[8]&&n[9]===r[9]&&n[10]===r[10]&&n[11]===r[11]&&n[12]===r[12]&&n[13]===r[13]&&n[14]===r[14]&&n[15]===r[15]}function equals$5(n,r){var a=n[0],i=n[1],o=n[2],s=n[3],l=n[4],u=n[5],c=n[6],f=n[7],h=n[8],p=n[9],d=n[10],v=n[11],_=n[12],m=n[13],y=n[14],g=n[15],C=r[0],b=r[1],k=r[2],L=r[3],F=r[4],W=r[5],j=r[6],Y=r[7],N=r[8],$=r[9],w=r[10],E=r[11],A=r[12],R=r[13],O=r[14],P=r[15];return Math.abs(a-C)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(C))&&Math.abs(i-b)<=EPSILON*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(o-k)<=EPSILON*Math.max(1,Math.abs(o),Math.abs(k))&&Math.abs(s-L)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(L))&&Math.abs(l-F)<=EPSILON*Math.max(1,Math.abs(l),Math.abs(F))&&Math.abs(u-W)<=EPSILON*Math.max(1,Math.abs(u),Math.abs(W))&&Math.abs(c-j)<=EPSILON*Math.max(1,Math.abs(c),Math.abs(j))&&Math.abs(f-Y)<=EPSILON*Math.max(1,Math.abs(f),Math.abs(Y))&&Math.abs(h-N)<=EPSILON*Math.max(1,Math.abs(h),Math.abs(N))&&Math.abs(p-$)<=EPSILON*Math.max(1,Math.abs(p),Math.abs($))&&Math.abs(d-w)<=EPSILON*Math.max(1,Math.abs(d),Math.abs(w))&&Math.abs(v-E)<=EPSILON*Math.max(1,Math.abs(v),Math.abs(E))&&Math.abs(_-A)<=EPSILON*Math.max(1,Math.abs(_),Math.abs(A))&&Math.abs(m-R)<=EPSILON*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(y-O)<=EPSILON*Math.max(1,Math.abs(y),Math.abs(O))&&Math.abs(g-P)<=EPSILON*Math.max(1,Math.abs(g),Math.abs(P))}var mul$5=multiply$5,sub$3=subtract$3,mat4=Object.freeze({__proto__:null,create:create$5,clone:clone$5,copy:copy$5,fromValues:fromValues$5,set:set$5,identity:identity$2,transpose:transpose,invert:invert$2,adjoint:adjoint,determinant:determinant,multiply:multiply$5,translate:translate$1,scale:scale$5,rotate:rotate$1,rotateX:rotateX$3,rotateY:rotateY$3,rotateZ:rotateZ$3,fromTranslation:fromTranslation$1,fromScaling:fromScaling,fromRotation:fromRotation$1,fromXRotation:fromXRotation,fromYRotation:fromYRotation,fromZRotation:fromZRotation,fromRotationTranslation:fromRotationTranslation$1,fromQuat2:fromQuat2,getTranslation:getTranslation$1,getScaling:getScaling,getRotation:getRotation,fromRotationTranslationScale:fromRotationTranslationScale,fromRotationTranslationScaleOrigin:fromRotationTranslationScaleOrigin,fromQuat:fromQuat,frustum:frustum,perspectiveNO:perspectiveNO,perspective:perspective,perspectiveZO:perspectiveZO,perspectiveFromFieldOfView:perspectiveFromFieldOfView,orthoNO:orthoNO,ortho:ortho,orthoZO:orthoZO,lookAt:lookAt,targetTo:targetTo,str:str$5,frob:frob,add:add$5,subtract:subtract$3,multiplyScalar:multiplyScalar,multiplyScalarAndAdd:multiplyScalarAndAdd,exactEquals:exactEquals$5,equals:equals$5,mul:mul$5,sub:sub$3});function create$4(){var n=new ARRAY_TYPE(3);return ARRAY_TYPE!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function clone$4(n){var r=new ARRAY_TYPE(3);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r}function length$4(n){var r=n[0],a=n[1],i=n[2];return Math.hypot(r,a,i)}function fromValues$4(n,r,a){var i=new ARRAY_TYPE(3);return i[0]=n,i[1]=r,i[2]=a,i}function copy$4(n,r){return n[0]=r[0],n[1]=r[1],n[2]=r[2],n}function set$4(n,r,a,i){return n[0]=r,n[1]=a,n[2]=i,n}function add$4(n,r,a){return n[0]=r[0]+a[0],n[1]=r[1]+a[1],n[2]=r[2]+a[2],n}function subtract$2(n,r,a){return n[0]=r[0]-a[0],n[1]=r[1]-a[1],n[2]=r[2]-a[2],n}function multiply$4(n,r,a){return n[0]=r[0]*a[0],n[1]=r[1]*a[1],n[2]=r[2]*a[2],n}function divide$2(n,r,a){return n[0]=r[0]/a[0],n[1]=r[1]/a[1],n[2]=r[2]/a[2],n}function ceil$2(n,r){return n[0]=Math.ceil(r[0]),n[1]=Math.ceil(r[1]),n[2]=Math.ceil(r[2]),n}function floor$2(n,r){return n[0]=Math.floor(r[0]),n[1]=Math.floor(r[1]),n[2]=Math.floor(r[2]),n}function min$2(n,r,a){return n[0]=Math.min(r[0],a[0]),n[1]=Math.min(r[1],a[1]),n[2]=Math.min(r[2],a[2]),n}function max$2(n,r,a){return n[0]=Math.max(r[0],a[0]),n[1]=Math.max(r[1],a[1]),n[2]=Math.max(r[2],a[2]),n}function round$2(n,r){return n[0]=Math.round(r[0]),n[1]=Math.round(r[1]),n[2]=Math.round(r[2]),n}function scale$4(n,r,a){return n[0]=r[0]*a,n[1]=r[1]*a,n[2]=r[2]*a,n}function scaleAndAdd$2(n,r,a,i){return n[0]=r[0]+a[0]*i,n[1]=r[1]+a[1]*i,n[2]=r[2]+a[2]*i,n}function distance$2(n,r){var a=r[0]-n[0],i=r[1]-n[1],o=r[2]-n[2];return Math.hypot(a,i,o)}function squaredDistance$2(n,r){var a=r[0]-n[0],i=r[1]-n[1],o=r[2]-n[2];return a*a+i*i+o*o}function squaredLength$4(n){var r=n[0],a=n[1],i=n[2];return r*r+a*a+i*i}function negate$2(n,r){return n[0]=-r[0],n[1]=-r[1],n[2]=-r[2],n}function inverse$2(n,r){return n[0]=1/r[0],n[1]=1/r[1],n[2]=1/r[2],n}function normalize$4(n,r){var a=r[0],i=r[1],o=r[2],s=a*a+i*i+o*o;return s>0&&(s=1/Math.sqrt(s)),n[0]=r[0]*s,n[1]=r[1]*s,n[2]=r[2]*s,n}function dot$4(n,r){return n[0]*r[0]+n[1]*r[1]+n[2]*r[2]}function cross$2(n,r,a){var i=r[0],o=r[1],s=r[2],l=a[0],u=a[1],c=a[2];return n[0]=o*c-s*u,n[1]=s*l-i*c,n[2]=i*u-o*l,n}function lerp$4(n,r,a,i){var o=r[0],s=r[1],l=r[2];return n[0]=o+i*(a[0]-o),n[1]=s+i*(a[1]-s),n[2]=l+i*(a[2]-l),n}function hermite(n,r,a,i,o,s){var l=s*s,u=l*(2*s-3)+1,c=l*(s-2)+s,f=l*(s-1),h=l*(3-2*s);return n[0]=r[0]*u+a[0]*c+i[0]*f+o[0]*h,n[1]=r[1]*u+a[1]*c+i[1]*f+o[1]*h,n[2]=r[2]*u+a[2]*c+i[2]*f+o[2]*h,n}function bezier(n,r,a,i,o,s){var l=1-s,u=l*l,c=s*s,f=u*l,h=3*s*u,p=3*c*l,d=c*s;return n[0]=r[0]*f+a[0]*h+i[0]*p+o[0]*d,n[1]=r[1]*f+a[1]*h+i[1]*p+o[1]*d,n[2]=r[2]*f+a[2]*h+i[2]*p+o[2]*d,n}function random$3(n,r){r=r||1;var a=RANDOM()*2*Math.PI,i=RANDOM()*2-1,o=Math.sqrt(1-i*i)*r;return n[0]=Math.cos(a)*o,n[1]=Math.sin(a)*o,n[2]=i*r,n}function transformMat4$2(n,r,a){var i=r[0],o=r[1],s=r[2],l=a[3]*i+a[7]*o+a[11]*s+a[15];return l=l||1,n[0]=(a[0]*i+a[4]*o+a[8]*s+a[12])/l,n[1]=(a[1]*i+a[5]*o+a[9]*s+a[13])/l,n[2]=(a[2]*i+a[6]*o+a[10]*s+a[14])/l,n}function transformMat3$1(n,r,a){var i=r[0],o=r[1],s=r[2];return n[0]=i*a[0]+o*a[3]+s*a[6],n[1]=i*a[1]+o*a[4]+s*a[7],n[2]=i*a[2]+o*a[5]+s*a[8],n}function transformQuat$1(n,r,a){var i=a[0],o=a[1],s=a[2],l=a[3],u=r[0],c=r[1],f=r[2],h=o*f-s*c,p=s*u-i*f,d=i*c-o*u,v=o*d-s*p,_=s*h-i*d,m=i*p-o*h,y=l*2;return h*=y,p*=y,d*=y,v*=2,_*=2,m*=2,n[0]=u+h+v,n[1]=c+p+_,n[2]=f+d+m,n}function rotateX$2(n,r,a,i){var o=[],s=[];return o[0]=r[0]-a[0],o[1]=r[1]-a[1],o[2]=r[2]-a[2],s[0]=o[0],s[1]=o[1]*Math.cos(i)-o[2]*Math.sin(i),s[2]=o[1]*Math.sin(i)+o[2]*Math.cos(i),n[0]=s[0]+a[0],n[1]=s[1]+a[1],n[2]=s[2]+a[2],n}function rotateY$2(n,r,a,i){var o=[],s=[];return o[0]=r[0]-a[0],o[1]=r[1]-a[1],o[2]=r[2]-a[2],s[0]=o[2]*Math.sin(i)+o[0]*Math.cos(i),s[1]=o[1],s[2]=o[2]*Math.cos(i)-o[0]*Math.sin(i),n[0]=s[0]+a[0],n[1]=s[1]+a[1],n[2]=s[2]+a[2],n}function rotateZ$2(n,r,a,i){var o=[],s=[];return o[0]=r[0]-a[0],o[1]=r[1]-a[1],o[2]=r[2]-a[2],s[0]=o[0]*Math.cos(i)-o[1]*Math.sin(i),s[1]=o[0]*Math.sin(i)+o[1]*Math.cos(i),s[2]=o[2],n[0]=s[0]+a[0],n[1]=s[1]+a[1],n[2]=s[2]+a[2],n}function angle$1(n,r){var a=n[0],i=n[1],o=n[2],s=r[0],l=r[1],u=r[2],c=Math.sqrt(a*a+i*i+o*o),f=Math.sqrt(s*s+l*l+u*u),h=c*f,p=h&&dot$4(n,r)/h;return Math.acos(Math.min(Math.max(p,-1),1))}function zero$2(n){return n[0]=0,n[1]=0,n[2]=0,n}function str$4(n){return"vec3("+n[0]+", "+n[1]+", "+n[2]+")"}function exactEquals$4(n,r){return n[0]===r[0]&&n[1]===r[1]&&n[2]===r[2]}function equals$4(n,r){var a=n[0],i=n[1],o=n[2],s=r[0],l=r[1],u=r[2];return Math.abs(a-s)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(s))&&Math.abs(i-l)<=EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(o-u)<=EPSILON*Math.max(1,Math.abs(o),Math.abs(u))}var sub$2=subtract$2,mul$4=multiply$4,div$2=divide$2,dist$2=distance$2,sqrDist$2=squaredDistance$2,len$4=length$4,sqrLen$4=squaredLength$4,forEach$2=function(){var n=create$4();return function(r,a,i,o,s,l){var u,c;for(a||(a=3),i||(i=0),o?c=Math.min(o*a+i,r.length):c=r.length,u=i;u<c;u+=a)n[0]=r[u],n[1]=r[u+1],n[2]=r[u+2],s(n,n,l),r[u]=n[0],r[u+1]=n[1],r[u+2]=n[2];return r}}(),vec3=Object.freeze({__proto__:null,create:create$4,clone:clone$4,length:length$4,fromValues:fromValues$4,copy:copy$4,set:set$4,add:add$4,subtract:subtract$2,multiply:multiply$4,divide:divide$2,ceil:ceil$2,floor:floor$2,min:min$2,max:max$2,round:round$2,scale:scale$4,scaleAndAdd:scaleAndAdd$2,distance:distance$2,squaredDistance:squaredDistance$2,squaredLength:squaredLength$4,negate:negate$2,inverse:inverse$2,normalize:normalize$4,dot:dot$4,cross:cross$2,lerp:lerp$4,hermite:hermite,bezier:bezier,random:random$3,transformMat4:transformMat4$2,transformMat3:transformMat3$1,transformQuat:transformQuat$1,rotateX:rotateX$2,rotateY:rotateY$2,rotateZ:rotateZ$2,angle:angle$1,zero:zero$2,str:str$4,exactEquals:exactEquals$4,equals:equals$4,sub:sub$2,mul:mul$4,div:div$2,dist:dist$2,sqrDist:sqrDist$2,len:len$4,sqrLen:sqrLen$4,forEach:forEach$2});function create$3(){var n=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function clone$3(n){var r=new ARRAY_TYPE(4);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r}function fromValues$3(n,r,a,i){var o=new ARRAY_TYPE(4);return o[0]=n,o[1]=r,o[2]=a,o[3]=i,o}function copy$3(n,r){return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n}function set$3(n,r,a,i,o){return n[0]=r,n[1]=a,n[2]=i,n[3]=o,n}function add$3(n,r,a){return n[0]=r[0]+a[0],n[1]=r[1]+a[1],n[2]=r[2]+a[2],n[3]=r[3]+a[3],n}function subtract$1(n,r,a){return n[0]=r[0]-a[0],n[1]=r[1]-a[1],n[2]=r[2]-a[2],n[3]=r[3]-a[3],n}function multiply$3(n,r,a){return n[0]=r[0]*a[0],n[1]=r[1]*a[1],n[2]=r[2]*a[2],n[3]=r[3]*a[3],n}function divide$1(n,r,a){return n[0]=r[0]/a[0],n[1]=r[1]/a[1],n[2]=r[2]/a[2],n[3]=r[3]/a[3],n}function ceil$1(n,r){return n[0]=Math.ceil(r[0]),n[1]=Math.ceil(r[1]),n[2]=Math.ceil(r[2]),n[3]=Math.ceil(r[3]),n}function floor$1(n,r){return n[0]=Math.floor(r[0]),n[1]=Math.floor(r[1]),n[2]=Math.floor(r[2]),n[3]=Math.floor(r[3]),n}function min$1(n,r,a){return n[0]=Math.min(r[0],a[0]),n[1]=Math.min(r[1],a[1]),n[2]=Math.min(r[2],a[2]),n[3]=Math.min(r[3],a[3]),n}function max$1(n,r,a){return n[0]=Math.max(r[0],a[0]),n[1]=Math.max(r[1],a[1]),n[2]=Math.max(r[2],a[2]),n[3]=Math.max(r[3],a[3]),n}function round$1(n,r){return n[0]=Math.round(r[0]),n[1]=Math.round(r[1]),n[2]=Math.round(r[2]),n[3]=Math.round(r[3]),n}function scale$3(n,r,a){return n[0]=r[0]*a,n[1]=r[1]*a,n[2]=r[2]*a,n[3]=r[3]*a,n}function scaleAndAdd$1(n,r,a,i){return n[0]=r[0]+a[0]*i,n[1]=r[1]+a[1]*i,n[2]=r[2]+a[2]*i,n[3]=r[3]+a[3]*i,n}function distance$1(n,r){var a=r[0]-n[0],i=r[1]-n[1],o=r[2]-n[2],s=r[3]-n[3];return Math.hypot(a,i,o,s)}function squaredDistance$1(n,r){var a=r[0]-n[0],i=r[1]-n[1],o=r[2]-n[2],s=r[3]-n[3];return a*a+i*i+o*o+s*s}function length$3(n){var r=n[0],a=n[1],i=n[2],o=n[3];return Math.hypot(r,a,i,o)}function squaredLength$3(n){var r=n[0],a=n[1],i=n[2],o=n[3];return r*r+a*a+i*i+o*o}function negate$1(n,r){return n[0]=-r[0],n[1]=-r[1],n[2]=-r[2],n[3]=-r[3],n}function inverse$1(n,r){return n[0]=1/r[0],n[1]=1/r[1],n[2]=1/r[2],n[3]=1/r[3],n}function normalize$3(n,r){var a=r[0],i=r[1],o=r[2],s=r[3],l=a*a+i*i+o*o+s*s;return l>0&&(l=1/Math.sqrt(l)),n[0]=a*l,n[1]=i*l,n[2]=o*l,n[3]=s*l,n}function dot$3(n,r){return n[0]*r[0]+n[1]*r[1]+n[2]*r[2]+n[3]*r[3]}function cross$1(n,r,a,i){var o=a[0]*i[1]-a[1]*i[0],s=a[0]*i[2]-a[2]*i[0],l=a[0]*i[3]-a[3]*i[0],u=a[1]*i[2]-a[2]*i[1],c=a[1]*i[3]-a[3]*i[1],f=a[2]*i[3]-a[3]*i[2],h=r[0],p=r[1],d=r[2],v=r[3];return n[0]=p*f-d*c+v*u,n[1]=-(h*f)+d*l-v*s,n[2]=h*c-p*l+v*o,n[3]=-(h*u)+p*s-d*o,n}function lerp$3(n,r,a,i){var o=r[0],s=r[1],l=r[2],u=r[3];return n[0]=o+i*(a[0]-o),n[1]=s+i*(a[1]-s),n[2]=l+i*(a[2]-l),n[3]=u+i*(a[3]-u),n}function random$2(n,r){r=r||1;var a,i,o,s,l,u;do a=RANDOM()*2-1,i=RANDOM()*2-1,l=a*a+i*i;while(l>=1);do o=RANDOM()*2-1,s=RANDOM()*2-1,u=o*o+s*s;while(u>=1);var c=Math.sqrt((1-l)/u);return n[0]=r*a,n[1]=r*i,n[2]=r*o*c,n[3]=r*s*c,n}function transformMat4$1(n,r,a){var i=r[0],o=r[1],s=r[2],l=r[3];return n[0]=a[0]*i+a[4]*o+a[8]*s+a[12]*l,n[1]=a[1]*i+a[5]*o+a[9]*s+a[13]*l,n[2]=a[2]*i+a[6]*o+a[10]*s+a[14]*l,n[3]=a[3]*i+a[7]*o+a[11]*s+a[15]*l,n}function transformQuat(n,r,a){var i=r[0],o=r[1],s=r[2],l=a[0],u=a[1],c=a[2],f=a[3],h=f*i+u*s-c*o,p=f*o+c*i-l*s,d=f*s+l*o-u*i,v=-l*i-u*o-c*s;return n[0]=h*f+v*-l+p*-c-d*-u,n[1]=p*f+v*-u+d*-l-h*-c,n[2]=d*f+v*-c+h*-u-p*-l,n[3]=r[3],n}function zero$1(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=0,n}function str$3(n){return"vec4("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"}function exactEquals$3(n,r){return n[0]===r[0]&&n[1]===r[1]&&n[2]===r[2]&&n[3]===r[3]}function equals$3(n,r){var a=n[0],i=n[1],o=n[2],s=n[3],l=r[0],u=r[1],c=r[2],f=r[3];return Math.abs(a-l)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(i-u)<=EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-c)<=EPSILON*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(s-f)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(f))}var sub$1=subtract$1,mul$3=multiply$3,div$1=divide$1,dist$1=distance$1,sqrDist$1=squaredDistance$1,len$3=length$3,sqrLen$3=squaredLength$3,forEach$1=function(){var n=create$3();return function(r,a,i,o,s,l){var u,c;for(a||(a=4),i||(i=0),o?c=Math.min(o*a+i,r.length):c=r.length,u=i;u<c;u+=a)n[0]=r[u],n[1]=r[u+1],n[2]=r[u+2],n[3]=r[u+3],s(n,n,l),r[u]=n[0],r[u+1]=n[1],r[u+2]=n[2],r[u+3]=n[3];return r}}(),vec4=Object.freeze({__proto__:null,create:create$3,clone:clone$3,fromValues:fromValues$3,copy:copy$3,set:set$3,add:add$3,subtract:subtract$1,multiply:multiply$3,divide:divide$1,ceil:ceil$1,floor:floor$1,min:min$1,max:max$1,round:round$1,scale:scale$3,scaleAndAdd:scaleAndAdd$1,distance:distance$1,squaredDistance:squaredDistance$1,length:length$3,squaredLength:squaredLength$3,negate:negate$1,inverse:inverse$1,normalize:normalize$3,dot:dot$3,cross:cross$1,lerp:lerp$3,random:random$2,transformMat4:transformMat4$1,transformQuat:transformQuat,zero:zero$1,str:str$3,exactEquals:exactEquals$3,equals:equals$3,sub:sub$1,mul:mul$3,div:div$1,dist:dist$1,sqrDist:sqrDist$1,len:len$3,sqrLen:sqrLen$3,forEach:forEach$1});function create$2(){var n=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function identity$1(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function setAxisAngle(n,r,a){a=a*.5;var i=Math.sin(a);return n[0]=i*r[0],n[1]=i*r[1],n[2]=i*r[2],n[3]=Math.cos(a),n}function getAxisAngle(n,r){var a=Math.acos(r[3])*2,i=Math.sin(a/2);return i>EPSILON?(n[0]=r[0]/i,n[1]=r[1]/i,n[2]=r[2]/i):(n[0]=1,n[1]=0,n[2]=0),a}function getAngle(n,r){var a=dot$2(n,r);return Math.acos(2*a*a-1)}function multiply$2(n,r,a){var i=r[0],o=r[1],s=r[2],l=r[3],u=a[0],c=a[1],f=a[2],h=a[3];return n[0]=i*h+l*u+o*f-s*c,n[1]=o*h+l*c+s*u-i*f,n[2]=s*h+l*f+i*c-o*u,n[3]=l*h-i*u-o*c-s*f,n}function rotateX$1(n,r,a){a*=.5;var i=r[0],o=r[1],s=r[2],l=r[3],u=Math.sin(a),c=Math.cos(a);return n[0]=i*c+l*u,n[1]=o*c+s*u,n[2]=s*c-o*u,n[3]=l*c-i*u,n}function rotateY$1(n,r,a){a*=.5;var i=r[0],o=r[1],s=r[2],l=r[3],u=Math.sin(a),c=Math.cos(a);return n[0]=i*c-s*u,n[1]=o*c+l*u,n[2]=s*c+i*u,n[3]=l*c-o*u,n}function rotateZ$1(n,r,a){a*=.5;var i=r[0],o=r[1],s=r[2],l=r[3],u=Math.sin(a),c=Math.cos(a);return n[0]=i*c+o*u,n[1]=o*c-i*u,n[2]=s*c+l*u,n[3]=l*c-s*u,n}function calculateW(n,r){var a=r[0],i=r[1],o=r[2];return n[0]=a,n[1]=i,n[2]=o,n[3]=Math.sqrt(Math.abs(1-a*a-i*i-o*o)),n}function exp(n,r){var a=r[0],i=r[1],o=r[2],s=r[3],l=Math.sqrt(a*a+i*i+o*o),u=Math.exp(s),c=l>0?u*Math.sin(l)/l:0;return n[0]=a*c,n[1]=i*c,n[2]=o*c,n[3]=u*Math.cos(l),n}function ln(n,r){var a=r[0],i=r[1],o=r[2],s=r[3],l=Math.sqrt(a*a+i*i+o*o),u=l>0?Math.atan2(l,s)/l:0;return n[0]=a*u,n[1]=i*u,n[2]=o*u,n[3]=.5*Math.log(a*a+i*i+o*o+s*s),n}function pow(n,r,a){return ln(n,r),scale$2(n,n,a),exp(n,n),n}function slerp(n,r,a,i){var o=r[0],s=r[1],l=r[2],u=r[3],c=a[0],f=a[1],h=a[2],p=a[3],d,v,_,m,y;return v=o*c+s*f+l*h+u*p,v<0&&(v=-v,c=-c,f=-f,h=-h,p=-p),1-v>EPSILON?(d=Math.acos(v),_=Math.sin(d),m=Math.sin((1-i)*d)/_,y=Math.sin(i*d)/_):(m=1-i,y=i),n[0]=m*o+y*c,n[1]=m*s+y*f,n[2]=m*l+y*h,n[3]=m*u+y*p,n}function random$1(n){var r=RANDOM(),a=RANDOM(),i=RANDOM(),o=Math.sqrt(1-r),s=Math.sqrt(r);return n[0]=o*Math.sin(2*Math.PI*a),n[1]=o*Math.cos(2*Math.PI*a),n[2]=s*Math.sin(2*Math.PI*i),n[3]=s*Math.cos(2*Math.PI*i),n}function invert$1(n,r){var a=r[0],i=r[1],o=r[2],s=r[3],l=a*a+i*i+o*o+s*s,u=l?1/l:0;return n[0]=-a*u,n[1]=-i*u,n[2]=-o*u,n[3]=s*u,n}function conjugate$1(n,r){return n[0]=-r[0],n[1]=-r[1],n[2]=-r[2],n[3]=r[3],n}function fromMat3(n,r){var a=r[0]+r[4]+r[8],i;if(a>0)i=Math.sqrt(a+1),n[3]=.5*i,i=.5/i,n[0]=(r[5]-r[7])*i,n[1]=(r[6]-r[2])*i,n[2]=(r[1]-r[3])*i;else{var o=0;r[4]>r[0]&&(o=1),r[8]>r[o*3+o]&&(o=2);var s=(o+1)%3,l=(o+2)%3;i=Math.sqrt(r[o*3+o]-r[s*3+s]-r[l*3+l]+1),n[o]=.5*i,i=.5/i,n[3]=(r[s*3+l]-r[l*3+s])*i,n[s]=(r[s*3+o]+r[o*3+s])*i,n[l]=(r[l*3+o]+r[o*3+l])*i}return n}function fromEuler(n,r,a,i){var o=.5*Math.PI/180;r*=o,a*=o,i*=o;var s=Math.sin(r),l=Math.cos(r),u=Math.sin(a),c=Math.cos(a),f=Math.sin(i),h=Math.cos(i);return n[0]=s*c*h-l*u*f,n[1]=l*u*h+s*c*f,n[2]=l*c*f-s*u*h,n[3]=l*c*h+s*u*f,n}function str$2(n){return"quat("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"}var clone$2=clone$3,fromValues$2=fromValues$3,copy$2=copy$3,set$2=set$3,add$2=add$3,mul$2=multiply$2,scale$2=scale$3,dot$2=dot$3,lerp$2=lerp$3,length$2=length$3,len$2=length$2,squaredLength$2=squaredLength$3,sqrLen$2=squaredLength$2,normalize$2=normalize$3,exactEquals$2=exactEquals$3,equals$2=equals$3,rotationTo=function(){var n=create$4(),r=fromValues$4(1,0,0),a=fromValues$4(0,1,0);return function(i,o,s){var l=dot$4(o,s);return l<-.999999?(cross$2(n,r,o),len$4(n)<1e-6&&cross$2(n,a,o),normalize$4(n,n),setAxisAngle(i,n,Math.PI),i):l>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(cross$2(n,o,s),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=1+l,normalize$2(i,i))}}(),sqlerp=function(){var n=create$2(),r=create$2();return function(a,i,o,s,l,u){return slerp(n,i,l,u),slerp(r,o,s,u),slerp(a,n,r,2*u*(1-u)),a}}(),setAxes=function(){var n=create$6();return function(r,a,i,o){return n[0]=i[0],n[3]=i[1],n[6]=i[2],n[1]=o[0],n[4]=o[1],n[7]=o[2],n[2]=-a[0],n[5]=-a[1],n[8]=-a[2],normalize$2(r,fromMat3(r,n))}}(),quat=Object.freeze({__proto__:null,create:create$2,identity:identity$1,setAxisAngle:setAxisAngle,getAxisAngle:getAxisAngle,getAngle:getAngle,multiply:multiply$2,rotateX:rotateX$1,rotateY:rotateY$1,rotateZ:rotateZ$1,calculateW:calculateW,exp:exp,ln:ln,pow:pow,slerp:slerp,random:random$1,invert:invert$1,conjugate:conjugate$1,fromMat3:fromMat3,fromEuler:fromEuler,str:str$2,clone:clone$2,fromValues:fromValues$2,copy:copy$2,set:set$2,add:add$2,mul:mul$2,scale:scale$2,dot:dot$2,lerp:lerp$2,length:length$2,len:len$2,squaredLength:squaredLength$2,sqrLen:sqrLen$2,normalize:normalize$2,exactEquals:exactEquals$2,equals:equals$2,rotationTo:rotationTo,sqlerp:sqlerp,setAxes:setAxes});function create$1(){var n=new ARRAY_TYPE(8);return ARRAY_TYPE!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[4]=0,n[5]=0,n[6]=0,n[7]=0),n[3]=1,n}function clone$1(n){var r=new ARRAY_TYPE(8);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r}function fromValues$1(n,r,a,i,o,s,l,u){var c=new ARRAY_TYPE(8);return c[0]=n,c[1]=r,c[2]=a,c[3]=i,c[4]=o,c[5]=s,c[6]=l,c[7]=u,c}function fromRotationTranslationValues(n,r,a,i,o,s,l){var u=new ARRAY_TYPE(8);u[0]=n,u[1]=r,u[2]=a,u[3]=i;var c=o*.5,f=s*.5,h=l*.5;return u[4]=c*i+f*a-h*r,u[5]=f*i+h*n-c*a,u[6]=h*i+c*r-f*n,u[7]=-c*n-f*r-h*a,u}function fromRotationTranslation(n,r,a){var i=a[0]*.5,o=a[1]*.5,s=a[2]*.5,l=r[0],u=r[1],c=r[2],f=r[3];return n[0]=l,n[1]=u,n[2]=c,n[3]=f,n[4]=i*f+o*c-s*u,n[5]=o*f+s*l-i*c,n[6]=s*f+i*u-o*l,n[7]=-i*l-o*u-s*c,n}function fromTranslation(n,r){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n[4]=r[0]*.5,n[5]=r[1]*.5,n[6]=r[2]*.5,n[7]=0,n}function fromRotation(n,r){return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=0,n[5]=0,n[6]=0,n[7]=0,n}function fromMat4(n,r){var a=create$2();getRotation(a,r);var i=new ARRAY_TYPE(3);return getTranslation$1(i,r),fromRotationTranslation(n,a,i),n}function copy$1(n,r){return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n}function identity(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n[4]=0,n[5]=0,n[6]=0,n[7]=0,n}function set$1(n,r,a,i,o,s,l,u,c){return n[0]=r,n[1]=a,n[2]=i,n[3]=o,n[4]=s,n[5]=l,n[6]=u,n[7]=c,n}var getReal=copy$2;function getDual(n,r){return n[0]=r[4],n[1]=r[5],n[2]=r[6],n[3]=r[7],n}var setReal=copy$2;function setDual(n,r){return n[4]=r[0],n[5]=r[1],n[6]=r[2],n[7]=r[3],n}function getTranslation(n,r){var a=r[4],i=r[5],o=r[6],s=r[7],l=-r[0],u=-r[1],c=-r[2],f=r[3];return n[0]=(a*f+s*l+i*c-o*u)*2,n[1]=(i*f+s*u+o*l-a*c)*2,n[2]=(o*f+s*c+a*u-i*l)*2,n}function translate(n,r,a){var i=r[0],o=r[1],s=r[2],l=r[3],u=a[0]*.5,c=a[1]*.5,f=a[2]*.5,h=r[4],p=r[5],d=r[6],v=r[7];return n[0]=i,n[1]=o,n[2]=s,n[3]=l,n[4]=l*u+o*f-s*c+h,n[5]=l*c+s*u-i*f+p,n[6]=l*f+i*c-o*u+d,n[7]=-i*u-o*c-s*f+v,n}function rotateX(n,r,a){var i=-r[0],o=-r[1],s=-r[2],l=r[3],u=r[4],c=r[5],f=r[6],h=r[7],p=u*l+h*i+c*s-f*o,d=c*l+h*o+f*i-u*s,v=f*l+h*s+u*o-c*i,_=h*l-u*i-c*o-f*s;return rotateX$1(n,r,a),i=n[0],o=n[1],s=n[2],l=n[3],n[4]=p*l+_*i+d*s-v*o,n[5]=d*l+_*o+v*i-p*s,n[6]=v*l+_*s+p*o-d*i,n[7]=_*l-p*i-d*o-v*s,n}function rotateY(n,r,a){var i=-r[0],o=-r[1],s=-r[2],l=r[3],u=r[4],c=r[5],f=r[6],h=r[7],p=u*l+h*i+c*s-f*o,d=c*l+h*o+f*i-u*s,v=f*l+h*s+u*o-c*i,_=h*l-u*i-c*o-f*s;return rotateY$1(n,r,a),i=n[0],o=n[1],s=n[2],l=n[3],n[4]=p*l+_*i+d*s-v*o,n[5]=d*l+_*o+v*i-p*s,n[6]=v*l+_*s+p*o-d*i,n[7]=_*l-p*i-d*o-v*s,n}function rotateZ(n,r,a){var i=-r[0],o=-r[1],s=-r[2],l=r[3],u=r[4],c=r[5],f=r[6],h=r[7],p=u*l+h*i+c*s-f*o,d=c*l+h*o+f*i-u*s,v=f*l+h*s+u*o-c*i,_=h*l-u*i-c*o-f*s;return rotateZ$1(n,r,a),i=n[0],o=n[1],s=n[2],l=n[3],n[4]=p*l+_*i+d*s-v*o,n[5]=d*l+_*o+v*i-p*s,n[6]=v*l+_*s+p*o-d*i,n[7]=_*l-p*i-d*o-v*s,n}function rotateByQuatAppend(n,r,a){var i=a[0],o=a[1],s=a[2],l=a[3],u=r[0],c=r[1],f=r[2],h=r[3];return n[0]=u*l+h*i+c*s-f*o,n[1]=c*l+h*o+f*i-u*s,n[2]=f*l+h*s+u*o-c*i,n[3]=h*l-u*i-c*o-f*s,u=r[4],c=r[5],f=r[6],h=r[7],n[4]=u*l+h*i+c*s-f*o,n[5]=c*l+h*o+f*i-u*s,n[6]=f*l+h*s+u*o-c*i,n[7]=h*l-u*i-c*o-f*s,n}function rotateByQuatPrepend(n,r,a){var i=r[0],o=r[1],s=r[2],l=r[3],u=a[0],c=a[1],f=a[2],h=a[3];return n[0]=i*h+l*u+o*f-s*c,n[1]=o*h+l*c+s*u-i*f,n[2]=s*h+l*f+i*c-o*u,n[3]=l*h-i*u-o*c-s*f,u=a[4],c=a[5],f=a[6],h=a[7],n[4]=i*h+l*u+o*f-s*c,n[5]=o*h+l*c+s*u-i*f,n[6]=s*h+l*f+i*c-o*u,n[7]=l*h-i*u-o*c-s*f,n}function rotateAroundAxis(n,r,a,i){if(Math.abs(i)<EPSILON)return copy$1(n,r);var o=Math.hypot(a[0],a[1],a[2]);i=i*.5;var s=Math.sin(i),l=s*a[0]/o,u=s*a[1]/o,c=s*a[2]/o,f=Math.cos(i),h=r[0],p=r[1],d=r[2],v=r[3];n[0]=h*f+v*l+p*c-d*u,n[1]=p*f+v*u+d*l-h*c,n[2]=d*f+v*c+h*u-p*l,n[3]=v*f-h*l-p*u-d*c;var _=r[4],m=r[5],y=r[6],g=r[7];return n[4]=_*f+g*l+m*c-y*u,n[5]=m*f+g*u+y*l-_*c,n[6]=y*f+g*c+_*u-m*l,n[7]=g*f-_*l-m*u-y*c,n}function add$1(n,r,a){return n[0]=r[0]+a[0],n[1]=r[1]+a[1],n[2]=r[2]+a[2],n[3]=r[3]+a[3],n[4]=r[4]+a[4],n[5]=r[5]+a[5],n[6]=r[6]+a[6],n[7]=r[7]+a[7],n}function multiply$1(n,r,a){var i=r[0],o=r[1],s=r[2],l=r[3],u=a[4],c=a[5],f=a[6],h=a[7],p=r[4],d=r[5],v=r[6],_=r[7],m=a[0],y=a[1],g=a[2],C=a[3];return n[0]=i*C+l*m+o*g-s*y,n[1]=o*C+l*y+s*m-i*g,n[2]=s*C+l*g+i*y-o*m,n[3]=l*C-i*m-o*y-s*g,n[4]=i*h+l*u+o*f-s*c+p*C+_*m+d*g-v*y,n[5]=o*h+l*c+s*u-i*f+d*C+_*y+v*m-p*g,n[6]=s*h+l*f+i*c-o*u+v*C+_*g+p*y-d*m,n[7]=l*h-i*u-o*c-s*f+_*C-p*m-d*y-v*g,n}var mul$1=multiply$1;function scale$1(n,r,a){return n[0]=r[0]*a,n[1]=r[1]*a,n[2]=r[2]*a,n[3]=r[3]*a,n[4]=r[4]*a,n[5]=r[5]*a,n[6]=r[6]*a,n[7]=r[7]*a,n}var dot$1=dot$2;function lerp$1(n,r,a,i){var o=1-i;return dot$1(r,a)<0&&(i=-i),n[0]=r[0]*o+a[0]*i,n[1]=r[1]*o+a[1]*i,n[2]=r[2]*o+a[2]*i,n[3]=r[3]*o+a[3]*i,n[4]=r[4]*o+a[4]*i,n[5]=r[5]*o+a[5]*i,n[6]=r[6]*o+a[6]*i,n[7]=r[7]*o+a[7]*i,n}function invert(n,r){var a=squaredLength$1(r);return n[0]=-r[0]/a,n[1]=-r[1]/a,n[2]=-r[2]/a,n[3]=r[3]/a,n[4]=-r[4]/a,n[5]=-r[5]/a,n[6]=-r[6]/a,n[7]=r[7]/a,n}function conjugate(n,r){return n[0]=-r[0],n[1]=-r[1],n[2]=-r[2],n[3]=r[3],n[4]=-r[4],n[5]=-r[5],n[6]=-r[6],n[7]=r[7],n}var length$1=length$2,len$1=length$1,squaredLength$1=squaredLength$2,sqrLen$1=squaredLength$1;function normalize$1(n,r){var a=squaredLength$1(r);if(a>0){a=Math.sqrt(a);var i=r[0]/a,o=r[1]/a,s=r[2]/a,l=r[3]/a,u=r[4],c=r[5],f=r[6],h=r[7],p=i*u+o*c+s*f+l*h;n[0]=i,n[1]=o,n[2]=s,n[3]=l,n[4]=(u-i*p)/a,n[5]=(c-o*p)/a,n[6]=(f-s*p)/a,n[7]=(h-l*p)/a}return n}function str$1(n){return"quat2("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+", "+n[6]+", "+n[7]+")"}function exactEquals$1(n,r){return n[0]===r[0]&&n[1]===r[1]&&n[2]===r[2]&&n[3]===r[3]&&n[4]===r[4]&&n[5]===r[5]&&n[6]===r[6]&&n[7]===r[7]}function equals$1(n,r){var a=n[0],i=n[1],o=n[2],s=n[3],l=n[4],u=n[5],c=n[6],f=n[7],h=r[0],p=r[1],d=r[2],v=r[3],_=r[4],m=r[5],y=r[6],g=r[7];return Math.abs(a-h)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(i-p)<=EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(o-d)<=EPSILON*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(s-v)<=EPSILON*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(l-_)<=EPSILON*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(u-m)<=EPSILON*Math.max(1,Math.abs(u),Math.abs(m))&&Math.abs(c-y)<=EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(f-g)<=EPSILON*Math.max(1,Math.abs(f),Math.abs(g))}var quat2=Object.freeze({__proto__:null,create:create$1,clone:clone$1,fromValues:fromValues$1,fromRotationTranslationValues:fromRotationTranslationValues,fromRotationTranslation:fromRotationTranslation,fromTranslation:fromTranslation,fromRotation:fromRotation,fromMat4:fromMat4,copy:copy$1,identity:identity,set:set$1,getReal:getReal,getDual:getDual,setReal:setReal,setDual:setDual,getTranslation:getTranslation,translate:translate,rotateX:rotateX,rotateY:rotateY,rotateZ:rotateZ,rotateByQuatAppend:rotateByQuatAppend,rotateByQuatPrepend:rotateByQuatPrepend,rotateAroundAxis:rotateAroundAxis,add:add$1,multiply:multiply$1,mul:mul$1,scale:scale$1,dot:dot$1,lerp:lerp$1,invert:invert,conjugate:conjugate,length:length$1,len:len$1,squaredLength:squaredLength$1,sqrLen:sqrLen$1,normalize:normalize$1,str:str$1,exactEquals:exactEquals$1,equals:equals$1});function create(){var n=new ARRAY_TYPE(2);return ARRAY_TYPE!=Float32Array&&(n[0]=0,n[1]=0),n}function clone(n){var r=new ARRAY_TYPE(2);return r[0]=n[0],r[1]=n[1],r}function fromValues(n,r){var a=new ARRAY_TYPE(2);return a[0]=n,a[1]=r,a}function copy(n,r){return n[0]=r[0],n[1]=r[1],n}function set(n,r,a){return n[0]=r,n[1]=a,n}function add(n,r,a){return n[0]=r[0]+a[0],n[1]=r[1]+a[1],n}function subtract(n,r,a){return n[0]=r[0]-a[0],n[1]=r[1]-a[1],n}function multiply(n,r,a){return n[0]=r[0]*a[0],n[1]=r[1]*a[1],n}function divide(n,r,a){return n[0]=r[0]/a[0],n[1]=r[1]/a[1],n}function ceil(n,r){return n[0]=Math.ceil(r[0]),n[1]=Math.ceil(r[1]),n}function floor(n,r){return n[0]=Math.floor(r[0]),n[1]=Math.floor(r[1]),n}function min(n,r,a){return n[0]=Math.min(r[0],a[0]),n[1]=Math.min(r[1],a[1]),n}function max(n,r,a){return n[0]=Math.max(r[0],a[0]),n[1]=Math.max(r[1],a[1]),n}function round(n,r){return n[0]=Math.round(r[0]),n[1]=Math.round(r[1]),n}function scale(n,r,a){return n[0]=r[0]*a,n[1]=r[1]*a,n}function scaleAndAdd(n,r,a,i){return n[0]=r[0]+a[0]*i,n[1]=r[1]+a[1]*i,n}function distance(n,r){var a=r[0]-n[0],i=r[1]-n[1];return Math.hypot(a,i)}function squaredDistance(n,r){var a=r[0]-n[0],i=r[1]-n[1];return a*a+i*i}function length(n){var r=n[0],a=n[1];return Math.hypot(r,a)}function squaredLength(n){var r=n[0],a=n[1];return r*r+a*a}function negate(n,r){return n[0]=-r[0],n[1]=-r[1],n}function inverse(n,r){return n[0]=1/r[0],n[1]=1/r[1],n}function normalize(n,r){var a=r[0],i=r[1],o=a*a+i*i;return o>0&&(o=1/Math.sqrt(o)),n[0]=r[0]*o,n[1]=r[1]*o,n}function dot(n,r){return n[0]*r[0]+n[1]*r[1]}function cross(n,r,a){var i=r[0]*a[1]-r[1]*a[0];return n[0]=n[1]=0,n[2]=i,n}function lerp(n,r,a,i){var o=r[0],s=r[1];return n[0]=o+i*(a[0]-o),n[1]=s+i*(a[1]-s),n}function random(n,r){r=r||1;var a=RANDOM()*2*Math.PI;return n[0]=Math.cos(a)*r,n[1]=Math.sin(a)*r,n}function transformMat2(n,r,a){var i=r[0],o=r[1];return n[0]=a[0]*i+a[2]*o,n[1]=a[1]*i+a[3]*o,n}function transformMat2d(n,r,a){var i=r[0],o=r[1];return n[0]=a[0]*i+a[2]*o+a[4],n[1]=a[1]*i+a[3]*o+a[5],n}function transformMat3(n,r,a){var i=r[0],o=r[1];return n[0]=a[0]*i+a[3]*o+a[6],n[1]=a[1]*i+a[4]*o+a[7],n}function transformMat4(n,r,a){var i=r[0],o=r[1];return n[0]=a[0]*i+a[4]*o+a[12],n[1]=a[1]*i+a[5]*o+a[13],n}function rotate(n,r,a,i){var o=r[0]-a[0],s=r[1]-a[1],l=Math.sin(i),u=Math.cos(i);return n[0]=o*u-s*l+a[0],n[1]=o*l+s*u+a[1],n}function angle(n,r){var a=n[0],i=n[1],o=r[0],s=r[1],l=Math.sqrt(a*a+i*i)*Math.sqrt(o*o+s*s),u=l&&(a*o+i*s)/l;return Math.acos(Math.min(Math.max(u,-1),1))}function zero(n){return n[0]=0,n[1]=0,n}function str(n){return"vec2("+n[0]+", "+n[1]+")"}function exactEquals(n,r){return n[0]===r[0]&&n[1]===r[1]}function equals(n,r){var a=n[0],i=n[1],o=r[0],s=r[1];return Math.abs(a-o)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(o))&&Math.abs(i-s)<=EPSILON*Math.max(1,Math.abs(i),Math.abs(s))}var len=length,sub=subtract,mul=multiply,div=divide,dist=distance,sqrDist=squaredDistance,sqrLen=squaredLength,forEach=function(){var n=create();return function(r,a,i,o,s,l){var u,c;for(a||(a=2),i||(i=0),o?c=Math.min(o*a+i,r.length):c=r.length,u=i;u<c;u+=a)n[0]=r[u],n[1]=r[u+1],s(n,n,l),r[u]=n[0],r[u+1]=n[1];return r}}(),vec2=Object.freeze({__proto__:null,create:create,clone:clone,fromValues:fromValues,copy:copy,set:set,add:add,subtract:subtract,multiply:multiply,divide:divide,ceil:ceil,floor:floor,min:min,max:max,round:round,scale:scale,scaleAndAdd:scaleAndAdd,distance:distance,squaredDistance:squaredDistance,length:length,squaredLength:squaredLength,negate:negate,inverse:inverse,normalize:normalize,dot:dot,cross:cross,lerp:lerp,random:random,transformMat2:transformMat2,transformMat2d:transformMat2d,transformMat3:transformMat3,transformMat4:transformMat4,rotate:rotate,angle:angle,zero:zero,str:str,exactEquals:exactEquals,equals:equals,len:len,sub:sub,mul:mul,div:div,dist:dist,sqrDist:sqrDist,sqrLen:sqrLen,forEach:forEach}),esm=Object.freeze({__proto__:null,glMatrix:common,mat2:mat2,mat2d:mat2d,mat3:mat3,mat4:mat4,quat:quat,quat2:quat2,vec2:vec2,vec3:vec3,vec4:vec4}),require$$6=getAugmentedNamespace(esm);function _instanceof$1(n,r){return r!=null&&typeof Symbol!="undefined"&&r[Symbol.hasInstance]?!!r[Symbol.hasInstance](n):n instanceof r}function _type_of$1(n){return n&&typeof Symbol!="undefined"&&n.constructor===Symbol?"symbol":typeof n}function ___$insertStyle(n){if(!!n&&typeof window!="undefined"){var r=document.createElement("style");return r.setAttribute("type","text/css"),r.innerHTML=n,document.head.appendChild(r),n}}function colorToString(n,r){var a=n.__state.conversionName.toString(),i=Math.round(n.r),o=Math.round(n.g),s=Math.round(n.b),l=n.a,u=Math.round(n.h),c=n.s.toFixed(1),f=n.v.toFixed(1);if(r||a==="THREE_CHAR_HEX"||a==="SIX_CHAR_HEX"){for(var h=n.hex.toString(16);h.length<6;)h="0"+h;return"#"+h}else{if(a==="CSS_RGB")return"rgb("+i+","+o+","+s+")";if(a==="CSS_RGBA")return"rgba("+i+","+o+","+s+","+l+")";if(a==="HEX")return"0x"+n.hex.toString(16);if(a==="RGB_ARRAY")return"["+i+","+o+","+s+"]";if(a==="RGBA_ARRAY")return"["+i+","+o+","+s+","+l+"]";if(a==="RGB_OBJ")return"{r:"+i+",g:"+o+",b:"+s+"}";if(a==="RGBA_OBJ")return"{r:"+i+",g:"+o+",b:"+s+",a:"+l+"}";if(a==="HSV_OBJ")return"{h:"+u+",s:"+c+",v:"+f+"}";if(a==="HSVA_OBJ")return"{h:"+u+",s:"+c+",v:"+f+",a:"+l+"}"}return"unknown format"}var ARR_EACH=Array.prototype.forEach,ARR_SLICE=Array.prototype.slice,Common={BREAK:{},extend:function(r){return this.each(ARR_SLICE.call(arguments,1),function(a){var i=this.isObject(a)?Object.keys(a):[];i.forEach(function(o){this.isUndefined(a[o])||(r[o]=a[o])}.bind(this))},this),r},defaults:function(r){return this.each(ARR_SLICE.call(arguments,1),function(a){var i=this.isObject(a)?Object.keys(a):[];i.forEach(function(o){this.isUndefined(r[o])&&(r[o]=a[o])}.bind(this))},this),r},compose:function(){var r=ARR_SLICE.call(arguments);return function(){for(var a=ARR_SLICE.call(arguments),i=r.length-1;i>=0;i--)a=[r[i].apply(this,a)];return a[0]}},each:function(r,a,i){if(!!r){if(ARR_EACH&&r.forEach&&r.forEach===ARR_EACH)r.forEach(a,i);else if(r.length===r.length+0){var o=void 0,s=void 0;for(o=0,s=r.length;o<s;o++)if(o in r&&a.call(i,r[o],o)===this.BREAK)return}else for(var l in r)if(a.call(i,r[l],l)===this.BREAK)return}},defer:function(r){setTimeout(r,0)},debounce:function(r,a,i){var o=void 0;return function(){var s=function(){o=null,i||r.apply(l,u)},l=this,u=arguments,c=i||!o;clearTimeout(o),o=setTimeout(s,a),c&&r.apply(l,u)}},toArray:function(r){return r.toArray?r.toArray():ARR_SLICE.call(r)},isUndefined:function(r){return r===void 0},isNull:function(r){return r===null},isNaN:function(n){var r=function(i){return n.apply(this,arguments)};return r.toString=function(){return n.toString()},r}(function(n){return isNaN(n)}),isArray:Array.isArray||function(n){return n.constructor===Array},isObject:function(r){return r===Object(r)},isNumber:function(r){return r===r+0},isString:function(r){return r===r+""},isBoolean:function(r){return r===!1||r===!0},isFunction:function(r){return _instanceof$1(r,Function)}},INTERPRETATIONS=[{litmus:Common.isString,conversions:{THREE_CHAR_HEX:{read:function(r){var a=r.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return a===null?!1:{space:"HEX",hex:parseInt("0x"+a[1].toString()+a[1].toString()+a[2].toString()+a[2].toString()+a[3].toString()+a[3].toString(),0)}},write:colorToString},SIX_CHAR_HEX:{read:function(r){var a=r.match(/^#([A-F0-9]{6})$/i);return a===null?!1:{space:"HEX",hex:parseInt("0x"+a[1].toString(),0)}},write:colorToString},CSS_RGB:{read:function(r){var a=r.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return a===null?!1:{space:"RGB",r:parseFloat(a[1]),g:parseFloat(a[2]),b:parseFloat(a[3])}},write:colorToString},CSS_RGBA:{read:function(r){var a=r.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return a===null?!1:{space:"RGB",r:parseFloat(a[1]),g:parseFloat(a[2]),b:parseFloat(a[3]),a:parseFloat(a[4])}},write:colorToString}}},{litmus:Common.isNumber,conversions:{HEX:{read:function(r){return{space:"HEX",hex:r,conversionName:"HEX"}},write:function(r){return r.hex}}}},{litmus:Common.isArray,conversions:{RGB_ARRAY:{read:function(r){return r.length!==3?!1:{space:"RGB",r:r[0],g:r[1],b:r[2]}},write:function(r){return[r.r,r.g,r.b]}},RGBA_ARRAY:{read:function(r){return r.length!==4?!1:{space:"RGB",r:r[0],g:r[1],b:r[2],a:r[3]}},write:function(r){return[r.r,r.g,r.b,r.a]}}}},{litmus:Common.isObject,conversions:{RGBA_OBJ:{read:function(r){return Common.isNumber(r.r)&&Common.isNumber(r.g)&&Common.isNumber(r.b)&&Common.isNumber(r.a)?{space:"RGB",r:r.r,g:r.g,b:r.b,a:r.a}:!1},write:function(r){return{r:r.r,g:r.g,b:r.b,a:r.a}}},RGB_OBJ:{read:function(r){return Common.isNumber(r.r)&&Common.isNumber(r.g)&&Common.isNumber(r.b)?{space:"RGB",r:r.r,g:r.g,b:r.b}:!1},write:function(r){return{r:r.r,g:r.g,b:r.b}}},HSVA_OBJ:{read:function(r){return Common.isNumber(r.h)&&Common.isNumber(r.s)&&Common.isNumber(r.v)&&Common.isNumber(r.a)?{space:"HSV",h:r.h,s:r.s,v:r.v,a:r.a}:!1},write:function(r){return{h:r.h,s:r.s,v:r.v,a:r.a}}},HSV_OBJ:{read:function(r){return Common.isNumber(r.h)&&Common.isNumber(r.s)&&Common.isNumber(r.v)?{space:"HSV",h:r.h,s:r.s,v:r.v}:!1},write:function(r){return{h:r.h,s:r.s,v:r.v}}}}}],result=void 0,toReturn=void 0,interpret=function(){toReturn=!1;var r=arguments.length>1?Common.toArray(arguments):arguments[0];return Common.each(INTERPRETATIONS,function(a){if(a.litmus(r))return Common.each(a.conversions,function(i,o){if(result=i.read(r),toReturn===!1&&result!==!1)return toReturn=result,result.conversionName=o,result.conversion=i,Common.BREAK}),Common.BREAK}),toReturn},tmpComponent=void 0,ColorMath={hsv_to_rgb:function(r,a,i){var o=Math.floor(r/60)%6,s=r/60-Math.floor(r/60),l=i*(1-a),u=i*(1-s*a),c=i*(1-(1-s)*a),f=[[i,c,l],[u,i,l],[l,i,c],[l,u,i],[c,l,i],[i,l,u]][o];return{r:f[0]*255,g:f[1]*255,b:f[2]*255}},rgb_to_hsv:function(r,a,i){var o=Math.min(r,a,i),s=Math.max(r,a,i),l=s-o,u=void 0,c=void 0;if(s!==0)c=l/s;else return{h:NaN,s:0,v:0};return r===s?u=(a-i)/l:a===s?u=2+(i-r)/l:u=4+(r-a)/l,u/=6,u<0&&(u+=1),{h:u*360,s:c,v:s/255}},rgb_to_hex:function(r,a,i){var o=this.hex_with_component(0,2,r);return o=this.hex_with_component(o,1,a),o=this.hex_with_component(o,0,i),o},component_from_hex:function(r,a){return r>>a*8&255},hex_with_component:function(r,a,i){return i<<(tmpComponent=a*8)|r&~(255<<tmpComponent)}},_typeof=typeof Symbol=="function"&&_type_of$1(Symbol.iterator)==="symbol"?function(r){return typeof r=="undefined"?"undefined":_type_of$1(r)}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n=="undefined"?"undefined":_type_of$1(n)},classCallCheck=function(r,a){if(!_instanceof$1(r,a))throw new TypeError("Cannot call a class as a function")},createClass=function(){var n=function(a,i){for(var o=0;o<i.length;o++){var s=i[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(a,s.key,s)}};return function(r,a,i){return a&&n(r.prototype,a),i&&n(r,i),r}}(),get=function n(r,a,i){r===null&&(r=Function.prototype);var o=Object.getOwnPropertyDescriptor(r,a);if(o===void 0){var s=Object.getPrototypeOf(r);return s===null?void 0:n(s,a,i)}else{if("value"in o)return o.value;var l=o.get;return l===void 0?void 0:l.call(i)}},inherits=function(r,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function, not "+(typeof a=="undefined"?"undefined":_type_of$1(a)));r.prototype=Object.create(a&&a.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(r,a):r.__proto__=a)},possibleConstructorReturn=function(r,a){if(!r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a&&(typeof a=="object"||typeof a=="function")?a:r},Color=function(){function n(){if(classCallCheck(this,n),this.__state=interpret.apply(this,arguments),this.__state===!1)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return createClass(n,[{key:"toString",value:function(){return colorToString(this)}},{key:"toHexString",value:function(){return colorToString(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),n}();function defineRGBComponent(n,r,a){Object.defineProperty(n,r,{get:function(){return this.__state.space==="RGB"?this.__state[r]:(Color.recalculateRGB(this,r,a),this.__state[r])},set:function(o){this.__state.space!=="RGB"&&(Color.recalculateRGB(this,r,a),this.__state.space="RGB"),this.__state[r]=o}})}function defineHSVComponent(n,r){Object.defineProperty(n,r,{get:function(){return this.__state.space==="HSV"?this.__state[r]:(Color.recalculateHSV(this),this.__state[r])},set:function(i){this.__state.space!=="HSV"&&(Color.recalculateHSV(this),this.__state.space="HSV"),this.__state[r]=i}})}Color.recalculateRGB=function(n,r,a){if(n.__state.space==="HEX")n.__state[r]=ColorMath.component_from_hex(n.__state.hex,a);else if(n.__state.space==="HSV")Common.extend(n.__state,ColorMath.hsv_to_rgb(n.__state.h,n.__state.s,n.__state.v));else throw new Error("Corrupted color state")},Color.recalculateHSV=function(n){var r=ColorMath.rgb_to_hsv(n.r,n.g,n.b);Common.extend(n.__state,{s:r.s,v:r.v}),Common.isNaN(r.h)?Common.isUndefined(n.__state.h)&&(n.__state.h=0):n.__state.h=r.h},Color.COMPONENTS=["r","g","b","h","s","v","hex","a"],defineRGBComponent(Color.prototype,"r",2),defineRGBComponent(Color.prototype,"g",1),defineRGBComponent(Color.prototype,"b",0),defineHSVComponent(Color.prototype,"h"),defineHSVComponent(Color.prototype,"s"),defineHSVComponent(Color.prototype,"v"),Object.defineProperty(Color.prototype,"a",{get:function(){return this.__state.a},set:function(r){this.__state.a=r}}),Object.defineProperty(Color.prototype,"hex",{get:function(){return this.__state.space!=="HEX"&&(this.__state.hex=ColorMath.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(r){this.__state.space="HEX",this.__state.hex=r}});var Controller=function(){function n(r,a){classCallCheck(this,n),this.initialValue=r[a],this.domElement=document.createElement("div"),this.object=r,this.property=a,this.__onChange=void 0,this.__onFinishChange=void 0}return createClass(n,[{key:"onChange",value:function(a){return this.__onChange=a,this}},{key:"onFinishChange",value:function(a){return this.__onFinishChange=a,this}},{key:"setValue",value:function(a){return this.object[this.property]=a,this.__onChange&&this.__onChange.call(this,a),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),n}(),EVENT_MAP={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},EVENT_MAP_INV={};Common.each(EVENT_MAP,function(n,r){Common.each(n,function(a){EVENT_MAP_INV[a]=r})});var CSS_VALUE_PIXELS=/(\d+(\.\d+)?)px/;function cssValueToPixels(n){if(n==="0"||Common.isUndefined(n))return 0;var r=n.match(CSS_VALUE_PIXELS);return Common.isNull(r)?0:parseFloat(r[1])}var dom={makeSelectable:function(r,a){r===void 0||r.style===void 0||(r.onselectstart=a?function(){return!1}:function(){},r.style.MozUserSelect=a?"auto":"none",r.style.KhtmlUserSelect=a?"auto":"none",r.unselectable=a?"on":"off")},makeFullscreen:function(r,a,i){var o=i,s=a;Common.isUndefined(s)&&(s=!0),Common.isUndefined(o)&&(o=!0),r.style.position="absolute",s&&(r.style.left=0,r.style.right=0),o&&(r.style.top=0,r.style.bottom=0)},fakeEvent:function(r,a,i,o){var s=i||{},l=EVENT_MAP_INV[a];if(!l)throw new Error("Event type "+a+" not supported.");var u=document.createEvent(l);switch(l){case"MouseEvents":{var c=s.x||s.clientX||0,f=s.y||s.clientY||0;u.initMouseEvent(a,s.bubbles||!1,s.cancelable||!0,window,s.clickCount||1,0,0,c,f,!1,!1,!1,!1,0,null);break}case"KeyboardEvents":{var h=u.initKeyboardEvent||u.initKeyEvent;Common.defaults(s,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),h(a,s.bubbles||!1,s.cancelable,window,s.ctrlKey,s.altKey,s.shiftKey,s.metaKey,s.keyCode,s.charCode);break}default:{u.initEvent(a,s.bubbles||!1,s.cancelable||!0);break}}Common.defaults(u,o),r.dispatchEvent(u)},bind:function(r,a,i,o){var s=o||!1;return r.addEventListener?r.addEventListener(a,i,s):r.attachEvent&&r.attachEvent("on"+a,i),dom},unbind:function(r,a,i,o){var s=o||!1;return r.removeEventListener?r.removeEventListener(a,i,s):r.detachEvent&&r.detachEvent("on"+a,i),dom},addClass:function(r,a){if(r.className===void 0)r.className=a;else if(r.className!==a){var i=r.className.split(/ +/);i.indexOf(a)===-1&&(i.push(a),r.className=i.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return dom},removeClass:function(r,a){if(a)if(r.className===a)r.removeAttribute("class");else{var i=r.className.split(/ +/),o=i.indexOf(a);o!==-1&&(i.splice(o,1),r.className=i.join(" "))}else r.className=void 0;return dom},hasClass:function(r,a){return new RegExp("(?:^|\\s+)"+a+"(?:\\s+|$)").test(r.className)||!1},getWidth:function(r){var a=getComputedStyle(r);return cssValueToPixels(a["border-left-width"])+cssValueToPixels(a["border-right-width"])+cssValueToPixels(a["padding-left"])+cssValueToPixels(a["padding-right"])+cssValueToPixels(a.width)},getHeight:function(r){var a=getComputedStyle(r);return cssValueToPixels(a["border-top-width"])+cssValueToPixels(a["border-bottom-width"])+cssValueToPixels(a["padding-top"])+cssValueToPixels(a["padding-bottom"])+cssValueToPixels(a.height)},getOffset:function(r){var a=r,i={left:0,top:0};if(a.offsetParent)do i.left+=a.offsetLeft,i.top+=a.offsetTop,a=a.offsetParent;while(a);return i},isActive:function(r){return r===document.activeElement&&(r.type||r.href)}},BooleanController=function(n){inherits(r,n);function r(a,i){classCallCheck(this,r);var o=possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,a,i)),s=o;o.__prev=o.getValue(),o.__checkbox=document.createElement("input"),o.__checkbox.setAttribute("type","checkbox");function l(){s.setValue(!s.__prev)}return dom.bind(o.__checkbox,"change",l,!1),o.domElement.appendChild(o.__checkbox),o.updateDisplay(),o}return createClass(r,[{key:"setValue",value:function(i){var o=get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"setValue",this).call(this,i);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),o}},{key:"updateDisplay",value:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"updateDisplay",this).call(this)}}]),r}(Controller),OptionController=function(n){inherits(r,n);function r(a,i,o){classCallCheck(this,r);var s=possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,a,i)),l=o,u=s;if(s.__select=document.createElement("select"),Common.isArray(l)){var c={};Common.each(l,function(f){c[f]=f}),l=c}return Common.each(l,function(f,h){var p=document.createElement("option");p.innerHTML=h,p.setAttribute("value",f),u.__select.appendChild(p)}),s.updateDisplay(),dom.bind(s.__select,"change",function(){var f=this.options[this.selectedIndex].value;u.setValue(f)}),s.domElement.appendChild(s.__select),s}return createClass(r,[{key:"setValue",value:function(i){var o=get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"setValue",this).call(this,i);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),o}},{key:"updateDisplay",value:function(){return dom.isActive(this.__select)?this:(this.__select.value=this.getValue(),get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"updateDisplay",this).call(this))}}]),r}(Controller),StringController=function(n){inherits(r,n);function r(a,i){classCallCheck(this,r);var o=possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,a,i)),s=o;function l(){s.setValue(s.__input.value)}function u(){s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),dom.bind(o.__input,"keyup",l),dom.bind(o.__input,"change",l),dom.bind(o.__input,"blur",u),dom.bind(o.__input,"keydown",function(c){c.keyCode===13&&this.blur()}),o.updateDisplay(),o.domElement.appendChild(o.__input),o}return createClass(r,[{key:"updateDisplay",value:function(){return dom.isActive(this.__input)||(this.__input.value=this.getValue()),get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"updateDisplay",this).call(this)}}]),r}(Controller);function numDecimals(n){var r=n.toString();return r.indexOf(".")>-1?r.length-r.indexOf(".")-1:0}var NumberController=function(n){inherits(r,n);function r(a,i,o){classCallCheck(this,r);var s=possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,a,i)),l=o||{};return s.__min=l.min,s.__max=l.max,s.__step=l.step,Common.isUndefined(s.__step)?s.initialValue===0?s.__impliedStep=1:s.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(s.initialValue))/Math.LN10))/10:s.__impliedStep=s.__step,s.__precision=numDecimals(s.__impliedStep),s}return createClass(r,[{key:"setValue",value:function(i){var o=i;return this.__min!==void 0&&o<this.__min?o=this.__min:this.__max!==void 0&&o>this.__max&&(o=this.__max),this.__step!==void 0&&o%this.__step!==0&&(o=Math.round(o/this.__step)*this.__step),get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"setValue",this).call(this,o)}},{key:"min",value:function(i){return this.__min=i,this}},{key:"max",value:function(i){return this.__max=i,this}},{key:"step",value:function(i){return this.__step=i,this.__impliedStep=i,this.__precision=numDecimals(i),this}}]),r}(Controller);function roundToDecimal(n,r){var a=Math.pow(10,r);return Math.round(n*a)/a}var NumberControllerBox=function(n){inherits(r,n);function r(a,i,o){classCallCheck(this,r);var s=possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,a,i,o));s.__truncationSuspended=!1;var l=s,u=void 0;function c(){var _=parseFloat(l.__input.value);Common.isNaN(_)||l.setValue(_)}function f(){l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}function h(){f()}function p(_){var m=u-_.clientY;l.setValue(l.getValue()+m*l.__impliedStep),u=_.clientY}function d(){dom.unbind(window,"mousemove",p),dom.unbind(window,"mouseup",d),f()}function v(_){dom.bind(window,"mousemove",p),dom.bind(window,"mouseup",d),u=_.clientY}return s.__input=document.createElement("input"),s.__input.setAttribute("type","text"),dom.bind(s.__input,"change",c),dom.bind(s.__input,"blur",h),dom.bind(s.__input,"mousedown",v),dom.bind(s.__input,"keydown",function(_){_.keyCode===13&&(l.__truncationSuspended=!0,this.blur(),l.__truncationSuspended=!1,f())}),s.updateDisplay(),s.domElement.appendChild(s.__input),s}return createClass(r,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():roundToDecimal(this.getValue(),this.__precision),get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"updateDisplay",this).call(this)}}]),r}(NumberController);function map(n,r,a,i,o){return i+(o-i)*((n-r)/(a-r))}var NumberControllerSlider=function(n){inherits(r,n);function r(a,i,o,s,l){classCallCheck(this,r);var u=possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,a,i,{min:o,max:s,step:l})),c=u;u.__background=document.createElement("div"),u.__foreground=document.createElement("div"),dom.bind(u.__background,"mousedown",f),dom.bind(u.__background,"touchstart",d),dom.addClass(u.__background,"slider"),dom.addClass(u.__foreground,"slider-fg");function f(m){document.activeElement.blur(),dom.bind(window,"mousemove",h),dom.bind(window,"mouseup",p),h(m)}function h(m){m.preventDefault();var y=c.__background.getBoundingClientRect();return c.setValue(map(m.clientX,y.left,y.right,c.__min,c.__max)),!1}function p(){dom.unbind(window,"mousemove",h),dom.unbind(window,"mouseup",p),c.__onFinishChange&&c.__onFinishChange.call(c,c.getValue())}function d(m){m.touches.length===1&&(dom.bind(window,"touchmove",v),dom.bind(window,"touchend",_),v(m))}function v(m){var y=m.touches[0].clientX,g=c.__background.getBoundingClientRect();c.setValue(map(y,g.left,g.right,c.__min,c.__max))}function _(){dom.unbind(window,"touchmove",v),dom.unbind(window,"touchend",_),c.__onFinishChange&&c.__onFinishChange.call(c,c.getValue())}return u.updateDisplay(),u.__background.appendChild(u.__foreground),u.domElement.appendChild(u.__background),u}return createClass(r,[{key:"updateDisplay",value:function(){var i=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=i*100+"%",get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"updateDisplay",this).call(this)}}]),r}(NumberController),FunctionController=function(n){inherits(r,n);function r(a,i,o){classCallCheck(this,r);var s=possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,a,i)),l=s;return s.__button=document.createElement("div"),s.__button.innerHTML=o===void 0?"Fire":o,dom.bind(s.__button,"click",function(u){return u.preventDefault(),l.fire(),!1}),dom.addClass(s.__button,"button"),s.domElement.appendChild(s.__button),s}return createClass(r,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),r}(Controller),ColorController=function(n){inherits(r,n);function r(a,i){classCallCheck(this,r);var o=possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,a,i));o.__color=new Color(o.getValue()),o.__temp=new Color(0);var s=o;o.domElement=document.createElement("div"),dom.makeSelectable(o.domElement,!1),o.__selector=document.createElement("div"),o.__selector.className="selector",o.__saturation_field=document.createElement("div"),o.__saturation_field.className="saturation-field",o.__field_knob=document.createElement("div"),o.__field_knob.className="field-knob",o.__field_knob_border="2px solid ",o.__hue_knob=document.createElement("div"),o.__hue_knob.className="hue-knob",o.__hue_field=document.createElement("div"),o.__hue_field.className="hue-field",o.__input=document.createElement("input"),o.__input.type="text",o.__input_textShadow="0 1px 1px ",dom.bind(o.__input,"keydown",function(m){m.keyCode===13&&p.call(this)}),dom.bind(o.__input,"blur",p),dom.bind(o.__selector,"mousedown",function(){dom.addClass(this,"drag").bind(window,"mouseup",function(){dom.removeClass(s.__selector,"drag")})}),dom.bind(o.__selector,"touchstart",function(){dom.addClass(this,"drag").bind(window,"touchend",function(){dom.removeClass(s.__selector,"drag")})});var l=document.createElement("div");Common.extend(o.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),Common.extend(o.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:o.__field_knob_border+(o.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),Common.extend(o.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),Common.extend(o.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),Common.extend(l.style,{width:"100%",height:"100%",background:"none"}),linearGradient(l,"top","rgba(0,0,0,0)","#000"),Common.extend(o.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),hueGradient(o.__hue_field),Common.extend(o.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:o.__input_textShadow+"rgba(0,0,0,0.7)"}),dom.bind(o.__saturation_field,"mousedown",u),dom.bind(o.__saturation_field,"touchstart",u),dom.bind(o.__field_knob,"mousedown",u),dom.bind(o.__field_knob,"touchstart",u),dom.bind(o.__hue_field,"mousedown",c),dom.bind(o.__hue_field,"touchstart",c);function u(m){v(m),dom.bind(window,"mousemove",v),dom.bind(window,"touchmove",v),dom.bind(window,"mouseup",f),dom.bind(window,"touchend",f)}function c(m){_(m),dom.bind(window,"mousemove",_),dom.bind(window,"touchmove",_),dom.bind(window,"mouseup",h),dom.bind(window,"touchend",h)}function f(){dom.unbind(window,"mousemove",v),dom.unbind(window,"touchmove",v),dom.unbind(window,"mouseup",f),dom.unbind(window,"touchend",f),d()}function h(){dom.unbind(window,"mousemove",_),dom.unbind(window,"touchmove",_),dom.unbind(window,"mouseup",h),dom.unbind(window,"touchend",h),d()}function p(){var m=interpret(this.value);m!==!1?(s.__color.__state=m,s.setValue(s.__color.toOriginal())):this.value=s.__color.toString()}function d(){s.__onFinishChange&&s.__onFinishChange.call(s,s.__color.toOriginal())}o.__saturation_field.appendChild(l),o.__selector.appendChild(o.__field_knob),o.__selector.appendChild(o.__saturation_field),o.__selector.appendChild(o.__hue_field),o.__hue_field.appendChild(o.__hue_knob),o.domElement.appendChild(o.__input),o.domElement.appendChild(o.__selector),o.updateDisplay();function v(m){m.type.indexOf("touch")===-1&&m.preventDefault();var y=s.__saturation_field.getBoundingClientRect(),g=m.touches&&m.touches[0]||m,C=g.clientX,b=g.clientY,k=(C-y.left)/(y.right-y.left),L=1-(b-y.top)/(y.bottom-y.top);return L>1?L=1:L<0&&(L=0),k>1?k=1:k<0&&(k=0),s.__color.v=L,s.__color.s=k,s.setValue(s.__color.toOriginal()),!1}function _(m){m.type.indexOf("touch")===-1&&m.preventDefault();var y=s.__hue_field.getBoundingClientRect(),g=m.touches&&m.touches[0]||m,C=g.clientY,b=1-(C-y.top)/(y.bottom-y.top);return b>1?b=1:b<0&&(b=0),s.__color.h=b*360,s.setValue(s.__color.toOriginal()),!1}return o}return createClass(r,[{key:"updateDisplay",value:function(){var i=interpret(this.getValue());if(i!==!1){var o=!1;Common.each(Color.COMPONENTS,function(u){if(!Common.isUndefined(i[u])&&!Common.isUndefined(this.__color.__state[u])&&i[u]!==this.__color.__state[u])return o=!0,{}},this),o&&Common.extend(this.__color.__state,i)}Common.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var s=this.__color.v<.5||this.__color.s>.5?255:0,l=255-s;Common.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+s+","+s+","+s+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,linearGradient(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),Common.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+s+","+s+","+s+")",textShadow:this.__input_textShadow+"rgba("+l+","+l+","+l+",.7)"})}}]),r}(Controller),vendors=["-moz-","-o-","-webkit-","-ms-",""];function linearGradient(n,r,a,i){n.style.background="",Common.each(vendors,function(o){n.style.cssText+="background: "+o+"linear-gradient("+r+", "+a+" 0%, "+i+" 100%); "})}function hueGradient(n){n.style.background="",n.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",n.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",n.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var css={load:function(r,a){var i=a||document,o=i.createElement("link");o.type="text/css",o.rel="stylesheet",o.href=r,i.getElementsByTagName("head")[0].appendChild(o)},inject:function(r,a){var i=a||document,o=document.createElement("style");o.type="text/css",o.innerHTML=r;var s=i.getElementsByTagName("head")[0];try{s.appendChild(o)}catch(l){}}},saveDialogContents='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>',ControllerFactory=function(r,a){var i=r[a];return Common.isArray(arguments[2])||Common.isObject(arguments[2])?new OptionController(r,a,arguments[2]):Common.isNumber(i)?Common.isNumber(arguments[2])&&Common.isNumber(arguments[3])?Common.isNumber(arguments[4])?new NumberControllerSlider(r,a,arguments[2],arguments[3],arguments[4]):new NumberControllerSlider(r,a,arguments[2],arguments[3]):Common.isNumber(arguments[4])?new NumberControllerBox(r,a,{min:arguments[2],max:arguments[3],step:arguments[4]}):new NumberControllerBox(r,a,{min:arguments[2],max:arguments[3]}):Common.isString(i)?new StringController(r,a):Common.isFunction(i)?new FunctionController(r,a,""):Common.isBoolean(i)?new BooleanController(r,a):null};function requestAnimationFrame$1(n){setTimeout(n,1e3/60)}var requestAnimationFrame$1$1=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||requestAnimationFrame$1,CenteredDiv=function(){function n(){classCallCheck(this,n),this.backgroundElement=document.createElement("div"),Common.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),dom.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),Common.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var r=this;dom.bind(this.backgroundElement,"click",function(){r.hide()})}return createClass(n,[{key:"show",value:function(){var a=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),Common.defer(function(){a.backgroundElement.style.opacity=1,a.domElement.style.opacity=1,a.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var a=this,i=function o(){a.domElement.style.display="none",a.backgroundElement.style.display="none",dom.unbind(a.domElement,"webkitTransitionEnd",o),dom.unbind(a.domElement,"transitionend",o),dom.unbind(a.domElement,"oTransitionEnd",o)};dom.bind(this.domElement,"webkitTransitionEnd",i),dom.bind(this.domElement,"transitionend",i),dom.bind(this.domElement,"oTransitionEnd",i),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-dom.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-dom.getHeight(this.domElement)/2+"px"}}]),n}(),styleSheet=___$insertStyle(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n");css.inject(styleSheet);var CSS_NAMESPACE="dg",HIDE_KEY_CODE=72,CLOSE_BUTTON_HEIGHT=20,DEFAULT_DEFAULT_PRESET_NAME="Default",SUPPORTS_LOCAL_STORAGE=function(){try{return!!window.localStorage}catch(n){return!1}}(),SAVE_DIALOGUE=void 0,autoPlaceVirgin=!0,autoPlaceContainer=void 0,hide=!1,hideableGuis=[],GUI=function n(r){var a=function(){var d=i.getRoot();d.width+=1,Common.defer(function(){d.width-=1})},i=this,o=r||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),dom.addClass(this.domElement,CSS_NAMESPACE),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],o=Common.defaults(o,{closeOnTop:!1,autoPlace:!0,width:n.DEFAULT_WIDTH}),o=Common.defaults(o,{resizable:o.autoPlace,hideable:o.autoPlace}),Common.isUndefined(o.load)?o.load={preset:DEFAULT_DEFAULT_PRESET_NAME}:o.preset&&(o.load.preset=o.preset),Common.isUndefined(o.parent)&&o.hideable&&hideableGuis.push(this),o.resizable=Common.isUndefined(o.parent)&&o.resizable,o.autoPlace&&Common.isUndefined(o.scrollable)&&(o.scrollable=!0);var s=SUPPORTS_LOCAL_STORAGE&&localStorage.getItem(getLocalStorageHash(this,"isLocal"))==="true",l=void 0,u=void 0;if(Object.defineProperties(this,{parent:{get:function(){return o.parent}},scrollable:{get:function(){return o.scrollable}},autoPlace:{get:function(){return o.autoPlace}},closeOnTop:{get:function(){return o.closeOnTop}},preset:{get:function(){return i.parent?i.getRoot().preset:o.load.preset},set:function(d){i.parent?i.getRoot().preset=d:o.load.preset=d,setPresetSelectIndex(this),i.revert()}},width:{get:function(){return o.width},set:function(d){o.width=d,setWidth(i,d)}},name:{get:function(){return o.name},set:function(d){o.name=d,u&&(u.innerHTML=o.name)}},closed:{get:function(){return o.closed},set:function(d){o.closed=d,o.closed?dom.addClass(i.__ul,n.CLASS_CLOSED):dom.removeClass(i.__ul,n.CLASS_CLOSED),this.onResize(),i.__closeButton&&(i.__closeButton.innerHTML=d?n.TEXT_OPEN:n.TEXT_CLOSED)}},load:{get:function(){return o.load}},useLocalStorage:{get:function(){return s},set:function(d){SUPPORTS_LOCAL_STORAGE&&(s=d,d?dom.bind(window,"unload",l):dom.unbind(window,"unload",l),localStorage.setItem(getLocalStorageHash(i,"isLocal"),d))}}}),Common.isUndefined(o.parent)){if(this.closed=o.closed||!1,dom.addClass(this.domElement,n.CLASS_MAIN),dom.makeSelectable(this.domElement,!1),SUPPORTS_LOCAL_STORAGE&&s){i.useLocalStorage=!0;var c=localStorage.getItem(getLocalStorageHash(this,"gui"));c&&(o.load=JSON.parse(c))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=n.TEXT_CLOSED,dom.addClass(this.__closeButton,n.CLASS_CLOSE_BUTTON),o.closeOnTop?(dom.addClass(this.__closeButton,n.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(dom.addClass(this.__closeButton,n.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),dom.bind(this.__closeButton,"click",function(){i.closed=!i.closed})}else{o.closed===void 0&&(o.closed=!0);var f=document.createTextNode(o.name);dom.addClass(f,"controller-name"),u=addRow(i,f);var h=function(d){return d.preventDefault(),i.closed=!i.closed,!1};dom.addClass(this.__ul,n.CLASS_CLOSED),dom.addClass(u,"title"),dom.bind(u,"click",h),o.closed||(this.closed=!1)}o.autoPlace&&(Common.isUndefined(o.parent)&&(autoPlaceVirgin&&(autoPlaceContainer=document.createElement("div"),dom.addClass(autoPlaceContainer,CSS_NAMESPACE),dom.addClass(autoPlaceContainer,n.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(autoPlaceContainer),autoPlaceVirgin=!1),autoPlaceContainer.appendChild(this.domElement),dom.addClass(this.domElement,n.CLASS_AUTO_PLACE)),this.parent||setWidth(i,o.width)),this.__resizeHandler=function(){i.onResizeDebounced()},dom.bind(window,"resize",this.__resizeHandler),dom.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),dom.bind(this.__ul,"transitionend",this.__resizeHandler),dom.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),o.resizable&&addResizeHandle(this),l=function(){SUPPORTS_LOCAL_STORAGE&&localStorage.getItem(getLocalStorageHash(i,"isLocal"))==="true"&&localStorage.setItem(getLocalStorageHash(i,"gui"),JSON.stringify(i.getSaveObject()))},this.saveToLocalStorageIfPossible=l,o.parent||a()};GUI.toggleHide=function(){hide=!hide,Common.each(hideableGuis,function(n){n.domElement.style.display=hide?"none":""})},GUI.CLASS_AUTO_PLACE="a",GUI.CLASS_AUTO_PLACE_CONTAINER="ac",GUI.CLASS_MAIN="main",GUI.CLASS_CONTROLLER_ROW="cr",GUI.CLASS_TOO_TALL="taller-than-window",GUI.CLASS_CLOSED="closed",GUI.CLASS_CLOSE_BUTTON="close-button",GUI.CLASS_CLOSE_TOP="close-top",GUI.CLASS_CLOSE_BOTTOM="close-bottom",GUI.CLASS_DRAG="drag",GUI.DEFAULT_WIDTH=245,GUI.TEXT_CLOSED="Close Controls",GUI.TEXT_OPEN="Open Controls",GUI._keydownHandler=function(n){document.activeElement.type!=="text"&&(n.which===HIDE_KEY_CODE||n.keyCode===HIDE_KEY_CODE)&&GUI.toggleHide()},dom.bind(window,"keydown",GUI._keydownHandler,!1),Common.extend(GUI.prototype,{add:function(r,a){return _add(this,r,a,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(r,a){return _add(this,r,a,{color:!0})},remove:function(r){this.__ul.removeChild(r.__li),this.__controllers.splice(this.__controllers.indexOf(r),1);var a=this;Common.defer(function(){a.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&autoPlaceContainer.removeChild(this.domElement);var r=this;Common.each(this.__folders,function(a){r.removeFolder(a)}),dom.unbind(window,"keydown",GUI._keydownHandler,!1),removeListeners(this)},addFolder:function(r){if(this.__folders[r]!==void 0)throw new Error('You already have a folder in this GUI by the name "'+r+'"');var a={name:r,parent:this};a.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[r]&&(a.closed=this.load.folders[r].closed,a.load=this.load.folders[r]);var i=new GUI(a);this.__folders[r]=i;var o=addRow(this,i.domElement);return dom.addClass(o,"folder"),i},removeFolder:function(r){this.__ul.removeChild(r.domElement.parentElement),delete this.__folders[r.name],this.load&&this.load.folders&&this.load.folders[r.name]&&delete this.load.folders[r.name],removeListeners(r);var a=this;Common.each(r.__folders,function(i){r.removeFolder(i)}),Common.defer(function(){a.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var r=this.getRoot();if(r.scrollable){var a=dom.getOffset(r.__ul).top,i=0;Common.each(r.__ul.childNodes,function(o){r.autoPlace&&o===r.__save_row||(i+=dom.getHeight(o))}),window.innerHeight-a-CLOSE_BUTTON_HEIGHT<i?(dom.addClass(r.domElement,GUI.CLASS_TOO_TALL),r.__ul.style.height=window.innerHeight-a-CLOSE_BUTTON_HEIGHT+"px"):(dom.removeClass(r.domElement,GUI.CLASS_TOO_TALL),r.__ul.style.height="auto")}r.__resize_handle&&Common.defer(function(){r.__resize_handle.style.height=r.__ul.offsetHeight+"px"}),r.__closeButton&&(r.__closeButton.style.width=r.width+"px")},onResizeDebounced:Common.debounce(function(){this.onResize()},50),remember:function(){if(Common.isUndefined(SAVE_DIALOGUE)&&(SAVE_DIALOGUE=new CenteredDiv,SAVE_DIALOGUE.domElement.innerHTML=saveDialogContents),this.parent)throw new Error("You can only call remember on a top level GUI.");var r=this;Common.each(Array.prototype.slice.call(arguments),function(a){r.__rememberedObjects.length===0&&addSaveMenu(r),r.__rememberedObjects.indexOf(a)===-1&&r.__rememberedObjects.push(a)}),this.autoPlace&&setWidth(this,this.width)},getRoot:function(){for(var r=this;r.parent;)r=r.parent;return r},getSaveObject:function(){var r=this.load;return r.closed=this.closed,this.__rememberedObjects.length>0&&(r.preset=this.preset,r.remembered||(r.remembered={}),r.remembered[this.preset]=getCurrentPreset(this)),r.folders={},Common.each(this.__folders,function(a,i){r.folders[i]=a.getSaveObject()}),r},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=getCurrentPreset(this),markPresetModified(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(r){this.load.remembered||(this.load.remembered={},this.load.remembered[DEFAULT_DEFAULT_PRESET_NAME]=getCurrentPreset(this,!0)),this.load.remembered[r]=getCurrentPreset(this),this.preset=r,addPresetOption(this,r,!0),this.saveToLocalStorageIfPossible()},revert:function(r){Common.each(this.__controllers,function(a){this.getRoot().load.remembered?recallSavedValue(r||this.getRoot(),a):a.setValue(a.initialValue),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())},this),Common.each(this.__folders,function(a){a.revert(a)}),r||markPresetModified(this.getRoot(),!1)},listen:function(r){var a=this.__listening.length===0;this.__listening.push(r),a&&updateDisplays(this.__listening)},updateDisplay:function(){Common.each(this.__controllers,function(r){r.updateDisplay()}),Common.each(this.__folders,function(r){r.updateDisplay()})}});function addRow(n,r,a){var i=document.createElement("li");return r&&i.appendChild(r),a?n.__ul.insertBefore(i,a):n.__ul.appendChild(i),n.onResize(),i}function removeListeners(n){dom.unbind(window,"resize",n.__resizeHandler),n.saveToLocalStorageIfPossible&&dom.unbind(window,"unload",n.saveToLocalStorageIfPossible)}function markPresetModified(n,r){var a=n.__preset_select[n.__preset_select.selectedIndex];r?a.innerHTML=a.value+"*":a.innerHTML=a.value}function augmentController(n,r,a){if(a.__li=r,a.__gui=n,Common.extend(a,{options:function(l){if(arguments.length>1){var u=a.__li.nextElementSibling;return a.remove(),_add(n,a.object,a.property,{before:u,factoryArgs:[Common.toArray(arguments)]})}if(Common.isArray(l)||Common.isObject(l)){var c=a.__li.nextElementSibling;return a.remove(),_add(n,a.object,a.property,{before:c,factoryArgs:[l]})}},name:function(l){return a.__li.firstElementChild.firstElementChild.innerHTML=l,a},listen:function(){return a.__gui.listen(a),a},remove:function(){return a.__gui.remove(a),a}}),_instanceof$1(a,NumberControllerSlider)){var i=new NumberControllerBox(a.object,a.property,{min:a.__min,max:a.__max,step:a.__step});Common.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(s){var l=a[s],u=i[s];a[s]=i[s]=function(){var c=Array.prototype.slice.call(arguments);return u.apply(i,c),l.apply(a,c)}}),dom.addClass(r,"has-slider"),a.domElement.insertBefore(i.domElement,a.domElement.firstElementChild)}else if(_instanceof$1(a,NumberControllerBox)){var o=function(l){if(Common.isNumber(a.__min)&&Common.isNumber(a.__max)){var u=a.__li.firstElementChild.firstElementChild.innerHTML,c=a.__gui.__listening.indexOf(a)>-1;a.remove();var f=_add(n,a.object,a.property,{before:a.__li.nextElementSibling,factoryArgs:[a.__min,a.__max,a.__step]});return f.name(u),c&&f.listen(),f}return l};a.min=Common.compose(o,a.min),a.max=Common.compose(o,a.max)}else _instanceof$1(a,BooleanController)?(dom.bind(r,"click",function(){dom.fakeEvent(a.__checkbox,"click")}),dom.bind(a.__checkbox,"click",function(s){s.stopPropagation()})):_instanceof$1(a,FunctionController)?(dom.bind(r,"click",function(){dom.fakeEvent(a.__button,"click")}),dom.bind(r,"mouseover",function(){dom.addClass(a.__button,"hover")}),dom.bind(r,"mouseout",function(){dom.removeClass(a.__button,"hover")})):_instanceof$1(a,ColorController)&&(dom.addClass(r,"color"),a.updateDisplay=Common.compose(function(s){return r.style.borderLeftColor=a.__color.toString(),s},a.updateDisplay),a.updateDisplay());a.setValue=Common.compose(function(s){return n.getRoot().__preset_select&&a.isModified()&&markPresetModified(n.getRoot(),!0),s},a.setValue)}function recallSavedValue(n,r){var a=n.getRoot(),i=a.__rememberedObjects.indexOf(r.object);if(i!==-1){var o=a.__rememberedObjectIndecesToControllers[i];if(o===void 0&&(o={},a.__rememberedObjectIndecesToControllers[i]=o),o[r.property]=r,a.load&&a.load.remembered){var s=a.load.remembered,l=void 0;if(s[n.preset])l=s[n.preset];else if(s[DEFAULT_DEFAULT_PRESET_NAME])l=s[DEFAULT_DEFAULT_PRESET_NAME];else return;if(l[i]&&l[i][r.property]!==void 0){var u=l[i][r.property];r.initialValue=u,r.setValue(u)}}}}function _add(n,r,a,i){if(r[a]===void 0)throw new Error('Object "'+r+'" has no property "'+a+'"');var o=void 0;if(i.color)o=new ColorController(r,a);else{var s=[r,a].concat(i.factoryArgs);o=ControllerFactory.apply(n,s)}_instanceof$1(i.before,Controller)&&(i.before=i.before.__li),recallSavedValue(n,o),dom.addClass(o.domElement,"c");var l=document.createElement("span");dom.addClass(l,"property-name"),l.innerHTML=o.property;var u=document.createElement("div");u.appendChild(l),u.appendChild(o.domElement);var c=addRow(n,u,i.before);return dom.addClass(c,GUI.CLASS_CONTROLLER_ROW),_instanceof$1(o,ColorController)?dom.addClass(c,"color"):dom.addClass(c,_typeof(o.getValue())),augmentController(n,c,o),n.__controllers.push(o),o}function getLocalStorageHash(n,r){return document.location.href+"."+r}function addPresetOption(n,r,a){var i=document.createElement("option");i.innerHTML=r,i.value=r,n.__preset_select.appendChild(i),a&&(n.__preset_select.selectedIndex=n.__preset_select.length-1)}function showHideExplain(n,r){r.style.display=n.useLocalStorage?"block":"none"}function addSaveMenu(n){var r=n.__save_row=document.createElement("li");dom.addClass(n.domElement,"has-save"),n.__ul.insertBefore(r,n.__ul.firstChild),dom.addClass(r,"save-row");var a=document.createElement("span");a.innerHTML="&nbsp;",dom.addClass(a,"button gears");var i=document.createElement("span");i.innerHTML="Save",dom.addClass(i,"button"),dom.addClass(i,"save");var o=document.createElement("span");o.innerHTML="New",dom.addClass(o,"button"),dom.addClass(o,"save-as");var s=document.createElement("span");s.innerHTML="Revert",dom.addClass(s,"button"),dom.addClass(s,"revert");var l=n.__preset_select=document.createElement("select");if(n.load&&n.load.remembered?Common.each(n.load.remembered,function(p,d){addPresetOption(n,d,d===n.preset)}):addPresetOption(n,DEFAULT_DEFAULT_PRESET_NAME,!1),dom.bind(l,"change",function(){for(var p=0;p<n.__preset_select.length;p++)n.__preset_select[p].innerHTML=n.__preset_select[p].value;n.preset=this.value}),r.appendChild(l),r.appendChild(a),r.appendChild(i),r.appendChild(o),r.appendChild(s),SUPPORTS_LOCAL_STORAGE){var u=document.getElementById("dg-local-explain"),c=document.getElementById("dg-local-storage"),f=document.getElementById("dg-save-locally");f.style.display="block",localStorage.getItem(getLocalStorageHash(n,"isLocal"))==="true"&&c.setAttribute("checked","checked"),showHideExplain(n,u),dom.bind(c,"change",function(){n.useLocalStorage=!n.useLocalStorage,showHideExplain(n,u)})}var h=document.getElementById("dg-new-constructor");dom.bind(h,"keydown",function(p){p.metaKey&&(p.which===67||p.keyCode===67)&&SAVE_DIALOGUE.hide()}),dom.bind(a,"click",function(){h.innerHTML=JSON.stringify(n.getSaveObject(),void 0,2),SAVE_DIALOGUE.show(),h.focus(),h.select()}),dom.bind(i,"click",function(){n.save()}),dom.bind(o,"click",function(){var p=prompt("Enter a new preset name.");p&&n.saveAs(p)}),dom.bind(s,"click",function(){n.revert()})}function addResizeHandle(n){var r=function(l){return l.preventDefault(),n.width+=i-l.clientX,n.onResize(),i=l.clientX,!1},a=function(l){return l.preventDefault(),i=l.clientX,dom.addClass(n.__closeButton,GUI.CLASS_DRAG),dom.bind(window,"mousemove",r),dom.bind(window,"mouseup",o),!1},i=void 0;n.__resize_handle=document.createElement("div"),Common.extend(n.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});function o(){dom.removeClass(n.__closeButton,GUI.CLASS_DRAG),dom.unbind(window,"mousemove",r),dom.unbind(window,"mouseup",o)}dom.bind(n.__resize_handle,"mousedown",a),dom.bind(n.__closeButton,"mousedown",a),n.domElement.insertBefore(n.__resize_handle,n.domElement.firstElementChild)}function setWidth(n,r){n.domElement.style.width=r+"px",n.__save_row&&n.autoPlace&&(n.__save_row.style.width=r+"px"),n.__closeButton&&(n.__closeButton.style.width=r+"px")}function getCurrentPreset(n,r){var a={};return Common.each(n.__rememberedObjects,function(i,o){var s={},l=n.__rememberedObjectIndecesToControllers[o];Common.each(l,function(u,c){s[c]=r?u.initialValue:u.getValue()}),a[o]=s}),a}function setPresetSelectIndex(n){for(var r=0;r<n.__preset_select.length;r++)n.__preset_select[r].value===n.preset&&(n.__preset_select.selectedIndex=r)}function updateDisplays(n){n.length!==0&&requestAnimationFrame$1$1.call(window,function(){updateDisplays(n)}),Common.each(n,function(r){r.updateDisplay()})}var color={Color:Color,math:ColorMath,interpret:interpret},controllers={Controller:Controller,BooleanController:BooleanController,OptionController:OptionController,StringController:StringController,NumberController:NumberController,NumberControllerBox:NumberControllerBox,NumberControllerSlider:NumberControllerSlider,FunctionController:FunctionController,ColorController:ColorController},dom$1={dom:dom},gui={GUI:GUI},GUI$1=GUI,index={color:color,controllers:controllers,dom:dom$1,gui:gui,GUI:GUI$1},dat_gui_module=Object.freeze({__proto__:null,color:color,controllers:controllers,dom:dom$1,gui:gui,GUI:GUI$1,default:index}),require$$7=getAugmentedNamespace(dat_gui_module);function _array_like_to_array(n,r){(r==null||r>n.length)&&(r=n.length);for(var a=0,i=new Array(r);a<r;a++)i[a]=n[a];return i}function _array_with_holes(n){if(Array.isArray(n))return n}function _array_without_holes(n){if(Array.isArray(n))return _array_like_to_array(n)}function _assert_this_initialized(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function _class_call_check(n,r){if(!(n instanceof r))throw new TypeError("Cannot call a class as a function")}function _construct(n,r,a){return _is_native_reflect_construct()?_construct=Reflect.construct:_construct=function(i,o,s){var l=[null];l.push.apply(l,o);var u=Function.bind.apply(i,l),c=new u;return s&&_set_prototype_of(c,s.prototype),c},_construct.apply(null,arguments)}function _defineProperties(n,r){for(var a=0;a<r.length;a++){var i=r[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}function _create_class(n,r,a){return r&&_defineProperties(n.prototype,r),a&&_defineProperties(n,a),n}function _define_property(n,r,a){return r in n?Object.defineProperty(n,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[r]=a,n}function _get(n,r,a){return typeof Reflect!="undefined"&&Reflect.get?_get=Reflect.get:_get=function(i,o,s){var l=_super_prop_base(i,o);if(l){var u=Object.getOwnPropertyDescriptor(l,o);return u.get?u.get.call(s||i):u.value}},_get(n,r,a||n)}function _get_prototype_of(n){return _get_prototype_of=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},_get_prototype_of(n)}function _inherits(n,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(r&&r.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),r&&_set_prototype_of(n,r)}function _instanceof(n,r){return r!=null&&typeof Symbol!="undefined"&&r[Symbol.hasInstance]?!!r[Symbol.hasInstance](n):n instanceof r}function _is_native_function(n){return Function.toString.call(n).indexOf("[native code]")!==-1}function _iterable_to_array(n){if(typeof Symbol!="undefined"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function _iterable_to_array_limit(n,r){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var i=[],o=!0,s=!1,l,u;try{for(a=a.call(n);!(o=(l=a.next()).done)&&(i.push(l.value),!(r&&i.length===r));o=!0);}catch(c){s=!0,u=c}finally{try{!o&&a.return!=null&&a.return()}finally{if(s)throw u}}return i}}function _non_iterable_rest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _non_iterable_spread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _possible_constructor_return(n,r){return r&&(_type_of(r)==="object"||typeof r=="function")?r:_assert_this_initialized(n)}function _set_prototype_of(n,r){return _set_prototype_of=Object.setPrototypeOf||function(a,i){return a.__proto__=i,a},_set_prototype_of(n,r)}function _sliced_to_array(n,r){return _array_with_holes(n)||_iterable_to_array_limit(n,r)||_unsupported_iterable_to_array(n,r)||_non_iterable_rest()}function _super_prop_base(n,r){for(;!Object.prototype.hasOwnProperty.call(n,r)&&(n=_get_prototype_of(n),n!==null););return n}function _to_consumable_array(n){return _array_without_holes(n)||_iterable_to_array(n)||_unsupported_iterable_to_array(n)||_non_iterable_spread()}function _type_of(n){return n&&typeof Symbol!="undefined"&&n.constructor===Symbol?"symbol":typeof n}function _unsupported_iterable_to_array(n,r){if(n){if(typeof n=="string")return _array_like_to_array(n,r);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(a);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return _array_like_to_array(n,r)}}function _wrap_native_super(n){var r=typeof Map=="function"?new Map:void 0;return _wrap_native_super=function(a){if(a===null||!_is_native_function(a))return a;if(typeof a!="function")throw new TypeError("Super expression must either be null or a function");if(typeof r!="undefined"){if(r.has(a))return r.get(a);r.set(a,i)}function i(){return _construct(a,arguments,_get_prototype_of(this).constructor)}return i.prototype=Object.create(a.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),_set_prototype_of(i,a)},_wrap_native_super(n)}function _is_native_reflect_construct(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function _create_super(n){var r=_is_native_reflect_construct();return function(){var a=_get_prototype_of(n),i;if(r){var o=_get_prototype_of(this).constructor;i=Reflect.construct(a,arguments,o)}else i=a.apply(this,arguments);return _possible_constructor_return(this,i)}}function _ts_generator(n,r){var a,i,o,s,l={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(f){return function(h){return c([f,h])}}function c(f){if(a)throw new TypeError("Generator is already executing.");for(;l;)try{if(a=1,i&&(o=f[0]&2?i.return:f[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,f[1])).done)return o;switch(i=0,o&&(f=[f[0]&2,o.value]),f[0]){case 0:case 1:o=f;break;case 4:return l.label++,{value:f[1],done:!1};case 5:l.label++,i=f[1],f=[0];continue;case 7:f=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(f[0]===6||f[0]===2)){l=0;continue}if(f[0]===3&&(!o||f[1]>o[0]&&f[1]<o[3])){l.label=f[1];break}if(f[0]===6&&l.label<o[1]){l.label=o[1],o=f;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(f);break}o[2]&&l.ops.pop(),l.trys.pop();continue}f=r.call(n,l)}catch(h){f=[6,h],i=0}finally{a=o=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}(function(module,exports){(function(n,r){r(exports,requireUaParser(),requireChito(),requireBezier(),requireSrc(),requireEarcut(),requireRegl(),require$$6,require$$7)})(commonjsGlobal,function(exports,uaParserJs,chito,bezierJs,BezierEasing,earcut,REGL,glMatrix,dat){var _interopDefaultLegacy=function(n){return n&&typeof n=="object"&&"default"in n?n:{default:n}},_interopNamespace=function(n){if(n&&n.i)return n;var r=Object.create(null);return n&&Object.keys(n).forEach(function(a){if(a!=="default"){var i=Object.getOwnPropertyDescriptor(n,a);Object.defineProperty(r,a,i.get?i:{enumerable:!0,get:function(){return n[a]}})}}),r.default=n,Object.freeze(r)},getAugmentedNamespace=function(n){var r=n.default;if(typeof r=="function"){var a=function(){return r.apply(this,arguments)};a.prototype=r.prototype}else a={};return Object.defineProperty(a,"i",{value:!0}),Object.keys(n).forEach(function(i){var o=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(a,i,o.get?o:{enumerable:!0,get:function(){return n[i]}})}),a},defaultCompare=function(n,r){return n<r?-1:n>r?1:0},polylabel=function(n,r,a){r=r||1;for(var i,o,s,l,u=0;u<n[0].length;u++){var c=n[0][u];(!u||c[0]<i)&&(i=c[0]),(!u||c[1]<o)&&(o=c[1]),(!u||c[0]>s)&&(s=c[0]),(!u||c[1]>l)&&(l=c[1])}var f=s-i,h=l-o,p=Math.min(f,h),d=p/2;if(p===0){var v=[i,o];return v.distance=0,v}for(var _=new Queue(void 0,compareMax),m=i;m<s;m+=p)for(var y=o;y<l;y+=p)_.push(new Cell(m+d,y+d,d,n));var g=getCentroidCell(n),C=new Cell(i+f/2,o+h/2,0,n);C.d>g.d&&(g=C);for(var b=_.length;_.length;){var k=_.pop();k.d>g.d&&(g=k,a&&console.log("found best %d after %d probes",Math.round(1e4*k.d)/1e4,b)),!(k.max-g.d<=r)&&(d=k.Eb/2,_.push(new Cell(k.x-d,k.y-d,d,n)),_.push(new Cell(k.x+d,k.y-d,d,n)),_.push(new Cell(k.x-d,k.y+d,d,n)),_.push(new Cell(k.x+d,k.y+d,d,n)),b+=4)}a&&(console.log("num probes: "+b),console.log("best distance: "+g.d));var L=[g.x,g.y];return L.distance=g.d,L},compareMax=function(n,r){return r.max-n.max},Cell=function(n,r,a,i){this.x=n,this.y=r,this.Eb=a,this.d=pointToPolygonDist(n,r,i),this.max=this.d+this.Eb*Math.SQRT2},pointToPolygonDist=function(n,r,a){for(var i=!1,o=1/0,s=0;s<a.length;s++)for(var l=a[s],u=0,c=l.length,f=c-1;u<c;f=u++){var h=l[u],p=l[f];h[1]>r!=p[1]>r&&n<(p[0]-h[0])*(r-h[1])/(p[1]-h[1])+h[0]&&(i=!i),o=Math.min(o,getSegDistSq(n,r,h,p))}return o===0?0:(i?1:-1)*Math.sqrt(o)},getCentroidCell=function(n){for(var r=0,a=0,i=0,o=n[0],s=0,l=o.length,u=l-1;s<l;u=s++){var c=o[s],f=o[u],h=c[0]*f[1]-f[0]*c[1];a+=(c[0]+f[0])*h,i+=(c[1]+f[1])*h,r+=h*3}return r===0?new Cell(o[0][0],o[0][1],0,n):new Cell(a/r,i/r,0,n)},getSegDistSq=function(n,r,a,i){var o=a[0],s=a[1],l=i[0]-o,u=i[1]-s;if(l!==0||u!==0){var c=((n-o)*l+(r-s)*u)/(l*l+u*u);c>1?(o=i[0],s=i[1]):c>0&&(o+=l*c,s+=u*c)}return l=n-o,u=r-s,l*l+u*u},encode=function(n,r){keys$1={},keysArr=[],keysNum=0,dim$1=0,e$1=1,analyze(n),e$1=Math.min(e$1,maxPrecision);for(var a=Math.ceil(Math.log(e$1)/Math.LN10),i=0;i<keysArr.length;i++)r.nP(1,keysArr[i]);return dim$1!==2&&r.tP(2,dim$1),a!==6&&r.tP(3,a),n.type==="FeatureCollection"?r.Az(4,writeFeatureCollection,n):n.type==="Feature"?r.Az(5,writeFeature,n):r.Az(6,writeGeometry,n),keys$1=null,r.finish()},analyzeMultiLine=function(n){for(var r=0;r<n.length;r++)analyzePoints(n[r])},analyzePoints=function(n){for(var r=0;r<n.length;r++)analyzePoint(n[r])},analyzePoint=function(n){dim$1=Math.max(dim$1,n.length);for(var r=0;r<n.length;r++)for(;Math.round(n[r]*e$1)/e$1!==n[r]&&e$1<maxPrecision;)e$1*=10},saveKey=function(n){keys$1[n]===void 0&&(keysArr.push(n),keys$1[n]=keysNum++)},writeFeatureCollection=function(n,r){for(var a=0;a<n.features.length;a++)r.Az(1,writeFeature,n.features[a]);writeProps(n,r,!0)},writeFeature=function(n,r){n.geometry!==null&&r.Az(1,writeGeometry,n.geometry),n.id!==void 0&&(typeof n.id=="number"&&n.id%1===0?r.iP(12,n.id):r.nP(11,n.id)),n.properties&&writeProps(n.properties,r),writeProps(n,r,!0)},writeProps=function(n,r,a){var i=[],o=0;for(var s in n)a&&isSpecialKey(s,n.type)||(r.Az(13,writeValue,n[s]),i.push(keys$1[s]),i.push(o++));r.Wz(a?15:14,i)},writeValue=function(n,r){if(n!==null){var a=typeof n=="undefined"?"undefined":_type_of(n);a==="string"?r.nP(1,n):a==="boolean"?r.oP(5,n):a==="object"?r.nP(6,JSON.stringify(n)):a==="number"&&(n%1!==0?r.rP(2,n):n>=0?r.tP(3,n):r.tP(4,-n))}},writePoint=function(n,r){for(var a=[],i=0;i<dim$1;i++)a.push(Math.round(n[i]*e$1));r.Nz(3,a)},writeLine=function(n,r){var a=[];populateLine(a,n),r.Nz(3,a)},writeMultiLine=function(n,r,a){var i=n.length,o;if(i!==1){var s=[];for(o=0;o<i;o++)s.push(n[o].length-(a?1:0));r.Wz(2,s)}var l=[];for(o=0;o<i;o++)populateLine(l,n[o],a);r.Nz(3,l)},writeMultiPolygon=function(n,r){var a=n.length,i,o;if(a!==1||n[0].length!==1){var s=[a];for(i=0;i<a;i++)for(s.push(n[i].length),o=0;o<n[i].length;o++)s.push(n[i][o].length-1);r.Wz(2,s)}var l=[];for(i=0;i<a;i++)for(o=0;o<n[i].length;o++)populateLine(l,n[i][o],!0);r.Nz(3,l)},populateLine=function(n,r,a){var i,o,s=r.length-(a?1:0),l=new Array(dim$1);for(o=0;o<dim$1;o++)l[o]=0;for(i=0;i<s;i++)for(o=0;o<dim$1;o++){var u=Math.round(r[i][o]*e$1)-l[o];n.push(u),l[o]+=u}},isSpecialKey=function(n,r){if(n==="type")return!0;if(r==="FeatureCollection"){if(n==="features")return!0}else if(r==="Feature"){if(n==="id"||n==="properties"||n==="geometry")return!0}else if(r==="GeometryCollection"){if(n==="geometries")return!0}else if(n==="coordinates")return!0;return!1},decode=function(n){dim=2,e=Math.pow(10,6),lengths=null,keys=[],values=[];var r=n.ez(readDataField,{});return keys=null,r},readDataField=function(n,r,a){n===1?keys.push(a.JC()):n===2?dim=a.YC():n===3?e=Math.pow(10,a.YC()):n===4?readFeatureCollection(a,r):n===5?readFeature(a,r):n===6&&readGeometry(a,r)},readFeatureCollection=function(n,r){return r.type="FeatureCollection",r.features=[],n.$C(readFeatureCollectionField,r)},readFeature=function(n,r){r.type="Feature";var a=n.$C(readFeatureField,r);return"geometry"in a||(a.geometry=null),a},readGeometry=function(n,r){return r.type="Point",n.$C(readGeometryField,r)},readFeatureCollectionField=function(n,r,a){n===1?r.features.push(readFeature(a,{})):n===13?values.push(readValue(a)):n===15&&readProps(a,r)},readFeatureField=function(n,r,a){n===1?r.geometry=readGeometry(a,{}):n===11?r.id=a.JC():n===12?r.id=a.ZC():n===13?values.push(readValue(a)):n===14?r.properties=readProps(a,{}):n===15&&readProps(a,r)},readGeometryField=function(n,r,a){n===1?r.type=geometryTypes[a.YC()]:n===2?lengths=a.KC():n===3?readCoords(r,a,r.type):n===4?(r.tz=r.tz||[],r.tz.push(readGeometry(a,{}))):n===13?values.push(readValue(a)):n===15&&readProps(a,r)},readCoords=function(n,r,a){a==="Point"?n.coordinates=readPoint(r):a==="MultiPoint"||a==="LineString"?n.coordinates=readLine(r):a==="MultiLineString"?n.coordinates=readMultiLine(r):a==="Polygon"?n.coordinates=readMultiLine(r,!0):a==="MultiPolygon"&&(n.coordinates=readMultiPolygon(r))},readValue=function(n){for(var r=n.YC()+n.Br,a=null;n.Br<r;){var i=n.YC(),o=i>>3;o===1?a=n.JC():o===2?a=n.iz():o===3?a=n.YC():o===4?a=-n.YC():o===5?a=n.nz():o===6&&(a=JSON.parse(n.JC()))}return a},readProps=function(n,r){for(var a=n.YC()+n.Br;n.Br<a;)r[keys[n.YC()]]=values[n.YC()];return values=[],r},readPoint=function(n){for(var r=n.YC()+n.Br,a=[];n.Br<r;)a.push(n.ZC()/e);return a},readLinePart=function(n,r,a,i){var o=0,s=[],l,u,c=[];for(u=0;u<dim;u++)c[u]=0;for(;a?o<a:n.Br<r;){for(l=[],u=0;u<dim;u++)c[u]+=n.ZC(),l[u]=c[u]/e;s.push(l),o++}return i&&s.push(s[0]),s},readLine=function(n){return readLinePart(n,n.YC()+n.Br)},readMultiLine=function(n,r){var a=n.YC()+n.Br;if(!lengths)return[readLinePart(n,a,null,r)];for(var i=[],o=0;o<lengths.length;o++)i.push(readLinePart(n,a,lengths[o],r));return lengths=null,i},readMultiPolygon=function(n){var r=n.YC()+n.Br;if(!lengths)return[[readLinePart(n,r,null,!0)]];for(var a=[],i=1,o=0;o<lengths[0];o++){for(var s=[],l=0;l<lengths[i];l++)s.push(readLinePart(n,r,lengths[i+1+l],!0));i+=lengths[i]+1,a.push(s)}return lengths=null,a},Pbf=function(n){this.rz=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.Br=0,this.type=0,this.length=this.rz.length},readVarintRemainder=function(n,r,a){var i=a.rz,o,s;if(s=i[a.Br++],o=(s&112)>>4,s<128||(s=i[a.Br++],o|=(s&127)<<3,s<128)||(s=i[a.Br++],o|=(s&127)<<10,s<128)||(s=i[a.Br++],o|=(s&127)<<17,s<128)||(s=i[a.Br++],o|=(s&127)<<24,s<128)||(s=i[a.Br++],o|=(s&1)<<31,s<128))return toNum(n,o,r);throw new Error("Expected varint not more than 10 bytes")},readPackedEnd=function(n){return n.type===Pbf.az?n.YC()+n.Br:n.Br+1},toNum=function(n,r,a){return a?r*4294967296+(n>>>0):(r>>>0)*4294967296+(n>>>0)},writeBigVarint=function(n,r){var a,i;if(n>=0?(a=n%4294967296|0,i=n/4294967296|0):(a=~(-n%4294967296),i=~(-n/4294967296),a^4294967295?a=a+1|0:(a=0,i=i+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.hz(10),writeBigVarintLow(a,i,r),writeBigVarintHigh(i,r)},writeBigVarintLow=function(n,r,a){a.rz[a.Br++]=n&127|128,n>>>=7,a.rz[a.Br++]=n&127|128,n>>>=7,a.rz[a.Br++]=n&127|128,n>>>=7,a.rz[a.Br++]=n&127|128,n>>>=7,a.rz[a.Br]=n&127},writeBigVarintHigh=function(n,r){var a=(n&7)<<4;r.rz[r.Br++]|=a|((n>>>=3)?128:0),n&&(r.rz[r.Br++]=n&127|((n>>>=7)?128:0),n&&(r.rz[r.Br++]=n&127|((n>>>=7)?128:0),n&&(r.rz[r.Br++]=n&127|((n>>>=7)?128:0),n&&(r.rz[r.Br++]=n&127|((n>>>=7)?128:0),n&&(r.rz[r.Br++]=n&127)))))},makeRoomForExtraLength=function(n,r,a){var i=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(Math.LN2*7));a.hz(i);for(var o=a.Br-1;o>=n;o--)a.rz[o+i]=a.rz[o]},writePackedVarint=function(n,r){for(var a=0;a<n.length;a++)r.lz(n[a])},writePackedSVarint=function(n,r){for(var a=0;a<n.length;a++)r.fz(n[a])},writePackedFloat=function(n,r){for(var a=0;a<n.length;a++)r.cz(n[a])},writePackedDouble=function(n,r){for(var a=0;a<n.length;a++)r.vz(n[a])},writePackedBoolean=function(n,r){for(var a=0;a<n.length;a++)r.dz(n[a])},writePackedFixed32=function(n,r){for(var a=0;a<n.length;a++)r.pz(n[a])},writePackedSFixed32=function(n,r){for(var a=0;a<n.length;a++)r.mz(n[a])},writePackedFixed64=function(n,r){for(var a=0;a<n.length;a++)r.gz(n[a])},writePackedSFixed64=function(n,r){for(var a=0;a<n.length;a++)r.bz(n[a])},readUInt32=function(n,r){return(n[r]|n[r+1]<<8|n[r+2]<<16)+n[r+3]*16777216},writeInt32=function(n,r,a){n[a]=r,n[a+1]=r>>>8,n[a+2]=r>>>16,n[a+3]=r>>>24},readInt32=function(n,r){return(n[r]|n[r+1]<<8|n[r+2]<<16)+(n[r+3]<<24)},readUtf8=function(n,r,a){for(var i="",o=r;o<a;){var s=n[o],l=null,u=s>239?4:s>223?3:s>191?2:1;if(o+u>a)break;var c,f,h;u===1?s<128&&(l=s):u===2?(c=n[o+1],(c&192)===128&&(l=(s&31)<<6|c&63,l<=127&&(l=null))):u===3?(c=n[o+1],f=n[o+2],(c&192)===128&&(f&192)===128&&(l=(s&15)<<12|(c&63)<<6|f&63,(l<=2047||l>=55296&&l<=57343)&&(l=null))):u===4&&(c=n[o+1],f=n[o+2],h=n[o+3],(c&192)===128&&(f&192)===128&&(h&192)===128&&(l=(s&15)<<18|(c&63)<<12|(f&63)<<6|h&63,(l<=65535||l>=1114112)&&(l=null))),l===null?(l=65533,u=1):l>65535&&(l-=65536,i+=String.fromCharCode(l>>>10&1023|55296),l=56320|l&1023),i+=String.fromCharCode(l),o+=u}return i},readUtf8TextDecoder=function(n,r,a){return utf8TextDecoder.decode(n.subarray(r,a))},writeUtf8=function(n,r,a){for(var i=0,o,s;i<r.length;i++){if(o=r.charCodeAt(i),o>55295&&o<57344)if(s)if(o<56320){n[a++]=239,n[a++]=191,n[a++]=189,s=o;continue}else o=s-55296<<10|o-56320|65536,s=null;else{o>56319||i+1===r.length?(n[a++]=239,n[a++]=191,n[a++]=189):s=o;continue}else s&&(n[a++]=239,n[a++]=191,n[a++]=189,s=null);o<128?n[a++]=o:(o<2048?n[a++]=o>>6|192:(o<65536?n[a++]=o>>12|224:(n[a++]=o>>18|240,n[a++]=o>>12&63|128),n[a++]=o>>6&63|128),n[a++]=o&63|128)}return a},feature=function(n,r,a){a===void 0&&(a={});var i={type:"Feature"};return(a.id===0||a.id)&&(i.id=a.id),a.bbox&&(i.bbox=a.bbox),i.properties=r||{},i.geometry=n,i},point$1=function(n,r,a){if(a===void 0&&(a={}),!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!isNumber$1(n[0])||!isNumber$1(n[1]))throw new Error("coordinates must contain numbers");var i={type:"Point",coordinates:n};return feature(i,r,a)},multiPoint=function(n,r,a){a===void 0&&(a={});var i={type:"MultiPoint",coordinates:n};return feature(i,r,a)},isNumber$1=function(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)},getMaximumPolygon=function(n){var r=0,a,i=!0,o=!1,s=void 0;try{for(var l=n[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var c=u.value,f=GeometryUtil.s$(c);f>r&&(r=f,a=c)}}catch(h){o=!0,s=h}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return a},nestParse=function nestParse(nestString){function string2function(x){return x&&(Array.isArray(x)?x.map(function(n){return string2function(n)}):typeof x=="object"?Object.keys(x).reduce(function(n,r){return n[r]=string2function(x[r]),n},{}):typeof x=="string"&&(x.startsWith("(")||x.startsWith("function"))?eval(x):x)}return string2function(JSON.parse(nestString))},nestStringify=function n(r){function a(i){return i&&(Array.isArray(i)?i.map(function(o){return a(o)}):typeof i=="object"?Object.keys(i).reduce(function(o,s){return o[s]=a(i[s]),o},{}):typeof i=="function"?i.toString():i)}return JSON.stringify(a(r))},getABC=function n(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:2,a=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:.5,l=bezierJs.Bezier.getUtils(),u=l.projectionratio(s,r),c=1-u,f={x:u*a.x+c*o.x,y:u*a.y+c*o.y,z:u*a.z+c*o.z},h=l.abcratio(s,r),p={x:i.x+(i.x-f.x)/h,y:i.y+(i.y-f.y)/h,z:i.y+(i.z-f.z)/h};return{rs:p,ps:i,Ju:f,bs:a,E:o}},cubicBezier=function n(r,a,i,o,s){typeof o=="undefined"&&(o=.5);var l;o===0&&(l=new bezierJs.Bezier(a,a,i)),o===1&&(l=new bezierJs.Bezier(r,a,a));var u=getABC(2,r,a,i,o);l=new bezierJs.Bezier(r,u.rs,i);var c=100;s&&(s<=3?c=4:c=Math.floor(s)+1);var f=l.getLUT(c);return f},Linear$1=function n(r,a,i){var o=(a-r)*i+r;return o},LinearSplit=function n(r,a){for(var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=[],s=0;s<=i-1;s++){var l=r.x,u=r.y,c=r.z,f=a.x,h=a.y,p=a.z,d=s/(i-1),v={x:+Linear$1(l,f,d),y:+Linear$1(u,h,d),z:+Linear$1(c,p,d),t:d};o.push(v)}return o},Linear=function n(r,a,i){return(a-r)*i+r},linearGradient=function n(r){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Linear,o=r.length-1,s=o*a,l=s>>0,u=i,c=function(d,v,_){var m=_sliced_to_array(d,4),y=m[0],g=m[1],C=m[2],b=m[3],k=_sliced_to_array(v,4),L=k[0],F=k[1],W=k[2],j=k[3],Y=[u(y,L,_),u(g,F,_),u(C,W,_),u(b,j,_)];return Y},f=r[l],h=r[l+1>o?o:l+1],p=s-l;return c(f,h,p)},isLngLat=function n(r){return r&&r.className==="AMap.LngLat"},isNumber=function n(r){var a=+r;return typeof+a=="number"&&!isNaN(a)},isNumberArray=function n(r){return Array.isArray(r)&&isNumber(r[0])},generatePathFromCircle=function n(r,a){var i=[],o=parseLngLatData(r),s=ProjectionManager.Y$("EPSG:3857");if(o)for(var l=s.project(o.K$,o.Z$),u=l[0],c=l[1],f=60,h=360/f*Math.PI/180,p=Math.cos(o.Z$*Math.PI/180),d=0,v=f;d<=v;d++){var _=d*h,m=a*Math.cos(_)/p,y=a*Math.sin(_)/p,g=s.unproject(u+m,c+y);i.push(g)}return i},transToPolygonData=function n(r,a){return r.map(function(i,o){var s,l,u=(l=(s=a[o])==null?void 0:s.attributes)==null?void 0:l.radius,c=[];return i.features.points.forEach(function(f,h){if(f.type==="MultiPoint"){var p=[],d=[];f.coordinates.forEach(function(v){d.push(v),p.push([generatePathFromCircle(v,u[h])])}),c.push(__spreadProps$a(__spreadValues$f({},f),{center:d,radius:u[h],coordinates:p}))}else c.push(__spreadProps$a(__spreadValues$f({},f),{center:f.coordinates,radius:u[h],coordinates:[generatePathFromCircle(f.coordinates,u[h])]}))}),i.features.points=c,i})},transToPolygonStyle=function n(r){return __spreadProps$a(__spreadValues$f({},r),{topColor:r.color})},svgToBlobUrl=function n(r){var a=r.outerHTML,i=new Blob([a],{type:"image/svg+xml;charset=utf-8"}),o=window.URL||window.webkitURL||window,s=o.createObjectURL(i);return s},concatImages=function n(r,a){var i=r.images,o=r.wx,s=o===void 0?[64,64]:o,l=s[0],u=s[1],c=i.reduce(function(g){return g+l},0),f=document.createElement("canvas");f.width=c,f.height=u;for(var h=f.getContext("2d"),p=0,d=0,v=[],_=0;_<i.length;_++){var m=i[_];h.drawImage(m,p,d,l,u);var y={width:l,height:u,xx:m,x:p,y:d};p+=l,v.push(y)}f.toBlob(function(g){var C=document.createElement("img"),b=URL.createObjectURL(g);C.onload=function(){URL.revokeObjectURL(b),a({blob:g,xx:C,canvas:f,Mx:v})},C.src=b})},concatSprites=function n(r,a,i){var o=r.images,s=r.wx,l=s===void 0?[64,64]:s;if(!Array.isArray(o))throw new Error("must be called with an array of iconSrcs to concatenate");var u=o.map(function(f){try{if(_instanceof(f,SVGSVGElement)){var h=svgToBlobUrl(f),p=new Image;return p.crossOrigin="anonymous",p.src=h,p}else{if(_instanceof(f,Image))return f.crossOrigin="anonymous",f;var d=new Image;return d.crossOrigin="anonymous",d.src=f,d}}catch(v){throw v}}).filter(function(f){return f&&_instanceof(f,Image)}),c=u.map(function(f){return new Promise(function(h,p){try{f.onerror=function(d){h(d)},f.onload=function(){h(f)},f.complete&&h(f)}catch(d){p(d)}})});return Promise.all(c).then(function(f){return f.filter(function(h){return _instanceof(h,Image)})}).then(function(f){f.length?concatImages({images:f,wx:l},function(h){a(h)}):a()}).catch(function(f){i&&i(f)})},getIconIndex=function n(r,a,i){var o=-1,s=r;if(a.has(s))o=a.get(s);else{if(s=r,_instanceof(r,SVGSVGElement)){var l=new XMLSerializer;s=l.serializeToString(r)}else _instanceof(r,Image)&&(s=r.src);a.has(s)?o=a.get(s):(i.push(r),o=i.length-1,a.set(s,o))}return o},mergeImages=function n(r,a,i){var o=r.images,s=r.wx,l=s===void 0?[64,64]:s,u=new Map,c=[],f=o.map(function(h){var p=getIconIndex(h,u,c);return p});concatSprites({images:c,wx:l},function(h){if(h){var p=h.Mx,d=f.map(function(v){return p[v]});h.Mx=d}a&&a(h)},function(h){i&&i(h)})},toSvg=function n(r,a){return a=a||{},copyOptions(a),Promise.resolve(r).then(function(o){return cloneNode(o,a.filter,!0)}).then(embedFonts).then(inlineImages).then(i).then(function(o){return makeSvgDataUri(o,a.width||util.width(r),a.height||util.height(r))});function i(o){return a.hM&&(o.style.backgroundColor=a.hM),a.width&&(o.style.width=a.width+"px"),a.height&&(o.style.height=a.height+"px"),a.style&&Object.keys(a.style).forEach(function(s){o.style[s]=a.style[s]}),o}},toPixelData=function n(r,a){return draw(r,a||{}).then(function(i){return i.getContext("2d").getImageData(0,0,util.width(r),util.height(r)).data})},toPng=function n(r,a){return draw(r,a||{}).then(function(i){return i.toDataURL()})},toCanvas=function n(r,a){return draw(r,a||{}).then(function(i){return i})},toJpeg=function n(r,a){return a=a||{},draw(r,a).then(function(i){return i.toDataURL("image/jpeg",a.dM||1)})},toBlob=function n(r,a){return draw(r,a||{}).then(util.vM)},copyOptions=function n(r){typeof r.iM=="undefined"?domtoimage.sM.options.iM=defaultOptions.iM:domtoimage.sM.options.iM=r.iM,typeof r.rM=="undefined"?domtoimage.sM.options.rM=defaultOptions.rM:domtoimage.sM.options.rM=r.rM},draw=function n(r,a){return toSvg(r,a).then(util.pM).then(util.delay(100)).then(function(o){var s=i(r);return s.getContext("2d").drawImage(o,0,0),s});function i(o){var s=document.createElement("canvas");if(s.width=a.width||util.width(o),s.height=a.height||util.height(o),a.hM){var l=s.getContext("2d");l.fillStyle=a.hM,l.fillRect(0,0,s.width,s.height)}return s}},embedFonts=function n(r){return fontFaces.gM().then(function(a){var i=document.createElement("style");return r.appendChild(i),i.appendChild(document.createTextNode(a)),r})},inlineImages=function n(r){return images.yM(r).then(function(){return r})},makeSvgDataUri=function n(r,a,i){return Promise.resolve(r).then(function(o){return o.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),new XMLSerializer().serializeToString(o)}).then(util.wM).then(function(o){return'<foreignObject x="0" y="0" width="100%" height="100%">'+o+"</foreignObject>"}).then(function(o){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+a+'" height="'+i+'">'+o+"</svg>"}).then(function(o){return"data:image/svg+xml;charset=utf-8,"+o})},newUtil=function n(){return{escape:d,xM:a,mimeType:i,MM:p,kM:o,vM:l,CM:u,AM:h,bM:c(),delay:v,mM:_,wM:m,pM:f,width:y,height:g};function r(){var b="application/font-woff",k="image/jpeg";return{woff:b,woff2:b,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:k,jpeg:k,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"}}function a(b){var k=/\.([^\.\/]*?)$/g.exec(b);return k?k[1]:""}function i(b){var k=a(b).toLowerCase();return r()[k]||""}function o(b){return b.search(/^(data:)/)!==-1}function s(b){return new Promise(function(k){for(var L=window.atob(b.toDataURL().split(",")[1]),F=L.length,W=new Uint8Array(F),j=0;j<F;j++)W[j]=L.charCodeAt(j);k(new Blob([W],{type:"image/png"}))})}function l(b){return b.toBlob?new Promise(function(k){b.toBlob(k)}):s(b)}function u(b,k){var L=document.implementation.createHTMLDocument(),F=L.createElement("base");L.head.appendChild(F);var W=L.createElement("a");return L.body.appendChild(W),F.href=k,W.href=b,W.href}function c(){var b=0;return function(){return"u"+k()+b++;function k(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}}}function f(b){return new Promise(function(k,L){var F=new Image;F.onload=function(){k(F)},F.onerror=L,F.src=b})}function h(b){var k=3e4;return domtoimage.sM.options.rM&&(b+=(/\?/.test(b)?"&":"?")+new Date().getTime()),new Promise(function(L){var F=new XMLHttpRequest;F.onreadystatechange=Y,F.ontimeout=N,F.responseType="blob",F.timeout=k,F.open("GET",b,!0),F.send();var W;if(domtoimage.sM.options.iM){var j=domtoimage.sM.options.iM.split(/,/);j&&j[1]&&(W=j[1])}function Y(){if(F.readyState===4){if(F.status!==200){W?L(W):$("cannot fetch resource: "+b+", status: "+F.status);return}var w=new FileReader;w.onloadend=function(){var E=w.result.split(/,/)[1];L(E)},w.readAsDataURL(F.response)}}function N(){W?L(W):$("timeout of "+k+"ms occured while fetching resource: "+b)}function $(w){console.error(w),L("")}})}function p(b,k){return"data:"+k+";base64,"+b}function d(b){return b.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")}function v(b){return function(k){return new Promise(function(L){setTimeout(function(){L(k)},b)})}}function _(b){for(var k=[],L=b.length,F=0;F<L;F++)k.push(b[F]);return k}function m(b){return b.replace(/#/g,"%23").replace(/\n/g,"%0A")}function y(b){var k=C(b,"border-left-width"),L=C(b,"border-right-width");return b.scrollWidth+k+L}function g(b){var k=C(b,"border-top-width"),L=C(b,"border-bottom-width");return b.scrollHeight+k+L}function C(b,k){var L=window.getComputedStyle(b).getPropertyValue(k);return parseFloat(L.replace("px",""))}},newInliner=function n(){var r=/url\(['"]?([^'"]+?)['"]?\)/g;return{yM:s,OM:a,sM:{zM:i,_M:o}};function a(l){return l.search(r)!==-1}function i(l){for(var u=[],c;(c=r.exec(l))!==null;)u.push(c[1]);return u.filter(function(f){return!util.kM(f)})}function o(l,u,c,f){return Promise.resolve(u).then(function(p){return c?util.CM(p,c):p}).then(f||util.AM).then(function(p){return util.MM(p,util.mimeType(u))}).then(function(p){return l.replace(h(u),"$1"+p+"$3")});function h(p){return new RegExp("(url\\(['\"]?)("+util.escape(p)+")(['\"]?\\))","g")}}function s(l,u,c){if(f())return Promise.resolve(l);return Promise.resolve(l).then(i).then(function(h){var p=Promise.resolve(l);return h.forEach(function(d){p=p.then(function(v){return o(v,d,u,c)})}),p});function f(){return!a(l)}}},newFontFaces=function n(){return{gM:r,sM:{SM:a}};function r(){return a().then(function(i){return Promise.all(i.map(function(o){return o.resolve()}))}).then(function(i){return i.join("\n")})}function a(){return Promise.resolve(util.mM(document.styleSheets)).then(o).then(i).then(function(l){return l.map(s)});function i(l){return l.filter(function(u){return u.type===CSSRule.FONT_FACE_RULE}).filter(function(u){return inliner.OM(u.style.getPropertyValue("src"))})}function o(l){var u=[];return l.forEach(function(c){try{util.mM(c.cssRules||[]).forEach(u.push.bind(u))}catch(f){console.log("Error while reading CSS rules from "+c.href,f.toString())}}),u}function s(l){return{resolve:function(){var u=(l.parentStyleSheet||{}).href;return inliner.yM(l.cssText,u)},src:function(){return l.style.getPropertyValue("src")}}}}},newImages=function n(){return{yM:a,sM:{IM:r}};function r(i){return{_M:o};function o(s){return util.kM(i.src)?Promise.resolve():Promise.resolve(i.src).then(s||util.AM).then(function(l){return util.MM(l,util.mimeType(i.src))}).then(function(l){return new Promise(function(u,c){i.onload=u,i.onerror=c,i.src=l})})}}function a(i){if(!_instanceof(i,Element))return Promise.resolve(i);return o(i).then(function(){return _instanceof(i,HTMLImageElement)?r(i)._M():Promise.all(util.mM(i.childNodes).map(function(s){return a(s)}))});function o(s){var l=s.style.getPropertyValue("background");return l?inliner.yM(l).then(function(u){s.style.setProperty("background",u,s.style.getPropertyPriority("background"))}).then(function(){return s}):Promise.resolve(s)}}},_arrayBuffer2TypedArray=function n(r,a,i,o){switch(o){case 5122:return new Int16Array(r,a,i);case 5123:return new Uint16Array(r,a,i);case 5124:return new Int32Array(r,a,i);case 5125:return new Uint32Array(r,a,i);case 5126:return new Float32Array(r,a,i);default:return null}},_getAccessorData=function n(r){return _arrayBuffer2TypedArray(r.bufferView.data,r.byteOffset,r.count*Type2NumOfComponent[r.type],r.componentType)},_getBaseUri=function n(r){var a="",i=r.lastIndexOf("/");return i!==-1&&(a=r.substring(0,i+1)),a},_loadGlb=function n(r,a){var i=new XMLHttpRequest;i.overrideMimeType("model/gltf-binary"),i.responseType="arraybuffer",i.open("GET",r,!0),i.onload=function(){var o=i.response;if(o){var s=new GLTFBinaryExtension(o);if(s.content){JSON.parse(s.content),a(s,this);debugger}}},i.send(null)},_loadJSON=function n(r,a){var i=new XMLHttpRequest;i.overrideMimeType("application/json"),i.open("GET",r,!0),i.onreadystatechange=function(){i.readyState==4&&i.status===200&&a(i.responseText,this)},i.send(null)},_loadArrayBuffer=function n(r,a,i){return __async$1(this,null,function(){var o,s;return _ts_generator(this,function(l){switch(l.label){case 0:return[4,fetch(r)];case 1:return o=l.sent(),[4,o.arrayBuffer()];case 2:return s=l.sent(),a(s,i),[2]}})})},isPowOf2=function n(r){for(var a=2;a!==r&&a<r;)a*=2;return a==r},getFitPow=function n(r){for(var a=2;a<r;)a*=2;return a/r>1.5?a:a/2},_loadImage=function n(r,a,i){var o=new Image;o.crossOrigin="Anonymous",o.src=r,o.onload=function(s){var l=s.target,u=l.width,c=l.height;if(isPowOf2(u)&&isPowOf2(c)){i(l,a);return}var f=getFitPow(u),h=getFitPow(c);canvas.width=f,canvas.height=h,context.drawImage(l,0,0,f,h),i(context.getImageData(0,0,f,h),a)}},formatArray=function n(r,a,i){var o={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},s={5120:"int8",5121:"uint8",5122:"int16",5123:"uint16",5125:"uint32",5126:"float32"},l=r.bufferView.data,u=o[r.componentType],c;c=new u(l);var f=s[r.componentType];return i==="buffer"?c=a.buffer(c):c=a.elements({primitive:"triangles",type:f,data:c}),{array:c,type:f,offset:r.byteOffset||0,stride:r.byteStride||0,HAS:1}},BezierEasing__namespace=_interopNamespace(BezierEasing),earcut__default=_interopDefaultLegacy(earcut),REGL__default=_interopDefaultLegacy(REGL),dat__namespace=_interopNamespace(dat),polylabel$1={exports:{}},TinyQueue=function(){function n(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:defaultCompare;if(_class_call_check(this,n),this.data=r,this.length=this.data.length,this.t$=a,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this.e$(i)}return _create_class(n,[{key:"push",value:function(r){this.data.push(r),this.length++,this.i$(this.length-1)}},{key:"pop",value:function(){if(this.length!==0){var r=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this.e$(0)),r}}},{key:"n$",value:function(){return this.data[0]}},{key:"i$",value:function(r){for(var a=this,i=a.data,o=a.t$,s=i[r];r>0;){var l=r-1>>1,u=i[l];if(o(s,u)>=0)break;i[r]=u,r=l}i[r]=s}},{key:"e$",value:function(r){for(var a=this,i=a.data,o=a.t$,s=this.length>>1,l=i[r];r<s;){var u=(r<<1)+1,c=i[u],f=u+1;if(f<this.length&&o(i[f],c)<0&&(u=f,c=i[f]),o(c,l)>=0)break;i[r]=c,r=u}i[r]=l}}]),n}(),tinyqueue=Object.freeze({__proto__:null,default:TinyQueue}),require$$0=getAugmentedNamespace(tinyqueue),Queue=require$$0;Queue.default&&(Queue=Queue.default),polylabel$1.exports=polylabel,polylabel$1.exports.default=polylabel;function coordEach(n,r,a){if(n!==null)for(var i,o,s,l,u,c,f,h=0,p=0,d,v=n.type,_=v==="FeatureCollection",m=v==="Feature",y=_?n.features.length:1,g=0;g<y;g++){f=_?n.features[g].geometry:m?n.geometry:n,d=f?f.type==="GeometryCollection":!1,u=d?f.tz.length:1;for(var C=0;C<u;C++){var b=0,k=0;if(l=d?f.tz[C]:f,l!==null){c=l.coordinates;var L=l.type;switch(h=a&&(L==="Polygon"||L==="MultiPolygon")?1:0,L){case null:break;case"Point":if(r(c,p,g,b,k)===!1)return!1;p++,b++;break;case"LineString":case"MultiPoint":for(i=0;i<c.length;i++){if(r(c[i],p,g,b,k)===!1)return!1;p++,L==="MultiPoint"&&b++}L==="LineString"&&b++;break;case"Polygon":case"MultiLineString":for(i=0;i<c.length;i++){for(o=0;o<c[i].length-h;o++){if(r(c[i][o],p,g,b,k)===!1)return!1;p++}L==="MultiLineString"&&b++,L==="Polygon"&&k++}L==="Polygon"&&b++;break;case"MultiPolygon":for(i=0;i<c.length;i++){for(k=0,o=0;o<c[i].length;o++){for(s=0;s<c[i][o].length-h;s++){if(r(c[i][o][s],p,g,b,k)===!1)return!1;p++}k++}b++}break;case"GeometryCollection":for(i=0;i<l.tz.length;i++)if(coordEach(l.tz[i],r,a)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}var geobuf={},encode_1=encode,keys$1,keysNum,keysArr,dim$1,e$1,maxPrecision=1e6,geometryTypes$1={Point:0,MultiPoint:1,LineString:2,MultiLineString:3,Polygon:4,MultiPolygon:5,GeometryCollection:6};function analyze(n){var r,a;if(n.type==="FeatureCollection")for(r=0;r<n.features.length;r++)analyze(n.features[r]);else if(n.type==="Feature"){n.geometry!==null&&analyze(n.geometry);for(a in n.properties)saveKey(a)}else if(n.type==="Point")analyzePoint(n.coordinates);else if(n.type==="MultiPoint")analyzePoints(n.coordinates);else if(n.type==="GeometryCollection")for(r=0;r<n.tz.length;r++)analyze(n.tz[r]);else if(n.type==="LineString")analyzePoints(n.coordinates);else if(n.type==="Polygon"||n.type==="MultiLineString")analyzeMultiLine(n.coordinates);else if(n.type==="MultiPolygon")for(r=0;r<n.coordinates.length;r++)analyzeMultiLine(n.coordinates[r]);for(a in n)isSpecialKey(a,n.type)||saveKey(a)}function writeGeometry(n,r){r.tP(1,geometryTypes$1[n.type]);var a=n.coordinates;if(n.type==="Point")writePoint(a,r);else if(n.type==="MultiPoint")writeLine(a,r);else if(n.type==="LineString")writeLine(a,r);else if(n.type==="MultiLineString")writeMultiLine(a,r);else if(n.type==="Polygon")writeMultiLine(a,r,!0);else if(n.type==="MultiPolygon")writeMultiPolygon(a,r);else if(n.type==="GeometryCollection")for(var i=0;i<n.tz.length;i++)r.Az(4,writeGeometry,n.tz[i]);writeProps(n,r,!0)}var decode_1=decode,keys,values,lengths,dim,e,geometryTypes=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","GeometryCollection"];geobuf.encode=encode_1,geobuf.decode=decode_1;var ieee754$1={};ieee754$1.read=function(n,r,a,i,o){var s,l,u=o*8-i-1,c=(1<<u)-1,f=c>>1,h=-7,p=a?o-1:0,d=a?-1:1,v=n[r+p];for(p+=d,s=v&(1<<-h)-1,v>>=-h,h+=u;h>0;s=s*256+n[r+p],p+=d,h-=8);for(l=s&(1<<-h)-1,s>>=-h,h+=i;h>0;l=l*256+n[r+p],p+=d,h-=8);if(s===0)s=1-f;else{if(s===c)return l?NaN:(v?-1:1)*(1/0);l=l+Math.pow(2,i),s=s-f}return(v?-1:1)*l*Math.pow(2,s-i)},ieee754$1.write=function(n,r,a,i,o,s){var l,u,c,f=s*8-o-1,h=(1<<f)-1,p=h>>1,d=o===23?Math.pow(2,-24)-Math.pow(2,-77):0,v=i?0:s-1,_=i?1:-1,m=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(u=isNaN(r)?1:0,l=h):(l=Math.floor(Math.log(r)/Math.LN2),r*(c=Math.pow(2,-l))<1&&(l--,c*=2),l+p>=1?r+=d/c:r+=d*Math.pow(2,1-p),r*c>=2&&(l++,c/=2),l+p>=h?(u=0,l=h):l+p>=1?(u=(r*c-1)*Math.pow(2,o),l=l+p):(u=r*Math.pow(2,p-1)*Math.pow(2,o),l=0));o>=8;n[a+v]=u&255,v+=_,u/=256,o-=8);for(l=l<<o|u,f+=o;f>0;n[a+v]=l&255,v+=_,l/=256,f-=8);n[a+v-_]|=m*128};var pbf=Pbf,ieee754=ieee754$1;Pbf.oz=0,Pbf.sz=1,Pbf.az=2,Pbf.uz=5;var SHIFT_LEFT_32=(1<<16)*(1<<16),SHIFT_RIGHT_32=1/SHIFT_LEFT_32,TEXT_DECODER_MIN_LENGTH=12,utf8TextDecoder=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");Pbf.prototype={destroy:function n(){this.rz=null},ez:function n(r,a,i){for(i=i||this.length;this.Br<i;){var o=this.YC(),s=o>>3,l=this.Br;this.type=o&7,r(s,a,this),this.Br===l&&this.yz(o)}return a},$C:function n(r,a){return this.ez(r,a,this.YC()+this.Br)},xz:function n(){var r=readUInt32(this.rz,this.Br);return this.Br+=4,r},wz:function n(){var r=readInt32(this.rz,this.Br);return this.Br+=4,r},Cz:function n(){var r=readUInt32(this.rz,this.Br)+readUInt32(this.rz,this.Br+4)*SHIFT_LEFT_32;return this.Br+=8,r},kz:function n(){var r=readUInt32(this.rz,this.Br)+readInt32(this.rz,this.Br+4)*SHIFT_LEFT_32;return this.Br+=8,r},hl:function n(){var r=ieee754.read(this.rz,this.Br,!0,23,4);return this.Br+=4,r},iz:function n(){var r=ieee754.read(this.rz,this.Br,!0,52,8);return this.Br+=8,r},YC:function n(r){var a=this.rz,i,o;return o=a[this.Br++],i=o&127,o<128||(o=a[this.Br++],i|=(o&127)<<7,o<128)||(o=a[this.Br++],i|=(o&127)<<14,o<128)||(o=a[this.Br++],i|=(o&127)<<21,o<128)?i:(o=a[this.Br],i|=(o&15)<<28,readVarintRemainder(i,r,this))},zz:function n(){return this.YC(!0)},ZC:function n(){var r=this.YC();return r%2===1?(r+1)/-2:r/2},nz:function n(){return Boolean(this.YC())},JC:function n(){var r=this.YC()+this.Br,a=this.Br;return this.Br=r,r-a>=TEXT_DECODER_MIN_LENGTH&&utf8TextDecoder?readUtf8TextDecoder(this.rz,a,r):readUtf8(this.rz,a,r)},Pz:function n(){var r=this.YC()+this.Br,a=this.rz.subarray(this.Br,r);return this.Br=r,a},KC:function n(r,a){if(this.type!==Pbf.az)return r.push(this.YC(a));var i=readPackedEnd(this);for(r=r||[];this.Br<i;)r.push(this.YC(a));return r},Sz:function n(r){if(this.type!==Pbf.az)return r.push(this.ZC());var a=readPackedEnd(this);for(r=r||[];this.Br<a;)r.push(this.ZC());return r},Mz:function n(r){if(this.type!==Pbf.az)return r.push(this.nz());var a=readPackedEnd(this);for(r=r||[];this.Br<a;)r.push(this.nz());return r},_z:function n(r){if(this.type!==Pbf.az)return r.push(this.hl());var a=readPackedEnd(this);for(r=r||[];this.Br<a;)r.push(this.hl());return r},Iz:function n(r){if(this.type!==Pbf.az)return r.push(this.iz());var a=readPackedEnd(this);for(r=r||[];this.Br<a;)r.push(this.iz());return r},Vz:function n(r){if(this.type!==Pbf.az)return r.push(this.xz());var a=readPackedEnd(this);for(r=r||[];this.Br<a;)r.push(this.xz());return r},Dz:function n(r){if(this.type!==Pbf.az)return r.push(this.wz());var a=readPackedEnd(this);for(r=r||[];this.Br<a;)r.push(this.wz());return r},Lz:function n(r){if(this.type!==Pbf.az)return r.push(this.Cz());var a=readPackedEnd(this);for(r=r||[];this.Br<a;)r.push(this.Cz());return r},Fz:function n(r){if(this.type!==Pbf.az)return r.push(this.kz());var a=readPackedEnd(this);for(r=r||[];this.Br<a;)r.push(this.kz());return r},yz:function n(r){var a=r&7;if(a===Pbf.oz)for(;this.rz[this.Br++]>127;);else if(a===Pbf.az)this.Br=this.YC()+this.Br;else if(a===Pbf.uz)this.Br+=4;else if(a===Pbf.sz)this.Br+=8;else throw new Error("Unimplemented type: "+a)},Rz:function n(r,a){this.lz(r<<3|a)},hz:function n(r){for(var a=this.length||16;a<this.Br+r;)a*=2;if(a!==this.length){var i=new Uint8Array(a);i.set(this.rz),this.rz=i,this.length=a}},finish:function n(){return this.length=this.Br,this.Br=0,this.rz.subarray(0,this.length)},pz:function n(r){this.hz(4),writeInt32(this.rz,r,this.Br),this.Br+=4},mz:function n(r){this.hz(4),writeInt32(this.rz,r,this.Br),this.Br+=4},gz:function n(r){this.hz(8),writeInt32(this.rz,r&-1,this.Br),writeInt32(this.rz,Math.floor(r*SHIFT_RIGHT_32),this.Br+4),this.Br+=8},bz:function n(r){this.hz(8),writeInt32(this.rz,r&-1,this.Br),writeInt32(this.rz,Math.floor(r*SHIFT_RIGHT_32),this.Br+4),this.Br+=8},lz:function n(r){if(r=+r||0,r>268435455||r<0){writeBigVarint(r,this);return}this.hz(4),this.rz[this.Br++]=r&127|(r>127?128:0),!(r<=127)&&(this.rz[this.Br++]=(r>>>=7)&127|(r>127?128:0),!(r<=127)&&(this.rz[this.Br++]=(r>>>=7)&127|(r>127?128:0),!(r<=127)&&(this.rz[this.Br++]=r>>>7&127)))},fz:function n(r){this.lz(r<0?-r*2-1:r*2)},dz:function n(r){this.lz(Boolean(r))},Tz:function n(r){r=String(r),this.hz(r.length*4),this.Br++;var a=this.Br;this.Br=writeUtf8(this.rz,r,this.Br);var i=this.Br-a;i>=128&&makeRoomForExtraLength(a,i,this),this.Br=a-1,this.lz(i),this.Br+=i},cz:function n(r){this.hz(4),ieee754.write(this.rz,r,this.Br,!0,23,4),this.Br+=4},vz:function n(r){this.hz(8),ieee754.write(this.rz,r,this.Br,!0,52,8),this.Br+=8},Oz:function n(r){var a=r.length;this.lz(a),this.hz(a);for(var i=0;i<a;i++)this.rz[this.Br++]=r[i]},Bz:function n(r,a){this.Br++;var i=this.Br;r(a,this);var o=this.Br-i;o>=128&&makeRoomForExtraLength(i,o,this),this.Br=i-1,this.lz(o),this.Br+=o},Az:function n(r,a,i){this.Rz(r,Pbf.az),this.Bz(a,i)},Wz:function n(r,a){a.length&&this.Az(r,writePackedVarint,a)},Nz:function n(r,a){a.length&&this.Az(r,writePackedSVarint,a)},Ez:function n(r,a){a.length&&this.Az(r,writePackedBoolean,a)},jz:function n(r,a){a.length&&this.Az(r,writePackedFloat,a)},Uz:function n(r,a){a.length&&this.Az(r,writePackedDouble,a)},Gz:function n(r,a){a.length&&this.Az(r,writePackedFixed32,a)},qz:function n(r,a){a.length&&this.Az(r,writePackedSFixed32,a)},Qz:function n(r,a){a.length&&this.Az(r,writePackedFixed64,a)},Xz:function n(r,a){a.length&&this.Az(r,writePackedSFixed64,a)},Jz:function n(r,a){this.Rz(r,Pbf.az),this.Oz(a)},Yz:function n(r,a){this.Rz(r,Pbf.uz),this.pz(a)},$z:function n(r,a){this.Rz(r,Pbf.uz),this.mz(a)},Zz:function n(r,a){this.Rz(r,Pbf.sz),this.gz(a)},Kz:function n(r,a){this.Rz(r,Pbf.sz),this.bz(a)},tP:function n(r,a){this.Rz(r,Pbf.oz),this.lz(a)},iP:function n(r,a){this.Rz(r,Pbf.oz),this.fz(a)},nP:function n(r,a){this.Rz(r,Pbf.az),this.Tz(a)},eP:function n(r,a){this.Rz(r,Pbf.uz),this.cz(a)},rP:function n(r,a){this.Rz(r,Pbf.sz),this.vz(a)},oP:function n(r,a){this.tP(r,Boolean(a))}};var __defProp$3$1=Object.defineProperty,__defProps$2$1=Object.defineProperties,__getOwnPropDescs$2$1=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3$1=Object.getOwnPropertySymbols,__hasOwnProp$3$1=Object.prototype.hasOwnProperty,__propIsEnum$3$1=Object.prototype.propertyIsEnumerable,__defNormalProp$3$1=function(n,r,a){return r in n?__defProp$3$1(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$3$1=function(n,r){for(var a in r||(r={}))__hasOwnProp$3$1.call(r,a)&&__defNormalProp$3$1(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$3$1)try{for(var l=__getOwnPropSymbols$3$1(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$3$1.call(r,a)&&__defNormalProp$3$1(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},__spreadProps$2$1=function(n,r){return __defProps$2$1(n,__getOwnPropDescs$2$1(r))},colorNameDist={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",grey:"#808080",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},ColorUtil$1={yC:function n(r){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!r)return r;for(var i=[],o=0,s=r.length;o<s;o+=2){var l=parseInt(r.substr(o,2),16);a&&(l=parseInt(l/255+"")),i.push(l)}return i.push(i.shift()),i},xC:function n(r){var a=r.split(",");return a[0]=parseFloat(a[0].slice(5))/255,a[1]=parseFloat(a[1])/255,a[2]=parseFloat(a[2])/255,a[3]=parseFloat(a[3]),a},Zn:function n(r){var a=r.split(",");return a[0]=parseFloat(a[0].slice(4))/255,a[1]=parseFloat(a[1])/255,a[2]=parseFloat(a[2])/255,a[3]=1,a},CC:function n(r){for(var a=[],i=1,o=r.length;i<o;i+=2)a.push(parseInt(r.substr(i,2),16));return a.push((a.shift()/255).toFixed(2)),"rgba("+a.join(",")+")"},$n:function n(r){for(var a=[],i=1,o=r.length;i<o;i+=2)a.push(parseInt(r.substr(i,2),16)/255);return a},Kn:function n(r){for(var a=[],i=1,o=r.length;i<o;i+=2)a.push(parseInt(r.substr(i,2),16)/255);return a[3]=1,a},ti:function n(r){for(var a=[],i=1,o=r.length;i<o;i+=1){var s=r.substr(i,1);a.push(parseInt(s+s,16)/255)}return a[3]=1,a},kC:function n(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return r=r.toLowerCase(),colorNameDist[r]},zC:function n(r){if(_instanceof(r,Array))return[r[0]/255,r[1]/255,r[2]/255,r[3]||1];if(/^rgba\(/.test(r))return this.xC(r);if(/^rgb\(/.test(r))return this.Zn(r);if(r[0]==="#"&&typeof r=="string"){var a=r.length;if(a===4)return this.ti(r);if(a===7)return this.Kn(r);if(a===9)return this.$n(r)}else if(typeof r=="string"){var i=this.kC(r);return this.Kn(i)}return r}},DomUtil={wC:function n(r,a){var i=a.target;if(i){var o=r.getBoundingClientRect(),s=[r.clientLeft,r.clientTop],l=a;return _instanceof(a,TouchEvent)&&a.touches&&a.changedTouches&&(a.touches.length>0?l=a.touches[0]:l=a.changedTouches[a.changedTouches.length-1]),[l.clientX-o.left-s[0],l.clientY-o.left-s[1]]}return[0,0]}},MathUtil={PC:function n(r){return r/180*Math.PI},SC:function n(r){return r*180/Math.PI}},CommonUtil$1={MC:function n(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:10;return r+Math.round(Math.random()*Math.pow(10,a))+"_"+new Date().getTime()},_C:function n(r,a){var i=r.length,o=a.length;r.length=i+o;for(var s=0;s<o;s++)r[i+s]=a[s];return r},ni:function n(r,a){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};r=encodeURI(r);var o={callback:"callback",type:"json",charset:"utf-8"},s=CommonUtil$1.MC("jsonp_",6)+"_",l=document.createElement("script");l.type="text/javascript",l.async=!0,i=Object.assign({},o,i);var u=function(){window[s]=null,l.onerror=null,l.parentNode&&l.parentNode.removeChild(l)};l.onerror=function(){u(),a&&a("error",{url:r,info:"Request Error"})},window[s]=function(p){u(),a&&a("complete",{info:"ok",url:r,data:p})};var c="?";r.indexOf("?")!==-1&&(c="&");var f=r+c+i.callback+"="+s;l.src=f;var h=document.getElementsByTagName("body")[0]||document.getElementsByTagName("head")[0];h.appendChild(l)},grid:{ri:function n(r){for(var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100,i={},o=[],s=a*2,l=-1,u=r.length;++l<u;){var c=r[l].coordinaties,f=Math.floor(c[0]/s),h=Math.floor(c[1]/s),p=f+"-"+h,d=i[p];d?d.coordinates.push(r[l]):(i[p]=d={rowCol:[f,h],center:[f*s+a,h*s+a],coordinates:[r[l]]},o.push(d))}return o},DC:function n(r,a){var i,o=[],s=a.gap,l=a.radius,u=s/2,c=_sliced_to_array(r.center,2),f=c[0],h=c[1],p=[f-l+u,h+l-u],d=[f-l+u,h-l+u],v=[f+l-u,h-l+u],_=[f+l-u,h+l-u];return(i=o).push.apply(i,[p,d,v,_,p]),o}},hexagon:{ei:Math.PI/3,oi:[0,Math.PI/3,2*Math.PI/3,Math.PI/3,Math.PI/3,5*Math.PI/3],ri:function n(r){for(var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100,i={},o=[],s=a*2*Math.sin(this.ei),l=a*1.5,u=0,c=r.length;u<c;++u){var f=r[u].coordinaties,h=_sliced_to_array(f,2),p=h[0],d=h[1];d=d/l;var v=Math.round(d);p=p/s-(v&1)/2;var _=Math.round(p),m=d-v;if(Math.abs(m)*3>1){var y=p-_,g=_+(p<_?-1:1)/2,C=v+(d<v?-1:1),b=p-g,k=d-C;y*y+m*m>b*b+k*k&&(_=g+(v&1?1:-1)/2,v=C)}var L=_+"-"+v,F=i[L];F?F.coordinates.push(r[u]):(i[L]=F={rowCol:[_,v],center:[(_+(v&1)/2)*s,v*l],coordinates:[r[u]]},o.push(F))}return o},DC:function n(r,a){var i,o=[],s=a.gap,l=a.radius,u=s/2,c=l/2,f=Math.sqrt(3)*l,h=Math.sqrt(Math.pow(f,2)+Math.pow(l,2)),p=_sliced_to_array(r.center,2),d=p[0],v=p[1],_=[d,v+h/2-u],m=[d-f/2+u,v+c-u/2],y=[d-f/2+u,v-c+u/2],g=[d,v-h/2+u],C=[d+f/2-u,v-c+u/2],b=[d+f/2-u,v+c-u/2];return(i=o).push.apply(i,[_,m,y,g,C,b,_]),o}},ai:function n(r){var a=[];if(r.type==="MultiPoint")for(var i=r.properties,o=r.coordinates,s=o.length,l=0;l<s;++l){var u=o[l];a.push({properties:i,type:"Point",coordinates:u})}else if(r.type==="MultiLineString")for(var c=r.properties,f=r.coordinates,h=f.length,p=0;p<h;++p){var d=f[p];a.push({properties:c,type:"Point",coordinates:d})}else if(r.type==="MultiPolygon")for(var v=r.properties,_=r.coordinates,m=_.length,y=0;y<m;++y){var g=_[y];a.push({properties:v,type:"Point",coordinates:g})}return a}},GeometryUtil=__spreadProps$2$1(__spreadValues$3$1({},AMap.GeometryUtil),{s$:function n(r){var a=0;if(r&&r.length>0){a+=Math.abs(this.ringArea(r[0]));for(var i=1;i<r.length;i++)a-=Math.abs(this.ringArea(r[i]))}return a},a$:function n(r){return polylabel$1.exports(r,1)},l$:function n(r){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=0,o=0,s=0;return coordEach(r,function(l){i+=l[0],o+=l[1],s++},!0),point$1([i/s,o/s],a.properties)},c$:function n(r){for(var a=multiPoint(r),i=a.geometry,o=this.l$(a),s=!1,l=0;!s&&l<i.coordinates.length;)o.geometry.coordinates[0]===i.coordinates[l][0]&&o.geometry.coordinates[1]===i.coordinates[l][1]&&(s=!0),l++;if(s)return o.geometry.coordinates;var u=1/0,c,f=!0,h=!1,p=void 0;try{for(var d=i.coordinates[Symbol.iterator](),v;!(f=(v=d.next()).done);f=!0){var _=v.value,m=this.distance(_,o.geometry.coordinates);m<u&&(u=m,c=_)}}catch(y){h=!0,p=y}finally{try{!f&&d.return!=null&&d.return()}finally{if(h)throw p}}return c}}),LangUtil={Wb:function n(r){return Object.prototype.toString.call(r)==="[object Object]"}},__defProp$2$1=Object.defineProperty,__getOwnPropSymbols$2$1=Object.getOwnPropertySymbols,__hasOwnProp$2$1=Object.prototype.hasOwnProperty,__propIsEnum$2$1=Object.prototype.propertyIsEnumerable,__defNormalProp$2$1=function(n,r,a){return r in n?__defProp$2$1(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$2$1=function(n,r){for(var a in r||(r={}))__hasOwnProp$2$1.call(r,a)&&__defNormalProp$2$1(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$2$1)try{for(var l=__getOwnPropSymbols$2$1(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$2$1.call(r,a)&&__defNormalProp$2$1(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},ColorUtil=ColorUtil$1,_Style=function(){function n(){_class_call_check(this,n)}return _create_class(n,[{key:"parse",value:function(r,a,i){for(var o={},s={},l={},u=0,c=r.length;u<c;u++){var f=r[u],h=this.u$(f,u,a,i);for(var p in h)o[p]||(o[p]=[]),o[p].push(h[p])}for(var d in i)if(["uniform","config"].includes(i[d].render)){var v=this.h$(d,a[d],i[d].defaultValue,i[d].type);i[d].render==="uniform"?s[d]=v:l[d]=v}return{attributes:o,uniforms:s,si:l}}},{key:"u$",value:function(r,a,i,o){var s={};for(var l in o)o[l].render==="attribute"&&(s[l]=this.h$(l,i[l],o[l].defaultValue,o[l].type,function(){return[a,r]}));return s}},{key:"h$",value:function(r,a,i,o,s){var l=typeof o=="function"?o(r):o;if((LangUtil.Wb(i)||LangUtil.Wb(a))&&l==="nest"){var u=__spreadValues$2$1(__spreadValues$2$1({},i),a);for(var c in u)if(Object.prototype.toString.call(u[c])==="[object Object]")u[c]=this.h$(c,u[c],(i||{})[c],o,s);else if(typeof u[c]=="function"){var f;u[c]=this.f$(l,(f=u)[c].apply(f,_to_consumable_array((s==null?void 0:s(r))||[])))}else u[c]=this.f$(l,u[c]);return u}else{var h;return typeof a=="function"?h=a.apply(void 0,_to_consumable_array((s==null?void 0:s(r))||[])):h=a!=null?a:i,this.f$(l,h)}}},{key:"f$",value:function(r,a){if(r==="color")return ColorUtil.zC(a);if(r==="colors"){if(!Array.isArray(a))throw new Error("style.colors \u5FC5\u987B\u662F\u6570\u7EC4");return a.map(function(i){return ColorUtil.zC(i)})}return a}}],[{key:"getInstance",value:function(){return this.ui}}]),n}(),Style=_Style;Style.ui=new _Style;var StyleInstance=Style.getInstance(),__defProp$1$2=Object.defineProperty,__defProps$1$1=Object.defineProperties,__getOwnPropDescs$1$1=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1$2=Object.getOwnPropertySymbols,__hasOwnProp$1$2=Object.prototype.hasOwnProperty,__propIsEnum$1$2=Object.prototype.propertyIsEnumerable,__defNormalProp$1$2=function(n,r,a){return r in n?__defProp$1$2(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$1$2=function(n,r){for(var a in r||(r={}))__hasOwnProp$1$2.call(r,a)&&__defNormalProp$1$2(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$1$2)try{for(var l=__getOwnPropSymbols$1$2(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$1$2.call(r,a)&&__defNormalProp$1$2(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},__spreadProps$1$1=function(n,r){return __defProps$1$1(n,__getOwnPropDescs$1$1(r))},Event=function(){function n(){_class_call_check(this,n),this.fi={}}return _create_class(n,[{key:"on",value:function(r,a){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s;Array.isArray(r)?s=r:s=[r];var l=!0,u=!1,c=void 0;try{for(var f=s[Symbol.iterator](),h;!(l=(h=f.next()).done);l=!0){var p=h.value;this._on(p,a,i,o)}}catch(d){u=!0,c=d}finally{try{!l&&f.return!=null&&f.return()}finally{if(u)throw c}}return this}},{key:"off",value:function(r,a){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this,o=this.fi;if(r in o){for(var s=0;s<o[r].length;s+=1)if(o[r][s].hi===a&&o[r][s].context===i)return o[r].splice(s,1),this}return this}},{key:"hasEvents",value:function(r,a){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this,o=this.fi;if(r&&a&&r in o){for(var s=0;s<o[r].length;s+=1)if(o[r][s].hi===a&&o[r][s].context===i)return!0}return!1}},{key:"clearEvents",value:function(r){return r?this.fi[r]&&delete this.fi[r]:this.fi={},this}},{key:"emit",value:function(r){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!(r in this.fi))return this;for(var i=__spreadProps$1$1(__spreadValues$1$2({},a),{type:r}),o=this.fi[r],s=0,l=o.length;s<l;s+=1){var u=o[s];!u.hi||(u.hi.call(u.context,i),u.once&&(this.fi[r].splice(s,1),s-=1,l-=1))}return this}},{key:"getEvents",value:function(){return this.fi}},{key:"_on",value:function(r,a){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(this.hasEvents(r,a,i))return this;var s=this.fi;return s[r]=s[r]||[],s[r].push({hi:a,context:i||this,once:o}),this}}]),n}(),parser=new uaParserJs.UAParser,buryPoint={sr:Math.random(),cr:"1.0",lr:{},hr:"",dr:"LOCA",vr:{},pr:{},init:function n(){this.mr(),setTimeout(function(){buryPoint.send()},2e3),setInterval(function(){buryPoint.send()},1e4)},setAPIKey:function n(r){this.hr=r},setContainer:function n(r){this.lr=r;var a=r.getBoundingClientRect();this.pr.size=[a.width,a.height]},setVersion:function n(r){this.cr=r},mr:function n(){var r=document.createElement("canvas"),a=r.getContext("webgl");if(a){var i=a.getExtension("WEBGL_debug_renderer_info");this.pr.br=i&&a.getParameter(i.UNMASKED_RENDERER_WEBGL)}},getKey:function n(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",a=arguments.length>1?arguments[1]:void 0;r=r;var i,o=[];return Object.prototype.toString.call(a)==="[object Object]"&&(o=Object.keys(a)),a!==void 0&&r?i=r+"@"+o.join():i=r,i},record:function n(r,a,i){this.vr[r]||(this.vr[r]={});var o=this.getKey(a,i);this.vr[r][o]==null&&(this.vr[r][o]=0)},send:function n(){var r=[];for(var a in this.vr)if(this.vr.hasOwnProperty(a)){var i=this.vr[a],o=[];for(var s in i)i.hasOwnProperty(s)&&i[s]==0&&(o.push(s),i[s]=1);o.length&&r.push(a+"~"+o.join(","))}if(r.length){var l=parser.getResult(),u=["type=nfl","k="+this.hr,"m="+(l.device.type==="moblie"?1:0),"pf="+l.os.name,"v="+this.cr,"branch="+this.dr,"logversion=2.0","gc="+this.pr.br,"log="+r.join("!"),"appname="+window.location.origin+window.location.pathname,"sdkversion="+this.cr],c="https://webapi.amap.com/count?"+u.join("&");CommonUtil$1.ni(c)}},gr:function n(){}},Layer$1=function(n){_inherits(a,n);var r=_create_super(a);function a(i){_class_call_check(this,a);var o;return o=r.call(this),o.CLASS_NAME="Layer",o.meshes=[],o.preHandle=!1,o.buryPoint=buryPoint,o.d$=i,o.id=CommonUtil$1.MC(),o.map=i.map,o.zIndex=i.zIndex,o.visible=i.visible,o.opacity=i.opacity,o.zooms=i.zooms,o.style=StyleInstance,o.preHandle=!!i.preHandle,o}return _create_class(a,[{key:"setSource",value:function(i,o){this.source&&this.source.Mr(this),this.buryPoint.record(this.CLASS_NAME,"setSource"),this.source=i,o&&this.setStyle(o),this.source.addLayer(this)}},{key:"setStyle",value:function(i){i&&this.buryPoint.record(this.CLASS_NAME,"setStyle",i),this.styleOptions=i,this.preHandle&&this.beforeRender()}},{key:"WC",value:function(){for(var i=function(c){var f=o[c].id,h=s.find(function(p){return p.id===f});h?(l.didFusion.push(h),l.didFusionDataset.push(o[c])):l.willFusion.push(o[c])},o=this.dataset,s=this.meshes,l={willFusion:[],didFusion:[],didFusionDataset:[]},u=0;u<o.length;u++)i(u);return l}},{key:"setMap",value:function(i){this.map=i}},{key:"onAdd",value:function(){this.Cr=performance.now()}},{key:"Ar",value:function(){this.Cr=0}},{key:"setZooms",value:function(i){this.zooms=i}},{key:"setOpacity",value:function(i){this.opacity=i}},{key:"setzIndex",value:function(i){this.zIndex=i}},{key:"show",value:function(){this.visible=!0}},{key:"hide",value:function(){this.visible=!1}},{key:"zr",value:function(){return performance.now()-this.Cr}}]),a}(_wrap_native_super(Event)),Handler=function(){function n(r){var a=this;_class_call_check(this,n),this._r=[0,0],this.Sr=[0,0],this.clickCount=0,this.Ir=!1,this.Pr=function(i){var o=i.deltaX,s=i.deltaY;a.map.emit("wheel",{event:i,deltaX:o,deltaY:s})},this.Tr=function(i){a.Ir=!0,a.container&&(a._r=DomUtil.wC(a.container,i),a.Sr=a._r),a.map.emit("mousedown",{event:i,Br:a._r})},this.Dr=function(i){var o=[0,0],s=_to_consumable_array(a.Sr),l={event:i,Sr:s,Er:o,_r:a._r};if(a.Ir&&a.container){var u=DomUtil.wC(a.container,i);o=[u[0]-s[0],u[1]-s[1]],a.Sr=u,l.Er=o,a.map.emit("drag",l)}a.map.emit("mousemove",l)},this.Vr=function(i){a.Ir=!1;var o=[0,0];a.container&&(o=DomUtil.wC(a.container,i),Math.abs(o[0]-a._r[0])<=1&&Math.abs(o[1]-a._r[1])<=1&&(a.clickCount++,a.clickCount>=2?a.map.emit("dblclick",{event:i,Br:o}):a.map.emit("click",{event:i,Br:o})),a.map.emit("mouseup",{event:i,Br:o}),setTimeout(function(){a.clickCount=0},300))},this.Rr=function(i){if(i.preventDefault(),a.container){var o=DomUtil.wC(a.container,i);a.map.emit("rightclick",{event:i,Br:o})}},this.map=r,this.container=this.map.container,this.bindEvents()}return _create_class(n,[{key:"bindEvents",value:function(){var r,a,i,o,s;(r=this.container)==null||r.addEventListener("wheel",this.Pr),(a=this.container)==null||a.addEventListener("mousedown",this.Tr),(i=this.container)==null||i.addEventListener("mousemove",this.Dr),(o=this.container)==null||o.addEventListener("mouseup",this.Vr),(s=this.container)==null||s.addEventListener("contextmenu",this.Rr)}}]),n}();buryPoint.record("Base");var Map$1=function(n){_inherits(a,n);var r=_create_super(a);function a(i,o){_class_call_check(this,a);var s;return s=r.call(this),s.center=[0,0],s.zoom=10,s.pitch=0,s.rotation=0,s.zooms=[1,30],s.animate=new chito.Animation,s.layers=[],s.buryPoint=buryPoint,s.Fa=30*2,s.La=0,s.Wa=!1,s.Na=!1,s.Ua=s.Fa,s.timeline=performance.now(),s.container=document.getElementById(i),s.qa=new Handler(_assert_this_initialized(s)),s.options=o,s.Na=o.Na===void 0?s.Na:o.Na,s.Fa=o.Fa===void 0?s.Fa:o.Fa,s.animate.addClip(new chito.Clip({duration:1e4,repeat:1/0}),{x:[0,1]}),buryPoint.init(),s}return _create_class(a,[{key:"render",value:function(){var i=this;this.layers.sort(function(o,s){return o.zIndex-s.zIndex}),this.layers.forEach(function(o){o.visible&&o.opacity>0&&o.zooms[0]<i.zoom&&o.zooms[1]>i.zoom&&(o.beforeRender(),o.render(),o.afterRender())})}},{key:"Qa",value:function(i){i&&(i.zoom!==void 0&&(this.zoom=Math.min(Math.max(this.zooms[0],i.zoom),this.zooms[1]),this.setZoom()),i.center!==void 0&&(this.setCenter(i.center),this.center=i.center),i.pitch!==void 0&&(this.pitch=Math.min(150,Math.max(i.pitch,0)),this.setPitch()),i.rotation!==void 0&&(this.setRotation(this.rotation-i.rotation),this.rotation=i.rotation)),this.requestRender(),this.emit("viewchange")}},{key:"addLayer",value:function(i){var o=this.layers.some(function(s){return s.id===i.id});!o&&(i.onAdd()||this.layers.push(i)),this.requestRender()}},{key:"Mr",value:function(i){var o=this.layers.findIndex(function(l){return l.id===i.id});if(o>-1){var s=this.layers.splice(o,1);s.length>=0&&(s[0].Ar(),this.requestRender())}}},{key:"requestRender",value:function(){var i=this;this.Ua=this.Fa;var o=function(){if(i.La=requestAnimationFrame(o),i.Wa=!i.Wa,!(i.Na&&i.Wa)){if(i.Ua<=0){cancelAnimationFrame(i.La),i.La=0;return}i.render(),i.Ua--}};this.Ua>0&&!this.La&&o()}},{key:"Za",value:function(){return{startTime:this.timeline,duration:performance.now()-this.timeline}}},{key:"$a",value:function(){return this.Na}}]),a}(_wrap_native_super(Event));Map$1.Clip=chito.Clip,Map$1.Animation=chito.Animation;var ViewControl$1=function(){function n(r){var a=this;_class_call_check(this,n),this.La=0,this.Bs=[],this.animateStatus="start",this.Es=Date.now(),this.Vs=[],this.map=r,this.map.animate.on("update",function(){a.Rs(),a.Fs()}),buryPoint.record("ViewControl")}return _create_class(n,[{key:"addAnimates",value:function(r,a){this.animateStatus="start",buryPoint.record("ViewControl","addAnimates");var i=r[0],o;r.length>1?o=this.addAnimates.bind(this,r.slice(1),a):r.length===1&&(o=a),this.Ls(i,o)}},{key:"removeAnimate",value:function(r){buryPoint.record("ViewControl","removeAnimate");var a=this.Bs.findIndex(function(i){return i===r});return this.Bs.splice(a,1)}},{key:"Ws",value:function(r){return buryPoint.record("ViewControl","removeAnimateByIndex"),this.Bs.splice(r,1),this.Bs}},{key:"Ns",value:function(){return this.Bs}},{key:"clearAnimates",value:function(){buryPoint.record("ViewControl","clearAnimates"),this.Bs=[],this.qs()}},{key:"pauseAnimate",value:function(){this.animateStatus="pause",this.Es=Date.now()}},{key:"resumeAnimate",value:function(){if(this.animateStatus==="pause")for(var r=Date.now()-this.Es,a=0;a<this.Bs.length;a++)this.Bs[a].startTime+=r;this.animateStatus="start"}},{key:"addTrackAnimate",value:function(r,a){this.animateStatus="start",(r||a)&&(this.animateStatus="start")}},{key:"Ys",value:function(){return{zoom:this.map.getZoom(),center:this.map.getCenter(),pitch:this.map.getPitch(),rotation:this.map.getRotation()}}},{key:"Zs",value:function(r){var a=r.zoom,i=r.center,o=r.pitch,s=r.rotation;a&&this.map.setZoom(a),i&&this.map.setCenter(i),o!==void 0&&this.map.setPitch(o),s!==void 0&&this.map.setRotation(s)}},{key:"Ls",value:function(r,a){var i=this.Ys(),o=i.zoom,s=i.pitch,l=i.center,u=i.rotation,c=Object.keys(r),f,h=-1,p;c.forEach(function(F){h<r[F].duration&&(h=r[F].duration,p=F)});for(var d in r){var v,_=r[d],m=_.value,y=_.control,g=_.duration,C=_.timing,b=(v=BezierEasing__namespace).default.apply(v,_to_consumable_array(C)),k=d==="zoom"?o:d==="pitch"?s:d==="rotation"?u:l;d==="center"&&l?f=new bezierJs.Bezier({x:l[0],y:l[1]},{x:y[0][0],y:y[0][1]},{x:y[1][0],y:y[1][1]},{x:m[0],y:m[1]}):f=new bezierJs.Bezier({x:0,y:k},{x:y[0][0],y:y[0][1]},{x:y[1][0],y:y[1][1]},{x:1,y:m});var L={type:d,$s:f,timing:b,duration:g,startTime:0,finish:p===d?a:void 0};this.Ks(L)}}},{key:"Ks",value:function(r){r.startTime=Date.now(),this.Bs.push(r)}},{key:"qs",value:function(){this.animateStatus="stop",cancelAnimationFrame(this.La),this.La=0,this.Bs=[]}},{key:"Rs",value:function(){var r=this,a=function(l){var u=r.Bs[l],c=u.timing,f=u.$s,h=u.startTime,p=u.duration,d=u.type,v=u.finish,_=o-h;_>p?(u.tf=!0,requestAnimationFrame(function(){v&&v(u)})):i.push(u);var m=Math.min(1,c(_/p)),y=f.get(m);switch(d){case"zoom":r.Zs({zoom:y.y});break;case"pitch":r.Zs({pitch:y.y});break;case"rotation":r.Zs({rotation:y.y});break;case"center":r.Zs({center:[y.x,y.y]});break}};if(this.animateStatus==="start"){for(var i=[],o=Date.now(),s=0;s<this.Bs.length;s++)a(s);this.Bs=i,i.length>0}}},{key:"Fs",value:function(){}}]),n}(),DataSource=function(){function n(r){_class_call_check(this,n),this.layers=[],this.status="unload",this.dataset=[],this.options=r,this.id=CommonUtil$1.MC()}return _create_class(n,[{key:"nf",value:function(){this.status="loaded";for(var r=0;r<this.layers.length;r++){var a=this.layers[r];a.receiveDataset(this.dataset),a.emit("loaded")}}},{key:"addLayer",value:function(r){var a=this.layers.some(function(i){return i.id===r.id});a||(this.layers.push(r),r.receiveDataset(this.dataset))}},{key:"Mr",value:function(r){var a=this.layers.findIndex(function(i){return i.id===r.id});a>-1&&this.layers.splice(a,1)}}]),n}(),__defProp$y=Object.defineProperty,__defProps$o=Object.defineProperties,__getOwnPropDescs$o=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$y=Object.getOwnPropertySymbols,__hasOwnProp$y=Object.prototype.hasOwnProperty,__propIsEnum$y=Object.prototype.propertyIsEnumerable,__defNormalProp$y=function(n,r,a){return r in n?__defProp$y(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$y=function(n,r){for(var a in r||(r={}))__hasOwnProp$y.call(r,a)&&__defNormalProp$y(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$y)try{for(var l=__getOwnPropSymbols$y(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$y.call(r,a)&&__defNormalProp$y(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},__spreadProps$o=function(n,r){return __defProps$o(n,__getOwnPropDescs$o(r))},CommonUtil=CommonUtil$1,GeoUtil={ai:function n(r){var a=[];if(r.type==="MultiPoint")for(var i=r.properties,o=r.coordinates,s=o.length,l=0;l<s;++l){var u=o[l];a.push({properties:i,type:"Point",coordinates:u})}else if(r.type==="MultiLineString")for(var c=r.properties,f=r.coordinates,h=f.length,p=0;p<h;++p){var d=f[p];a.push({properties:c,type:"Point",coordinates:d})}else if(r.type==="MultiPolygon")for(var v=r.properties,_=r.coordinates,m=_.length,y=0;y<m;++y){var g=_[y];a.push({properties:v,type:"Point",coordinates:g})}return a},hf:function n(r){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;if(r.type==="FeatureCollection"&&r.features.length>0){var o=r.features,s=this.df(o,i);return a&&s.polygons.length>0&&(s.polygons=this.vf(s.polygons)),s}return r},vf:function n(r){for(var a=[],i=0,o=r.length;i<o;i++){var s=r[i],l=__spreadProps$o(__spreadValues$y({},s),{polygons:[]});if(s.geometry.type==="MultiPolygon")for(var u=s.geometry.coordinates,c=0,f=u.length;c<f;c++){var h=u[c];l.polygons[c]=this.triangle(h)}else l.polygons[0]=this.triangle(s.geometry.coordinates);a[i]=l}return a},df:function n(r){for(var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i={points:[],lines:[],polygons:[],mf:[]},o=0,s=r.length;o<s;o++){var l=r[o].geometry,u=l.type,c="points";u==="Point"||u==="MultiPoint"?c="points":u==="LineString"||u==="MultiLineString"?c="lines":u==="Polygon"||u==="MultiPolygon"?c="polygons":c="others",i[c][i[c].length]=__spreadProps$o(__spreadValues$y({},l),{properties:r[o].properties,sr:++a})}return i},triangle:function n(r){var a=earcut__default.default.flatten(r),i=earcut__default.default(a.vertices,a.holes,a.dimensions);return{index:i,vertex:a.vertices}},mergeTriangles:function n(r,a){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,o=r.index,s=r.vertex,l=a.index,u=a.vertex,c=s.length/i,f=l.length,h=o.length;o.length+=l.length;for(var p=0;p<f;p++){var d=l[p];o[p+h]=d+c}return CommonUtil._C(s,u),{index:o,vertex:s}},isClock:function n(r){for(var a=r.length,i=0,o=0;o<a;o++){var s=r[o],l=r[(o+1)%a];i+=(l[0]-s[0])*(l[1]+s[1])}return i>0}},GeoJSONSource=function(n){_inherits(a,n);var r=_create_super(a);function a(i){_class_call_check(this,a);var o;return o=r.call(this,i),o.className="GeoJSONSource",o.type="geojson",o.url=i.url,buryPoint.record(o.className),o}return _create_class(a,[{key:"LC",value:function(){return this.load(),this.dataset}},{key:"load",value:function(){var i=this;if(!(this.status==="loaded"||this.status==="loading"))if(this.status="loading",this.options.data){var o=this.options.data;this.valid(o)&&Promise.resolve().then(function(){i.dataset=i.bf(o),i.nf()})}else{var s=this.url;fetch(s).then(function(l){return l.json()}).then(function(l){i.valid(l)&&(i.dataset=i.bf(l),i.nf())})}}},{key:"valid",value:function(i){return i||console.warn("\u65E0\u6548\u6570\u636E"),!0}},{key:"bf",value:function(i){var o=GeoUtil.hf(i,!1,0);return[{id:CommonUtil$1.MC(),features:o}]}},{key:"destroy",value:function(){this.dataset=[],this.url=""}}]),a}(DataSource),GeoBufferSource=function(n){_inherits(a,n);var r=_create_super(a);function a(i){_class_call_check(this,a);var o;return o=r.call(this,i),o.className="GeoBufferSource",o.type="geobuffer",o}return _create_class(a,[{key:"load",value:function(){var i=this;if(!(this.status==="loaded"||this.status==="loading")){this.status="loading";var o=this.options,s=o.data,l=o.url;s?this.valid(s)&&Promise.resolve().then(function(){var u=geobuf.decode(new pbf(s));i.dataset=i.bf(u),i.nf()}):fetch(l).then(function(u){return u.arrayBuffer()}).then(function(u){var c=geobuf.decode(new pbf(u));i.valid(c)&&(i.dataset=i.bf(c),i.nf())})}}},{key:"destroy",value:function(){_get(_get_prototype_of(a.prototype),"destroy",this).call(this)}}]),a}(GeoJSONSource),Context=function(){function n(){_class_call_check(this,n),this.gf()}return _create_class(n,[{key:"gf",value:function(){console.log("gl",this.gl)}},{key:"wf",value:function(){}},{key:"reset",value:function(){}}]),n}(),GeometryFusion=function n(){_class_call_check(this,n)},Projection$1=function n(){_class_call_check(this,n)},_Earth=function(n){_inherits(a,n);var r=_create_super(a);function a(){return _class_call_check(this,a),r.apply(this,arguments)}return _create_class(a,[{key:"project",value:function(i){var o=_sliced_to_array(i,3),s=o[0],l=o[1],u=o[2],c=_Earth.xf+u,f=MathUtil.PC(s),h=MathUtil.PC(l),p=c*Math.cos(h),d=p*Math.sin(f),v=c*Math.sin(h),_=p*Math.cos(f);return[d,v,_]}},{key:"unproject",value:function(i){var o=_sliced_to_array(i,3),s=o[0],l=o[1],u=o[2],c=Math.sqrt(s*s+l*l+u*u),f=Math.asin(l/c),h=c*Math.cos(f),p=Math.asin(s/h);return[p,f,c-_Earth.xf]}},{key:"getResolution",value:function(i){return 20037508342789244e-9*2/256/Math.pow(2,i)}}]),a}(Projection$1),Earth=_Earth;Earth.xf=6378137,Earth.Mf=20037508342789244e-9,Earth.kf=1496e8,Earth.Cf=363e6,Earth.Af=23.3/180*Math.PI;var _Mercator=function(n){_inherits(a,n);var r=_create_super(a);function a(){return _class_call_check(this,a),r.apply(this,arguments)}return _create_class(a,[{key:"project",value:function(i){var o=_Mercator.r,s=_Mercator.Of,l=_sliced_to_array(i,2),u=l[0],c=l[1],f=_Mercator.zf,h=c*s,p=Math.max(Math.min(f,u),-f)*s;return p=Math.log(Math.tan(Math.PI/4+p/2)),[h*o,p*o]}},{key:"unproject",value:function(i){var o=_Mercator.r,s=_Mercator._f,l=_sliced_to_array(i,2),u=l[0],c=l[1],f=u/o*s,h=(2*Math.atan(Math.exp(c/o))-Math.PI/2)*s;return[f,h,0]}},{key:"getResolution",value:function(i){return 20037508342789244e-9*2/256/Math.pow(2,i)}}]),a}(Projection$1),Mercator=_Mercator;Mercator.Of=Math.PI/180,Mercator._f=180/Math.PI,Mercator.r=6378137,Mercator.zf=85.0511287798;var ColorPick=function(){function n(){_class_call_check(this,n),this.Sf=[],this.If=[0,0,0,255],this.Pf=256}return _create_class(n,[{key:"add",value:function(r){return this.Sf[this.Tf()]=r,_to_consumable_array(this.If)}},{key:"clear",value:function(){this.If=[0,0,0,255],this.Sf={}}},{key:"getColor",value:function(){return _to_consumable_array(this.If)}},{key:"jf",value:function(r){var a=this.Pf,i=a*a,o=_sliced_to_array(r,3),s=o[0],l=o[1],u=o[2],c=s+l*a+u*i;return this.Sf[c]}},{key:"Tf",value:function(){var r=this.Pf,a=r*r,i=_sliced_to_array(this.If,3),o=i[0],s=i[1],l=i[2],u=o+s*r+l*a+1;return this.If[0]=u%r,this.If[1]=~~(u/r)%r,this.If[2]=~~(u/a)%r,u}}]),n}(),_Project=function(n){_inherits(a,n);var r=_create_super(a);function a(){return _class_call_check(this,a),r.apply(this,arguments)}return _create_class(a,[{key:"project",value:function(i){var o=[];return this.loca?(o=this.loca.customCoords.lngLatToCoord([i[0],i[1]]),o[2]=i[2]||0,o):i}},{key:"unproject",value:function(i){return i}},{key:"coordsToContainer",value:function(i){return i}},{key:"containerToCoords",value:function(i){return i}},{key:"getResolution",value:function(i){return 20037508342789244e-9*2/256/Math.pow(2,i)}}],[{key:"getProject",value:function(){return this.ui}}]),a}(Projection$1),Project=_Project;Project.ui=new _Project;var ProjectInstance=Project.getProject(),RendererManager=function(){function n(){_class_call_check(this,n),this.Cp=[]}return _create_class(n,[{key:"addRenderer",value:function(r){var a=this.Cp.findIndex(function(i){return i===r});a<0&&this.Cp.push(r)}},{key:"removeRenderer",value:function(r){var a=this.Cp.findIndex(function(i){return i===r});a>-1&&this.Cp.splice(a,1)}},{key:"destroyRenderers",value:function(){this.Cp.forEach(function(r){r.destroy()})}}]),n}(),FusionManager=function(){function n(){_class_call_check(this,n),this.Ap=[]}return _create_class(n,[{key:"addFusion",value:function(r){var a=this.Ap.findIndex(function(i){return i===r});a<0&&this.Ap.push(r)}},{key:"removeFusion",value:function(r){var a=this.Ap.findIndex(function(i){return i===r});a>-1&&this.Ap.splice(a,1)}},{key:"destroyFusions",value:function(){this.Ap.forEach(function(r){r.destroy()})}}]),n}(),__defProp$1$1=Object.defineProperty,__defProps$n=Object.defineProperties,__getOwnPropDescs$n=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1$1=Object.getOwnPropertySymbols,__hasOwnProp$1$1=Object.prototype.hasOwnProperty,__propIsEnum$1$1=Object.prototype.propertyIsEnumerable,__defNormalProp$1$1=function(n,r,a){return r in n?__defProp$1$1(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$1$1=function(n,r){for(var a in r||(r={}))__hasOwnProp$1$1.call(r,a)&&__defNormalProp$1$1(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$1$1)try{for(var l=__getOwnPropSymbols$1$1(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$1$1.call(r,a)&&__defNormalProp$1$1(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},__spreadProps$n=function(n,r){return __defProps$n(n,__getOwnPropDescs$n(r))},ViewControl=function(n){_inherits(a,n);var r=_create_super(a);function a(){_class_call_check(this,a);var i;return i=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))),i.Op={},i.zp=-1,i}return _create_class(a,[{key:"addAnimates",value:function(i,o){_get(_get_prototype_of(a.prototype),"addAnimates",this).call(this,i,o)}},{key:"addTrackAnimate",value:function(i,o){_get(_get_prototype_of(a.prototype),"addTrackAnimate",this).call(this,i,o);var s=i.path,l=i.timing,u=i.rotationSpeed,c=i.duration,f=this.Sp(s),h=f.Ip,p=f.oi,d=f.coords,v=f.Pp,_=new bezierJs.Bezier({x:0,y:0},{x:l[0][0],y:l[0][1]},{x:l[1][0],y:l[1][1]},{x:1,y:1}),m=Date.now();this.Op=__spreadProps$n(__spreadValues$1$1({$s:_,startTime:m,coords:d,Ip:h,Pp:v,oi:p},i),{Tp:this.jp(p,h,v,c,u),finish:o&&o.bind(this)})}},{key:"clearAnimates",value:function(){_get(_get_prototype_of(a.prototype),"clearAnimates",this).call(this),this.Op={}}},{key:"pauseAnimate",value:function(){this.animateStatus="pause",this.Es=Date.now()}},{key:"resumeAnimate",value:function(){var i=this.animateStatus;if(_get(_get_prototype_of(a.prototype),"resumeAnimate",this).call(this),i==="pause"){var o=Date.now()-this.Es;this.Op.startTime+=o}}},{key:"Fs",value:function(){if(this.animateStatus==="start"){var i=Date.now(),o=this.Op,s=o.timing,l=o.$s,u=o.startTime,c=o.duration,f=o.finish,h=o.Ip,p=o.Pp,d=o.path,v=o.oi,_=o.Tp;if(!(!h||!s)){var m=i-u;m>c&&(f&&f(this.Op),this.Op={});for(var y=Math.min(1,m/c),g=l.get(y),C=0,b={index:0,Bp:0},k=p*g.y,L=0;L<h.length;L++){var F=h[L];if(C+F>=k){b.index=L,b.Bp=(k-C)/F;break}C+=F}var W=b.index,j=b.Bp,Y=d[W],N=d[W+1];this.zp!=W&&this.Op.rotationSpeed>0&&this.map.map.setRotation(-v[W],!1,_[W]),this.Zs({center:[Y[0]+(N[0]-Y[0])*j,Y[1]+(N[1]-Y[1])*j]}),this.zp=W}}}},{key:"jp",value:function(i,o,s,l,u){for(var c=[],f=this.map.map.getRotation(),h=0;h<i.length;h++){var p=Math.abs(i[h]-f),d=h===0?1e3:o[h]/s*l,v=o[h]/s*l,_=p/u*1e3;c.push(Math.min(d,v,_)),f=i[h]}return c}},{key:"Sp",value:function(i){for(var o=[],s=[],l=[],u=!1,c=[0,1],f=0,h=0,p=i.length-1;h<p;h++){var d=u||ProjectInstance.project(i[h]),v=ProjectInstance.project(i[h+1]);o.push(Math.sqrt(Math.pow(d[0]-v[0],2)+Math.pow(d[1]-v[1],2)+Math.pow(d[2]-v[2],2))),f+=o[h],s.push(d);var _=[];glMatrix.vec2.normalize(_,[v[0]-d[0],v[1]-d[1]]);var m=[0,0,0];glMatrix.vec3.cross(m,[c[0],c[1],0],[_[0],_[1],0]),l.push((l[h-1]||0)+(m[2]<0?1:-1)*Math.acos(glMatrix.vec2.dot(_,c))*180/Math.PI),u=v,c=_}return{oi:l,coords:s,Ip:o,Pp:f}}}]),a}(ViewControl$1),DefaultLight=0,NewLight=1,LagacyLight=2,Light=function(){function n(r,a){_class_call_check(this,n),this.rawproperty=r,a&&(this.loca=a,this.loca.addLight(this))}return _create_class(n,[{key:"color",get:function(){return ColorUtil$1.zC(this.rawproperty.color).slice(0,3)},set:function(r){var a;this.rawproperty.color=r,(a=this.loca)==null||a.requestRender()}},{key:"intensity",get:function(){var r;return(r=this.rawproperty.intensity)!=null?r:1},set:function(r){var a;this.rawproperty.intensity=r,(a=this.loca)==null||a.requestRender()}}]),n}(),AmbientLight=function(n){_inherits(a,n);var r=_create_super(a);function a(){return _class_call_check(this,a),r.apply(this,arguments)}return _create_class(a,[{key:"eA",value:function(i){}},{key:"iA",value:function(i){i.intensity=this.intensity,i.lightColor=this.color}}]),a}(Light),DirectionalLight=function(n){_inherits(a,n);var r=_create_super(a);function a(){return _class_call_check(this,a),r.apply(this,arguments)}return _create_class(a,[{key:"target",get:function(){return this.rawproperty.target},set:function(i){var o;this.rawproperty.target=i,(o=this.loca)==null||o.requestRender()}},{key:"position",get:function(){return this.rawproperty.position},set:function(i){var o;this.rawproperty.position=i,(o=this.loca)==null||o.requestRender()}},{key:"direction",get:function(){return Array.from(glMatrix.vec3.subtract(glMatrix.vec3.create(),this.target,this.position))}},{key:"eA",value:function(i){}},{key:"iA",value:function(i){i.intensity=this.intensity,i.lightColor=this.color,i.direction=this.direction}}]),a}(Light),PointLight=function(n){_inherits(a,n);var r=_create_super(a);function a(){return _class_call_check(this,a),r.apply(this,arguments)}return _create_class(a,[{key:"position",get:function(){var i,o=(i=this.loca)==null?void 0:i.customCoords.lngLatToCoord(this.rawproperty.position);return[o[0],o[1],this.rawproperty.position[2]]},set:function(i){var o;this.rawproperty.position=i,(o=this.loca)==null||o.requestRender()}},{key:"distance",get:function(){var i;return(i=this.rawproperty.distance)!=null?i:0},set:function(i){var o;this.rawproperty.distance=i,(o=this.loca)==null||o.requestRender()}},{key:"eA",value:function(i){}},{key:"iA",value:function(i){i.intensity=this.intensity,i.lightColor=this.color,i.position=this.position,i.dist=this.distance}}]),a}(Light),Loca=function(n){_inherits(a,n);var r=_create_super(a);function a(i){_class_call_check(this,a);var o;o=r.call(this,"null",i),o.size=[0,0],o.layers=[],o.animateStatus="stop",o.rendererManager=new RendererManager,o.fusionManager=new FusionManager,o.Dp=document.createElement("div"),o.nA={},o.rA=[],o.oA=DefaultLight,o.Lp=!1,o.map=i.map,o.viewControl=new ViewControl(_assert_this_initialized(o)),o.Wp=i.Wp||[108.9398,34.3416],o.projection=ProjectInstance,o.projection.loca=_assert_this_initialized(o),o.customCoords=o.map.customCoords,o.Np=o.map.customCoords,o.Np.setCenter(o.Wp),o.Up(),o.qp();var s=o.map.getContainer();o.Dp.className="amap-loca loca-controls",s.appendChild(o.Dp),o.map&&o.buryPoint.setAPIKey(window.AMap.getConfig().key),o.buryPoint.setVersion("2.0.0"),o.buryPoint.record("Loca");var l=new AmbientLight({color:"#fff",intensity:.5}),u=new DirectionalLight({color:"rgb(255,255,255)",position:[0,-1,1],target:[0,0,0],intensity:.5}),c=new PointLight({color:"rgb(255,255,255)",position:[0,0,1e4],intensity:1,distance:0});return l.loca=u.loca=c.loca=_assert_this_initialized(o),o.nA={ambLight:l,dirLight:u,pointLight:c},o.animate.on("start",function(){return o.animateStatus="start"}),o.animate.on("pause",function(){return o.animateStatus="pause"}),o.animate.on("stop",function(){return o.animateStatus="stop"}),o}return _create_class(a,[{key:"ambLight",get:function(){return this.nA.ambLight.rawproperty},set:function(i){var o=new AmbientLight(i);o.loca=this,this.oA|=LagacyLight,this.nA.ambLight=o}},{key:"dirLight",get:function(){return this.nA.dirLight.rawproperty},set:function(i){var o=new DirectionalLight(i);o.loca=this,this.oA|=LagacyLight,this.nA.dirLight=o}},{key:"pointLight",get:function(){return this.nA.pointLight.rawproperty},set:function(i){var o=new PointLight(i);o.loca=this,this.oA|=LagacyLight,this.nA.pointLight=o}},{key:"lights",get:function(){var i=this.nA,o=i.ambLight,s=i.dirLight,l=i.pointLight;return this.oA===(NewLight|LagacyLight)?[o,s,l].concat(_to_consumable_array(this.rA)).filter(Boolean):this.oA===LagacyLight||this.oA===DefaultLight?[o,s,l].filter(Boolean):this.rA}},{key:"Up",value:function(){var i=this;if(this.map){var o=this.map.getGL&&this.map.getGL()||this.map.getContext().gl;o&&(REGL__default.default({gl:o,extensions:["OES_element_index_uint","ANGLE_instanced_arrays"],onDone:function(s,l){if(s)console.error(s);else{i.regl=l;var u=i.map.getContext();u&&u.setDirty(),i.requestRender()}}}),this.map.on("firstPaint",function(){var s=i.map.getContext();s&&s.setDirty()}))}}},{key:"requestRender",value:function(){this.map&&this.map.render()}},{key:"add",value:function(i){if(this.map){var o=this.layers.some(function(s){return s.id===i.id});o||(this.layers.push(i),i.setLoca(this),i.sA(this.lights,this),this.map.add(i.Yp))}}},{key:"remove",value:function(i){if(this.map){var o=this.layers.findIndex(function(s){return s.id===i.id});o>-1&&(this.layers.splice(o,1),this.map.remove(i.Yp),i.Ar(),i.setLoca(null))}}},{key:"clear",value:function(){if(this.map){var i=!0,o=!1,s=void 0;try{for(var l=this.layers[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var c=u.value;this.map.remove(c.Yp),c.Ar(),c.setLoca(null)}}catch(f){o=!0,s=f}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}this.layers.splice(0,this.layers.length)}}},{key:"getControlContainer",value:function(){return this.Dp}},{key:"getCenter",value:function(){return this.map.getCenter().toArray()}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getRotation()}},{key:"setRotation",value:function(i){this.map.setRotation(i,!0)}},{key:"setZoom",value:function(i){this.map.setZoom(i,!0)}},{key:"setCenter",value:function(i){this.map.setCenter(i,!0)}},{key:"setPitch",value:function(i){this.map.setPitch(i,!0)}},{key:"getLights",value:function(){var i=this.ambLight,o=i.intensity,s=i.color,l=this.dirLight,u=l.intensity,c=l.color,f=l.target,h=l.position,p=[f[0]-h[0],f[1]-h[1],f[2]-h[2]],d=this.pointLight,v=d.intensity,_=d.color,m=d.position,y=d.distance,g=this.customCoords.lngLatToCoord(m);return{ambIntensity:o,ambLightColor:ColorUtil$1.zC(s).slice(0,3),dirIntensity:u,dirLightColor:ColorUtil$1.zC(c).slice(0,3),dirVec:_to_consumable_array(p),pointIntensity:v,pointLightColor:ColorUtil$1.zC(_).slice(0,3),pointPosition:[g[0],g[1],m[2]],aA:y}}},{key:"addLight",value:function(i){i.loca||(i.loca=this),this.rA.includes(i)||this.rA.push(i),this.oA|=NewLight;var o=!0,s=!1,l=void 0;try{for(var u=this.layers[Symbol.iterator](),c;!(o=(c=u.next()).done);o=!0){var f=c.value;f.sA(this.lights,this)}}catch(h){s=!0,l=h}finally{try{!o&&u.return!=null&&u.return()}finally{if(s)throw l}}this.requestRender()}},{key:"removeLight",value:function(i){var o=this.rA.indexOf(i);if(!(o<0)){this.rA.splice(o,1),this.rA.length||(this.oA^=NewLight);var s=!0,l=!1,u=void 0;try{for(var c=this.layers[Symbol.iterator](),f;!(s=(f=c.next()).done);s=!0){var h=f.value;h.sA(this.lights,this)}}catch(p){l=!0,u=p}finally{try{!s&&c.return!=null&&c.return()}finally{if(l)throw u}}this.requestRender()}}},{key:"clearLight",value:function(){this.rA=[],this.nA={};var i=!0,o=!1,s=void 0;try{for(var l=this.layers[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var c=u.value;c.sA(this.lights,this)}}catch(f){o=!0,s=f}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}this.oA=DefaultLight,this.requestRender()}},{key:"destroy",value:function(){this.animate.stop(),this.fusionManager.destroyFusions();for(var i=0;this.layers.length>0;i=0){var o=this.layers[i];o.destroy()}this.regl.destroy(),this.animate.destroy();var s=this.map.getContainer();s&&s.removeChild(this.Dp),this.map=null,this.animate=null}},{key:"qp",value:function(){var i=this;this.animate.on("update",function(){i.requestRender()})}}]),a}(Map$1),Animation$1=Loca.Animation,Clip=Loca.Clip,legendColor={title:{label:"\u56FE\u4F8B",fontColor:"#fff",fontSize:"20px",fontWeight:"bold",padding:"0 0 5px 0",margin:0},style:{backgroundColor:"rgba(0,0,0,0.7)",fontSize:"14px",size:"16px",fontColor:"#fff",borderRadius:0,position:"absolute",padding:"10px 15px"},dataMap:[{label:"\u7B2C\u4E00\u4E2A",color:"#feedde"},{label:"\u7B2C\u4E8C\u4E2A",color:"#fdbe85"},{label:"\u7B2C\u4E09\u4E2A",color:"#fd8d3c"},{label:"\u7B2C\u56DB\u4E2A",color:"#e6550d"},{label:"\u7B2C\u4E94\u4E2A",color:"#a63603"}]},Legend=function(){function n(r){_class_call_check(this,n),this.$p=null,this.Kp={},this.tm={},this.$p=r.loca,this.nm=this.$p&&this.$p.getControlContainer(),this.lr=document.createElement("div"),this.im=r.dataMap||legendColor.dataMap,this.setStyle(r),this.addTo(this.$p),buryPoint.record("Legend")}return _create_class(n,[{key:"om",value:function(){var r=this,a,i,o=document.createElement("h5");o.innerHTML=this.tm.label,o.style.cssText="color: ".concat(this.tm.fontColor,";font-size: ").concat(this.tm.fontSize,";text-align: ").concat(this.tm.textAlign,";font-weight: ").concat(this.tm.fontWeight,";padding: ").concat(this.tm.padding,";margin: ").concat(this.tm.margin,";");var s=document.createElement("ul");s.style.cssText="margin: 0; padding: 0; list-style: none;";var l="";this.im.forEach(function(u){l+='\n                <li style="height: '.concat(r.Kp.size,'; box-sizing: content-box; padding: 2px 0;" ><span style="background-color: ').concat(u.color,"; float:left; width: ").concat(r.Kp.size,"; height: ").concat(r.Kp.size,';"></span><a style="float:left; height: ').concat(r.Kp.size,"; line-height: ").concat(r.Kp.size,"; text-align: left; padding-left: 10px; font-size: ").concat(r.Kp.fontSize,"; color: ").concat(r.Kp.fontColor,';">').concat(u.label,"</a></li>\n            ")}),s.innerHTML=l,this.lr.innerHTML="",(a=this.lr)==null||a.appendChild(o),(i=this.lr)==null||i.appendChild(s)}},{key:"setStyle",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{style:{},title:{}},a,i,o,s,l,u,c,f,h=legendColor.style,p=r.style||{};this.Kp.backgroundColor=p.backgroundColor||this.Kp.backgroundColor||h.backgroundColor,this.Kp.borderRadius=p.borderRadius||this.Kp.borderRadius||h.borderRadius,this.Kp.fontColor=p.fontColor||this.Kp.fontColor||h.fontColor,this.Kp.fontSize=p.fontSize||this.Kp.fontSize||h.fontSize,this.Kp.size=p.size||this.Kp.size||h.size,this.Kp.position=p.position||this.Kp.position||h.position,this.Kp.padding=p.padding||this.Kp.padding||h.padding,this.Kp.bottom=p.bottom||"",this.Kp.right=p.right||"",this.Kp.left=p.left||"",this.Kp.top=p.top||"";var d=legendColor.title,v=r.title||{};this.tm.label=v.label||this.tm.label||d.label,this.tm.fontColor=v.fontColor||this.tm.fontColor||d.fontColor,this.tm.fontSize=v.fontSize||this.tm.fontSize||d.fontSize,this.tm.fontWeight=v.fontWeight||this.tm.fontWeight||d.fontWeight,this.tm.padding=v.padding||this.tm.padding||d.padding,this.tm.margin=v.margin||this.tm.margin||d.margin,(a=this.lr)==null||a.style.setProperty("background-color",this.Kp.backgroundColor),(i=this.lr)==null||i.style.setProperty("border-radius",this.Kp.borderRadius),(o=this.lr)==null||o.style.setProperty("position",this.Kp.position),(s=this.lr)==null||s.style.setProperty("padding",this.Kp.padding),(l=this.lr)==null||l.style.setProperty("bottom",this.Kp.bottom),(u=this.lr)==null||u.style.setProperty("right",this.Kp.right),(c=this.lr)==null||c.style.setProperty("left",this.Kp.left),(f=this.lr)==null||f.style.setProperty("top",this.Kp.top),this.om()}},{key:"addTo",value:function(r){var a;!r||(this.$p=r,this.nm=r.getControlContainer(),this.lr&&((a=this.nm)==null||a.appendChild(this.lr)))}},{key:"remove",value:function(){var r;this.lr&&((r=this.nm)==null||r.removeChild(this.lr)),this.nm=null,this.$p=null}}]),n}(),RenderUtil={getMipMap:function n(r,a){var i={mipmap:"nice",min:"nearest mipmap linear",mag:"linear",wrapS:"repeat",wrapT:"repeat"},o=Math.log2(r),s=Math.log2(a);return o===~~o&&s===~~s?i:{min:"linear",mag:"linear"}},getBlend:function n(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"normal",a={normal:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"},lighter:{srcRGB:1,srcAlpha:1,dstRGB:1,dstAlpha:1},darker:{srcRGB:"dst color",srcAlpha:1,dstRGB:"dst color",dstAlpha:1},zero:{srcRGB:0,srcAlpha:0,dstRGB:0,dstAlpha:0}};return a[r]},getBezier:function n(){var r="\n            // \u4E8C\u6B21\n            float QuadraticIn (float k) {\n                return pow(k, 2.);\n            }\n            float QuadraticOut (float k) {\n                return k * (2.0 - k);\n            }\n            float QuadraticInOut (float k) {\n                if ((k *= 2.0) < 1.0) {\n                    return 0.5 * k * k;\n                }\n                return -0.5 * (--k * (k - 2.0) - 1.0);\n            }\n\n            // \u4E09\u6B21\n            float CubicIn (float k) {\n                return pow(k, 3.);\n            }\n            float CubicOut (float k) {\n                return pow(--k, 3.) + 1.0;\n            }\n            float CubicInOut (float k) {\n                if ((k *= 2.0) < 1.0) {\n                    return 0.5 * pow(k, 3.);\n                }\n                return 0.5 * ((k -= 2.0) * k * k + 2.0);\n            }\n\n            // \u56DB\u6B21\n            float QuarticIn (float k) {\n                return pow(k, 4.);\n            }\n            float QuarticOut (float k) {\n                return 1.0 - (pow(--k, 4.));\n            }\n            float QuarticInOut (float k) {\n                if ((k *= 2.0) < 1.0) {\n                    return 0.5 * pow(k, 4.);\n                }\n                return 0.5 * ((k -= 2.0) * pow(k, 3.) + 2.0);\n            }\n\n            // \u4E94\u6B21\n            float QuinticIn (float k) {\n                return pow(k, 5.);\n            }\n            float QuinticOut (float k) {\n                return 1.0 - (pow(--k, 5.));\n            }\n            float QuinticInOut (float k) {\n                if ((k *= 2.0) < 1.0) {\n                    return 0.5 * pow(k, 5.);\n                }\n                return 0.5 * ((k -= 2.0) * pow(k, 4.) + 2.0);\n            }\n\n            // \u516D\u6B21\n            float SinusoidalIn (float k) {\n                float pi = 3.14159265;\n                return 1.0 - cos(k * pi / 2.0);\n            }\n            float SinusoidalOut (float k) {\n                float pi = 3.14159265;\n                return sin(k * pi / 2.0);\n            }\n            float SinusoidalInOut (float k) {\n                float pi = 3.14159265;\n                return 0.5 * (1.0 - cos(pi * k));\n            }\n\n            // \u4E03\u6B21\n            float ExponentialIn (float k) {\n                return k == 0.0 ? 0.0 : pow(1024.0, k - 1.0);\n            }\n            float ExponentialOut (float k) {\n                return k == 1.0 ? 1.0 : 1.0 - pow(2.0, -10.0 * k);\n            }\n            float ExponentialInOut (float k) {\n                // if (k == 0.0) {\n                //     return 0.0;\n                // }\n                // if (k == 1.0) {\n                //     return 1.0;\n                // }\n                if ((k *= 2.0) < 1.0) {\n                    return 0.5 * pow(1024.0, k - 1.0);\n                }\n                return 0.5 * (-pow(2.0, -10.0 * (k - 1.0)) + 2.0);\n            }\n\n            // \u516B\u6B21\n            float CircularIn (float k) {\n                return 1.0 - sqrt(1.0 - k * k);\n            }\n            float CircularOut (float k) {\n                return sqrt(1.0 - (--k * k));\n            }\n            float CircularInOut (float k) {\n                if ((k *= 2.0) < 1.0) {\n                    return -0.5 * (sqrt(1.0 - k * k) - 1.0);\n                }\n                return 0.5 * (sqrt(1.0 - (k -= 2.0) * k) + 1.0);\n            }\n\n            // \u4E5D\u6B21\n            float ElasticIn (float k) {\n                float pi = 3.14159265;\n                float s;\n                float a = 0.1;\n                float p = 0.4;\n                // if (k == 0.0) {\n                //     return 0.0;\n                // }\n                // if (k == 1.0) {\n                //     return 1.0;\n                // }\n                if (a < 1.0) {\n                    a = 1.0;\n                    s = p / 4.0;\n                } else {\n                    s = p * asin(1.0 / a) / (2.0 * pi);\n                }\n                // return pow(2.0, 10.0 * (k -= 1.0));\n                return -(a * pow(2.0, 10.0 * (k -= 1.0)) * sin((k - s) * (2.0 * pi) / p));\n            }\n            float ElasticOut (float k) {\n                float pi = 3.14159265;\n                float s;\n                float a = 0.1;\n                float p = 0.4;\n                // if (k == 0.0) {\n                //     return 0.0;\n                // }\n                // if (k == 1.0) {\n                //     return 1.0;\n                // }\n                if (a < 1.0) {\n                    a = 1.0;\n                    s = p / 4.0;\n                } else {\n                    s = p * asin(1.0 / a) / (2.0 * pi);\n                }\n                return (a * pow(2.0, -10.0 * k) * sin((k - s) * (2.0 * pi) / p) + 1.0);\n            }\n            float ElasticInOut (float k) {\n                float pi = 3.14159265;\n                float s;\n                float a = 0.1;\n                float p = 0.4;\n                // if (k == 0.0) {\n                //     return 0.0;\n                // }\n                // if (k == 1.0) {\n                //     return 1.0;\n                // }\n                if (a < 1.0) {\n                    a = 1.0;\n                    s = p / 4.0;\n                } else {\n                    s = p * asin(1.0 / a) / (2.0 * pi);\n                }\n                if ((k *= 2.0) < 1.0) {\n                    return -0.5 * (a * pow(2.0, 10.0 * (k -= 1.0)) * sin((k - s) * (2.0 * pi) / p));\n                }\n                return a * pow(2.0, -10.0 * (k -= 1.0)) * sin((k - s) * (2.0 * pi) / p) * 0.5 + 1.0;\n            }\n\n            // \u56DE\u5F39\n            float BackIn (float k) {\n                float s = 1.70158;\n                return pow(k, 2.) * ((s + 1.0) * k - s);\n            }\n            float BackOut (float k) {\n                float s = 1.70158;\n                return pow(--k, 2.) * ((s + 1.0) * k + s) + 1.0;\n            }\n            float BackInOut (float k) {\n                float s = 1.70158 * 1.525;\n                if ((k *= 2.0) < 1.0) {\n                    return 0.5 * (pow(k, 2.) * ((s + 1.0) * k - s));\n                }\n                return 0.5 * ((k -= 2.0) * k * ((s + 1.0) * k + s) + 2.0);\n            }\n\n            // \u53CD\u590D\u6A2A\u8DF3\n            float BounceOut (float k) {\n                if (k < (1.0 / 2.75)) {\n                    return 7.5625 * k * k;\n                } else if (k < (2.0 / 2.75)) {\n                    return 7.5625 * (k -= (1.5 / 2.75)) * k + 0.75;\n                } else if (k < (2.5 / 2.75)) {\n                    return 7.5625 * (k -= (2.25 / 2.75)) * k + 0.9375;\n                } else {\n                    return 7.5625 * (k -= (2.625 / 2.75)) * k + 0.984375;\n                }\n            }\n            float BounceIn (float k) {\n                return 1.0 - BounceOut(1.0 - k);\n            }\n            float BounceInOut (float k) {\n                if (k < 0.5) {\n                    return BounceIn(k * 2.0) * 0.5;\n                }\n                return BounceOut(k * 2.0 - 1.0) * 0.5 + 0.5;\n            }\n            float getBezier(int type, float delayTime, float transformTime, float timer) {\n                if(type == 0) {\n                    return QuadraticIn(timer);\n                } else if(type == 1) {\n                    return QuadraticOut(timer);\n                } else if(type == 2) {\n                    return QuadraticInOut(timer);\n                } else if(type == 3) {\n                    return CubicIn(timer);\n                } else if(type == 4) {\n                    return CubicOut(timer);\n                } else if(type == 5) {\n                    return CubicInOut(timer);\n                } else if(type == 6) {\n                    return QuarticIn(timer);\n                } else if(type == 7) {\n                    return QuarticOut(timer);\n                } else if(type == 8) {\n                    return QuarticInOut(timer);\n                } else if(type == 9) {\n                    return QuinticIn(timer);\n                } else if(type == 10) {\n                    return QuinticOut(timer);\n                } else if(type == 11) {\n                    return QuinticInOut(timer);\n                } else if(type == 12) {\n                    return SinusoidalIn(timer);\n                } else if(type == 13) {\n                    return SinusoidalOut(timer);\n                } else if(type == 14) {\n                    return SinusoidalInOut(timer);\n                } else if(type == 15) {\n                    return ExponentialIn(timer);\n                } else if(type == 16) {\n                    return ExponentialOut(timer);\n                } else if(type == 17) {\n                    return ExponentialInOut(timer);\n                } else if(type == 18) {\n                    return CircularIn(timer);\n                } else if(type == 19) {\n                    return CircularOut(timer);\n                } else if(type == 20) {\n                    return CircularInOut(timer);\n                } else if(type == 21) {\n                    return ElasticIn(timer);\n                } else if(type == 22) {\n                    return ElasticOut(timer);\n                } else if(type == 23) {\n                    return ElasticInOut(timer);\n                } else if(type == 24) {\n                    return BackIn(timer);\n                } else if(type == 25) {\n                    return BackOut(timer);\n                } else if(type == 26) {\n                    return BackInOut(timer);\n                } else if(type == 27) {\n                    return BounceIn(timer);\n                } else if(type == 28) {\n                    return BounceOut(timer);\n                } else if(type == 29) {\n                    return BounceInOut(timer);\n                } else {\n                    return timer;\n                }\n            }";return r.replace(/\/\/.*\n/g,"").replace(/\s\s+/g,"")},getScaleType:function n(r){return"\n            uniform vec4 ".concat(r,"Time; // time/delay/trasform/random\n            uniform vec4 ").concat(r,"Type; // type/repeat/yoyo/duration\n            uniform vec2 ").concat(r,"Value; // start/end\n            float ").concat(r,"ScaleValue(float sule) {\n                bool isYoyoDuration = ").concat(r,"Type.z == 1.0 && mod(ceil(").concat(r,"Time.x / ").concat(r,"Type.w), 2.0) == 0.0;\n                bool isYoyoLast = mod(").concat(r,"Type.y, 2.0) == 0.0 && ").concat(r,"Type.z == 1.0;\n                float timer = 0.0;\n                float vs = ").concat(r,"Value.x;\n                float ve = ").concat(r,"Value.y;\n                if(").concat(r,"Time.w == 0.0) {\n                    timer = fract(").concat(r,"Time.x / ").concat(r,"Type.w);\n                    // \u6700\u540E\u4E00\u8F6E,\u7ED3\u675F\n                    if(").concat(r,"Time.x >= ").concat(r,"Type.y * ").concat(r,"Type.w) {\n                        if(isYoyoLast) {\n                            return 0.0;\n                        }\n                        return 1.0;\n                    }\n                    if(isYoyoDuration) {\n                        timer = 1.0 - timer;\n                    }\n                    float t = getBezier(int(").concat(r,"Type.x), 0.0, ").concat(r,"Type.w, timer);\n                    return t * (ve - vs) + vs;\n                }\n\n                float randomDelay = (sin(length(sule)) + 1.0) / 2.0 * ").concat(r,"Time.y;\n                timer = (").concat(r,"Time.x - randomDelay) / ").concat(r,"Time.z;\n                // \u7B2C\u4E00\u8F6E\n                if(timer < 0.0) {\n                    return 0.0;\n                } else if(").concat(r,"Time.x >= randomDelay + ").concat(r,"Type.y * ").concat(r,"Time.z) {\n                    // \u6700\u540E\u4E00\u8F6E,\u7ED3\u675F\n                    if(isYoyoLast) {\n                        return 0.0;\n                    }\n                    return 1.0;\n                } else {\n                    if(").concat(r,"Type.z == 1.0 && mod(ceil(timer), 2.0) == 0.0) {\n                        timer = 1.0 - fract(timer);\n                    } else {\n                        timer = fract(timer);\n                    }\n                    float t = getBezier(int(").concat(r,"Type.x), ").concat(r,"Time.y, ").concat(r,"Time.z, timer);\n                    return t * (ve - vs) + vs;\n                }\n            }\n        ").replace(/\/\/.*\n/g,"").replace(/\s\s+/g,"")},getScaleUniform:function n(r,a){var i;return i={},_define_property(i,r+"Time",a.prop(r+"Time")),_define_property(i,r+"Type",a.prop(r+"Type")),_define_property(i,r+"Value",a.prop(r+"Value")),i},getScaleProps:function n(r,a){var i={};if(a){var o=r[a];return i[a+"Time"]=o.time,i[a+"Type"]=o.type,i[a+"Value"]=o.value,i}for(var s in r){var l=r[s];i[s+"Time"]=l.time,i[s+"Type"]=l.type,i[s+"Value"]=l.value}return i}},NotDirty=0,LightDirty=1,AttributesDirty=2,LabelsDirty=4,MeshDirty=AttributesDirty|LabelsDirty,MeshesDirty=8,Defines=function(){function n(){_class_call_check(this,n),this.state=NotDirty}return _create_class(n,[{key:"isDirty",get:function(){return this.state!==NotDirty}}]),n}(),Shader=function(){function n(r){_class_call_check(this,n);var a=r.vertex,i=r.fragment,o=r.includes;this.uA=a,this.fA=i,this.includes=o||{}}return _create_class(n,[{key:"process",value:function(r){return(!(this.lA&&this.cA)||r.isDirty)&&(this.lA=this.hA(r,this.uA),this.cA=this.hA(r,this.fA)),{vertex:this.lA,fragment:this.cA}}},{key:"hA",value:function(r,a){var i=this,o=a;do o=a.replace(/#include <(.*?)>.*?\n/g,function(l,u){var c=u.split(",").map(function(f){return f.trim()}).filter(Boolean);return c.reduce(function(f,h){if(i.includes[h])return f+i.includes[h]+"\n";throw new Error("include not found: "+h)},"")});while(o.includes("#include"));var s=Object.keys(r).reduce(function(l,u){return r[u]?l+"#define ".concat(u," ").concat(r[u],"\n"):l},"");return s+"\n"+o}}]),n}(),Layer=function(n){_inherits(a,n);var r=_create_super(a);function a(i){_class_call_check(this,a);var o;return o=r.call(this,i),o.id=CommonUtil$1.MC(),o.Yp=[],o.styleOptions={},o.vA=new Defines,o.lights=new Array,o.dA=!1,o.customCenter=[108.9398,34.3416],o.colorPick=new ColorPick,o._needPickFrame=!1,o._pickPos=null,o.um={},o.sm=new Loca.Animation,o.sP=0,o.fm=1,o._animateLayerState=o.getInitialAnimateState(),o.q$=!1,o.customCenter=i.customCenter||o.customCenter,o.dA=i.acceptLight||!1,o.loca=i.loca,o.loca&&(o.map=i.loca.map,o.onAdd()),o.projection=ProjectInstance,o.vA.ACCEPT_LIGHT=o.dA,o.sm.addClip(new Loca.Clip({duration:1e4,repeat:1/0}),{x:[0,1]}),o.sm.start(),o}return _create_class(a,[{key:"acceptLight",get:function(){return this.dA},set:function(i){var o;i!==this.dA&&(this.vA.state|=LightDirty),this.vA.ACCEPT_LIGHT=i,this.dA=i,(o=this.loca)==null||o.requestRender()}},{key:"getInitialAnimateState",value:function(){return{}}},{key:"onAdd",value:function(){var i;_get(_get_prototype_of(a.prototype),"onAdd",this).call(this),this.map&&this.loca&&(this.loca.add(this),this.loca.requestRender(),(i=this.ll)==null||i.p$(this))}},{key:"sA",value:function(i,o){this.vA.HAS_LIGHTS=i.length>0,this.vA.state|=LightDirty}},{key:"setLoca",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,o=this.loca;this.loca=i,this.map=i?i==null?void 0:i.map:null,this.onAdd(),o&&o.requestRender()}},{key:"AC",value:function(i){var o=this;if(window.AMap){var s=new window.AMap.GLCustomLayer({zIndex:i.zIndex,visible:i.visible,zooms:i.zooms,render:function(){var l=o.render();l&&!o.q$&&(o.q$=!0,o.emit("complete"))}});s.beforeRender=this.beforeRender.bind(this),s.afterRender=this.afterRender.bind(this),this.Yp.push(s),this.map&&this.map.add(s)}}},{key:"getLayerOptions",value:function(){return{opacity:this.opacity,zooms:this.zooms,visible:this.visible,zIndex:this.zIndex}}},{key:"setOpacity",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1;this.opacity=i;var o=this.getLabelsLayer();o&&o.setOpacity(i),this.loca&&this.loca.requestRender()}},{key:"setzIndex",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:10;this.zIndex=i,this.Yp.forEach(function(s){s.setzIndex(i)});var o=this.getLabelsLayer();o&&o.setzIndex(i),this.loca&&this.loca.requestRender()}},{key:"setZooms",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[2,20];this.zooms=i,this.Yp.forEach(function(s){s.setZooms(i)});var o=this.getLabelsLayer();o&&o.setZooms(i),this.loca&&this.loca.requestRender()}},{key:"show",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,o=arguments.length>1?arguments[1]:void 0,s=this,l;if((l=this.ll)==null||l.O$(this),this.visible=!0,this.Yp.forEach(function(c){c.show()}),i<=0){this.fm=1,this.loca&&this.loca.requestRender();return}this.fm=0;var u=new Loca.Clip({duration:i},{opacity:[0,1]});this.sm.addClip(u),u.on("update",function(c){s.fm=c.keyframe.opacity,s.loca&&s.loca.requestRender()}),u.on("complete",function(){s.sm.removeClip(u),requestAnimationFrame(function(){o&&o.call(s)})}),this.sm.start()}},{key:"hide",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,o=arguments.length>1?arguments[1]:void 0,s=this,l;if((l=this.ll)==null||l.k$(this),i<=0){this.visible=!1,this.fm=0,this.Yp.forEach(function(c){c.hide()}),this.loca&&this.loca.requestRender();return}this.fm=1;var u=new Loca.Clip({duration:i},{opacity:[1,0]});this.sm.addClip(u),u.on("update",function(c){s.fm=c.keyframe.opacity,s.loca&&s.loca.requestRender()}),u.on("complete",function(){s.visible=!1,s.Yp.forEach(function(c){c.hide()}),s.sm.removeClip(u),requestAnimationFrame(function(){o&&o.call(s)})}),this.sm.start()}},{key:"setCustomCenter",value:function(i){this.customCenter=i,this.loca&&this.loca.requestRender()}},{key:"beforeRender",value:function(){if(!(!this.loca||!this.loca.regl)){var i=this.loca.regl;this.aP(i),this.loca.customCoords.setCenter(this.customCenter)}}},{key:"remove",value:function(){var i;this.map&&this.loca&&((i=this.loca)==null||i.remove(this),this.loca=null,this.map=null)}},{key:"destroy",value:function(){var i;(i=this.ll)==null||i.destroy(),this.remove(),this.sm.destroy(),this.styleOptions=null,this.fusion=null,this.ll=null,this.dataset=[],this.meshes=[],this.source=null}},{key:"queryFeature",value:function(i){var o,s,l;if(buryPoint.record(this.CLASS_NAME,"queryFeature"),!!this.dm()&&(this._needPickFrame=!0,!(!this._pickFbo||!i))){this._pickPos=i;var u=(o=this.loca)==null?void 0:o.regl,c=this.pickRender(),f=u._gl,h=f.drawingBufferHeight/f.canvas.clientHeight,p=i[0]*h,d=f.drawingBufferHeight-i[1]*h,v=new Uint8Array(4);f.bindFramebuffer(f.FRAMEBUFFER,this._pickFbo._framebuffer.framebuffer),f.readPixels(p,d,1,1,f.RGBA,f.UNSIGNED_BYTE,v);var _=typeof c=="function"?c(v):this.colorPick.jf([v[0],v[1],v[2],v[3]]);return f.bindFramebuffer(f.FRAMEBUFFER,null),this._needPickFrame=!1,this._pickPos=null,(s=this.loca)!=null&&s.map.getContext()&&((l=this.loca)==null||l.map.getContext().setDirty()),_}}},{key:"addAnimate",value:function(i,o){var s=this;buryPoint.record(this.CLASS_NAME,"addAnimate");var l=0,u={Linear:-1,QuadraticIn:l,QuadraticOut:++l,QuadraticInOut:++l,CubicIn:++l,CubicOut:++l,CubicInOut:++l,QuarticIn:++l,QuarticOut:++l,QuarticInOut:++l,QuinticIn:++l,QuinticOut:++l,QuinticInOut:++l,SinusoidalIn:++l,SinusoidalOut:++l,SinusoidalInOut:++l,ExponentialIn:++l,ExponentialOut:++l,ExponentialInOut:++l,CircularIn:++l,CircularOut:++l,CircularInOut:++l,ElasticIn:++l,ElasticOut:++l,ElasticInOut:++l,BackIn:++l,BackOut:++l,BackInOut:++l,BounceIn:++l,BounceOut:++l,BounceInOut:++l},c=Date.now(),f=c;i.random=i.random===void 0?!1:!!i.random,i.repeat=i.repeat===void 0?1:i.repeat;var h=new Loca.Clip({duration:i.random?i.transform:i.duration,easing:i.easing,repeat:i.repeat,startAt:i.startAt,yoyo:i.yoyo},_define_property({},i.key,i.value));this.sm.addClip(h),h.on("update",function(){c=Date.now()-f,s._animateLayerState[i.key]={time:[c,i.delay,i.transform,+i.random],type:[u[i.easing],+i.repeat,+i.yoyo,+i.duration],value:i.value},s.loca&&s.loca.requestRender()}),h.on("complete",function(){if(i.random&&i.delay>0){var p=new Loca.Clip({duration:i.delay},{delayTime:[0,1]});s.sm.addClip(p),p.on("update",function(){c=Date.now()-f,s._animateLayerState[i.key]={time:[c,i.delay,i.transform,+i.random],type:[u[i.easing],+i.repeat,+i.yoyo,+i.duration],value:i.value},s.loca&&s.loca.requestRender()}),p.on("complete",function(){c=0,s.sm.removeClip(p),o&&o.call(s)})}else c=0,s.sm.removeClip(h),o&&o.call(s)}),this.sm.start()}},{key:"clearAnimate",value:function(){buryPoint.record(this.CLASS_NAME,"clearAnimate"),this._animateLayerState=this.getInitialAnimateState(),this.sm.reset(),this.sm.removeClip(),this.loca&&this.loca.requestRender()}},{key:"jC",value:function(){if(!(!this.loca||!this.loca.regl||this._pickFbo)){var i=this.loca.regl;this._pickFbo=i.framebuffer({width:~~i._gl.canvas.width,height:~~i._gl.canvas.height,stencil:!1,depth:!1,Zh:!1})}}},{key:"gm",value:function(i,o){var s;if(!(!this.map&&this.loca)&&(o=o||this.um.size,i=i||this.um.center,!(!o||!i))){var l=(s=this.loca)==null?void 0:s.regl._gl,u=this.map.getCenter().toArray(),c=l.canvas.width,f=l.canvas.height;this.um={center:u,size:[c,f]},l.canvas.width=o[0]*window.devicePixelRatio,l.canvas.height=o[1]*window.devicePixelRatio,l.canvas.style.width=o[0]+"px",l.canvas.style.height=o[1]+"px",l.viewport(0,0,l.canvas.width,l.canvas.height),this.map.updateView({size:o,center:i},!1)}}},{key:"getLabelsLayer",value:function(){return null}},{key:"_getOpacity",value:function(){return this.fm*this.opacity}},{key:"dm",value:function(){var i;if(!this.loca||!this.visible||this.opacity<=0)return!1;var o=(i=this.loca)==null?void 0:i.getZoom();return!(o<this.zooms[0]||o>this.zooms[1])}},{key:"aP",value:function(i,o){if(this._pickFbo){var s=i._gl,l=s.canvas;(o||this._pickFbo.width!==l.width||this._pickFbo.height!==l.height)&&this._pickFbo({width:~~l.width,height:~~l.height})}}},{key:"uP",value:function(i){if(i)for(var o=0,s=i.length;o<s;o++){var l=i[o];if(l.attributes)for(var u in l.attributes){var c=l.attributes[u];c.destroy&&c.destroy(),c.buffer&&c.buffer.destroy()}}}},{key:"hP",value:function(){var i;return this.sP>=1<<30&&(this.sP=0),((i=this.loca)==null?void 0:i.animateStatus)==="start"&&this.sP++,this.sP}}]),a}(Layer$1),ColorGLSL={getColor:function n(r){return{uniform:{isPick:r.prop("isPick")},attribute:{pickColor:r.prop("pickColor")}}},getColorShader:function n(){return{vertex:"\n                uniform bool isPick;\n                attribute vec4 pickColor;\n                varying vec4 vPickColor;\n            ",fragment:"\n                uniform bool isPick;\n                varying vec4 vPickColor;\n            ",mainVert:"\n                vPickColor = pickColor;\n            ",mainFrag:"\n                if(isPick) {\n                    gl_FragColor = vec4(vPickColor.xyzw / 255.0);\n                }\n            "}}},LightGLSL={getLights:function n(r){return{acceptLight:r.prop("acceptLight"),ambIntensity:r.prop("ambIntensity"),ambLightColor:r.prop("ambLightColor"),dirIntensity:r.prop("dirIntensity"),dirLightColor:r.prop("dirLightColor"),dirVec:r.prop("dirVec"),pointIntensity:r.prop("pointIntensity"),pointLightColor:r.prop("pointLightColor"),pointPosition:r.prop("pointPosition"),pointDistence:r.prop("pointDistence"),cameraPosition:r.prop("cameraPosition"),shininess:r.prop("shininess")}},NC:function n(){return"\n            uniform bool acceptLight;\n            uniform float ambIntensity;\n            uniform vec3 ambLightColor;\n\n            uniform float dirIntensity;\n            uniform vec3 dirLightColor;\n            uniform vec3 dirVec;\n\n            uniform float pointIntensity;\n            uniform float pointDistence;\n            uniform vec3 pointLightColor;\n            uniform vec3 pointPosition;\n            uniform vec3 cameraPosition;\n            uniform float shininess;\n\n            struct DiffHighLight {\n                vec3 diffuse;\n                vec3 hightLight;\n            };\n\n            // \u73AF\u5883\u53CD\u5C04\n            vec3 ambient() {\n                return ambLightColor * ambIntensity;\n            }\n\n            // \u6F2B\u53CD\u5C04\n            vec3 diffuse(\n                vec3 normal,\n                vec3 lightDir,\n                vec3 lightColor,\n                float lightIntensity,\n                float weaken\n            ) {\n                vec3 nNormal = normalize(normal);\n                //\u8BA1\u7B97\u5149\u7EBF\u65B9\u5411\u548C\u6CD5\u5411\u91CF\u7684\u70B9\u79EF\n                float nDotL = max(dot(normalize(lightDir), nNormal), 0.0);\n                //\u8BA1\u7B97\u6F2B\u53CD\u5C04\u5149\u7684\u989C\u8272\n                return lightColor * nDotL * lightIntensity * weaken;\n            }\n\n            // \u955C\u9762\u53CD\u5C04\n            vec3 reflectLight(\n                vec3 cameraPosition,\n                vec3 lightDir,\n                vec3 position,\n                vec3 normal,\n                vec3 lightColor,\n                float shininess,\n                float lightIntensity,\n                float weaken\n            ) {\n                float specularLightWeighting = 0.0;\n                // vec3 lightDir = normalize(lightPosition - position);\n                vec3 cameraDirection = normalize(cameraPosition - position);\n                vec3 reflectionDirection = reflect(-lightDir, normal);\n                specularLightWeighting = pow(max(dot(reflectionDirection, cameraDirection), 0.0), shininess);\n                return lightColor * specularLightWeighting * lightIntensity * weaken;\n            }\n\n            // \u8BA1\u7B97\u8870\u51CF\u91CF\n            float lightWeaken(vec3 lightPosition, vec3 position, float distanceIntensity) {\n                // \u5149\u6E90\u548C\u5F53\u524D\u7684\u8DDD\u79BB\uFF0C\u8BA1\u7B97\u8870\u51CF\n                float dist = distance(lightPosition, position);\n                float weaken = 1.0 / (1.0 + dist + dist * dist);\n                if(distanceIntensity > 0.0) {\n                    weaken = clamp(-dist / distanceIntensity + 1.0, 0.0, 1.0);\n                } else {\n                    weaken = 1.0;\n                }\n                return weaken;\n            }\n\n            // \u8BA1\u7B97\u70B9\u5149\u7684\u6F2B\u53CD\u5C04\u548C\u955C\u9762\u53CD\u5C04\n            DiffHighLight pointLightCalc() {\n                vec3 normal = normalize(vNormal);\n                vec3 lightDir = normalize(pointPosition - vPosition);\n                float weaken = lightWeaken(pointPosition, vPosition, pointDistence);\n                vec3 diff = diffuse(normal, lightDir, pointLightColor, pointIntensity, weaken);\n                vec3 highL = reflectLight(cameraPosition, lightDir, vPosition, normal, pointLightColor, shininess, pointIntensity, weaken);\n                DiffHighLight result;\n                result.diffuse = diff;\n                result.hightLight = highL;\n                return result;\n            }\n\n            // \u8BA1\u7B97\u5E73\u884C\u5149\u7684\u6F2B\u53CD\u5C04\u548C\u955C\u9762\u53CD\u5C04\n            DiffHighLight dirLightCalc() {\n                vec3 normal = normalize(vNormal);\n                vec3 diff = diffuse(normal, -dirVec, dirLightColor, dirIntensity, 1.0);\n                // vec3 highL = reflectLight(cameraPosition, normalize(dirVec), vPosition, normal, dirLightColor, shininess, dirIntensity, 1.0);\n                DiffHighLight result;\n                result.diffuse = diff;\n                result.hightLight = vec3(0);\n                return result;\n            }\n\n            // \u8BA1\u7B97\u6700\u7EC8\u7684\u5149\u548C\u6750\u8D28\u7684\u5149 \u989C\u8272\u589E\u76CA\n            vec3 lightColor(vec3 color) {\n                vec3 amb = ambient() * color;\n                DiffHighLight pointDiffHigh = pointLightCalc();\n                DiffHighLight dirDiffHigh = dirLightCalc();\n\n                return amb + dirDiffHigh.diffuse * color + dirDiffHigh.hightLight * color + pointDiffHigh.diffuse * color + pointDiffHigh.hightLight * color;;\n            }\n        "}},__defProp$x=Object.defineProperty,__getOwnPropSymbols$x=Object.getOwnPropertySymbols,__hasOwnProp$x=Object.prototype.hasOwnProperty,__propIsEnum$x=Object.prototype.propertyIsEnumerable,__defNormalProp$x=function(n,r,a){return r in n?__defProp$x(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$x=function(n,r){for(var a in r||(r={}))__hasOwnProp$x.call(r,a)&&__defNormalProp$x(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$x)try{for(var l=__getOwnPropSymbols$x(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$x.call(r,a)&&__defNormalProp$x(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},Render=function(){function n(r){_class_call_check(this,n),this.pA=new Map,this.v$=[],this.regl=r}return _create_class(n,[{key:"mA",get:function(){return!this.bA}},{key:"p$",value:function(r){this.v$.forEach(function(a){var i;return(i=a.p$)==null?void 0:i.call(a,r)})}},{key:"O$",value:function(r){this.v$.forEach(function(a){var i;return(i=a.O$)==null?void 0:i.call(a,r)})}},{key:"k$",value:function(r){this.v$.forEach(function(a){var i;return(i=a.k$)==null?void 0:i.call(a,r)})}},{key:"gA",value:function(r,a,i,o){if(!this.regl){console.warn("Please initialize `regl` first.");return}var s=new Shader(r),l=s.process(a),u=l.vertex,c=l.fragment;o=o!=null?o:0;var f=this.pA.get(r)||[];f[o]=this.regl(__spreadValues$x({frag:c,vert:u},i)),this.pA.set(r,f)}},{key:"yA",value:function(r,a){var i=this.pA.get(r)||[];if(!this.regl||!(i!=null&&i.length)){console.warn("Please execute `prepareRender` first.");return}return a=a!=null?a:0,this.bA=i[a]}},{key:"destroy",value:function(){this.pA.clear(),this.bA=void 0,this.regl=void 0,this.v$.forEach(function(r){var a;(a=r.destroy)==null||a.call(r)})}}]),n}(),SubRender=function n(){_class_call_check(this,n)},__defProp$w=Object.defineProperty,__getOwnPropSymbols$w=Object.getOwnPropertySymbols,__hasOwnProp$w=Object.prototype.hasOwnProperty,__propIsEnum$w=Object.prototype.propertyIsEnumerable,__defNormalProp$w=function(n,r,a){return r in n?__defProp$w(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$w=function(n,r){for(var a in r||(r={}))__hasOwnProp$w.call(r,a)&&__defNormalProp$w(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$w)try{for(var l=__getOwnPropSymbols$w(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$w.call(r,a)&&__defNormalProp$w(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},polygon={Sw:{zooms:[2,26],zIndex:120,visible:!0,opacity:1,cullface:"back",shininess:30,hasSide:!0,depth:!0,acceptLight:!0,blockHide:!0,I$:!1,hasTop:!0},style:{topColor:{defaultValue:"rgba(200,200,200,1)",type:"color",render:"attribute"},bottomColor:{defaultValue:"rgba(200,200,200,1)",type:"color",render:"attribute"},sideTopColor:{defaultValue:"#ffffff",type:"color",render:"attribute"},sideBottomColor:{defaultValue:"#fff",type:"color",render:"attribute"},borderWidth:{defaultValue:10,type:"number",render:"attribute"},borderColor:{defaultValue:"rgba(250,250,250,1)",type:"color",render:"attribute"},altitude:{defaultValue:0,type:"number",render:"attribute"},height:{defaultValue:0,type:"number",render:"attribute"},texture:{defaultValue:!1,type:"image",render:"uniform"},textureSize:{defaultValue:[10,3],type:"array",render:"attribute"},labelAltitude:{defaultValue:0,type:"number",render:"attribute"},label:{defaultValue:null,type:"nest",render:"attribute"}}},line={Sw:{zooms:[2,26],zIndex:120,visible:!0,opacity:1,depth:!1},style:{unit:{defaultValue:"px",type:"string",render:"uniform"},color:{defaultValue:"rgba(200,200,200,1)",type:"color",render:"attribute"},borderWidth:{defaultValue:0,type:"number",render:"attribute"},borderColor:{defaultValue:"rgba(250,250,250,1)",type:"color",render:"attribute"},lineWidth:{defaultValue:20,type:"number",render:"attribute"},dash:{defaultValue:[1,0,1,0],type:"array",render:"attribute"},altitude:{defaultValue:0,type:"number",render:"attribute"}}},pulseline={Sw:{zooms:[2,26],zIndex:120,visible:!0,opacity:1},style:{lineWidth:{defaultValue:1,type:"number",render:"attribute"},headColor:{defaultValue:"rgba(0, 0, 0, 0.75)",type:"color",render:"attribute"},trailColor:{defaultValue:"rgba(0, 0, 0, 0.25)",type:"color",render:"attribute"},altitude:{defaultValue:0,type:"number",render:"uniform"},interval:{defaultValue:1,type:"number",render:"uniform"},duration:{defaultValue:2e3,type:"number",render:"uniform"}}},scatter={Sw:{zooms:[2,26],zIndex:120,visible:!0,opacity:1,depth:!1},style:{size:{defaultValue:[20,20],type:"array",render:"attribute"},rotation:{defaultValue:0,type:"number",render:"attribute"},color:{defaultValue:"rgba(200,200,200,1)",type:"color",render:"attribute"},altitude:{defaultValue:0,type:"number",render:"attribute"},borderWidth:{defaultValue:0,type:"number",render:"attribute"},borderColor:{defaultValue:"rgba(250,250,250,1)",type:"color",render:"attribute"},texture:{defaultValue:null,type:"image",render:"uniform"},unit:{defaultValue:"px",type:"string",render:"uniform"},animate:{defaultValue:!1,type:"boolean",render:"uniform"},duration:{defaultValue:0,type:"number",render:"uniform"},labelAltitude:{defaultValue:0,type:"number",render:"attribute"},label:{defaultValue:null,type:"nest",render:"attribute"}}},heatmap={Sw:{zooms:[2,26],zIndex:120,visible:!0,opacity:1,depth:!0},style:{radius:{defaultValue:20,type:"number",render:"attribute"},value:{defaultValue:10,type:"number",render:"attribute"},gradient:{defaultValue:{.5:"blue",.65:"rgb(117,211,248)",.7:"rgb(0, 255, 0)",.9:"#ffea00",1:"red"},type:"object",render:"uniform"},opacity:{defaultValue:[0,1],type:"array",render:"uniform"},height:{defaultValue:100,type:"number",render:"uniform"},heightBezier:{defaultValue:[.4,.2,.4,.8],type:"array",render:"uniform"},max:{defaultValue:null,type:"number",render:"uniform"},min:{defaultValue:null,type:"number",render:"uniform"},unit:{defaultValue:"px",type:"string",render:"uniform"},difference:{defaultValue:!1,type:"bool",render:"uniform"}}},point={Sw:{zooms:[2,26],zIndex:120,visible:!0,opacity:1,blend:"normal"},style:{unit:{defaultValue:"px",type:"string",render:"uniform"},radius:{defaultValue:20,type:"number",render:"attribute"},borderWidth:{defaultValue:10,type:"number",render:"attribute"},blurWidth:{defaultValue:-1,type:"number",render:"attribute"},color:{defaultValue:"rgba(255,255,255,1)",type:"color",render:"attribute"},borderColor:{defaultValue:"rgba(255,255,255,1)",type:"color",render:"attribute"},label:{defaultValue:null,type:"nest",render:"attribute"}}},circle={Sw:__spreadValues$w(__spreadValues$w({},polygon.Sw),point.Sw),style:__spreadValues$w(__spreadValues$w({},polygon.style),point.style)},icon={Sw:{zooms:[2,26],zIndex:120,visible:!0,opacity:1},style:{unit:{defaultValue:"px",type:"string",render:"uniform"},icon:{defaultValue:"",type:"string",render:"attribute"},iconSize:{defaultValue:[20,20],type:"array",render:"attribute"},offset:{defaultValue:[0,0],type:"array",render:"attribute"},rotation:{defaultValue:0,type:"number",render:"attribute"},opacity:{defaultValue:1,type:"number",render:"attribute"},label:{defaultValue:null,type:"nest",render:"attribute"}}},grid$1={Sw:{zooms:[2,26],zIndex:120,visible:!0,opacity:1,depth:!0,acceptLight:!0,shininess:30,hasSide:!0,cullface:"back"},style:{unit:{defaultValue:"meter",type:"string",render:"uniform"},radius:{defaultValue:1e3,type:"number",render:"uniform"},gap:{defaultValue:0,type:"number",render:"uniform"},altitude:{defaultValue:0,type:"number",render:"attribute"},value:{defaultValue:0,type:"number",render:"attribute"},height:{defaultValue:0,type:"number",render:"attribute"},topColor:{defaultValue:"#ffffff",type:"color",render:"attribute"},sideTopColor:{defaultValue:"#ffffff",type:"color",render:"attribute"},sideBottomColor:{defaultValue:"#fff",type:"color",render:"attribute"},bottomColor:{defaultValue:"rgba(253,0,255,0)",type:"color",render:"attribute"},labelAltitude:{defaultValue:0,type:"number",render:"attribute"},label:{defaultValue:null,type:"nest",render:"attribute"}}},hexagon$1={Sw:{zooms:[2,26],zIndex:120,visible:!0,opacity:1,depth:!0,acceptLight:!0,shininess:30,hasSide:!0,cullface:"back"},style:{unit:{defaultValue:"meter",type:"string",render:"uniform"},radius:{defaultValue:1e3,type:"number",render:"uniform"},gap:{defaultValue:0,type:"number",render:"uniform"},altitude:{defaultValue:0,type:"number",render:"attribute"},value:{defaultValue:0,type:"number",render:"attribute"},height:{defaultValue:0,type:"number",render:"attribute"},topColor:{defaultValue:"#ffffff",type:"color",render:"attribute"},bottomColor:{defaultValue:"rgba(253,0,255,0)",type:"color",render:"attribute"},sideTopColor:{defaultValue:"#ffffff",type:"color",render:"attribute"},sideBottomColor:{defaultValue:"#fff",type:"color",render:"attribute"},labelAltitude:{defaultValue:0,type:"number",render:"attribute"},label:{defaultValue:null,type:"nest",render:"attribute"}}},link={Sw:{zooms:[2,26],zIndex:120,visible:!0,opacity:1},style:{lineColors:{defaultValue:["rgba(10,10,10,1)"],type:"colors",render:"attribute"},height:{defaultValue:function n(r,a){return a.distance*.7},type:"number",render:"attribute"},smoothSteps:{defaultValue:50,type:"number",render:"uniform"}}},pulselink={Sw:{zooms:[2,26],zIndex:120,visible:!0,opacity:1,depth:!0},style:{maxHeightScale:{defaultValue:.5,type:"number",render:"uniform"},lineColors:{defaultValue:["rgb(255,228,105)","rgb(255,164,105)","rgba(1, 34, 249,1)"],type:"colors",render:"attribute"},dash:{defaultValue:[10,0,10,0],type:"array",render:"attribute"},lineWidth:{defaultValue:[10,20],type:"array",render:"attribute"},height:{defaultValue:0,type:"number",render:"attribute"},speed:{defaultValue:10,type:"number",render:"attribute"},smoothSteps:{defaultValue:50,type:"number",render:"uniform"},headColor:{defaultValue:"rgba(255, 255, 0, 1)",type:"color",render:"uniform"},trailColor:{defaultValue:"rgba(255, 255, 0, 0)",type:"color",render:"uniform"},unit:{defaultValue:"px",type:"number",render:"uniform"},flowLength:{defaultValue:10,type:"number",render:"uniform"}}},prism={Sw:{zooms:[2,26],zIndex:120,visible:!0,opacity:1,depth:!1,acceptLight:!0,shininess:30,hasSide:!0,cullface:"back"},style:{unit:{defaultValue:"px",type:"string",render:"uniform"},sideNumber:{defaultValue:3,type:"number",render:"uniform"},rotation:{defaultValue:0,type:"number",render:"attribute"},radius:{defaultValue:20,type:"number",render:"attribute"},altitude:{defaultValue:0,type:"number",render:"attribute"},height:{defaultValue:100,type:"number",render:"attribute"},topColor:{defaultValue:"#ffffff",type:"color",render:"attribute"},sideTopColor:{defaultValue:"#ffffff",type:"color",render:"attribute"},sideBottomColor:{defaultValue:"#fff",type:"color",render:"attribute"},labelAltitude:{defaultValue:0,type:"number",render:"attribute"},label:{defaultValue:null,type:"nest",render:"attribute"}}},gltf={Sw:{zooms:[2,26],zIndex:120,visible:!0,opacity:1,depth:!0},style:{rotateX:{defaultValue:0,type:"number",render:"attribute"},rotateY:{defaultValue:0,type:"number",render:"attribute"},rotateZ:{defaultValue:0,type:"number",render:"attribute"},height:{defaultValue:0,type:"number",render:"attribute"},visible:{defaultValue:!0,type:"boolean",render:"attribute"},scale:{defaultValue:[1,1,1],type:"array",render:"attribute"}}},zmarker={Sw:{zooms:[2,26],zIndex:120,visible:!0,opacity:1,depth:!0},style:{unit:{defaultValue:"px",type:"string",render:"uniform"},alwaysFront:{defaultValue:!1,type:"bool",render:"uniform"},content:{defaultValue:"<p>\u8FD9\u662F\u4E00\u4E2A\u6807\u8BB0</p>",type:"string",render:"attribute"},size:{defaultValue:[20,20],type:"array",render:"attribute"},rotation:{defaultValue:0,type:"number",render:"attribute"},altitude:{defaultValue:0,type:"number",render:"attribute"}}},labels={Sw:{zooms:[2,26],zIndex:120,visible:!0,opacity:1,z$:!0,A$:!0},style:{label:{defaultValue:null,type:"nest",render:"attribute"}}},laser={Sw:{zooms:[1,20],zIndex:10,visible:!0,opacity:1,depth:!0},style:{unit:{defaultValue:"px",type:"string",render:"uniform"},height:{defaultValue:200,type:"number",render:"attribute"},color:{defaultValue:"rgba(255,255,0,0.5)",type:"color",render:"attribute"},angle:{defaultValue:0,type:"number",render:"uniform"},trailLength:{defaultValue:30,type:"number",render:"uniform"},lineWidth:{defaultValue:2,type:"number",render:"uniform"},repeat:{defaultValue:1/0,type:"number",render:"uniform"},duration:{defaultValue:2e3,type:"number",render:"attribute"},interval:{defaultValue:0,type:"number",render:"attribute"},delay:{defaultValue:0,type:"number",render:"attribute"},fadeOpacity:{defaultValue:.2,type:"number",render:"uniform"}}},conf=Object.freeze({__proto__:null,polygon:polygon,line:line,pulseline:pulseline,scatter:scatter,heatmap:heatmap,grid:grid$1,hexagon:hexagon$1,link:link,point:point,X$:circle,icon:icon,pulselink:pulselink,Iw:gltf,prism:prism,zmarker:zmarker,labels:labels,laser:laser}),__defProp$v=Object.defineProperty,__defProps$m=Object.defineProperties,__getOwnPropDescs$m=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$v=Object.getOwnPropertySymbols,__hasOwnProp$v=Object.prototype.hasOwnProperty,__propIsEnum$v=Object.prototype.propertyIsEnumerable,__defNormalProp$v=function(n,r,a){return r in n?__defProp$v(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$v=function(n,r){for(var a in r||(r={}))__hasOwnProp$v.call(r,a)&&__defNormalProp$v(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$v)try{for(var l=__getOwnPropSymbols$v(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$v.call(r,a)&&__defNormalProp$v(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},__spreadProps$m=function(n,r){return __defProps$m(n,__getOwnPropDescs$m(r))},pushArray$q=CommonUtil$1._C,_PolygonsFusion=function(n){_inherits(a,n);var r=_create_super(a);function a(){return _class_call_check(this,a),r.apply(this,arguments)}return _create_class(a,[{key:"DC",value:function(){}},{key:"buildStyle",value:function(i,o){for(var s,l=polygon.style,u=[],c=0;c<i.length;c++)if(!(!i[c].features||!i[c].features.polygons)){for(var f=i[c].features.polygons,h=StyleInstance.parse(f,o,l),p={},d=0;d<f.length;d++)if(h)for(var v in h.attributes){var _=h.attributes[v];p[v]||(p[v]=[]),((s=_[d])==null?void 0:s.length)>0?pushArray$q(p[v],_[d]):p[v][p[v].length]=_[d]}u.push({attributes:p,uniforms:h.uniforms,si:h.si})}return u}},{key:"fusion",value:function(i,o,s,l){if(!this.regl||!s.loca)return[];var u=[];l=l||this.buildStyle(i,o);for(var c=s.loca.customCoords,f=0;f<i.length;f++){var h=i[f];if(!(!h.features||!h.features.polygons||!l[f])){for(var p=h.features.polygons,d=l[f],v={index:[],vertex:[],color:[],normal:[],uv:[],textureSize:[],pickColor:[],topOrBottom:[],labels:[]},_=[],m=[],y=[],g=[],C=0;C<p.length;C++){var b=p[C],k=s.colorPick.add(b),L=b.coordinates;if(b.type==="MultiPolygon"){for(var F=0,W=L.length;F<W;F++){var j=L[F],Y=this.triangles(j,{style:d,index:C,pickColor:k,id:b.sr},c,s.hasTop,s.hasSide,s.I$),N=v.vertex.length;_.push(N),m.push(N+Y.Tw.Pw),y.push(N+Y.Tw.top),GeoUtil.mergeTriangles(v,Y,4),pushArray$q(v.color,Y.color),pushArray$q(v.pickColor,Y.pickColor),pushArray$q(v.normal,Y.normal),pushArray$q(v.uv,Y.uv),pushArray$q(v.textureSize,Y.textureSize),pushArray$q(v.topOrBottom,Y.topOrBottom)}d.attributes.label[C]&&v.labels.push(__spreadValues$v({position:_to_consumable_array(GeometryUtil.a$(getMaximumPolygon(L))).concat([d.attributes.altitude[C]+d.attributes.height[C]+d.attributes.labelAltitude[C]])},d.attributes.label[C]))}else{var $=this.triangles(L,{style:d,index:C,pickColor:k,id:b.sr},c,s.hasTop,s.hasSide,s.I$),w=v.vertex.length;_.push(w),m.push(w+$.Tw.Pw),y.push(w+$.Tw.top),GeoUtil.mergeTriangles(v,$,4),pushArray$q(v.color,$.color),pushArray$q(v.pickColor,$.pickColor),pushArray$q(v.normal,$.normal),pushArray$q(v.uv,$.uv),pushArray$q(v.textureSize,$.textureSize),pushArray$q(v.topOrBottom,$.topOrBottom),d.attributes.label[C]&&v.labels.push(__spreadValues$v({position:_to_consumable_array(GeometryUtil.a$(L)).concat([d.attributes.altitude[C]+d.attributes.height[C]+d.attributes.labelAltitude[C]])},d.attributes.label[C]))}g[C]=v.vertex.length}u[f]={id:h.id,attributes:{position:{buffer:this.regl.buffer(v.vertex),offset:0,stride:4*4,td:!1,divisor:0},topOrBottom:{buffer:this.regl.buffer(v.topOrBottom),offset:0,stride:4*1,td:!1,divisor:0},color:{buffer:this.regl.buffer(v.color),offset:0,stride:4*4,td:!1,divisor:0},pickColor:{buffer:this.regl.buffer(v.pickColor),offset:0,stride:4*4,td:!1,divisor:0},normal:{buffer:this.regl.buffer(v.normal),offset:0,stride:4*3,td:!1,divisor:0},uv:{buffer:this.regl.buffer(v.uv),offset:0,stride:4*2,td:!1,divisor:0},textureSize:{buffer:this.regl.buffer(v.textureSize),offset:0,stride:4*2,td:!1,divisor:0},index:this.regl.elements({primitive:"triangles",type:"uint32",data:v.index})},uniforms:d.uniforms,si:d.si,mf:{Tw:{bottom:_,Pw:m,top:y,jw:g},origin:{position:v.vertex,color:v.color},labels:v.labels}}}}return u}},{key:"triangles",value:function(i,o,s){for(var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,c=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0,f=GeoUtil.triangle(i),h=f.vertex,p=f.index,d=[],v=o.index,_=o.pickColor,m=o.style.attributes,y=m.height,g=m.altitude,C=m.topColor,b=m.bottomColor,k=m.sideTopColor,L=m.sideBottomColor,F=m.textureSize,W=g[v],j=y[v]+W,Y=v*4,N=C.slice(Y,Y+4),$=b.slice(Y,Y+4),w=L.slice(Y,Y+4),E=k.slice(Y,Y+4),A=F&&F.slice(v*2,v*2+2),R=[],O=[],P=[],T=[],M=[],U=[],Q=[],K=[],te=[],ve=[],de=[],be=[],et=[],qe=[],Ne=[],Ge=[],ft=[],Ze=[],pt=[],dt=0,Ot=h.length;dt<Ot;dt+=2){var mt=h[dt],at=h[dt+1],St=s.lngLatToCoord([mt,at]);l&&(this.addVertex(R,Q,T,ve,[St[0],St[1],j,o.id],N,[0,0,1],[-1,-1],et,[-1,-1],Ge,_),Ze.push(1)),c&&(this.addVertex(O,K,M,de,[St[0],St[1],W,o.id],$,[0,0,-1],[-1,-1],qe,[-1,-1],Ge,_),ft.push(0))}if(u)for(var Tt=this.isClock(i[0]),Dt=!1,Lt=0,Rt=i.length;Lt<Rt;Lt++){var It=i[Lt];Lt>0&&(Dt=!0);for(var Bt=!1,Ft=0,ot=0,bt=It.length;ot<bt-1;ot++){var rt=It[ot],Pt=It[ot+1],st=Bt||s.lngLatToCoord(rt),$t=s.lngLatToCoord(Pt),_t=P.length/4,it=d.length,Vt=this.getNormal(st,$t,!!(+Tt^+Dt)),mr=glMatrix.vec2.distance(st,$t);pt.push(0,1,0,1),this.addVertex(P,te,U,be,[st[0],st[1],W,o.id],w,Vt,[Ft,0],Ne,A,Ge,_),this.addVertex(P,te,U,be,[st[0],st[1],j,o.id],E,Vt,[Ft,j],Ne,A,Ge,_),this.addVertex(P,te,U,be,[$t[0],$t[1],W,o.id],w,Vt,[Ft+mr,0],Ne,A,Ge,_),this.addVertex(P,te,U,be,[$t[0],$t[1],j,o.id],E,Vt,[Ft+mr,j],Ne,A,Ge,_),Tt?(d[it]=_t,d[it+1]=_t+3,d[it+2]=_t+1,d[it+3]=_t,d[it+4]=_t+2,d[it+5]=_t+3):(d[it]=_t,d[it+1]=_t+1,d[it+2]=_t+3,d[it+3]=_t,d[it+4]=_t+3,d[it+5]=_t+2),Bt=$t,Ft+=mr}}var wr=O.length,ii=wr+P.length,qr={vertex:P,index:d};return c&&(qr=GeoUtil.mergeTriangles({vertex:O,index:p.slice(0)},{vertex:P,index:d},4)),l&&GeoUtil.mergeTriangles(qr,{vertex:R,index:p.reverse()},4),pushArray$q(K,te),pushArray$q(K,Q),pushArray$q(M,U),pushArray$q(M,T),pushArray$q(de,be),pushArray$q(de,ve),pushArray$q(qe,Ne),pushArray$q(qe,et),pushArray$q(ft,pt),pushArray$q(ft,Ze),{vertex:qr.vertex,index:qr.index,color:K,normal:M,uv:de,textureSize:qe,pickColor:Ge,topOrBottom:ft,Tw:{Pw:wr,top:ii}}}},{key:"addVertex",value:function(i,o,s,l,u,c,f){var h=arguments.length>7&&arguments[7]!==void 0?arguments[7]:[-1,-1],p=arguments.length>8?arguments[8]:void 0,d=arguments.length>9?arguments[9]:void 0,v=arguments.length>10?arguments[10]:void 0,_=arguments.length>11?arguments[11]:void 0,m=i.length,y=s.length,g=l.length;if(i[m]=u[0],i[m+1]=u[1],i[m+2]=u[2],i[m+3]=u[3],o[m]=c[0],o[m+1]=c[1],o[m+2]=c[2],o[m+3]=c[3],v&&_){var C=v.length;v[C]=_[0],v[C+1]=_[1],v[C+2]=_[2],v[C+3]=_[3]}s[y]=f[0],s[y+1]=f[1],s[y+2]=f[2],l[g]=h[0],l[g+1]=h[1],p&&d&&(p[g]=d[0],p[g+1]=d[1])}},{key:"getNormal",value:function(i,o){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,l=glMatrix.vec3.create();glMatrix.vec3.set(l,o[0]-i[0],o[1]-i[1],0),s&&glMatrix.vec3.set(l,i[0]-o[0],i[1]-o[1],0);var u=glMatrix.vec3.create();glMatrix.vec3.set(u,0,0,1);var c=glMatrix.vec3.create();return glMatrix.vec3.normalize(c,glMatrix.vec3.cross(c,l,u))}},{key:"isClock",value:function(i){for(var o=i.length,s=0,l=0;l<o;l++){var u=i[l],c=i[(l+1)%o];s+=(c[0]-u[0])*(c[1]+u[1])}return s>0}},{key:"updateStyle",value:function(i,o,s){for(var l=function(f,h){for(var p=i[f],d=o[f].attributes,v=d.altitude,_=d.height,m=d.topColor,y=d.bottomColor,g=d.sideTopColor,C=d.sideBottomColor,b=d.textureSize,k=d.label,L=d.labelAltitude,F=p.mf.origin,W=F.position,j=F.color,Y=p.mf.Tw,N=Y.top,$=Y.bottom,w=Y.Pw,E=Y.jw,A=new Float32Array(j.length/2),R=0,O=0,P=0,T=W.length;P<T;P+=4){var M=P/4*4,U=void 0,Q=[-1,-1];P>=E[R]&&R++;var K=R*4;P>=$[O+1]&&O++,P<w[O]?s.I$&&(U=y,W[P+2]=v[R]):P>=w[O]&&P<N[O]?s.hasSide&&((P-w[O])/4%2===0?(U=C,W[P+2]=v[R]):(U=g,W[P+2]=_[R]+v[R]),Q=b.slice(R*2,R*2+2)):s.hasTop&&(U=m,W[P+2]=_[R]+v[R]),j[M]=U[K],j[M+1]=U[K+1],j[M+2]=U[K+2],j[M+3]=U[K+3],A[M/2]=Q[0],A[M/2+1]=Q[1]}p.attributes.position.buffer({data:W}),p.attributes.color.buffer({data:j}),p.attributes.textureSize.buffer({data:A}),p.uniforms=o[f].uniforms,p.mf.labels=p.mf.labels.map(function(te,ve){var de=te.position;return de[2]=_[ve]+v[ve]+L[ve],__spreadProps$m(__spreadValues$v(__spreadValues$v({},te),k[ve]),{position:de})})},u=0,c=i.length;u<c;u++)l(u,c)}},{key:"EC",value:function(){return[]}},{key:"destroy",value:function(){this.regl=null}}],[{key:"getInstance",value:function(){return this.ui}}]),a}(GeometryFusion),PolygonsFusion=_PolygonsFusion;PolygonsFusion.ui=new _PolygonsFusion;var PolygonsFusionInstance=PolygonsFusion.getInstance(),lightUniforms="\n#if defined(ACCEPT_LIGHT) && defined(HAS_LIGHTS)\n    #ifdef NUMBER_OF_AMBIENT_LIGHTS\n        struct AmbientLight {\n            float intensity;\n            vec3 lightColor; \n        };\n        uniform AmbientLight ambientLight; \n    #endif\n\n    #ifdef NUMBER_OF_POINT_LIGHTS\n        struct PointLight {\n            float intensity;\n            float dist;\n            vec3 lightColor;\n            vec3 position;\n        };\n        uniform PointLight pointLights[NUMBER_OF_POINT_LIGHTS]; \n    #endif\n\n    #ifdef NUMBER_OF_DIRECTIONAL_LIGHTS\n        struct DirectionalLight {\n            float intensity;\n            vec3 lightColor;\n            vec3 direction;\n        };\n        uniform DirectionalLight directionalLights[NUMBER_OF_DIRECTIONAL_LIGHTS]; \n    #endif\n#endif\n",lightFunctions="\n#if defined(ACCEPT_LIGHT) && defined(HAS_LIGHTS)\n    struct DiffHighLight {\n        vec3 diffuse;\n        vec3 highLight;\n    };\n\n    // \u73AF\u5883\u53CD\u5C04\n    vec3 ambient(vec3 ambLightColor, float ambIntensity) {\n        return ambLightColor * ambIntensity;\n    }\n\n    vec3 diffuse(\n        vec3 normal,\n        vec3 lightDir,\n        vec3 lightColor,\n        float lightIntensity,\n        float weaken\n    ) {\n        vec3 nNormal = normalize(normal);\n        //\u8BA1\u7B97\u5149\u7EBF\u65B9\u5411\u548C\u6CD5\u5411\u91CF\u7684\u70B9\u79EF\n        float nDotL = max(dot(normalize(lightDir), nNormal), 0.0);\n        //\u8BA1\u7B97\u6F2B\u53CD\u5C04\u5149\u7684\u989C\u8272\n        return lightColor * nDotL * lightIntensity * weaken;\n    }\n\n    // \u955C\u9762\u53CD\u5C04\n    vec3 reflectLight(\n        vec3 cameraPosition,\n        vec3 lightDir,\n        vec3 position,\n        vec3 normal,\n        vec3 lightColor,\n        float shininess,\n        float lightIntensity,\n        float weaken\n    ) {\n        float specularLightWeighting = 0.0;\n        // vec3 lightDir = normalize(lightPosition - position);\n        vec3 cameraDirection = normalize(cameraPosition - position);\n        vec3 reflectionDirection = reflect(-lightDir, normal);\n        specularLightWeighting = pow(max(dot(reflectionDirection, cameraDirection), 0.0), shininess);\n        return lightColor * specularLightWeighting * lightIntensity * weaken;\n    }\n\n    // \u8BA1\u7B97\u8870\u51CF\u91CF\n    float lightWeaken(vec3 lightPosition, vec3 position, float distanceIntensity) {\n        // \u5149\u6E90\u548C\u5F53\u524D\u7684\u8DDD\u79BB\uFF0C\u8BA1\u7B97\u8870\u51CF\n        float dist = distance(lightPosition, position);\n        float weaken;\n        if(distanceIntensity > 0.0) {\n            weaken = clamp(-dist / distanceIntensity + 1.0, 0.0, 1.0);\n        } else {\n            weaken = 1.0;\n        }\n        return weaken;\n    }\n\n    // \u8BA1\u7B97\u70B9\u5149\u7684\u6F2B\u53CD\u5C04\u548C\u955C\u9762\u53CD\u5C04\n    DiffHighLight pointLightCalc(vec3 pointPosition, vec3 pointLightColor, float pointDistance, float pointIntensity) {\n        vec3 normal = normalize(vNormal);\n        vec3 lightDir = normalize(pointPosition - vPosition);\n        float weaken = lightWeaken(pointPosition, vPosition, pointDistance);\n        vec3 diff = diffuse(normal, lightDir, pointLightColor, pointIntensity, weaken);\n        vec3 highL = reflectLight(cameraPosition, lightDir, vPosition, normal, pointLightColor, shininess, pointIntensity, weaken);\n        DiffHighLight result;\n        result.diffuse = diff;\n        result.highLight = highL;\n        return result;\n    }\n\n    // \u8BA1\u7B97\u5E73\u884C\u5149\u7684\u6F2B\u53CD\u5C04\u548C\u955C\u9762\u53CD\u5C04\n    DiffHighLight dirLightCalc(vec3 dirVec, vec3 dirLightColor, float dirIntensity) {\n        vec3 normal = normalize(vNormal);\n        vec3 diff = diffuse(normal, -dirVec, dirLightColor, dirIntensity, 1.0);\n        // vec3 highL = reflectLight(cameraPosition, normalize(dirVec), vPosition, normal, dirLightColor, shininess, dirIntensity, 1.0);\n        DiffHighLight result;\n        result.diffuse = diff;\n        result.highLight = vec3(0);\n        return result;\n    }\n#endif\n",lightMainCompute="\n#if defined(ACCEPT_LIGHT) && defined(HAS_LIGHTS)\n\n    DiffHighLight diffHighLight;\n    vec3 amb = vec3(0.0, 0.0, 0.0);\n    vec3 diffuse = vec3(0.0, 0.0, 0.0);\n    vec3 highLight = vec3(0.0, 0.0, 0.0);  \n\n    #ifdef NUMBER_OF_AMBIENT_LIGHTS\n        amb = ambient(ambientLight.lightColor, ambientLight.intensity) * gl_FragColor.rgb;\n    #endif\n\n    #ifdef NUMBER_OF_POINT_LIGHTS\n        for (int i = 0; i < NUMBER_OF_POINT_LIGHTS; i++) {\n            PointLight l = pointLights[i];\n            diffHighLight = pointLightCalc(l.position, l.lightColor, l.dist, l.intensity);\n            diffuse += diffHighLight.diffuse;\n            highLight += diffHighLight.highLight;\n        }\n    #endif\n\n    #ifdef NUMBER_OF_DIRECTIONAL_LIGHTS\n        for (int i = 0; i < NUMBER_OF_DIRECTIONAL_LIGHTS; i++) {\n            DirectionalLight l = directionalLights[i];\n            diffHighLight = dirLightCalc(l.direction, l.lightColor, l.intensity);\n            diffuse += diffHighLight.diffuse;\n            highLight += diffHighLight.highLight;   \n        }\n\n    #endif\n\n    gl_FragColor.rgb = amb + diffuse * gl_FragColor.rgb + highLight * gl_FragColor.rgb;\n\n#endif\n",LightIncludes={lightUniforms:lightUniforms,lightFunctions:lightFunctions,lightMainCompute:lightMainCompute},__defProp$u=Object.defineProperty,__getOwnPropSymbols$u=Object.getOwnPropertySymbols,__hasOwnProp$u=Object.prototype.hasOwnProperty,__propIsEnum$u=Object.prototype.propertyIsEnumerable,__defNormalProp$u=function(n,r,a){return r in n?__defProp$u(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$u=function(n,r){for(var a in r||(r={}))__hasOwnProp$u.call(r,a)&&__defNormalProp$u(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$u)try{for(var l=__getOwnPropSymbols$u(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$u.call(r,a)&&__defNormalProp$u(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},PolygonShader={vertex:"\n        precision highp float;\n\n        attribute vec4 position;\n        attribute vec3 normal;\n        attribute vec4 color;\n        attribute vec2 uv;\n        attribute vec2 textureSize;\n        attribute float topOrBottom;\n\n        varying vec3 vNormal;\n        varying vec4 vColor;\n        varying vec3 vPosition;\n        varying vec2 vUv;\n        varying vec2 vTexSize;\n        ".concat(ColorGLSL.getColorShader().vertex,"\n        ").concat(RenderUtil.getBezier(),"\n        ").concat(RenderUtil.getScaleType("height"),"\n        ").concat(RenderUtil.getScaleType("altitude"),"\n\n        uniform mat4 mvp;\n\n        void main() {\n            vec3 realPos = position.xyz;\n            float altitudeScale = altitudeScaleValue(position.w);\n            float heightScale = heightScaleValue(position.w);\n            if(topOrBottom == 0.0) {\n                realPos = vec3(position.xy, position.z * altitudeScale);\n            }\n            if(topOrBottom == 1.0) {\n                realPos = vec3(position.xy, position.z * heightScale);\n            }\n            vColor = color;\n            vNormal = normal;\n            vPosition = realPos;\n            vUv = vec2(uv.x / textureSize.x, uv.y / textureSize.y);\n            vTexSize = textureSize;\n            gl_Position = mvp * vec4(realPos, 1.0);\n            ").concat(ColorGLSL.getColorShader().mainVert,"\n        }\n    "),fragment:"\n        precision highp float;\n        varying vec4 vColor;\n\n        // \u5982\u679C\u9700\u8981\u5149\u7167\uFF0C\u8FD9\u4E24\u4E2A\u53D8\u91CF\u662F\u5FC5\u987B\u7684\n        varying vec3 vNormal;\n        varying vec3 vPosition;\n        varying vec2 vUv;\n        varying vec2 vTexSize;\n\n        uniform float opacity;\n        uniform sampler2D texture;\n        uniform bool useTexture;\n\n        uniform vec3 cameraPosition;\n        uniform float shininess;\n        #include <lightUniforms,lightFunctions>;\n\n        ".concat(ColorGLSL.getColorShader().fragment,"\n\n        void main() {\n            if(useTexture && vTexSize.x >= 0.0) {\n                gl_FragColor = texture2D(texture, vUv);\n            } else {\n                gl_FragColor = vColor;\n            }\n            #include <lightMainCompute>;\n            gl_FragColor.a *= opacity;\n            ").concat(ColorGLSL.getColorShader().mainFrag,"\n        }\n    "),includes:__spreadValues$u({},LightIncludes)},RenderHelper=function(){function n(){_class_call_check(this,n)}return _create_class(n,null,[{key:"SA",value:function(r,a,i){var o=a.vA,s=a.loca,l=r.mA||o.isDirty;if(l){if(r.mA&&(i==null||i("onFirstRendering")),(o.state&LightDirty)===LightDirty&&(this.MA(o,s.lights),i==null||i("light")),(o.state&MeshDirty)===MeshDirty&&(i==null||i("mesh")),(o.state&MeshesDirty)===MeshesDirty&&(i==null||i("meshes")),r.m$(o)===!1)return!1;o.state=NotDirty}return!0}},{key:"MA",value:function(r,a){for(var i=function(f,h){h>0?r[f]=h:delete r[f]},o=0,s=0,l=0,u=0;u<a.length;u++){var c=a[u];if(_instanceof(c,AmbientLight))if(o>0){console.warn("\u73AF\u5883\u5149\u53EA\u5141\u8BB8\u6709\u4E00\u4E2A\uFF01");continue}else o+=1;else _instanceof(c,PointLight)?s+=1:_instanceof(c,DirectionalLight)&&(l+=1)}i("NUMBER_OF_AMBIENT_LIGHTS",o),i("NUMBER_OF_POINT_LIGHTS",s),i("NUMBER_OF_DIRECTIONAL_LIGHTS",l)}},{key:"_A",value:function(r,a){var i=[];if(r.NUMBER_OF_AMBIENT_LIGHTS>0&&(i.push("ambientLight.intensity"),i.push("ambientLight.lightColor")),r.NUMBER_OF_POINT_LIGHTS>0)for(var o=0;o<r.NUMBER_OF_POINT_LIGHTS;o++)i.push("pointLights[".concat(o,"].intensity")),i.push("pointLights[".concat(o,"].dist")),i.push("pointLights[".concat(o,"].lightColor")),i.push("pointLights[".concat(o,"].position"));if(r.NUMBER_OF_DIRECTIONAL_LIGHTS>0)for(var s=0;s<r.NUMBER_OF_DIRECTIONAL_LIGHTS;s++)i.push("directionalLights[".concat(s,"].intensity")),i.push("directionalLights[".concat(s,"].lightColor")),i.push("directionalLights[".concat(s,"].direction"));return i.reduce(function(l,u){return l[u]=a.prop(u),l},{})}},{key:"IA",value:function(r){var a,i=[],o=[],s=!0,l=!1,u=void 0;try{for(var c=r[Symbol.iterator](),f;!(s=(f=c.next()).done);s=!0){var h=f.value,p={};h.iA(p),_instanceof(h,AmbientLight)?a=p:_instanceof(h,PointLight)?i.push(p):_instanceof(h,DirectionalLight)&&o.push(p)}}catch(v){l=!0,u=v}finally{try{!s&&c.return!=null&&c.return()}finally{if(l)throw u}}var d={};return a&&(d.ambientLight=a),i.length&&(d.pointLights=i),o.length&&(d.directionalLights=o),d}}]),n}(),NoneState=0,FreshState=1,UpdateState=2,LabelsRender$1=function(n){_inherits(a,n);var r=_create_super(a);function a(){_class_call_check(this,a);var i;return i=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))),i.g$=[],i.renderState=NoneState,i}return _create_class(a,[{key:"m$",value:function(i){(i.state&MeshesDirty)===MeshesDirty?this.renderState|=FreshState:(i.state&MeshDirty)===MeshDirty&&(this.renderState|=UpdateState)}},{key:"render",value:function(i){if("AMap"in window){var o=i.mf||{},s=o.labels;s&&s.length&&((this.renderState&FreshState)===FreshState?(this.g$=s.map(function(l){return new AMap.LabelMarker(l)}),this._$.clear(),this._$.add(this.g$),this.renderState=NoneState):(this.renderState&UpdateState)===UpdateState?(this.g$.forEach(function(l,u){l.setText({content:""}),l.setPosition(s[u].position),l._opts=s[u]}),this.renderState^=UpdateState):this.renderState=NoneState)}else this.renderState=NoneState}},{key:"p$",value:function(i){if("AMap"in window){var o=i.d$.labelsLayerOptions||{},s=i.zooms,l=i.opacity,u=i.zIndex;o.zooms===void 0&&(o.zooms=s),o.opacity===void 0&&(o.opacity=l),o.zIndex===void 0&&(o.zIndex=u),this._$=new AMap.LabelsLayer(o);var c=i.map;c.hasLayer(this._$)||c.add(this._$)}else console.warn("[LabelsRender]: \u4EC5\u652F\u6301\u5728AMap\u4E0A\u8FDB\u884Clabels\u6E32\u67D3\u3002")}},{key:"O$",value:function(){var i;(i=this._$)==null||i.show()}},{key:"k$",value:function(){var i;(i=this._$)==null||i.hide()}},{key:"destroy",value:function(){var i,o;(i=this._$)==null||i.clear(),(o=this._$)==null||o.setMap(null)}}]),a}(SubRender),__defProp$t=Object.defineProperty,__defProps$l=Object.defineProperties,__getOwnPropDescs$l=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$t=Object.getOwnPropertySymbols,__hasOwnProp$t=Object.prototype.hasOwnProperty,__propIsEnum$t=Object.prototype.propertyIsEnumerable,__defNormalProp$t=function(n,r,a){return r in n?__defProp$t(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$t=function(n,r){for(var a in r||(r={}))__hasOwnProp$t.call(r,a)&&__defNormalProp$t(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$t)try{for(var l=__getOwnPropSymbols$t(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$t.call(r,a)&&__defNormalProp$t(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},__spreadProps$l=function(n,r){return __defProps$l(n,__getOwnPropDescs$l(r))},PolygonsRender=function(n){_inherits(a,n);var r=_create_super(a);function a(){_class_call_check(this,a);var i;return i=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))),i.v$=[new LabelsRender$1],i}return _create_class(a,[{key:"m$",value:function(i){if(!this.regl)return!1;this.v$.forEach(function(l){return l.m$(i)});var o=this.regl,s=RenderHelper._A(i,o);this.gA(PolygonShader,i,{attributes:__spreadValues$t({position:o.prop("position"),color:o.prop("color"),normal:o.prop("normal"),uv:o.prop("uv"),textureSize:o.prop("textureSize"),topOrBottom:o.prop("topOrBottom")},ColorGLSL.getColor(o).attribute),uniforms:__spreadValues$t(__spreadValues$t(__spreadValues$t(__spreadValues$t({mvp:o.prop("mvp"),opacity:o.prop("opacity"),shininess:o.prop("shininess"),cameraPosition:o.prop("cameraPosition"),texture:o.prop("texture"),useTexture:o.prop("useTexture")},ColorGLSL.getColor(o).uniform),RenderUtil.getScaleUniform("altitude",o)),RenderUtil.getScaleUniform("height",o)),s),blend:{enable:!0,func:RenderUtil.getBlend("normal")},cull:{enable:o.prop("cullEnable"),face:o.prop("cullface")},frontFace:"cw",depth:{enable:o.prop("depth"),func:"lequal"},colorMask:o.prop("colorMask"),elements:o.prop("index")})}},{key:"render",value:function(i){var o=this.yA(PolygonShader);if(o){var s=i.meshes,l=i.mvp,u=i.lights,c=i.blockHide,f=i.opacity,h=i.cull,p=i.cameraPosition,d=i.shininess,v=i.acceptLight,_=i.texture,m=i.useTexture,y=i.depth,g=i.vP,C=h!=="none",b=h==="front"?"front":"back";if(c)for(var k=0;k<s.length;k++){var L=s[k],F=L.attributes;o(__spreadValues$t(__spreadProps$l(__spreadValues$t(__spreadValues$t({},F),u),{mvp:l,colorMask:[!1,!1,!1,!1],opacity:f,cullEnable:C,cullface:b,depth:y,cameraPosition:p,shininess:d,acceptLight:v,texture:_,useTexture:m,isPick:!1}),RenderUtil.getScaleProps(g)))}for(var W=0;W<s.length;W++){var j=s[W],Y=j.attributes;o(__spreadValues$t(__spreadProps$l(__spreadValues$t(__spreadValues$t({},Y),u),{mvp:l,colorMask:[!0,!0,!0,!0],opacity:f,cullEnable:C,cullface:b,cameraPosition:p,depth:y,shininess:d,acceptLight:v,texture:_,useTexture:m,isPick:!1}),RenderUtil.getScaleProps(g)))}for(var N=0;N<s.length;N++){var $=!0,w=!1,E=void 0;try{for(var A=this.v$[Symbol.iterator](),R;!($=(R=A.next()).done);$=!0){var O=R.value;O.render(s[N])}}catch(P){w=!0,E=P}finally{try{!$&&A.return!=null&&A.return()}finally{if(w)throw E}}}}}},{key:"pickRender",value:function(i){var o=this,s=this.yA(PolygonShader);if(s){var l=i.meshes,u=i.mvp,c=i.lights,f=i.opacity,h=i.cull,p=i.cameraPosition,d=i.depth,v=i.texture,_=i.pickFbo,m=i.pickPos,y=i.vP,g=h!=="none",C=h==="front"?"front":"back";_&&m&&_.use(function(){o.regl.clear({color:[0,0,0,0],depth:1});for(var b=0;b<l.length;b++){var k=l[b],L=k.attributes;s(__spreadValues$t(__spreadProps$l(__spreadValues$t(__spreadValues$t({},L),c),{mvp:u,colorMask:[!0,!0,!0,!0],opacity:f,cullEnable:g,cullface:C,cameraPosition:p,depth:d,shininess:1,acceptLight:!1,texture:v,useTexture:!1,isPick:!0}),RenderUtil.getScaleProps(y)))}})}}}]),a}(Render),__defProp$s=Object.defineProperty,__getOwnPropSymbols$s=Object.getOwnPropertySymbols,__hasOwnProp$s=Object.prototype.hasOwnProperty,__propIsEnum$s=Object.prototype.propertyIsEnumerable,__defNormalProp$s=function(n,r,a){return r in n?__defProp$s(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$s=function(n,r){for(var a in r||(r={}))__hasOwnProp$s.call(r,a)&&__defNormalProp$s(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$s)try{for(var l=__getOwnPropSymbols$s(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$s.call(r,a)&&__defNormalProp$s(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},getMipMap$1=RenderUtil.getMipMap,pushArray$p=CommonUtil$1._C,PolygonLayer=function(n){_inherits(a,n);var r=_create_super(a);function a(i){_class_call_check(this,a);var o;o=r.call(this,i),o.CLASS_NAME="Polygon",o.styleOptions={},o.fusion=new PolygonsFusion,o.ll=new PolygonsRender,o.Vw=!0;var s=polygon.Sw;return o.zooms=i.zooms===void 0?s.zooms:i.zooms,o.visible=i.visible===void 0?s.visible:i.visible,o.zIndex=i.zIndex===void 0?s.zIndex:i.zIndex,o.opacity=i.opacity===void 0?s.opacity:i.opacity,o.depth=i.depth===void 0?s.depth:i.depth,o.blockHide=i.blockHide===void 0?s.blockHide:i.blockHide,o.shininess=i.shininess===void 0?s.shininess:i.shininess,o.acceptLight=i.acceptLight===void 0?s.acceptLight:i.acceptLight,o.cullface=i.cullface||s.cullface,o.hasSide=i.hasSide===void 0?s.hasSide:i.hasSide,o.hasTop=i.hasTop===void 0?s.hasTop:i.hasTop,o.I$=i.I$===void 0?s.I$:i.I$,o.AC({zooms:o.zooms,visible:o.visible,zIndex:o.zIndex}),o.buryPoint.record(o.CLASS_NAME),o}return _create_class(a,[{key:"getLabelsLayer",value:function(){return this.ll.v$[0]._$||null}},{key:"receiveDataset",value:function(i){this.dataset=i,this.setStyle(this.styleOptions),this.onAdd()}},{key:"setStyle",value:function(i){if(_get(_get_prototype_of(a.prototype),"setStyle",this).call(this,i),this.Kf=null,this.dataset=this.source.LC(),this.dataset&&this.dataset.length>0&&this.meshes){var o=this.WC(),s=o.didFusion,l=this.fusion.buildStyle(this.dataset,this.styleOptions);this.fusion.updateStyle(s,l,this),this.vA.state|=MeshDirty,this.loca&&this.loca.requestRender()}}},{key:"getInitialAnimateState",value:function(){return{altitude:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]},height:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]}}}},{key:"jC",value:function(){_get(_get_prototype_of(a.prototype),"jC",this).call(this),!(!this.loca||!this.loca.regl||this.ll.regl)&&(this.ll.regl=this.loca.regl,this.loca.rendererManager.addRenderer(this.ll))}},{key:"beforeRender",value:function(){if(_get(_get_prototype_of(a.prototype),"beforeRender",this).call(this),!this.fusion.regl&&this.loca&&(this.fusion.regl=this.loca.regl,this.loca.fusionManager.addFusion(this.fusion)),this.jC(),this.source&&(this.dataset=this.source.LC()),this.fusion&&this.dataset&&this.dataset.length>0){var i=this.WC(),o=i.willFusion,s=i.didFusion;if(o.length>0){var l=this.fusion.fusion(o,this.styleOptions,this);this.meshes=pushArray$p(s,l),this.vA.state|=MeshesDirty}}var u=this.meshes[0]&&this.meshes[0].uniforms.texture;this.Rw(u)}},{key:"render",value:function(){var i;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var o=this.loca.customCoords.getCameraParams().position,s=(i=this.loca)==null?void 0:i.customCoords.getMVPMatrix(),l=RenderHelper.IA(this.loca.lights);if(this.ll&&this.meshes.length>0)return this.ll.render({meshes:this.meshes,mvp:s,lights:l,shininess:this.shininess,acceptLight:this.acceptLight,opacity:this._getOpacity(),depth:this.depth,cull:this.cullface,blockHide:this.blockHide,cameraPosition:o,texture:this.Kf,useTexture:this.Vw,vP:this._animateLayerState}),!0}}},{key:"pickRender",value:function(){var i;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var o=(i=this.loca)==null?void 0:i.customCoords.getMVPMatrix(),s=this.loca.customCoords.getCameraParams().position,l=RenderHelper.IA(this.loca.lights);this.ll&&this.Kf&&this.ll.pickRender({meshes:this.meshes,mvp:o,lights:l,shininess:this.shininess,acceptLight:this.acceptLight,opacity:this._getOpacity(),depth:this.depth,blockHide:this.blockHide,cull:this.cullface,texture:this.Kf,pickFbo:this._needPickFrame&&this._pickFbo,pickPos:this._pickPos,cameraPosition:s,vP:this._animateLayerState})}}},{key:"afterRender",value:function(){}},{key:"Rw",value:function(i){var o=this;if(this.Vw=!!i,!(this.Kf||!this.loca||!this.loca.regl)&&(this.Kf=this.loca.regl.texture({data:[[[0,255,0,0],[255,0,0,0]],[[0,0,255,0],[255,255,0,0]]],flipY:!0}),!!i))if(Object.prototype.toString.call(i)==="[object String]"){var s=new Image;s.crossOrigin="anonymous",s.src=i,s.onload=function(){o.Kf=o.loca.regl.texture(__spreadValues$s({data:s,flipY:!0},getMipMap$1(s.naturalWidth,s.naturalHeight)))}}else this.Kf=this.loca.regl.texture(__spreadValues$s({data:i,flipY:!0},getMipMap$1(i.width,i.height)))}},{key:"PA",value:function(){return RenderHelper.SA(this.ll,this)}}]),a}(Layer),pushArray$o=CommonUtil$1._C,LineFusion=function(n){_inherits(a,n);var r=_create_super(a);function a(){return _class_call_check(this,a),r.apply(this,arguments)}return _create_class(a,[{key:"DC",value:function(){}},{key:"buildStyle",value:function(i,o){for(var s,l=line.style,u=[],c=0;c<i.length;c++)if(!(!i[c].features||!i[c].features.lines)){for(var f=i[c].features.lines,h=StyleInstance.parse(f,o,l),p={},d=0;d<f.length;d++)if(h)for(var v in h.attributes){var _=h.attributes[v];p[v]||(p[v]=[]),((s=_[d])==null?void 0:s.length)>0?pushArray$o(p[v],_[d]):p[v][p[v].length]=_[d]}u.push({attributes:p,uniforms:h.uniforms,si:h.si})}return u}},{key:"fusion",value:function(i,o,s,l){if(!this.regl||!s.loca)return[];var u=[];l=l||this.buildStyle(i,o);for(var c=s.loca.customCoords,f=0;f<i.length;f++){var h=i[f];if(!(!h.features||!h.features.lines||!l[f])){for(var p=h.features.lines,d=l[f],v={index:[],vertex:[],color:[],normal:[],lineWidth:[],distance:[],dash:[],borderColor:[],borderWidth:[],pickColor:[]},_=[],m=0;m<p.length;m++){var y=p[m],g=y.coordinates,C=s.colorPick.add(y);if(y.type==="MultiLineString")for(var b=0,k=g.length;b<k;b++){var L=g[b],F=this.triangles(L,{style:d,index:m,pickColor:C,id:y.sr},c);GeoUtil.mergeTriangles(v,F,4),pushArray$o(v.color,F.color),pushArray$o(v.normal,F.normal),pushArray$o(v.lineWidth,F.lineWidth),pushArray$o(v.distance,F.distance),pushArray$o(v.dash,F.dash),pushArray$o(v.borderColor,F.borderColor),pushArray$o(v.pickColor,F.pickColor),pushArray$o(v.borderWidth,F.borderWidth)}else{var W=this.triangles(g,{style:d,index:m,pickColor:C,id:y.sr},c);GeoUtil.mergeTriangles(v,W,4),pushArray$o(v.color,W.color),pushArray$o(v.normal,W.normal),pushArray$o(v.lineWidth,W.lineWidth),pushArray$o(v.distance,W.distance),pushArray$o(v.dash,W.dash),pushArray$o(v.pickColor,W.pickColor),pushArray$o(v.borderColor,W.borderColor),pushArray$o(v.borderWidth,W.borderWidth)}_[m]=v.lineWidth.length}u[f]={id:h.id,attributes:{color:{buffer:this.regl.buffer(v.color),offset:0,stride:4*4,td:!1,divisor:0},dash:{buffer:this.regl.buffer(v.dash),offset:0,stride:4*4,td:!1,divisor:0},position:{buffer:this.regl.buffer(v.vertex),offset:0,stride:4*4,td:!1,divisor:0},normal:{buffer:this.regl.buffer(v.normal),offset:0,stride:4*3,td:!1,divisor:0},lineWidth:{buffer:this.regl.buffer(v.lineWidth),offset:0,stride:4,td:!1,divisor:0},borderWidth:{buffer:this.regl.buffer(v.borderWidth),offset:0,stride:4,td:!1,divisor:0},borderColor:{buffer:this.regl.buffer(v.borderColor),offset:0,stride:4*4,td:!1,divisor:0},distance:{buffer:this.regl.buffer(v.distance),offset:0,stride:4*2,td:!1,divisor:0},pickColor:{buffer:this.regl.buffer(v.pickColor),offset:0,stride:4*4,td:!1,divisor:0},index:this.regl.elements({primitive:"triangles",type:"uint32",data:v.index})},uniforms:d.uniforms,si:d.si,mf:{Tw:{jw:_},altitude:d.attributes.altitude,origin:{color:v.color,lineWidth:v.lineWidth,borderColor:v.borderColor,borderWidth:v.borderWidth,dash:v.dash,vertex:v.vertex}}}}}return u}},{key:"triangles",value:function(i,o,s){var l=o.index,u=o.pickColor,c=o.style.attributes,f=c.lineWidth,h=c.color,p=c.dash,d=c.borderColor,v=c.borderWidth,_=c.altitude,m=h.slice(l*4,l*4+4),y=p.slice(l*4,l*4+4),g=d.slice(l*4,l*4+4),C=v[l],b=f[l],k=_[l],L={vertex:[],index:[]},F=[],W=[],j=[],Y=[],N=[],$=[],w=[],E=[],A=glMatrix.vec3.create();glMatrix.vec3.set(A,0,0,1);for(var R,O,P,T=0,M=i.length-1;M>0;M--){var U=i[M],Q=i[M-1];U[0]===Q[0]&&U[1]===Q[1]&&i.splice(M,1)}for(var K=0,te=i.length;K<te-1;K++){var ve=[],de=[0,1,3,0,3,2],be=R||s.lngLatToCoord(i[K]),et=i[K][2]||k||0,qe=O||s.lngLatToCoord(i[K+1]),Ne=i[K+1][2]||k||0,Ge=!1,ft=!1,Ze=0,pt=0,dt=W.length;K>0&&(Ze=W[dt-1]);var Ot=glMatrix.vec2.distance(be,qe),mt=Math.max(Ot,T),at=mt;pt=Ze+Ot,K+2<te&&(Ge=s.lngLatToCoord(i[K+2]),at=Math.max(Ot,glMatrix.vec2.distance(Ge,qe))),pushArray$o(W,[mt,Ze,mt,Ze,at,pt,at,pt]);var St=this.calcNormal(be,qe,A),Tt=[St[0],St[1],0],Dt=[0,0,0],Lt=[0,0,0],Rt=P||{Fw:St,angle:Math.PI},It=Ge?this.calcAngleNormal(be,qe,Ge):{Fw:St,angle:Math.PI};It.Fw[0]===0&&It.Fw[1]===0&&(It.Fw[0]=-St[0],It.Fw[1]=-St[1]),Dt[0]=Rt.Fw[0],Dt[1]=Rt.Fw[1],Lt[0]=It.Fw[0],Lt[1]=It.Fw[1];var Bt=this.calcAngle(St,Dt),Ft=this.calcAngle(St,Lt);Bt<Math.PI/2&&Ft<Math.PI/2||Bt>Math.PI/2&&Ft>Math.PI/2?ft=!0:ft=!1,Bt<Math.PI/2&&(St=[-St[0],-St[1],0]),Ft<Math.PI/2&&(Tt=[-Tt[0],-Tt[1],0]);var ot=this.calcWise(Dt,[-St[0],-St[1]])||1,bt=this.calcWise(Lt,[-Tt[0],-Tt[1]])||1;if(Dt[2]=-ot*Rt.angle,Lt[2]=-bt*It.angle,this.addVertex({Lw:ve,Gh:j,Ww:F,Nw:w,Uw:Y,qw:N,Gw:$,Qw:E,vertex:[be[0],be[1],et,o.id],color:m,normal:St,lineWidth:b,dash:y,Hw:g,Yw:C,pickColor:u}),this.addVertex({Lw:ve,Gh:j,Ww:F,Nw:w,Uw:Y,qw:N,Gw:$,Qw:E,vertex:[be[0],be[1],et,o.id],color:m,normal:Dt,lineWidth:b,dash:y,Hw:g,Yw:C,pickColor:u}),this.addVertex({Lw:ve,Gh:j,Ww:F,Nw:w,Uw:Y,qw:N,Gw:$,Qw:E,vertex:[qe[0],qe[1],Ne,o.id],color:m,normal:ft?Tt:Lt,lineWidth:b,dash:y,Hw:g,Yw:C,pickColor:u}),this.addVertex({Lw:ve,Gh:j,Ww:F,Nw:w,Uw:Y,qw:N,Gw:$,Qw:E,vertex:[qe[0],qe[1],Ne,o.id],color:m,normal:ft?Lt:Tt,lineWidth:b,dash:y,Hw:g,Yw:C,pickColor:u}),Ge){pushArray$o(W,[at,pt]);var rt=this.calcNormal(qe,Ge,A),Pt=this.calcAngle(rt,Lt);Pt<Math.PI/2&&(rt[0]=-rt[0],rt[1]=-rt[1]),this.addVertex({Lw:ve,Gh:j,Ww:F,Nw:w,Uw:Y,qw:N,Gw:$,Qw:E,vertex:[qe[0],qe[1],Ne,o.id],color:m,normal:rt,lineWidth:b,dash:y,Hw:g,Yw:C,pickColor:u}),de[6]=2,de[7]=3,de[8]=4}GeoUtil.mergeTriangles(L,{index:de,vertex:ve},4),R=qe,O=Ge,P=It,T=at}return{index:L.index,vertex:L.vertex,distance:W,normal:F,color:j,lineWidth:w,dash:Y,borderColor:N,borderWidth:$,pickColor:E}}},{key:"addVertex",value:function(i){var o=i.Lw,s=i.Gh,l=i.Ww,u=i.Nw,c=i.Uw,f=i.qw,h=i.Gw,p=i.Qw,d=i.vertex,v=i.color,_=i.normal,m=i.lineWidth,y=i.dash,g=i.Hw,C=i.Yw,b=i.pickColor,k=o.length,L=s.length,F=l.length;o[k]=d[0],o[k+1]=d[1],o[k+2]=d[2],o[k+3]=d[3],s[L]=v[0],s[L+1]=v[1],s[L+2]=v[2],s[L+3]=v[3],l[F]=_[0],l[F+1]=_[1],l[F+2]=_[2],u[u.length]=m,c[L]=y[0],c[L+1]=y[1],c[L+2]=y[2],c[L+3]=y[3],f[L]=g[0],f[L+1]=g[1],f[L+2]=g[2],f[L+3]=g[3],p[L]=b[0],p[L+1]=b[1],p[L+2]=b[2],p[L+3]=b[3],h[h.length]=C}},{key:"calcAngleNormal",value:function(i,o,s){var l=glMatrix.vec2.create();glMatrix.vec2.set(l,i[0],i[1]);var u=glMatrix.vec2.create();glMatrix.vec2.set(u,o[0],o[1]);var c=glMatrix.vec2.create();glMatrix.vec2.set(c,s[0],s[1]);var f=glMatrix.vec2.create();glMatrix.vec2.sub(f,l,u),glMatrix.vec2.normalize(f,f);var h=glMatrix.vec2.create();glMatrix.vec2.sub(h,c,u),glMatrix.vec2.normalize(h,h);var p=glMatrix.vec2.create();return glMatrix.vec2.add(p,f,h),glMatrix.vec2.normalize(p,p),{Fw:[p[0],p[1],0],angle:this.calcAngle([f[0],f[1],0],[h[0],h[1],0])}}},{key:"calcAngle",value:function(i,o){var s=glMatrix.vec3.dot(i,o),l=s/glMatrix.vec3.length(i)/glMatrix.vec3.length(o);return Math.acos(Math.max(-1,Math.min(1,l)))}},{key:"calcNormal",value:function(i,o,s){var l=glMatrix.vec3.create(),u=glMatrix.vec3.create();glMatrix.vec3.set(u,i[0],i[1],0);var c=glMatrix.vec3.create();glMatrix.vec3.set(c,o[0],o[1],0);var f=glMatrix.vec3.create();return glMatrix.vec3.sub(f,c,u),glMatrix.vec3.cross(l,s,f),glMatrix.vec3.normalize(l,l),[l[0],l[1],0]}},{key:"calcWise",value:function(i,o){var s=glMatrix.vec3.create(),l=glMatrix.vec2.fromValues(i[0],i[1]),u=glMatrix.vec2.fromValues(o[0],o[1]);return glMatrix.vec2.cross(s,l,u),s[2]===0?s[2]:s[2]/Math.abs(s[2])}},{key:"updateStyle",value:function(i,o){for(var s=0,l=i.length;s<l;s++){for(var u=i[s],c=o[s].attributes,f=c.color,h=c.lineWidth,p=c.borderColor,d=c.borderWidth,v=c.dash,_=c.altitude,m=u.mf.origin,y=m.borderColor,g=m.color,C=m.lineWidth,b=m.borderWidth,k=m.dash,L=m.vertex,F=u.mf.altitude,W=u.mf.Tw.jw,j=0,Y=0,N=C.length;Y<N;Y++){var $=Y*4;Y>=W[j]&&j++;var w=j*4;g[$]=f[w],g[$+1]=f[w+1],g[$+2]=f[w+2],g[$+3]=f[w+3],y[$]=p[w],y[$+1]=p[w+1],y[$+2]=p[w+2],y[$+3]=p[w+3],k[$]=v[w],k[$+1]=v[w+1],k[$+2]=v[w+2],k[$+3]=v[w+3],b[Y]=d[j],C[Y]=h[j],F[j]!==_[j]&&(L[$+2]=_[j])}u.attributes.color.buffer({data:g}),u.attributes.lineWidth.buffer({data:C}),u.attributes.borderColor.buffer({data:y}),u.attributes.borderWidth.buffer({data:b}),u.attributes.dash.buffer({data:k}),u.attributes.position.buffer({data:L})}}},{key:"EC",value:function(){return[]}},{key:"destroy",value:function(){this.regl=null}}]),a}(GeometryFusion),LineShader={vertex:"\n        precision highp float;\n        #define PI 3.14159265359\n        attribute vec4 position;\n        attribute vec4 color;\n        attribute vec4 borderColor;\n        attribute vec4 dash;\n        attribute vec3 normal;\n        attribute float lineWidth;\n        attribute float borderWidth;\n        attribute vec2 distance;\n        varying vec4 vColor;\n        varying vec4 vBorderColor;\n        varying vec4 vDash;\n        varying vec2 vNormal;\n        varying float vDist;\n        varying float vWidth;\n        varying float vBorderWidth;\n        uniform mat4 mvp;\n        uniform float resolution;\n        uniform float unit; // 0: px; 1: meter;\n        ".concat(ColorGLSL.getColorShader().vertex,"\n        ").concat(RenderUtil.getBezier(),"\n        ").concat(RenderUtil.getScaleType("lineWidth"),"\n        ").concat(RenderUtil.getScaleType("altitude"),"\n\n        void main() {\n            vColor = color;\n            vBorderColor = borderColor;\n            vDash = dash;\n            vDist = distance.y; // \u8DDD\u79BB\u7EBF\u8D77\u59CB\u70B9\u7684\u8DDD\u79BB\n            float res = unit == 0.0 ? resolution : 1.0;\n            float lineWidthScale = lineWidthScaleValue(position.w);\n            float altitudeScale = altitudeScaleValue(position.w);\n            float realLineWidth = (borderWidth + lineWidth / 2.) * res * lineWidthScale;\n            vWidth = lineWidth * lineWidthScale;\n            vBorderWidth = borderWidth * lineWidthScale;\n            // \u7EBF\u6BB5\u7684\u6CD5\u5411\u91CF\u8FD8\u539F\n            vec2 tmpNormal = normal.xy;\n            float angleLineWidth = realLineWidth;\n\n            // z \u65B9\u5411\u4E0D\u7B49\u4E8E 0\uFF0C\u8BF4\u660E\u662F\u62D0\u89D2\u5411\u91CF\uFF0Cz \u4EE3\u8868\u89D2\u5EA6\uFF0C\u9700\u8981\u5BF9\u7EBF\u5BBD\u8FDB\u884C\u8BA1\u7B97\n            if(normal.z != 0.0) {\n                angleLineWidth /= sin(abs(normal.z / 2.));\n                angleLineWidth = max(realLineWidth, min(distance.x, angleLineWidth));\n\n                // \u62D0\u89D2\u5904\u7684\u6CD5\u5411\u91CF\uFF0C\u9700\u8981\u8FD8\u539F\u6210\u5782\u76F4\u7EBF\u6BB5\u65B9\u5411\u7684\u5411\u91CF\n                // \u8FD9\u6837\u624D\u80FD\u5C06\u63CF\u8FB9\u8BA1\u7B97\u51FA\u6765\n                // \u65CB\u8F6C\u89D2\u5EA6\u8BA1\u7B97\n                float theta = normal.z / abs(normal.z) * ((PI - abs(normal.z)) / 2.);\n                // \u65CB\u8F6C\n                tmpNormal =\n                    mat2(cos(theta), -sin(theta),\n                         sin(theta), cos(theta)) * tmpNormal;\n            }\n            vNormal = normalize(tmpNormal.xy);\n\n            vec3 pos = position.xyz + vec3(normal.xy, 0) * angleLineWidth;\n            gl_Position = mvp * vec4(pos.xy, pos.z * altitudeScale, 1.0);\n            ").concat(ColorGLSL.getColorShader().mainVert,"\n        }\n    "),fragment:"\n        precision highp float;\n        uniform float resolution;\n        uniform float unit; // 0: px; 1: meter;\n        uniform float opacity;\n        varying vec4 vDash;\n        varying vec2 vNormal;\n        varying vec4 vColor;\n        varying float vDist;\n        varying float vWidth;\n        varying float vBorderWidth;\n        varying vec4 vBorderColor;\n        ".concat(ColorGLSL.getColorShader().fragment,"\n\n        void main() {\n            float res = unit == 0.0 ? resolution : 1.0;\n            float distPixel = vDist / res;\n            float offset = mod(distPixel, vDash.r + vDash.g + vDash.b + vDash.a);\n            if(offset > vDash.r && offset < vDash.r + vDash.g) {\n                discard;\n            } else if(offset > vDash.r + vDash.g + vDash.b) {\n                discard;\n            }\n\n            gl_FragColor = vColor;\n\n            if(vBorderWidth > 0. && length(vNormal) > 1. - vBorderWidth / (vWidth / 2. + vBorderWidth)) {\n                gl_FragColor = vBorderColor;\n            }\n            gl_FragColor.a *= opacity;\n            ").concat(ColorGLSL.getColorShader().mainFrag,"\n        }\n    ")},__defProp$r=Object.defineProperty,__defProps$k=Object.defineProperties,__getOwnPropDescs$k=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$r=Object.getOwnPropertySymbols,__hasOwnProp$r=Object.prototype.hasOwnProperty,__propIsEnum$r=Object.prototype.propertyIsEnumerable,__defNormalProp$r=function(n,r,a){return r in n?__defProp$r(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$r=function(n,r){for(var a in r||(r={}))__hasOwnProp$r.call(r,a)&&__defNormalProp$r(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$r)try{for(var l=__getOwnPropSymbols$r(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$r.call(r,a)&&__defNormalProp$r(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},__spreadProps$k=function(n,r){return __defProps$k(n,__getOwnPropDescs$k(r))},LineRender=function(n){_inherits(a,n);var r=_create_super(a);function a(){return _class_call_check(this,a),r.apply(this,arguments)}return _create_class(a,[{key:"m$",value:function(i){if(!this.regl)return!1;var o=this.regl;this.gA(LineShader,i,{attributes:__spreadValues$r({position:o.prop("position"),color:o.prop("color"),lineWidth:o.prop("lineWidth"),normal:o.prop("normal"),distance:o.prop("distance"),dash:o.prop("dash"),borderColor:o.prop("borderColor"),borderWidth:o.prop("borderWidth")},ColorGLSL.getColor(o).attribute),uniforms:__spreadValues$r(__spreadValues$r(__spreadValues$r({mvp:o.prop("mvp"),resolution:o.prop("resolution"),unit:o.prop("unit"),opacity:o.prop("opacity")},RenderUtil.getScaleUniform("altitude",o)),RenderUtil.getScaleUniform("lineWidth",o)),ColorGLSL.getColor(o).uniform),cull:{enable:!1},depth:{enable:o.prop("depth")},blend:{enable:!0,func:RenderUtil.getBlend()},elements:o.prop("index")})}},{key:"render",value:function(i){var o=this.yA(LineShader);if(o)for(var s=i.meshes,l=i.mvp,u=i.resolution,c=i.opacity,f=i.vP,h=i.depth,p=0;p<s.length;p++){var d=s[p],v=d.attributes,_=d.uniforms,m=_.unit;o(__spreadProps$k(__spreadValues$r(__spreadProps$k(__spreadValues$r({},v),{unit:m==="px"?0:1,mvp:l,resolution:u,depth:h,opacity:c}),RenderUtil.getScaleProps(f)),{isPick:!1}))}}},{key:"pickRender",value:function(i){var o=this,s=this.yA(LineShader);if(s){var l=i.meshes,u=i.mvp,c=i.resolution,f=i.opacity,h=i.pickFbo,p=i.pickPos,d=i.depth,v=i.vP;h&&p&&h.use(function(){o.regl.clear({color:[0,0,0,0],depth:1});for(var _=0;_<l.length;_++){var m=l[_],y=m.attributes,g=m.uniforms,C=g.unit;s(__spreadValues$r(__spreadProps$k(__spreadValues$r({},y),{unit:C==="px"?0:1,mvp:u,depth:d,resolution:c,opacity:f,isPick:!0}),RenderUtil.getScaleProps(v)))}})}}}]),a}(Render),pushArray$n=CommonUtil$1._C,LineLayer=function(n){_inherits(a,n);var r=_create_super(a);function a(i){_class_call_check(this,a);var o;o=r.call(this,i),o.CLASS_NAME="Line",o.fusion=new LineFusion,o.ll=new LineRender,o.depth=!1;var s=line.Sw;return o.zooms=i.zooms===void 0?s.zooms:i.zooms,o.zIndex=i.zIndex===void 0?s.zIndex:i.zIndex,o.opacity=i.opacity===void 0?s.opacity:i.opacity,o.visible=i.visible===void 0?s.visible:i.visible,o.depth=i.depth===void 0?s.depth:i.depth,o.AC({zooms:o.zooms,visible:o.visible,zIndex:o.zIndex}),o.buryPoint.record(o.CLASS_NAME),o}return _create_class(a,[{key:"receiveDataset",value:function(i){this.dataset=i,this.setStyle(this.styleOptions),this.onAdd()}},{key:"setStyle",value:function(i){if(_get(_get_prototype_of(a.prototype),"setStyle",this).call(this,i),this.dataset=this.source.LC(),this.dataset&&this.dataset.length>0&&this.meshes){var o=this.WC(),s=o.didFusion,l=this.fusion.buildStyle(this.dataset,this.styleOptions);this.fusion.updateStyle(s,l),this.loca&&this.loca.requestRender()}}},{key:"getInitialAnimateState",value:function(){return{altitude:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]},lineWidth:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]}}}},{key:"jC",value:function(){_get(_get_prototype_of(a.prototype),"jC",this).call(this),!(!this.loca||!this.loca.regl||this.ll.regl)&&(this.ll.regl=this.loca.regl,this.loca.rendererManager.addRenderer(this.ll))}},{key:"beforeRender",value:function(){if(_get(_get_prototype_of(a.prototype),"beforeRender",this).call(this),!this.fusion.regl&&this.loca&&(this.fusion.regl=this.loca.regl,this.loca.fusionManager.addFusion(this.fusion)),this.jC(),this.source&&(this.dataset=this.source.LC()),this.fusion){var i=this.WC(),o=i.willFusion,s=i.didFusion;if(this.fusion.EC(),o.length>0){var l=this.fusion.fusion(o,this.styleOptions,this);this.meshes=pushArray$n(s,l)}}}},{key:"render",value:function(){var i,o;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var s=(i=this.loca)==null?void 0:i.customCoords.getMVPMatrix(),l=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom());if(this.ll&&this.meshes.length>0)return this.ll.render({meshes:this.meshes,mvp:s,vP:this._animateLayerState,resolution:l,depth:this.depth,opacity:this._getOpacity()}),!0}}},{key:"pickRender",value:function(){var i,o;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var s=(i=this.loca)==null?void 0:i.customCoords.getMVPMatrix(),l=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom());this.ll&&this.ll.pickRender({meshes:this.meshes,mvp:s,vP:this._animateLayerState,resolution:l,depth:this.depth,opacity:this._getOpacity(),pickFbo:this._needPickFrame&&this._pickFbo,pickPos:this._pickPos})}}},{key:"afterRender",value:function(){}},{key:"PA",value:function(){return RenderHelper.SA(this.ll,this)}}]),a}(Layer),__defProp$q=Object.defineProperty,__defProps$j=Object.defineProperties,__getOwnPropDescs$j=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$q=Object.getOwnPropertySymbols,__hasOwnProp$q=Object.prototype.hasOwnProperty,__propIsEnum$q=Object.prototype.propertyIsEnumerable,__defNormalProp$q=function(n,r,a){return r in n?__defProp$q(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$q=function(n,r){for(var a in r||(r={}))__hasOwnProp$q.call(r,a)&&__defNormalProp$q(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$q)try{for(var l=__getOwnPropSymbols$q(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$q.call(r,a)&&__defNormalProp$q(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},__spreadProps$j=function(n,r){return __defProps$j(n,__getOwnPropDescs$j(r))},pushArray$m=CommonUtil$1._C,colorToArray=ColorUtil$1.zC.bind(ColorUtil$1),DEFAULT_VALUE=0,_HeatMapFusion=function(n){_inherits(a,n);var r=_create_super(a);function a(){_class_call_check(this,a);var i;return i=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))),i.dP=[1/0,-1/0],i}return _create_class(a,[{key:"DC",value:function(){for(var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1e3,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3,s=[],l=[],u=0;u<i;u++)for(var c=0;c<o;c++){if(c<o-1&&u>=1){var f=((u-1)*i+c)*6;s[f]=i*(u-1)+c+1,s[f+1]=i*(u-1)+c,s[f+2]=u*i+c,s[f+3]=i*(u-1)+c+1,s[f+4]=u*i+c,s[f+5]=u*i+1+c}l.push(u*i+c)}return{size:[i,o],index:this.regl.elements({primitive:"triangles",type:"uint32",data:s}),position:{buffer:this.regl.buffer(l),offset:0,stride:4*1,td:!1,divisor:0},texture:this.regl.texture({data:[[[0,255,0,200],[255,0,0,200]],[[0,0,255,200],[255,0,255,200]]],flipY:!0})}}},{key:"buildStyle",value:function(i,o){for(var s,l=heatmap.style,u={attributes:[],uniforms:!1,si:!1},c=0;c<i.length;c++)if(!(!i[c].features||!i[c].features.points)){var f=i[c].features.points,h=StyleInstance.parse(f,o,l),p={};u.uniforms||(u.uniforms=h.uniforms),u.si||(u.si=h.si);for(var d=0,v=f.length;d<v;d++)if(h)for(var _ in h.attributes){var m=h.attributes[_];p[_]||(p[_]=[]),((s=m[d])==null?void 0:s.length)>0?pushArray$m(p[_],m[d]):p[_][p[_].length]=m[d]}u.attributes.push(p)}return u}},{key:"fusion",value:function(i,o,s,l){if(!this.regl||!s.loca)return[];var u=[];l=l||this.buildStyle(i,o);for(var c=l.attributes,f=s.loca.customCoords,h=[1/0,1/0,-1/0,-1/0],p=0,d=[1/0,-1/0],v=this.GC(l.uniforms.gradient),_=0;_<i.length;_++){var m=i[_];if(!(!m.features||!m.features.points||!c[_])){for(var y=m.features.points,g=c[_],C=[],b={vertex:[],index:[],radius:[],value:[]},k=[],L=0;L<y.length;L++){var F=y[L],W=F.coordinates,j=+g.radius[L],Y=+g.value[L];Number.isNaN(Y)&&(Y=DEFAULT_VALUE,k.push(L));var N=F.sr;if(F.type==="MultiPoint")for(var $=0,w=W.length;$<w;$++){var E=f.lngLatToCoord(W[$]),A=[E[0],E[1],0,N,E[0],E[1],1,N,E[0],E[1],2,N,E[0],E[1],3,N];GeoUtil.mergeTriangles(b,{vertex:A,index:[0,1,2,1,3,2]},4),pushArray$m(b.radius,[j,j,j,j]),pushArray$m(b.value,[Y,Y,Y,Y]),this.calcBbox(h,E),p=Math.max(p,j),d[0]=Math.min(Y,d[0]),d[1]=Math.max(Y,d[1])}else{var R=f.lngLatToCoord(W),O=[R[0],R[1],0,N,R[0],R[1],1,N,R[0],R[1],2,N,R[0],R[1],3,N];GeoUtil.mergeTriangles(b,{vertex:O,index:[0,1,2,1,3,2]},4),pushArray$m(b.radius,[j,j,j,j]),pushArray$m(b.value,[Y,Y,Y,Y]),this.calcBbox(h,R),p=Math.max(p,j),d[0]=Math.min(Y,d[0]),d[1]=Math.max(Y,d[1])}C[L]=b.radius.length}this.G$(k),u[_]={id:m.id,attributes:{position:{buffer:this.regl.buffer(b.vertex),offset:0,stride:4*4,td:!1,divisor:0},radius:{buffer:this.regl.buffer(b.radius),offset:0,stride:4,td:!1,divisor:0},value:{buffer:this.regl.buffer(b.value),offset:0,stride:4,td:!1,divisor:0},index:this.regl.elements({primitive:"triangles",type:"uint32",data:b.index})},uniforms:__spreadProps$j(__spreadValues$q({},l.uniforms),{gradient:v.Gh,alpha:v.alpha,maxRadius:p,dataBBox:h,min:l.uniforms.min===null?d[0]:l.uniforms.min,max:l.uniforms.max===null?d[1]:l.uniforms.max}),si:__spreadProps$j(__spreadValues$q({},l.si),{count:g.radius.length}),mf:{origin:{radius:b.radius,value:b.value},Tw:{jw:C}}}}}return this.dP=d,u}},{key:"updateStyle",value:function(i,o){for(var s=this.GC(o.uniforms.gradient),l=0,u=i.length;l<u;l++){for(var c=i[l],f=o.attributes[l],h=f.radius,p=f.value,d=c.mf.origin,v=d.radius,_=d.value,m=c.mf.Tw.jw,y=0,g=0,C=[1/0,-1/0],b=new Set,k=0,L=v.length;k<L;k++){k>=m[y]&&y++,v[k]=h[y];var F=+p[y];Number.isNaN(F)&&(F=DEFAULT_VALUE,b.add(y)),_[k]=F,g=Math.max(g,h[y]),C[0]=Math.min(F,C[0]),C[1]=Math.max(F,C[1])}c.attributes.radius.buffer({data:v}),c.attributes.value.buffer({data:_}),c.uniforms=__spreadProps$j(__spreadValues$q(__spreadValues$q({},c.uniforms),o.uniforms),{gradient:s.Gh,alpha:s.alpha,maxRadius:g,min:o.uniforms.min===null?C[0]:o.uniforms.min,max:o.uniforms.max===null?C[1]:o.uniforms.max}),this.G$(Array.from(b))}}},{key:"EC",value:function(){return[]}},{key:"calcBbox",value:function(i,o){var s=o[0],l=o[1];i[0]=Math.min(s,i[0]),i[1]=Math.min(l,i[1]),i[2]=Math.max(s,i[2]),i[3]=Math.max(l,i[3])}},{key:"GC",value:function(i){var o=[],s=[];for(var l in i)i.hasOwnProperty(l)&&o.push({stop:parseFloat(l),color:i[l]});o.sort(function(h,p){return h.stop-p.stop});for(var u=[],c=0;c<o.length;c+=1){var f=colorToArray(o[c].color);s.push(o[c].stop,f[0],f[1],f[2]),u.push(f[3])}return{Gh:s,alpha:u}}},{key:"destroy",value:function(){this.regl=null}},{key:"G$",value:function(i){i.length&&console.warn("\u6570\u636E\u6E90\u4E2D\u5B58\u5728value\u53D6\u503C\u7F3A\u5931\uFF0C\u9ED8\u8BA4\u4E3A".concat(DEFAULT_VALUE,"\uFF0C\u53EF\u80FD\u4F1A\u5F71\u54CD\u8BA1\u7B97\u7ED3\u679C\uFF0C\u8BF7\u68C0\u67E5\u7B2C").concat(i.join("\u3001"),"\u4E2A\u6570\u636E"))}}],[{key:"getInstance",value:function(){return this.ui}}]),a}(GeometryFusion),HeatMapFusion=_HeatMapFusion;HeatMapFusion.ui=new _HeatMapFusion,HeatMapFusion.getInstance();var HeatMapShader={gray:{vertex:"\n            precision highp float;\n            attribute vec4 position;\n            attribute float value;\n            attribute float radius;\n\n            varying float vValue;\n            varying vec2 vDir;\n            varying float vRadius;\n\n            uniform vec4 bbox;\n            uniform float resolution;\n            uniform float unit; // 0: px; 1: meter;\n            uniform float maxRadius;\n            // uniform float radiusScale;\n            ".concat(RenderUtil.getBezier(),"\n            ").concat(RenderUtil.getScaleType("radius"),"\n\n            // \u8BA1\u7B97\u65B9\u4F4D, xy \u662F\u4F4D\u7F6E, zw \u662F \u65B9\u5411 \u5750\u6807\n            vec4 getPosByDirection(vec2 pos, float direction, float r) {\n                vec2 targetPos;\n                vec2 dir;\n\n                targetPos = vec2(pos - r);\n                dir = vec2(-1, -1);\n                if (direction == 1.0) {\n                    targetPos = vec2(pos.x - r, pos.y + r);\n                    dir = vec2(-1, 1);\n                } else if (direction == 2.0) {\n                    targetPos = vec2(pos.x + r, pos.y - r);\n                    dir = vec2(1, -1);\n                } else if (direction == 3.0) {\n                    targetPos = vec2(pos + r);\n                    dir = vec2(1, 1);\n                }\n                return vec4(targetPos, normalize(dir));\n            }\n\n            void main() {\n                float radiusScale = radiusScaleValue(position.w);\n                float r = radius * radiusScale;\n                float maxR = maxRadius;\n                if(unit == 0.0) {\n                    r *= resolution;\n                    maxR *= resolution;\n                }\n                vec4 b = vec4(bbox.xy - maxR, bbox.zw + maxR);\n                vec2 center = vec2((b.z + b.x) / 2.0, (b.w + b.y) / 2.0);\n                vec2 bboxSize = vec2((b.z - b.x), (b.w - b.y)) / 2.0;\n                vec4 posDir = getPosByDirection(position.xy - center, position.z, r);\n                gl_Position = vec4(posDir.xy / bboxSize, 0, 1);\n                vValue = value;\n                vDir = posDir.zw * sqrt(r * r * 2.0);\n                vRadius = r;\n            }\n        "),fragment:"\n            precision highp float;\n            varying float vValue;\n            varying vec2 vDir;\n            varying float vRadius;\n\n            uniform float max;\n            uniform float min;\n\n            void main() {\n                float len = length(vDir);\n                gl_FragColor = vec4(1, 0, 0, (vRadius - len) / vRadius * (vValue - min) / (max - min));\n            }\n        "},grid:{vertex:"\n            precision highp float;\n            attribute float position;\n\n            varying float vValue;\n            varying vec2 vUv;\n\n            uniform mat4 mvp;\n            uniform float resolution;\n            uniform float height;\n            uniform float unit; // 0: px; 1: meter;\n            uniform vec2 size;\n            uniform vec4 bbox;\n            uniform float maxRadius;\n            uniform vec4 heightBezier;\n            uniform sampler2D texture;\n            ".concat(RenderUtil.getBezier(),"\n            ").concat(RenderUtil.getScaleType("height"),"\n\n            vec2 bezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {\n                float t2 = t * t;\n                float one_minus_t = 1.0 - t;\n                float one_minus_t2 = one_minus_t * one_minus_t;\n                return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);\n            }\n\n            vec2 toBezier(float t, vec4 p) {\n                return bezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));\n            }\n\n            // \u8BA1\u7B97\u7EB9\u7406\u5750\u6807\n            vec2 calcUV(float index, vec2 size) {\n                float y = floor(index / size.x);\n                float x = mod(index, size.x);\n                return vec2(x / (size.x - 1.0), y / (size.y - 1.0));\n            }\n\n            // \u8BA1\u7B97\u9876\u70B9\u5750\u6807\n            vec2 calcVertex(float index, vec2 size, vec4 bbox) {\n                // \u6839\u636E\u7D22\u5F15\u83B7\u53D6\u7ECF\u7EAC\u5EA6\n                float col = mod(index, size.x);\n                float row = floor(index / size.x);\n                float widthStep = (bbox.b - bbox.r) / (size.x - 1.0);\n                float heightStep = (bbox.a - bbox.g) / (size.y - 1.0);\n                float x = bbox.x + col * widthStep;\n                float y = bbox.y + row * heightStep;\n                return vec2(x, y);\n            }\n\n            void main() {\n                float heightScale = heightScaleValue(position);\n                vUv = calcUV(position, size);\n                vec4 color = texture2D(texture, vUv);\n                float h = height * toBezier(color.a, heightBezier).y;\n                float maxR = maxRadius;\n                if(unit == 0.0) {\n                    h *= resolution;\n                    maxR *= resolution;\n                }\n                vec4 b = vec4(bbox.xy - maxR, bbox.zw + maxR);\n                gl_Position = mvp * vec4(calcVertex(position, size, b), h * heightScale, 1);\n            }\n        "),fragment:"\n            precision highp float;\n            varying vec2 vUv;\n            uniform sampler2D texture;\n            uniform float opacity;\n            uniform vec4 gradient[8];\n            uniform vec2 alpha;\n            uniform bool difference;\n            uniform bool isPick;\n\n            float fade(float low, float high, float value) {\n                if (value < low || value > high) { return 0.0; }\n                return (value-low) / (high-low);\n            }\n\n            // \u6570\u503C\u6620\u5C04\u51FD\u6570\uFF0C\u4E3A\u4E86\u5C06 x:0-1 \u6620\u5C04\u5230\u4EFB\u610F\u4E00\u4E2A [min, max] \u533A\u95F4\u7684\u503C\n            float scaleMap(float min, float max, float x) {\n                if(x == 0.0) {\n                    return x;\n                }\n                if(x < 0.0) {\n                    return min;\n                }\n                if(x > 1.0) {\n                    return max;\n                }\n                float delta = max - min;\n                return min + delta * x;\n            }\n\n            vec4 getColor(float intensity) {\n                vec3 color = vec3(0);\n                float a = 1.0;\n                color = mix(vec3(0, 0, 1), gradient[0].yzw, fade(0.0, gradient[0].x, intensity));\n                for (int gn = 0; gn < 8; gn += 1) {\n                    if (gradient[gn].x >= intensity) {\n                        \n                        // \u5F69\u8679\u6548\u679C\n                        if(difference) {\n                            color = mix(gradient[gn+1].yzw, gradient[gn].yzw, intensity);\n                        } else {\n                            // \u6B63\u5E38\u6548\u679C\n                            color = mix(gradient[gn-1].yzw, gradient[gn].yzw, fade(gradient[gn-1].x, gradient[gn].x, intensity));\n                        }\n                        break;\n                    }\n\n                    // bool isBreak = false;\n                    // if (gradient[gn].x >= intensity) {\n                    //     color = mix(gradient[gn-1].yzw, gradient[gn].yzw, intensity);\n                    //     isBreak = true;\n                    // }\n                    // float delta = gradient[gn].x - intensity;\n                    // if((delta > -0.01 && delta < 0.01) && gn > 0 && intensity <= 1.0) {\n                    //     // \u5F69\u8679\u6548\u679C\n                    //     color = mix(gradient[gn+1].yzw, gradient[gn].yzw, (delta * 100. + 1.) / 2.);\n                    //     // color = vec3(0,1,0);\n                    // }\n                    // if(isBreak) {\n                    //     break;\n                    // }\n                }\n                return vec4(color, scaleMap(alpha.x, alpha.y, intensity));\n            }\n\n            void main() {\n                vec4 gray = texture2D(texture, vUv);\n                gl_FragColor = getColor(gray.a);\n                gl_FragColor.a *= opacity;\n                if (isPick) {\n                    // \u907F\u514D\u900F\u660E\u5EA6\u5F71\u54CD\u62FE\u53D6\u51C6\u786E\u6027\uFF0C\u8FD9\u91CC\u628Aa\u901A\u9053\u7684\u503C\u8F6C\u79FB\u5230b\u901A\u9053\n                    gl_FragColor = vec4(0, 0, gray.a, 1);\n                }\n            }\n        "}},__defProp$p=Object.defineProperty,__defProps$i=Object.defineProperties,__getOwnPropDescs$i=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$p=Object.getOwnPropertySymbols,__hasOwnProp$p=Object.prototype.hasOwnProperty,__propIsEnum$p=Object.prototype.propertyIsEnumerable,__defNormalProp$p=function(n,r,a){return r in n?__defProp$p(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$p=function(n,r){for(var a in r||(r={}))__hasOwnProp$p.call(r,a)&&__defNormalProp$p(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$p)try{for(var l=__getOwnPropSymbols$p(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$p.call(r,a)&&__defNormalProp$p(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},__spreadProps$i=function(n,r){return __defProps$i(n,__getOwnPropDescs$i(r))},_HeatMapRender=function(n){_inherits(a,n);var r=_create_super(a);function a(){_class_call_check(this,a);var i;return i=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))),i.Xw=[0,0],i}return _create_class(a,[{key:"m$",value:function(i){if(!this.regl)return!1;var o=this.regl;this.Jw=o.framebuffer({width:o._gl.drawingBufferWidth,height:o._gl.drawingBufferHeight,Zh:!1,stencil:!1,depth:!1}),this.Xw=[this.regl._gl.drawingBufferWidth,this.regl._gl.drawingBufferHeight],this.gA(HeatMapShader.gray,i,{framebuffer:o.prop("framebuffer"),attributes:{position:o.prop("position"),value:o.prop("value"),radius:o.prop("radius")},uniforms:__spreadValues$p({bbox:o.prop("bbox"),unit:o.prop("unit"),resolution:o.prop("resolution"),min:o.prop("min"),max:o.prop("max"),maxRadius:o.prop("maxRadius")},RenderUtil.getScaleUniform("radius",o)),depth:{enable:!1},blend:{enable:!0,func:RenderUtil.getBlend()},elements:o.prop("index")}),this.gA(HeatMapShader.grid,i,{attributes:{position:o.prop("position")},uniforms:__spreadValues$p({mvp:o.prop("mvp"),opacity:o.prop("opacity"),texture:o.prop("texture"),bbox:o.prop("bbox"),size:o.prop("size"),height:o.prop("height"),unit:o.prop("unit"),heightBezier:o.prop("heightBezier"),resolution:o.prop("resolution"),maxRadius:o.prop("maxRadius"),gradient:o.prop("gradient"),alpha:o.prop("alpha"),difference:o.prop("difference"),isPick:o.prop("isPick")},RenderUtil.getScaleUniform("height",o)),depth:{enable:o.prop("depth")},blend:{enable:!0,func:RenderUtil.getBlend()},cull:{enable:!0,face:"back"},frontFace:"cw",elements:o.prop("index")})}},{key:"render",value:function(i){var o=this,s=function(k){var L=f[k],F=L.attributes,W=L.uniforms,j=W.unit,Y=W.max,N=W.min,$=W.gradient,w=W.opacity,E=W.heightBezier,A=W.height,R=W.dataBBox,O=W.maxRadius,P=W.difference,T=L.si,M=T.count,U=o.QC(y,R);o.Jw.use(function(){l.regl.clear({color:[0,0,0,0],depth:1}),u(__spreadValues$p(__spreadProps$i(__spreadValues$p({framebuffer:l.Jw},F),{unit:j==="px"?0:1,resolution:p,max:Y,min:N,bbox:U,maxRadius:O,count:M}),RenderUtil.getScaleProps(C,"radius")))}),c(__spreadValues$p({texture:o.Jw,heightBezier:E,unit:j==="px"?0:1,height:A,gradient:o.HC($),alpha:w,position:_,index:v,resolution:p,mvp:h,bbox:U,maxRadius:O,size:m,opacity:d,depth:g,difference:P,isPick:!1},RenderUtil.getScaleProps(C,"height")))},l=this,u=this.yA(HeatMapShader.gray),c=this.yA(HeatMapShader.grid);if(!(!u||!c)){var f=i.meshes,h=i.mvp,p=i.resolution,d=i.opacity,v=i.index,_=i.position,m=i.size,y=i.bbox,g=i.depth,C=i.vP;(this.Xw[0]!==this.regl._gl.drawingBufferWidth||this.Xw[1]!==this.regl._gl.drawingBufferHeight)&&(this.Xw=[this.regl._gl.drawingBufferWidth,this.regl._gl.drawingBufferHeight],this.Jw({width:this.Xw[0],height:this.Xw[1]}));for(var b=0;b<f.length;b++)s(b)}}},{key:"pickRender",value:function(i){var o=this,s=this.yA(HeatMapShader.gray),l=this.yA(HeatMapShader.grid);if(!(!s||!l)){var u=i.meshes,c=i.mvp,f=i.resolution,h=i.opacity,p=i.index,d=i.position,v=i.size,_=i.bbox,m=i.depth,y=i.vP,g=i.pickFbo,C=i.pickPos;g&&C&&g.use(function(){o.regl.clear({color:[0,0,0,0],depth:1});for(var b=0;b<u.length;b++){var k=u[b],L=k.uniforms,F=L.unit,W=L.gradient,j=L.opacity,Y=L.heightBezier,N=L.height,$=L.dataBBox,w=L.maxRadius,E=L.difference,A=o.QC(_,$);l(__spreadValues$p({texture:o.Jw,heightBezier:Y,unit:F==="px"?0:1,height:N,gradient:o.HC(W),alpha:j,position:d,index:p,resolution:f,mvp:c,bbox:A,maxRadius:w,size:v,opacity:h,depth:m,difference:E,isPick:!0},RenderUtil.getScaleProps(y,"height")))}})}}},{key:"QC",value:function(i,o){var s=[];return s[0]=Math.max(i[0],o[0]),s[1]=Math.max(i[1],o[1]),s[2]=Math.min(i[2],o[2]),s[3]=Math.min(i[3],o[3]),s}},{key:"HC",value:function(i){for(var o=i.length,s=0;s<8;s++)o<=s*4&&(i=i.concat([-1,0,0,0]));return i}},{key:"destroy",value:function(){_get(_get_prototype_of(a.prototype),"destroy",this).call(this),this.Jw&&this.Jw.destroy(),this.Jw=null}}],[{key:"getInstance",value:function(){return this.ui}}]),a}(Render),HeatMapRender=_HeatMapRender;HeatMapRender.ui=new _HeatMapRender,HeatMapRender.getInstance();var __defProp$o=Object.defineProperty,__defProps$h=Object.defineProperties,__getOwnPropDescs$h=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$o=Object.getOwnPropertySymbols,__hasOwnProp$o=Object.prototype.hasOwnProperty,__propIsEnum$o=Object.prototype.propertyIsEnumerable,__defNormalProp$o=function(n,r,a){return r in n?__defProp$o(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$o=function(n,r){for(var a in r||(r={}))__hasOwnProp$o.call(r,a)&&__defNormalProp$o(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$o)try{for(var l=__getOwnPropSymbols$o(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$o.call(r,a)&&__defNormalProp$o(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},__spreadProps$h=function(n,r){return __defProps$h(n,__getOwnPropDescs$h(r))},pushArray$l=CommonUtil$1._C,HeatMapLayer=function(n){_inherits(a,n);var r=_create_super(a);function a(i){_class_call_check(this,a);var o;o=r.call(this,i),o.CLASS_NAME="HeatMap",o.fusion=new HeatMapFusion,o.ll=new HeatMapRender,o.Kw=!1;var s=heatmap.Sw;return o.zooms=i.zooms===void 0?s.zooms:i.zooms,o.zIndex=i.zIndex===void 0?s.zIndex:i.zIndex,o.opacity=i.opacity===void 0?s.opacity:i.opacity,o.visible=i.visible===void 0?s.visible:i.visible,o.depth=i.depth===void 0?s.depth:i.depth,o.AC({zooms:o.zooms,visible:o.visible,zIndex:o.zIndex}),o.buryPoint.record(o.CLASS_NAME),o}return _create_class(a,[{key:"receiveDataset",value:function(i){this.dataset=i,this.setStyle(this.styleOptions),this.onAdd()}},{key:"setStyle",value:function(i){if(_get(_get_prototype_of(a.prototype),"setStyle",this).call(this,i),this.dataset=this.source.LC(),this.dataset&&this.dataset.length>0&&this.meshes){var o=this.WC(),s=o.didFusion,l=this.fusion.buildStyle(this.dataset,this.styleOptions);this.fusion.updateStyle(s,l),this.loca&&this.loca.requestRender()}}},{key:"getInitialAnimateState",value:function(){return{height:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]},radius:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]}}}},{key:"jC",value:function(){_get(_get_prototype_of(a.prototype),"jC",this).call(this),!(!this.loca||!this.loca.regl||this.ll.regl)&&(this.ll.regl=this.loca.regl,this.loca.rendererManager.addRenderer(this.ll))}},{key:"beforeRender",value:function(){if(_get(_get_prototype_of(a.prototype),"beforeRender",this).call(this),!this.fusion.regl&&this.loca&&(this.fusion.regl=this.loca.regl,this.loca.fusionManager.addFusion(this.fusion)),this.jC(),this.source&&(this.dataset=this.source.LC()),this.fusion){var i=this.WC(),o=i.willFusion,s=i.didFusion;if(this.fusion.EC(),o.length>0){var l=this.fusion.fusion(o,this.styleOptions,this);this.meshes=pushArray$l(s,l),this.Kw=this.Kw||this.fusion.DC()}}}},{key:"render",value:function(){if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var i=this.loca.customCoords,o=i.getMVPMatrix(),s=this.projection.getResolution(this.loca.map.getZoom()),l=this.loca.map.getBounds().toJSON(),u=_to_consumable_array(i.lngLatToCoord(l.slice(0,2))).concat(_to_consumable_array(i.lngLatToCoord(l.slice(2))));if(this.ll&&this.meshes.length>0)return this.ll.render(__spreadProps$h(__spreadValues$o({meshes:this.meshes,mvp:o,resolution:s,opacity:this._getOpacity()},this.Kw),{bbox:u,depth:this.depth,vP:this._animateLayerState})),!0}}},{key:"pickRender",value:function(){var i=this;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var o=this.loca.customCoords,s=o.getMVPMatrix(),l=this.projection.getResolution(this.loca.map.getZoom()),u=this.loca.map.getBounds().toJSON(),c=_to_consumable_array(o.lngLatToCoord(u.slice(0,2))).concat(_to_consumable_array(o.lngLatToCoord(u.slice(2))));if(this.ll&&this.meshes.length>0){this.aP(this.loca.regl,!0),this.ll.pickRender(__spreadProps$h(__spreadValues$o({meshes:this.meshes,mvp:s,resolution:l,opacity:this._getOpacity()},this.Kw),{bbox:c,depth:this.depth,pickFbo:this._needPickFrame&&this._pickFbo,pickPos:this._pickPos,vP:this._animateLayerState}));var f=this.styleOptions,h=f.height,p=h===void 0?heatmap.style.height.defaultValue:h,d=f.heightBezier,v=d===void 0?heatmap.style.heightBezier.defaultValue:d,_=f.unit,m=_===void 0?heatmap.style.unit.defaultValue:_;return function(y){var g,C=y[2],b=C/255,k=new bezierJs.Bezier({x:0,y:0},{x:v[0],y:v[1]},{x:v[2],y:v[3]},{x:1,y:1}),L=p*k.get(b).y,F=m==="px"?L*l:L,W=_sliced_to_array(i.fusion.dP,2),j=W[0],Y=W[1];return{scale:b,value:b!==0?j+(Y-j)*b:0,height:L,lnglat:(g=i.loca)==null?void 0:g.map.containerToLngLat(_to_consumable_array(i._pickPos).concat([F])).toArray()}}}}}},{key:"afterRender",value:function(){}},{key:"getGradientSteps",value:function(){for(var i=this.styleOptions,o=i.gradient,s=o===void 0?heatmap.style.gradient.defaultValue:o,l=_sliced_to_array(this.fusion.dP,2),u=l[0],c=l[1],f=this.fusion.GC(s),h=f.Gh,p=f.alpha,d=[],v=0,_=0;v<h.length;v+=4,_+=1){var m=_sliced_to_array(h.slice(v,v+4),4),y=m[0],g=m[1],C=m[2],b=m[3],k=p[_];d.push({color:"rgba(".concat([g*255,C*255,b*255,k].join(","),")"),scale:y,value:y!==0?u+(c-u)*y:0})}return d}},{key:"destroy",value:function(){_get(_get_prototype_of(a.prototype),"destroy",this).call(this)}},{key:"PA",value:function(){return RenderHelper.SA(this.ll,this)}}]),a}(Layer),Dat=function(){function n(){_class_call_check(this,n),this.style={},this.lights=[],this._w=new dat__namespace.GUI}return _create_class(n,[{key:"addLayer",value:function(r){var a=function(h){c[h]=u[h];var p=l[h].type;if(_instanceof(c[h],Function))return"continue";c[h]===void 0&&(c[h]=l[h].defaultValue),p==="color"?s.addColor(c,h).onChange(function(d){c[h]=d,r.setStyle(o.getStyle(r,c))}):p==="array"?(c[h]=c[h]+"",s.add(c,h).onChange(function(d){c[h]=d,r.setStyle(o.getStyle(r,c))})):p==="image"?(Object.prototype.toString.call(c[h])!=="[object String]"&&(c[h]=""),s.add(c,h).onChange(function(d){c[h]=d,r.setStyle(o.getStyle(r,c))})):p==="object"?(c[h]=JSON.stringify(c[h]),s.add(c,h).onChange(function(d){c[h]=d,r.setStyle(o.getStyle(r,c))})):p==="nest"?(c[h]=nestStringify(c[h]),s.add(c,h).onChange(function(d){c[h]=d,r.setStyle(o.getStyle(r,c))})):s.add(c,h).onChange(function(d){c[h]=d,r.setStyle(o.getStyle(r,c))})},i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"\u56FE\u5C42",o=this,s=this._w.addFolder(i),l=this.getSchema(r),u=r.styleOptions,c={};for(var f in l)a(f)}},{key:"addLight",value:function(r,a){var i=function(c){var f=r[c];c==="color"?(l[c]=r[c],s.addColor(l,c).onChange(function(h){l[c]=h,r[c]=l[c],a.requestRender()})):Object.prototype.toString.call(f)==="[object Array]"?(l[c]=r[c]+"",s.add(l,c).onChange(function(h){l[c]=h.split(","),r[c]=l[c],a.requestRender()})):(l[c]=r[c],s.add(l,c).onChange(function(h){l[c]=h,r[c]=l[c],a.requestRender()}))},o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"\u5149\u6E90",s=this._w.addFolder(o),l={};this.lights.push(l);for(var u in r)i(u)}},{key:"addLightInstance",value:function(r,a){var i=this._w.addFolder(a),o={};this.lights.push(o),Object.keys(r.rawproperty).forEach(function(s){var l=r.rawproperty[s];s==="color"?(o[s]=r.rawproperty[s],i.addColor(o,s).onChange(function(u){r[s]=o[s]=u})):Object.prototype.toString.call(l)==="[object Array]"?(o[s]=r.rawproperty[s]+"",i.add(o,s).onChange(function(u){r[s]=o[s]=u.split(",")})):(o[s]=r.rawproperty[s],i.add(o,s).onChange(function(u){r[s]=o[s]=u}))})}},{key:"getSchema",value:function(r){var a=r.CLASS_NAME;if(a)return conf[a.toLowerCase()].style}},{key:"getStyle",value:function(r,a){var i=function(u){var c=o[u].type;if(s[u]=a[u],c==="array"){var f=(a[u]+"").split(",");isNaN(+f[0])||f.forEach(function(h,p){f[p]=+h}),s[u]=f}else c==="object"?s[u]=JSON.parse(s[u]):c==="nest"&&(s[u]=nestParse(s[u]))},o=this.getSchema(r),s={};for(var l in o)i(l);return s}},{key:"destroy",value:function(){this._w.destroy(),this.style={},this.lights=[]}}]),n}(),__defProp$n=Object.defineProperty,__defProps$g=Object.defineProperties,__getOwnPropDescs$g=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$n=Object.getOwnPropertySymbols,__hasOwnProp$n=Object.prototype.hasOwnProperty,__propIsEnum$n=Object.prototype.propertyIsEnumerable,__defNormalProp$n=function(n,r,a){return r in n?__defProp$n(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$n=function(n,r){for(var a in r||(r={}))__hasOwnProp$n.call(r,a)&&__defNormalProp$n(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$n)try{for(var l=__getOwnPropSymbols$n(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$n.call(r,a)&&__defNormalProp$n(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},__spreadProps$g=function(n,r){return __defProps$g(n,__getOwnPropDescs$g(r))},pushArray$k=CommonUtil$1._C,_ScatterFusion=function(n){_inherits(a,n);var r=_create_super(a);function a(){return _class_call_check(this,a),r.apply(this,arguments)}return _create_class(a,[{key:"DC",value:function(){}},{key:"buildStyle",value:function(i,o){for(var s,l=scatter.style,u={attributes:[],uniforms:!1,si:!1},c=0;c<i.length;c++)if(!(!i[c].features||!i[c].features.points)){var f=i[c].features.points,h=StyleInstance.parse(f,o,l),p={};u.uniforms||(u.uniforms=h.uniforms),u.si||(u.si=h.si);for(var d=0,v=f.length;d<v;d++)if(h)for(var _ in h.attributes){var m=h.attributes[_];p[_]||(p[_]=[]),((s=m[d])==null?void 0:s.length)>0?pushArray$k(p[_],m[d]):p[_][p[_].length]=m[d]}u.attributes.push(p)}return u}},{key:"fusion",value:function(i,o,s,l){if(!this.regl||!s.loca)return[];var u=[];l=l||this.buildStyle(i,o);for(var c=l.attributes,f=s.loca.customCoords,h=0;h<i.length;h++){var p=i[h];if(!(!p.features||!p.features.points)){for(var d=p.features.points,v=c[h],_={index:[],vertex:[],color:[],number:[],uv:[],size:[],rotation:[],borderColor:[],borderWidth:[],pickColor:[],labels:[]},m=[],y=0;y<d.length;y++){var g=d[y],C=g.coordinates,b=s.colorPick.add(g);if(g.type==="MultiPoint")for(var k=0,L=C.length;k<L;k++){var F=C[k],W=this.triangles(F,{attribute:v,index:y,pickColor:b},f);GeoUtil.mergeTriangles(_,W),pushArray$k(_.color,W.color),pushArray$k(_.rotation,W.rotation),pushArray$k(_.number,W.number),pushArray$k(_.size,W.size),pushArray$k(_.uv,W.uv),pushArray$k(_.borderColor,W.borderColor),pushArray$k(_.borderWidth,W.borderWidth),pushArray$k(_.pickColor,W.pickColor),v.label[y]&&_.labels.push(__spreadValues$n({position:[F[0],F[1],(F[2]||v.altitude[y])+v.labelAltitude[y]]},v.label[y]))}else{var j=this.triangles(C,{attribute:v,index:y,pickColor:b},f);GeoUtil.mergeTriangles(_,j),pushArray$k(_.color,j.color),pushArray$k(_.rotation,j.rotation),pushArray$k(_.number,j.number),pushArray$k(_.size,j.size),pushArray$k(_.uv,j.uv),pushArray$k(_.borderColor,j.borderColor),pushArray$k(_.borderWidth,j.borderWidth),pushArray$k(_.pickColor,j.pickColor),v.label[y]&&_.labels.push(__spreadValues$n({position:[C[0],C[1],(C[2]||v.altitude[y])+v.labelAltitude[y]]},v.label[y]))}m[y]=_.rotation.length}u[h]={id:p.id,attributes:{color:{buffer:this.regl.buffer(_.color),offset:0,stride:4*4,td:!1,divisor:0},pickColor:{buffer:this.regl.buffer(_.pickColor),offset:0,stride:4*4,td:!1,divisor:0},borderColor:{buffer:this.regl.buffer(_.borderColor),offset:0,stride:4*4,td:!1,divisor:0},position:{buffer:this.regl.buffer(_.vertex),offset:0,stride:4*3,td:!1,divisor:0},number:{buffer:this.regl.buffer(_.number),offset:0,stride:4,td:!1,divisor:0},borderWidth:{buffer:this.regl.buffer(_.borderWidth),offset:0,stride:4,td:!1,divisor:0},rotation:{buffer:this.regl.buffer(_.rotation),offset:0,stride:4,td:!1,divisor:0},size:{buffer:this.regl.buffer(_.size),offset:0,stride:4*2,td:!1,divisor:0},uv:{buffer:this.regl.buffer(_.uv),offset:0,stride:4*2,td:!1,divisor:0},index:this.regl.elements({primitive:"triangles",type:"uint32",data:_.index})},uniforms:l.uniforms,si:l.si,mf:{Tw:{jw:m},altitude:v.altitude,origin:{position:_.vertex,color:_.color,size:_.size,rotation:_.rotation,borderColor:_.borderColor,borderWidth:_.borderWidth},labels:_.labels}}}}return u}},{key:"triangles",value:function(i,o,s){var l=o.index,u=o.pickColor,c=o.attribute,f=c.size,h=c.color,p=c.rotation,d=c.altitude,v=c.borderColor,_=c.borderWidth,m=h.slice(l*4,l*4+4),y=v.slice(l*4,l*4+4),g=f.slice(l*2,l*2+2),C=p[l],b=_[l],k=d[l],L=s.lngLatToCoord(i),F=i[2]||k||0,W=[g[0],g[1],g[0],g[1],g[0],g[1],g[0],g[1]],j=[m[0],m[1],m[2],m[3],m[0],m[1],m[2],m[3],m[0],m[1],m[2],m[3],m[0],m[1],m[2],m[3]],Y=[C,C,C,C],N=[L[0],L[1],F,L[0],L[1],F,L[0],L[1],F,L[0],L[1],F],$=[0,0,0,1,1,0,1,1],w=[y[0],y[1],y[2],y[3],y[0],y[1],y[2],y[3],y[0],y[1],y[2],y[3],y[0],y[1],y[2],y[3]],E=[u[0],u[1],u[2],u[3],u[0],u[1],u[2],u[3],u[0],u[1],u[2],u[3],u[0],u[1],u[2],u[3]],A=[b,b,b,b];return{vertex:N,index:[0,1,2,1,3,2],number:[0,1,3,2],uv:$,size:W,rotation:Y,color:j,borderColor:w,borderWidth:A,pickColor:E}}},{key:"updateStyle",value:function(i,o){for(var s=function(c,f){for(var h=i[c],p=o.attributes[c],d=p.altitude,v=p.color,_=p.borderColor,m=p.borderWidth,y=p.rotation,g=p.size,C=p.label,b=p.labelAltitude,k=h.mf.origin,L=k.position,F=k.borderColor,W=k.color,j=k.borderWidth,Y=k.size,N=k.rotation,$=h.mf.altitude,w=h.mf.Tw.jw,E=0,A=0,R=N.length;A<R;A++){var O=A*4,P=A*2;A>=w[E]&&E++;var T=E*4,M=E*2;$[E]!==d[E]&&(L[O+2-A]=d[E]),W[O]=v[T],W[O+1]=v[T+1],W[O+2]=v[T+2],W[O+3]=v[T+3],F[O]=_[T],F[O+1]=_[T+1],F[O+2]=_[T+2],F[O+3]=_[T+3],Y[P]=+g[M],Y[P+1]=+g[M+1],j[A]=m[E],N[A]=y[E]}h.attributes.position.buffer({data:L}),h.attributes.color.buffer({data:W}),h.attributes.rotation.buffer({data:N}),h.attributes.borderColor.buffer({data:F}),h.attributes.borderWidth.buffer({data:j}),h.attributes.size.buffer({data:Y}),h.uniforms=o.uniforms,h.mf.labels=h.mf.labels.map(function(U,Q){var K=U.position,te=$[Q]!==d[Q]?d[Q]:L[3*Q+2];return K[2]=te+b[Q],__spreadProps$g(__spreadValues$n(__spreadValues$n({},U),C[Q]),{position:K})})},l=0,u=i.length;l<u;l++)s(l,u)}},{key:"EC",value:function(){return[]}},{key:"destroy",value:function(){this.regl=null}}],[{key:"getInstance",value:function(){return this.ui}}]),a}(GeometryFusion),ScatterFusion=_ScatterFusion;ScatterFusion.ui=new _ScatterFusion,ScatterFusion.getInstance();var ScatterShader={vertex:"\n        precision highp float;\n        #define PI 3.14159265359\n        attribute vec3 position;\n        attribute vec4 color;\n        attribute vec4 borderColor;\n        attribute vec2 size;\n        attribute vec2 uv;\n        attribute float rotation;\n        attribute float borderWidth;\n        attribute float number;\n\n        varying vec4 vColor;\n        varying vec4 vBColor;\n        varying float vBWidth;\n        varying vec2 vUv;\n        varying vec2 vSize;\n        varying vec2 vPos;\n\n        uniform mat4 mvp;\n        uniform float resolution;\n        // 0: px, 1: meter\n        uniform float unit;\n        ".concat(ColorGLSL.getColorShader().vertex,"\n\n        void main() {\n            // \u5BF9\u89D2\u7EBF\u957F\u5EA6\u4E00\u534A\n            float diagonal = length(size + vec2(borderWidth * 2.0)) / 2.0;\n            float x = size.x / 2.0 + borderWidth;\n            float y = size.y / 2.0 + borderWidth;\n\n            // \u8BA1\u7B97\u9876\u70B9\u5411\u91CF\n            // 1 3 -- 0 1\n            // 0 2 -- 2 3\n            float rotNumber = mod(number + 2.0, 4.0);\n            float oneAngle = asin(x / diagonal);\n            float twoAngle = asin(y / diagonal) * 2.0;\n            float theta = rotation / 180. * PI + oneAngle;\n            if(rotNumber == 1.0) {\n                theta += twoAngle;\n            } else if(rotNumber == 2.0) {\n                theta += twoAngle + oneAngle * 2.0;\n            } else if(rotNumber == 3.0) {\n                theta += (twoAngle + oneAngle) * 2.0;\n            }\n\n            vec2 pos =\n                mat2(cos(theta), -sin(theta),\n                     sin(theta), cos(theta)) * vec2(0, 1);\n\n            float res = unit == 0.0 ? resolution : 1.0;\n\n            gl_Position = mvp * vec4(position + vec3(pos, 0) * diagonal * res, 1.0);\n        \n            vColor = color;\n            vSize = size;\n            vBWidth = borderWidth;\n            vBColor = borderColor;\n            vUv = uv;\n            vPos = pos * diagonal;\n            ").concat(ColorGLSL.getColorShader().mainVert,"\n        }\n    "),fragment:"\n        precision highp float;\n        uniform float resolution;\n        uniform float opacity;\n        uniform float textureSequence;\n        uniform sampler2D texture;\n        uniform bool useTexture;\n        uniform float animateCounter;\n\n        varying vec2 vSize;\n        varying vec4 vColor;\n        varying vec4 vBColor;\n        varying float vBWidth;\n        varying vec2 vUv;\n        varying vec2 vPos;\n        ".concat(ColorGLSL.getColorShader().fragment,"\n\n        void main() {\n            if(useTexture) {\n                // 0.0001 \u89E3\u51B3 mod \u8FD0\u7B97\u7684\u7CBE\u5EA6\u8BEF\u5DEE\u95EE\u9898\u3002\n                float offset = mod(animateCounter + 0.001, textureSequence) / textureSequence;\n                gl_FragColor = texture2D(texture, vec2(vUv.x / textureSequence + offset, vUv.y));\n                // gl_FragColor = vec4(mod(textureSequence + 0.1, textureSequence) / textureSequence, 0, 0, 1);\n            } else {\n                gl_FragColor = vColor;\n\n                // \u6297\u952F\u9F7F\u50CF\u7D20\u4F4D\n                float len = length(vPos);\n                float taaRadius = 2.0;\n                if(len > vSize.x / 2.0 + vBWidth) {\n                    discard;\n                } else if(len > vSize.x / 2.0 + vBWidth - taaRadius) {\n                    gl_FragColor = vBWidth > 0.0 ? vBColor : vColor;\n                    float opa = smoothstep(1.0, 0.0, (len - (vSize.x / 2.0 + vBWidth - taaRadius)) / taaRadius);\n                    gl_FragColor.a *= opa;\n                } else if(vBWidth > 0.0 && len > vSize.x / 2.0 + taaRadius) {\n                    gl_FragColor = vBColor;\n                } else if(vBWidth > 0.0 && len > vSize.x / 2.0) {\n                    float blend = smoothstep(0.0, 1.0, (len - vSize.x / taaRadius) / taaRadius);\n                    gl_FragColor = mix(vColor, vBColor, blend);\n                }\n            }\n            gl_FragColor.a *= opacity;\n            ").concat(ColorGLSL.getColorShader().mainFrag,"\n        }\n    ")},__defProp$m=Object.defineProperty,__defProps$f=Object.defineProperties,__getOwnPropDescs$f=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$m=Object.getOwnPropertySymbols,__hasOwnProp$m=Object.prototype.hasOwnProperty,__propIsEnum$m=Object.prototype.propertyIsEnumerable,__defNormalProp$m=function(n,r,a){return r in n?__defProp$m(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$m=function(n,r){for(var a in r||(r={}))__hasOwnProp$m.call(r,a)&&__defNormalProp$m(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$m)try{for(var l=__getOwnPropSymbols$m(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$m.call(r,a)&&__defNormalProp$m(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},__spreadProps$f=function(n,r){return __defProps$f(n,__getOwnPropDescs$f(r))},ScatterRender=function(n){_inherits(a,n);var r=_create_super(a);function a(){_class_call_check(this,a);var i;return i=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))),i.v$=[new LabelsRender$1],i}return _create_class(a,[{key:"m$",value:function(i){if(!this.regl)return!1;this.v$.forEach(function(s){return s.m$(i)});var o=this.regl;this.gA(ScatterShader,i,{attributes:__spreadValues$m({position:o.prop("position"),color:o.prop("color"),size:o.prop("size"),uv:o.prop("uv"),rotation:o.prop("rotation"),number:o.prop("number"),borderColor:o.prop("borderColor"),borderWidth:o.prop("borderWidth")},ColorGLSL.getColor(o).attribute),uniforms:__spreadValues$m({mvp:o.prop("mvp"),resolution:o.prop("resolution"),opacity:o.prop("opacity"),unit:o.prop("unit"),texture:o.prop("texture"),textureSequence:o.prop("textureSequence"),useTexture:o.prop("useTexture"),animateCounter:o.prop("animateCounter")},ColorGLSL.getColor(o).uniform),blend:{enable:!0,func:RenderUtil.getBlend("normal"),equation:{rgb:"add",alpha:"add"}},cull:{enable:!0,face:"back"},frontFace:"cw",depth:{enable:o.prop("depth")},elements:o.prop("index")})}},{key:"render",value:function(i){var o=this.yA(ScatterShader);if(o){for(var s=i.meshes,l=i.mvp,u=i.resolution,c=i.opacity,f=i.texture,h=i.useTexture,p=i.animateCounter,d=i.textureSequence,v=i.depth,_=0;_<s.length;_++){var m=s[_],y=m.attributes,g=m.uniforms,C=g.unit,b=g.duration;g.animate;var k=parseInt(p/60*d/(b/1e3));o(__spreadProps$f(__spreadValues$m({},y),{mvp:l,resolution:u,opacity:c,unit:C==="px"?0:1,texture:f,textureSequence:d,useTexture:h,animateCounter:isNaN(k)?0:k,depth:v,isPick:!1}))}for(var L=0;L<s.length;L++){var F=!0,W=!1,j=void 0;try{for(var Y=this.v$[Symbol.iterator](),N;!(F=(N=Y.next()).done);F=!0){var $=N.value;$.render(s[L])}}catch(w){W=!0,j=w}finally{try{!F&&Y.return!=null&&Y.return()}finally{if(W)throw j}}}}}},{key:"pickRender",value:function(i){var o=this,s=this.yA(ScatterShader);if(s){var l=i.meshes,u=i.mvp,c=i.resolution,f=i.opacity,h=i.texture,p=i.useTexture,d=i.animateCounter,v=i.textureSequence,_=i.depth,m=i.pickFbo,y=i.pickPos;h&&m&&y&&m.use(function(){o.regl.clear({color:[0,0,0,0],depth:1});for(var g=0;g<l.length;g++){var C=l[g],b=C.attributes,k=C.uniforms,L=k.unit,F=k.duration,W=k.animate,j=parseInt(d/60*v/(F/1e3));s(__spreadProps$f(__spreadValues$m({},b),{mvp:u,resolution:c,opacity:f,unit:L==="px"?0:1,texture:h,textureSequence:v,useTexture:p,animateCounter:isNaN(j)?0:j,animate:W,depth:_,isPick:!0}))}})}}}]),a}(Render),__defProp$l=Object.defineProperty,__getOwnPropSymbols$l=Object.getOwnPropertySymbols,__hasOwnProp$l=Object.prototype.hasOwnProperty,__propIsEnum$l=Object.prototype.propertyIsEnumerable,__defNormalProp$l=function(n,r,a){return r in n?__defProp$l(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$l=function(n,r){for(var a in r||(r={}))__hasOwnProp$l.call(r,a)&&__defNormalProp$l(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$l)try{for(var l=__getOwnPropSymbols$l(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$l.call(r,a)&&__defNormalProp$l(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},getMipMap=RenderUtil.getMipMap,pushArray$j=CommonUtil$1._C,Scatter=function(n){_inherits(a,n);var r=_create_super(a);function a(i){_class_call_check(this,a);var o;o=r.call(this,i),o.CLASS_NAME="Scatter",o.fusion=new ScatterFusion,o.ll=new ScatterRender,o.Vw=!1,o.nx=0;var s=scatter.Sw;return o.zooms=i.zooms===void 0?s.zooms:i.zooms,o.visible=i.visible===void 0?s.visible:i.visible,o.zIndex=i.zIndex===void 0?s.zIndex:i.zIndex,o.opacity=i.opacity===void 0?s.opacity:i.opacity,o.depth=i.depth===void 0?s.depth:i.depth,o.AC({zooms:o.zooms,visible:o.visible,zIndex:o.zIndex}),o.buryPoint.record(o.CLASS_NAME),o}return _create_class(a,[{key:"getLabelsLayer",value:function(){return this.ll.v$[0]._$||null}},{key:"receiveDataset",value:function(i){this.dataset=i,this.setStyle(this.styleOptions),this.onAdd()}},{key:"setStyle",value:function(i){if(_get(_get_prototype_of(a.prototype),"setStyle",this).call(this,i),!!i&&(this.dataset=this.source.LC(),this.dataset&&this.dataset.length>0)){var o=this.WC(),s=o.didFusion;this.Kf=null;var l=this.fusion.buildStyle(this.dataset,this.styleOptions);this.fusion.updateStyle(s,l),this.vA.state|=MeshDirty,this.loca&&this.loca.requestRender()}}},{key:"jC",value:function(){_get(_get_prototype_of(a.prototype),"jC",this).call(this),!(!this.loca||!this.loca.regl||this.ll.regl)&&(this.ll.regl=this.loca.regl,this.loca.rendererManager.addRenderer(this.ll))}},{key:"beforeRender",value:function(){if(_get(_get_prototype_of(a.prototype),"beforeRender",this).call(this),!this.fusion.regl&&this.loca&&(this.fusion.regl=this.loca.regl,this.loca.fusionManager.addFusion(this.fusion)),this.jC(),this.source&&(this.dataset=this.source.LC()),this.fusion&&this.styleOptions){var i=this.WC(),o=i.willFusion,s=i.didFusion;if(this.fusion.EC(),o.length>0){var l=this.fusion.fusion(o,this.styleOptions,this);this.meshes=pushArray$j(s,l),this.vA.state|=MeshesDirty}}if(this.meshes.length>0){var u=this.meshes[0].uniforms.texture;this.createTexture(u)}}},{key:"render",value:function(){var i,o;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var s=(i=this.loca)==null?void 0:i.customCoords.getMVPMatrix(),l=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom());if(this.ll&&this.meshes.length>0){var u=this.hP();return this.ll.render({meshes:this.meshes,mvp:s,resolution:l,opacity:this._getOpacity(),texture:this.Kf,useTexture:this.Vw,animateCounter:u,textureSequence:this.nx,depth:this.depth}),!0}}}},{key:"pickRender",value:function(){var i,o;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var s=(i=this.loca)==null?void 0:i.customCoords.getMVPMatrix(),l=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom());if(this.ll){var u=this.hP();this.ll.pickRender({meshes:this.meshes,mvp:s,resolution:l,opacity:this._getOpacity(),texture:this.Kf,useTexture:this.Vw,animateCounter:u,textureSequence:this.nx,depth:this.depth,pickFbo:this._needPickFrame&&this._pickFbo,pickPos:this._pickPos})}}}},{key:"afterRender",value:function(){}},{key:"createTexture",value:function(i){var o=this;if(this.Vw=!!i,!(this.Kf||!this.loca||!this.loca.regl)&&(this.Kf=this.loca.regl.texture({data:[[[0,255,0,0],[255,0,0,0]],[[0,0,255,0],[255,255,255,0]]]}),!!i))if(Object.prototype.toString.call(i)==="[object String]"){var s=new Image;s.crossOrigin="anonymous",s.src=i,s.onload=function(){o.Kf=o.loca.regl.texture(__spreadValues$l({data:s,flipY:!0},getMipMap(s.naturalWidth,s.naturalHeight))),o.nx=s.naturalWidth/s.naturalHeight}}else this.Kf=this.loca.regl.texture(__spreadValues$l({data:i,flipY:!0},getMipMap(i.width,i.height))),this.nx=i.width/i.height}},{key:"PA",value:function(){return RenderHelper.SA(this.ll,this)}}]),a}(Layer),pushArray$i=CommonUtil$1._C,_LinkFusion=function(n){_inherits(a,n);var r=_create_super(a);function a(){return _class_call_check(this,a),r.apply(this,arguments)}return _create_class(a,[{key:"DC",value:function(){}},{key:"buildStyle",value:function(i,o,s){var l=link.style,u=[];if(!s.loca)return{};for(var c=s.loca.customCoords,f=0;f<i.length;f++)if(!(!i[f].features||!i[f].features.lines)){var h=i[f].features.lines,p=[],d=!0,v=!1,_=void 0;try{for(var m=h[Symbol.iterator](),y;!(d=(y=m.next()).done);d=!0){var g=y.value,C=g.coordinates,b=g.type;if(b==="LineString"){var k=_sliced_to_array(C,2),L=k[0],F=k[1],W=c.lngLatToCoord(L),j=c.lngLatToCoord(F),Y=glMatrix.vec2.distance(W,j);p.push({distance:Y,link:g})}if(b==="MultiLineString")for(var N=0;N<C.length;N++){var $=_sliced_to_array(C[N],2),w=$[0],E=$[1],A=c.lngLatToCoord(w),R=c.lngLatToCoord(E),O=glMatrix.vec2.distance(A,R);p.push({distance:O,link:{coordinates:g.coordinates[N],properties:g.properties}})}}}catch(T){v=!0,_=T}finally{try{!d&&m.return!=null&&m.return()}finally{if(v)throw _}}var P=StyleInstance.parse(p,o,l);u.push(P)}return u}},{key:"fusion",value:function(i,o,s,l){var u=this,c=function(d){var v=function(F){var W=m[F],j=W.coordinates,Y=g.lineColors,N=g.height,$=C.smoothSteps,w=s.colorPick.add(W);if(W.type==="MultiLineString"){var E=function(Ze,pt){var dt=j[Ze],Ot=_sliced_to_array(dt,2),mt=Ot[0],at=Ot[1],St=_sliced_to_array(mt,2),Tt=St[0],Dt=St[1],Lt=_sliced_to_array(at,2),Rt=Lt[0],It=Lt[1],Bt={x:+Tt,y:+Dt,z:0},Ft={x:+Rt,y:+It,z:0},ot=N[Ze],bt=[],rt=Y[Ze];if(rt.length===1&&(rt[1]=rt[0]),ot===0)bt=LinearSplit(Bt,Ft,rt.length),bt.forEach(function(st,$t){$t!==bt.length-1&&b.index.push(k,++k);var _t=h.lngLatToCoord([st.x,st.y]);b.vertex.push(_t[0],_t[1],st.z),pushArray$i(b.color,rt[$t]),pushArray$i(b.pickColor,w)});else{var Pt={x:Tt-(Tt-Rt)/2,y:Dt-(Dt-It)/2,z:ot};bt=cubicBezier(Bt,Pt,Ft,.5,$),bt.forEach(function(st,$t){$t!==bt.length-1&&b.index.push(k,++k);var _t=h.lngLatToCoord([st.x,st.y]);b.vertex.push(_t[0],_t[1],st.z);var it=linearGradient(rt,st.t);pushArray$i(b.color,it),pushArray$i(b.pickColor,w)})}k++};k=0;for(var A=0,R=j.length;A<R;A++)E(A,R)}else{var O=j,P=_sliced_to_array(O,2),T=P[0],M=P[1],U=_sliced_to_array(T,2),Q=U[0],K=U[1],te=_sliced_to_array(M,2),ve=te[0],de=te[1],be={x:+Q,y:+K,z:0},et={x:+ve,y:+de,z:0},qe=N[F],Ne=[],Ge=Y[F];if(Ge.length===1&&(Ge[1]=Ge[0]),qe===0)Ne=LinearSplit(be,et,Ge.length),Ne.forEach(function(Ze,pt){pt!==Ne.length-1&&b.index.push(k,++k);var dt=h.lngLatToCoord([Ze.x,Ze.y]);b.vertex.push(dt[0],dt[1],Ze.z),pushArray$i(b.color,Ge[pt]),pushArray$i(b.pickColor,w)});else{var ft={x:Q-(Q-ve)/2,y:K-(K-de)/2,z:qe};Ne=cubicBezier(be,ft,et,.5,$),Ne.forEach(function(Ze,pt){pt!==Ne.length-1&&b.index.push(k,++k);var dt=h.lngLatToCoord([Ze.x,Ze.y]);b.vertex.push(dt[0],dt[1],Ze.z);var Ot=linearGradient(Ge,Ze.t);pushArray$i(b.color,Ot),pushArray$i(b.pickColor,w)})}k++}},_=i[d];if(!_.features||!_.features.lines)return"continue";for(var m=_.features.lines,y=l[d],g=y.attributes,C=y.uniforms,b={vertex:[],color:[],pickColor:[],index:[]},k=0,L=0;L<m.length;L++)v(L);f[d]={id:_.id,attributes:{color:{buffer:u.regl.buffer(b.color),offset:0,stride:4*4,td:!1,divisor:0},pickColor:{buffer:u.regl.buffer(b.pickColor),offset:0,stride:4*4,td:!1,divisor:0},position:{buffer:u.regl.buffer(b.vertex),offset:0,stride:4*3,td:!1,divisor:0},index:u.regl.elements({primitive:"lines",type:"uint32",data:b.index})},uniforms:y.uniforms,si:y.si}};if(!this.regl||!s.loca)return[];var f=[];l=l||this.buildStyle(i,o,s);for(var h=s.loca.customCoords,p=0;p<i.length;p++)c(p);return f}},{key:"updateStyle",value:function(i,o,s,l){if(!s.loca)return[];var u=s.dataset;return this.fusion(u,o,s,l)}},{key:"EC",value:function(){return[]}},{key:"destroy",value:function(){this.regl=null}}],[{key:"getInstance",value:function(){return this.ui}}]),a}(GeometryFusion),LinkFusion=_LinkFusion;LinkFusion.ui=new _LinkFusion,LinkFusion.getInstance();var LinkShader={vertex:"\n        precision highp float;\n        attribute vec3 position;\n        attribute vec4 color;\n        varying vec4 v_color;\n        uniform mat4 mvp;\n        ".concat(ColorGLSL.getColorShader().vertex,"\n\n        void main() {\n            v_color = color;\n            gl_Position = mvp * vec4(position, 1.0);\n            ").concat(ColorGLSL.getColorShader().mainVert,"\n        }\n    "),fragment:"\n        precision highp float;\n        varying vec4 v_color;\n        uniform float opacity;\n        ".concat(ColorGLSL.getColorShader().fragment,"\n\n        void main() {\n            gl_FragColor = v_color;\n            gl_FragColor *= opacity;\n            ").concat(ColorGLSL.getColorShader().mainFrag,"\n        }\n    ")},__defProp$k=Object.defineProperty,__defProps$e=Object.defineProperties,__getOwnPropDescs$e=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$k=Object.getOwnPropertySymbols,__hasOwnProp$k=Object.prototype.hasOwnProperty,__propIsEnum$k=Object.prototype.propertyIsEnumerable,__defNormalProp$k=function(n,r,a){return r in n?__defProp$k(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$k=function(n,r){for(var a in r||(r={}))__hasOwnProp$k.call(r,a)&&__defNormalProp$k(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$k)try{for(var l=__getOwnPropSymbols$k(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$k.call(r,a)&&__defNormalProp$k(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},__spreadProps$e=function(n,r){return __defProps$e(n,__getOwnPropDescs$e(r))},LinkRender=function(n){_inherits(a,n);var r=_create_super(a);function a(){return _class_call_check(this,a),r.apply(this,arguments)}return _create_class(a,[{key:"m$",value:function(i){if(!this.regl)return!1;var o=this.regl;this.gA(LinkShader,i,{attributes:__spreadValues$k({position:o.prop("position"),color:o.prop("color")},ColorGLSL.getColor(o).attribute),uniforms:__spreadValues$k({mvp:o.prop("mvp"),opacity:o.prop("opacity")},ColorGLSL.getColor(o).uniform),depth:{enable:!1},blend:{enable:!0,func:o.prop("blendFun"),equation:{rgb:"add",alpha:"add"}},elements:o.prop("index")})}},{key:"render",value:function(i){var o=this.yA(LinkShader);if(o)for(var s=i.meshes,l=i.mvp,u=i.opacity,c=0;c<s.length;c++){var f=s[c],h=f.attributes;o(__spreadProps$e(__spreadValues$k({blendFun:RenderUtil.getBlend("zero")},h),{mvp:l,opacity:u,isPick:!1})),o(__spreadProps$e(__spreadValues$k({blendFun:RenderUtil.getBlend("lighter")},h),{mvp:l,opacity:u,isPick:!1}))}}},{key:"pickRender",value:function(i){var o=this,s=this.yA(LinkShader);if(s){var l=i.meshes,u=i.mvp,c=i.opacity,f=i.pickFbo,h=i.pickPos;f&&h&&f.use(function(){o.regl.clear({color:[0,0,0,0],depth:1});for(var p=0;p<l.length;p++){var d=l[p],v=d.attributes;s(__spreadProps$e(__spreadValues$k({blendFun:RenderUtil.getBlend("normal")},v),{mvp:u,opacity:c,isPick:!0}))}})}}}]),a}(Render),pushArray$h=CommonUtil$1._C,LinkLayer=function(n){_inherits(a,n);var r=_create_super(a);function a(i){_class_call_check(this,a);var o;o=r.call(this,i),o.CLASS_NAME="Link",o.fusion=new LinkFusion,o.ll=new LinkRender;var s=link.Sw;return o.zooms=i.zooms===void 0?s.zooms:i.zooms,o.zIndex=i.zIndex===void 0?s.zIndex:i.zIndex,o.opacity=i.opacity===void 0?s.opacity:i.opacity,o.visible=i.visible===void 0?s.visible:i.visible,o.AC({zooms:o.zooms,visible:o.visible,zIndex:o.zIndex}),o.buryPoint.record(o.CLASS_NAME),o}return _create_class(a,[{key:"receiveDataset",value:function(i){this.dataset=i,this.setStyle(this.styleOptions),this.onAdd()}},{key:"setStyle",value:function(i){if(_get(_get_prototype_of(a.prototype),"setStyle",this).call(this,i),this.dataset=this.source.LC(),this.meshes=[],this.dataset&&this.dataset.length>0&&this.meshes){var o=this.WC(),s=o.didFusion,l=this.fusion.buildStyle(this.dataset,this.styleOptions,this),u=this.fusion.updateStyle(s,this.styleOptions,this,l);this.meshes=u,this.loca&&this.loca.requestRender()}}},{key:"jC",value:function(){_get(_get_prototype_of(a.prototype),"jC",this).call(this),!(!this.loca||!this.loca.regl||this.ll.regl)&&(this.ll.regl=this.loca.regl,this.loca.rendererManager.addRenderer(this.ll))}},{key:"beforeRender",value:function(){if(_get(_get_prototype_of(a.prototype),"beforeRender",this).call(this),!this.fusion.regl&&this.loca&&(this.fusion.regl=this.loca.regl,this.loca.fusionManager.addFusion(this.fusion)),this.jC(),this.source&&(this.dataset=this.source.LC()),this.fusion){var i=this.WC(),o=i.willFusion,s=i.didFusion;if(this.fusion.EC(),o.length>0){var l=this.fusion.fusion(o,this.styleOptions,this);this.meshes=pushArray$h(s,l)}}}},{key:"render",value:function(){var i;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var o=(i=this.loca)==null?void 0:i.customCoords.getMVPMatrix();if(this.ll&&this.meshes.length>0)return this.ll.render({meshes:this.meshes,mvp:o,opacity:this._getOpacity()}),!0}}},{key:"pickRender",value:function(){var i;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var o=(i=this.loca)==null?void 0:i.customCoords.getMVPMatrix();this.ll&&this.ll.pickRender({meshes:this.meshes,mvp:o,opacity:this._getOpacity(),pickFbo:this._needPickFrame&&this._pickFbo,pickPos:this._pickPos})}}},{key:"afterRender",value:function(){}},{key:"PA",value:function(){return RenderHelper.SA(this.ll,this)}}]),a}(Layer),calcDistance=function(n){for(var r=0,a=0;a<n.length-1;a++)r+=glMatrix.vec2.distance(n[a],n[a+1]);return r},reverse=function(n){return glMatrix.vec3.fromValues(-n[0],-n[1],-n[2])},normalMultiple=function(n,r){return glMatrix.vec3.fromValues(n[0]*r,n[1]*r,n[2]*r)},calcNormal=function(n,r,a){var i=glMatrix.vec3.sub(glMatrix.vec3.create(),r,n),o=glMatrix.vec3.create();return glMatrix.vec3.cross(o,a,i),glMatrix.vec3.normalize(o,o)},calcAngle=function(n,r){var a=glMatrix.vec3.dot(n,r)/glMatrix.vec3.length(n)/glMatrix.vec3.length(r);return Math.acos(Math.min(1,a))},calcWise=function(n,r){var a=glMatrix.vec3.create(),i=glMatrix.vec2.fromValues(n[0],n[1]),o=glMatrix.vec2.fromValues(r[0],r[1]);return glMatrix.vec2.cross(a,o,i),a[2]===0?a[2]:a[2]/Math.abs(a[2])},calcAngleBisector=function(n,r){var a=glMatrix.vec3.normalize(glMatrix.vec3.create(),n),i=glMatrix.vec3.normalize(glMatrix.vec3.create(),r),o=glMatrix.vec3.add(glMatrix.vec3.create(),a,i);return glMatrix.vec3.normalize(o,o)},pushArray$g=CommonUtil$1._C,_PulseLineFusion=function(n){_inherits(a,n);var r=_create_super(a);function a(){return _class_call_check(this,a),r.apply(this,arguments)}return _create_class(a,[{key:"DC",value:function(){}},{key:"buildStyle",value:function(i,o){for(var s=function(f){var h=i[f];if(!i[f].features||!i[f].features.lines)return"continue";var p=h.features.lines,d=StyleInstance.parse(p,o,l),v={};p.forEach(function(_,m){if(d)for(var y in d.attributes){var g=d.attributes[y];v[y]||(v[y]=[]),v[y][v[y].length]=g[m]}}),u.push({attributes:v,uniforms:d.uniforms,si:d.si}),u.push(d)},l=pulseline.style,u=[],c=0;c<i.length;c++)s(c);return u}},{key:"updateStyle",value:function(i,o,s,l){if(!s.loca)return[];var u=s.dataset;return this.fusion(u,o,s,l)}},{key:"fusion",value:function(i,o,s,l){var u=this,c=function(v){var _=i[v];if(!i[v].features||!i[v].features.lines)return"continue";var m=_.features.lines,y=l[v],g={position:[],normal:[],angle:[],pointType:[],distance:[],startDistance:[],totalDistance:[],lineWidth:[],headColor:[],trailColor:[],pickColor:[],index:[]},C=0,b=[];m.forEach(function(k,L){var F=k.type,W=k.coordinates,j=s.colorPick.add(k);if(F==="MultiLineString")W.forEach(function(w){var E=w.map(function(O){return p.lngLatToCoord(O)}),A=f.triangles(E,{style:y,index:L,pickColor:j}),R=A.index.map(function(O){return O+C});pushArray$g(g.position,A.position),pushArray$g(g.normal,A.normal),pushArray$g(g.angle,A.angle),pushArray$g(g.pointType,A.pointType),pushArray$g(g.distance,A.distance),pushArray$g(g.startDistance,A.startDistance),pushArray$g(g.totalDistance,A.totalDistance),pushArray$g(g.lineWidth,A.lineWidth),pushArray$g(g.headColor,A.headColor),pushArray$g(g.trailColor,A.trailColor),pushArray$g(g.pickColor,A.pickColor),pushArray$g(g.index,R),C+=A.distance.length});else{var Y=W.map(function(w){return p.lngLatToCoord(w)}),N=f.triangles(Y,{style:y,index:L,pickColor:j}),$=N.index.map(function(w){return w+C});pushArray$g(g.position,N.position),pushArray$g(g.normal,N.normal),pushArray$g(g.angle,N.angle),pushArray$g(g.pointType,N.pointType),pushArray$g(g.distance,N.distance),pushArray$g(g.startDistance,N.startDistance),pushArray$g(g.totalDistance,N.totalDistance),pushArray$g(g.lineWidth,N.lineWidth),pushArray$g(g.headColor,N.headColor),pushArray$g(g.trailColor,N.trailColor),pushArray$g(g.pickColor,N.pickColor),pushArray$g(g.index,$),C+=N.distance.length}b[L]=g.distance.length}),h[v]={id:_.id,attributes:{position:{buffer:u.regl.buffer(g.position),size:3,offset:0,stride:0,td:!1,divisor:0},normal:{buffer:u.regl.buffer(g.normal),size:3,offset:0,stride:0,td:!1,divisor:0},angle:{buffer:u.regl.buffer(g.angle),size:1,offset:0,stride:0,td:!1,divisor:0},pointType:{buffer:u.regl.buffer(g.pointType),size:1,offset:0,stride:0,td:!1,divisor:0},distance:{buffer:u.regl.buffer(g.distance),size:1,offset:0,stride:0,td:!1,divisor:0},startDistance:{buffer:u.regl.buffer(g.startDistance),size:1,offset:0,stride:0,td:!1,divisor:0},totalDistance:{buffer:u.regl.buffer(g.totalDistance),size:1,offset:0,stride:0,td:!1,divisor:0},lineWidth:{buffer:u.regl.buffer(g.lineWidth),size:1,offset:0,stride:0,td:!1,divisor:0},headColor:{buffer:u.regl.buffer(g.headColor),size:4,offset:0,stride:0,td:!1,divisor:0},trailColor:{buffer:u.regl.buffer(g.trailColor),size:4,offset:0,stride:0,td:!1,divisor:0},pickColor:{buffer:u.regl.buffer(g.pickColor),size:4,offset:0,stride:0,td:!1,divisor:0},index:u.regl.elements({primitive:"triangles",type:"uint32",data:g.index})},uniforms:y.uniforms,si:y.si,mf:{Tw:{jw:b},origin:{position:g.position,normal:g.normal,angle:g.angle,pointType:g.pointType,distance:g.distance,startDistance:g.startDistance,totalDistance:g.totalDistance,lineWidth:g.lineWidth,index:g.index}}}},f=this;if(!this.regl||!s.loca)return[];var h=[];l=l||this.buildStyle(i,o);for(var p=s.loca.customCoords,d=0;d<i.length;d++)c(d);return h}},{key:"EC",value:function(){return[]}},{key:"triangles",value:function(i,o){for(var s=o.style,l=s.attributes,u=s.uniforms,c=o.index,f=o.pickColor,h=l.lineWidth,p=l.headColor,d=l.trailColor,v=u.altitude,_=calcDistance(i),m={position:[],normal:[],angle:[],pointType:[],distance:[],startDistance:[],totalDistance:[],lineWidth:[],headColor:[],trailColor:[],pickColor:[],index:[]},y=[],g=0;g<i.length;g++)(g===0||i[g][0]!==i[g-1][0]||i[g][1]!==i[g-1][1])&&y.push(i[g]);if(y.length<=1)return m;for(var C=glMatrix.vec3.fromValues(0,0,1),b=[],k=[],L=[],F=[],W=[],j=[],Y=[],N=glMatrix.vec3.create(),$=glMatrix.vec3.create(),w=glMatrix.vec3.create(),E=0,A=0;A<y.length;A++){var R=y[A],O=glMatrix.vec3.fromValues(R[0],R[1],v),P=glMatrix.vec3.fromValues(R[0],R[1],0);if(glMatrix.vec3.normalize(P,P),A===0){var T=y[A+1],M=glMatrix.vec3.fromValues(T[0],T[1],v),U=glMatrix.vec3.sub(glMatrix.vec3.create(),M,O),Q=calcNormal(O,M,C);k.push(O,O),L.push(Q,normalMultiple(Q,-1)),F.push(0,0),W.push(0,0),j.push(0,0),Y.push(E,E),N=reverse(U),$=Q,w=O}else if(A===y.length-1){var K=glMatrix.vec3.dist(w,O);k.push(O,O),L.push($,normalMultiple($,-1)),F.push(0,0),W.push(0,0),E+=K,j.push(K,K),Y.push(E,E);var te=k.length;b.push(te-4,te-2,te-1),b.push(te-4,te-1,te-3)}else{var ve=y[A+1],de=glMatrix.vec3.fromValues(ve[0],ve[1],v),be=glMatrix.vec3.sub(glMatrix.vec3.create(),de,O),et=calcAngleBisector(N,be);if(glMatrix.vec3.length(et)===0)continue;var qe=calcNormal(O,de,C),Ne=calcAngle(et,be),Ge=glMatrix.vec3.dist(w,O),ft=calcWise(N,be);if(ft>=0){k.push(O,O,O,O,O),L.push(et,normalMultiple($,-1),et,et,normalMultiple(qe,-1)),F.push(Ne,0,Ne,Ne,0),W.push(-1,0,0,1,0),E+=Ge,j.push(Ge,Ge,Ge,Ge,Ge),Y.push(E,E,E,E,E);var Ze=k.length;b.push(Ze-3,Ze-4,Ze-1),b.push(Ze-7,Ze-5,Ze-4),b.push(Ze-7,Ze-4,Ze-6)}else{k.push(O,O,O,O,O),L.push($,et,et,qe,et),F.push(0,Ne,Ne,0,Ne),W.push(0,-1,0,0,1),E+=Ge,j.push(Ge,Ge,Ge,Ge,Ge),Y.push(E,E,E,E,E);var pt=k.length;b.push(pt-3,pt-5,pt-2),b.push(pt-7,pt-5,pt-4),b.push(pt-7,pt-4,pt-6)}N=reverse(be),$=qe,w=O}}var dt=[],Ot=k.length;k.forEach(function(bt){var rt=_sliced_to_array(bt,3),Pt=rt[0],st=rt[1],$t=rt[2];dt.push(Pt,st,$t)});var mt=[];L.forEach(function(bt){var rt=_sliced_to_array(bt,3),Pt=rt[0],st=rt[1],$t=rt[2];mt.push(Pt,st,$t)});for(var at=h[c],St=p[c],Tt=[],Dt=d[c],Lt=[],Rt=[],It=0;It<Ot;It++){var Bt,Ft,ot;(Bt=Tt).push.apply(Bt,_to_consumable_array(St)),(Ft=Lt).push.apply(Ft,_to_consumable_array(Dt)),(ot=Rt).push.apply(ot,_to_consumable_array(f))}return m.index=b,m.position=dt,m.normal=mt,m.angle=F,m.pointType=W,m.distance=j,m.startDistance=Y,m.totalDistance=new Array(Ot).fill(_),m.lineWidth=new Array(Ot).fill(at),m.headColor=Tt,m.trailColor=Lt,m.pickColor=Rt,m}},{key:"destroy",value:function(){this.regl=null}}],[{key:"getInstance",value:function(){return this.ui}}]),a}(GeometryFusion),PulseLineFusion=_PulseLineFusion;PulseLineFusion.ui=new _PulseLineFusion,PulseLineFusion.getInstance();var PulseLineShader={vertex:"\n        precision highp float;\n        attribute vec3 position;\n        attribute vec3 normal;\n        attribute float angle;\n        attribute float pointType;\n        attribute float distance;\n        attribute float startDistance;\n        attribute float totalDistance;\n        attribute float lineWidth;\n        attribute vec4 headColor;\n        attribute vec4 trailColor;\n        uniform mat4 mvp;\n        uniform float resolution;\n        varying float vDistance;\n        varying float vTotalDistance;\n        varying vec4 vHeadColor;\n        varying vec4 vTrailColor;\n        ".concat(ColorGLSL.getColorShader().vertex,"\n\n        vec3 normalizeAndMulti(vec3 vec, float multi) {\n            vec3 nNormal = normalize(vec);\n            return vec3(\n                multi * nNormal.x,\n                multi * nNormal.y,\n                multi * nNormal.z\n            );\n        }\n        \n        void main() {\n          float halfLineWidth = lineWidth / 2.0 * resolution;\n          vec3 pointPosition;\n            // \u5224\u65AD\u662F\u5426\u4E3A\u5185\u89D2\u70B9\n            if (angle != 0.0) {\n                // \u5224\u65AD\u662F\u5426\u4E3A\u89D2\u5EA6\u8FC7\u5C0F\u7684\u7279\u6B8A\u60C5\u5F62\n                bool angleIsTooSmall = halfLineWidth / tan(angle) >= distance;\n                if (angleIsTooSmall) {\n                    if (pointType == 0.0) {\n                        pointPosition = position;\n                    } else {\n                        pointPosition = position + normalizeAndMulti(normal, halfLineWidth);\n                    }\n                    vDistance = startDistance;\n                } else {\n                    pointPosition = position + normalizeAndMulti(normal, halfLineWidth / sin(angle));\n                    vDistance = startDistance + pointType * halfLineWidth / tan(angle);\n                }\n            } else {\n                // \u5916\u89D2\u70B9\n                pointPosition = position + normalizeAndMulti(normal, halfLineWidth);\n                vDistance = startDistance;\n            }\n            vTotalDistance = totalDistance;\n            vHeadColor = headColor;\n            vTrailColor = trailColor;\n            gl_Position = mvp * vec4(pointPosition, 1.0);\n            ").concat(ColorGLSL.getColorShader().mainVert,"\n        }\n    "),fragment:"\n        precision highp float;\n        varying float vDistance;\n        varying float vTotalDistance;\n        varying vec4 vHeadColor;\n        varying vec4 vTrailColor;\n        uniform float interval;\n        uniform float duration;\n        uniform float time;\n        uniform float opacity;\n\n        float trailLength;\n        float offset;\n        float distanceMod;\n        float ratio;\n        ".concat(ColorGLSL.getColorShader().fragment,"\n\n        void main() {\n            trailLength = vTotalDistance * interval;\n            offset = vTotalDistance * mod(time / duration * 1000.0, 1.0);\n            distanceMod = mod(vDistance + trailLength - offset, trailLength);\n            ratio = distanceMod / trailLength;\n            gl_FragColor = mix(vTrailColor, vHeadColor, ratio);\n            gl_FragColor.a *= opacity;\n\n            ").concat(ColorGLSL.getColorShader().mainFrag,"\n            // if (vDistance > offset) {\n            //   gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n            // } else {\n            // }\n        }\n    ")},__defProp$j=Object.defineProperty,__defProps$d=Object.defineProperties,__getOwnPropDescs$d=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$j=Object.getOwnPropertySymbols,__hasOwnProp$j=Object.prototype.hasOwnProperty,__propIsEnum$j=Object.prototype.propertyIsEnumerable,__defNormalProp$j=function(n,r,a){return r in n?__defProp$j(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$j=function(n,r){for(var a in r||(r={}))__hasOwnProp$j.call(r,a)&&__defNormalProp$j(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$j)try{for(var l=__getOwnPropSymbols$j(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$j.call(r,a)&&__defNormalProp$j(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},__spreadProps$d=function(n,r){return __defProps$d(n,__getOwnPropDescs$d(r))},PulseLineRender=function(n){_inherits(a,n);var r=_create_super(a);function a(){return _class_call_check(this,a),r.apply(this,arguments)}return _create_class(a,[{key:"m$",value:function(i){if(!this.regl)return!1;var o=this.regl;this.gA(PulseLineShader,i,{attributes:__spreadValues$j({position:o.prop("position"),normal:o.prop("normal"),angle:o.prop("angle"),pointType:o.prop("pointType"),startDistance:o.prop("startDistance"),totalDistance:o.prop("totalDistance"),distance:o.prop("distance"),lineWidth:o.prop("lineWidth"),headColor:o.prop("headColor"),trailColor:o.prop("trailColor")},ColorGLSL.getColor(o).attribute),uniforms:__spreadValues$j({mvp:o.prop("mvp"),resolution:o.prop("resolution"),opacity:o.prop("opacity"),duration:o.prop("duration"),interval:o.prop("interval"),time:o.prop("time")},ColorGLSL.getColor(o).uniform),blend:{enable:!0,func:{srcRGB:"src alpha",dstRGB:"one minus src alpha",srcAlpha:1,dstAlpha:"one minus src alpha"},equation:{rgb:"add",alpha:"add"}},depth:{enable:!1},primitive:"triangles",offset:0,elements:o.prop("index")})}},{key:"render",value:function(i){var o=this.yA(PulseLineShader);if(o){var s=i.meshes,l=i.mvp,u=i.resolution,c=i.opacity,f=i.animateCounter;s.forEach(function(h){var p=h.attributes,d=h.uniforms,v=d.interval,_=d.duration,m=60,y=f/m;o(__spreadProps$d(__spreadValues$j({},p),{mvp:l,resolution:u,opacity:c,interval:v,duration:_,time:y,isPick:!1}))})}}},{key:"pickRender",value:function(i){var o=this,s=this.yA(PulseLineShader);if(s){var l=i.meshes,u=i.mvp,c=i.resolution,f=i.opacity,h=i.animateCounter,p=i.pickFbo,d=i.pickPos;p&&d&&p.use(function(){o.regl.clear({color:[0,0,0,0],depth:1}),l.forEach(function(v){var _=v.attributes,m=v.uniforms,y=m.interval,g=m.duration,C=60,b=h/C;s(__spreadProps$d(__spreadValues$j({},_),{mvp:u,resolution:c,opacity:f,interval:y,duration:g,time:b,isPick:!0}))})})}}}]),a}(Render),pushArray$f=CommonUtil$1._C,PulseLineLayer=function(n){_inherits(a,n);var r=_create_super(a);function a(i){_class_call_check(this,a);var o;o=r.call(this,i),o.CLASS_NAME="PulseLine",o.fusion=new PulseLineFusion,o.ll=new PulseLineRender;var s=pulseline.Sw;return o.zooms=i.zooms===void 0?s.zooms:i.zooms,o.visible=i.visible===void 0?s.visible:i.visible,o.zIndex=i.zIndex===void 0?s.zIndex:i.zIndex,o.opacity=i.opacity===void 0?s.opacity:i.opacity,o.AC({zooms:o.zooms,visible:o.visible,zIndex:o.zIndex}),o.buryPoint.record(o.CLASS_NAME),o}return _create_class(a,[{key:"receiveDataset",value:function(i){this.dataset=i,this.setStyle(this.styleOptions),this.onAdd()}},{key:"sx",value:function(){return{ux:this.sP,timestamp:0}}},{key:"setStyle",value:function(i){if(_get(_get_prototype_of(a.prototype),"setStyle",this).call(this,i),this.dataset&&this.dataset.length>0&&this.meshes){var o=this.WC(),s=o.didFusion;if(s.length){var l=this.fusion.buildStyle(this.dataset,this.styleOptions),u=this.fusion.updateStyle(s,this.styleOptions,this,l);this.meshes=u,this.loca&&this.loca.requestRender()}}}},{key:"jC",value:function(){_get(_get_prototype_of(a.prototype),"jC",this).call(this),!(!this.loca||!this.loca.regl||this.ll.regl)&&(this.ll.regl=this.loca.regl,this.loca.rendererManager.addRenderer(this.ll))}},{key:"beforeRender",value:function(){if(_get(_get_prototype_of(a.prototype),"beforeRender",this).call(this),!this.fusion.regl&&this.loca&&(this.fusion.regl=this.loca.regl,this.loca.fusionManager.addFusion(this.fusion)),this.jC(),this.source&&(this.dataset=this.source.LC()),this.fusion){var i=this.WC(),o=i.willFusion,s=i.didFusion;if(this.fusion.EC(),o.length>0){var l=this.fusion.fusion(o,this.styleOptions,this);this.meshes=pushArray$f(s,l)}}}},{key:"render",value:function(){var i,o;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var s=(i=this.loca)==null?void 0:i.customCoords.getMVPMatrix(),l=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom());if(this.ll&&this.meshes.length>0){var u=this.hP();return this.ll.render({meshes:this.meshes,mvp:s,resolution:l,opacity:this._getOpacity(),animateCounter:u}),!0}}}},{key:"pickRender",value:function(){var i,o;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var s=(i=this.loca)==null?void 0:i.customCoords.getMVPMatrix(),l=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom());if(this.ll){var u=this.hP();this.ll.pickRender({meshes:this.meshes,mvp:s,resolution:l,opacity:this._getOpacity(),animateCounter:u,pickFbo:this._needPickFrame&&this._pickFbo,pickPos:this._pickPos})}}}},{key:"afterRender",value:function(){}},{key:"PA",value:function(){return RenderHelper.SA(this.ll,this)}}]),a}(Layer),SphericalMercator=function(){var n=Math.PI/180,r=180/Math.PI,a=6378137,i=85.0511287798,o=function(u,c){var f=i;c=Math.max(Math.min(f,c),-f);var h=u*n,p=c*n;return p=Math.log(Math.tan(Math.PI/4+p/2)),[h*a,p*a]},s=function(u,c){var f=u/a*r,h=(2*Math.atan(Math.exp(c/a))-Math.PI/2)*r;return[f,h]},l=function(u){return 20037508342789244e-9*2/256/Math.pow(2,u)};return{project:o,unproject:s,getResolution:l}}(),grid={ri:function n(r){for(var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100,i=arguments.length>2?arguments[2]:void 0,o={},s=[],l=a*2,u=-1,c=r.length;++u<c;){var f=_sliced_to_array(r[u].lnglat,2),h=f[0],p=f[1],d=SphericalMercator.project(h,p),v=Math.floor(d[0]/l),_=Math.floor(d[1]/l),m=v+"-"+_,y=o[m];if(y)y.coordinates.push(r[u]);else{var g=SphericalMercator.unproject(v*l+a,_*l+a);o[m]=y={rowCol:[v,_],center:g,coordinates:[r[u]],hx:i(g)},s.push(y)}}return s},vx:function n(r){for(var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100,i={},o=[],s=a*2,l=-1,u=r.length;++l<u;){var c=r[l].coordinaties,f=Math.floor(c[0]/s),h=Math.floor(c[1]/s),p=f+"-"+h,d=i[p];d?d.coordinates.push(r[l]):(i[p]=d={rowCol:[f,h],center:[f*s+a,h*s+a],coordinates:[r[l]]},o.push(d))}return o},DC:function n(r,a){var i,o=[],s=a.radius,l=0,u=_sliced_to_array(r.hx,2),c=u[0],f=u[1],h=[c-s+l,f+s-l],p=[c-s+l,f-s+l],d=[c+s-l,f-s+l],v=[c+s-l,f+s-l];return(i=o).push.apply(i,[h,p,d,v,h]),o}},hexagon={ei:Math.PI/3,oi:[0,Math.PI/3,2*Math.PI/3,Math.PI/3,Math.PI/3,5*Math.PI/3],ri:function n(r){for(var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100,i=arguments.length>2?arguments[2]:void 0,o={},s=[],l=a*2*Math.sin(this.ei),u=a*1.5,c=0,f=r.length;c<f;++c){var h=_sliced_to_array(r[c].lnglat,2),p=h[0],d=h[1],v=SphericalMercator.project(p,d),_=_sliced_to_array(v,2),m=_[0],y=_[1];y=y/u;var g=Math.round(y);m=m/l-(g&1)/2;var C=Math.round(m),b=y-g;if(Math.abs(b)*3>1){var k=m-C,L=C+(m<C?-1:1)/2,F=g+(y<g?-1:1),W=m-L,j=y-F;k*k+b*b>W*W+j*j&&(C=L+(g&1?1:-1)/2,g=F)}var Y=C+"-"+g,N=o[Y];if(N)N.coordinates.push(r[c]);else{var $=SphericalMercator.unproject((C+(g&1)/2)*l,g*u);o[Y]=N={rowCol:[C,g],center:$,coordinates:[r[c]],hx:i($)},s.push(N)}}return s},DC:function n(r,a){var i,o=[],s=a.radius,l=0,u=s/2,c=Math.sqrt(3)*s,f=Math.sqrt(Math.pow(c,2)+Math.pow(s,2)),h=_sliced_to_array(r.hx,2),p=h[0],d=h[1],v=[p,d+f/2-l],_=[p-c/2+l,d+u-l/2],m=[p-c/2+l,d-u+l/2],y=[p,d-f/2+l],g=[p+c/2-l,d-u+l/2],C=[p+c/2-l,d+u-l/2];return(i=o).push.apply(i,[v,_,m,y,g,C,v]),o}},Bin=Object.freeze({__proto__:null,grid:grid,hexagon:hexagon}),geoUtils={ai:function n(r){var a=[];if(r.type==="MultiPoint")for(var i=r.properties,o=r.coordinates,s=o.length,l=0;l<s;++l){var u=o[l];a.push({properties:i,type:"Point",coordinates:u})}else if(r.type==="MultiLineString")for(var c=r.properties,f=r.coordinates,h=f.length,p=0;p<h;++p){var d=f[p];a.push({properties:c,type:"Point",coordinates:d})}else if(r.type==="MultiPolygon")for(var v=r.properties,_=r.coordinates,m=_.length,y=0;y<m;++y){var g=_[y];a.push({properties:v,type:"Point",coordinates:g})}return a}},__defProp$i=Object.defineProperty,__defProps$c=Object.defineProperties,__getOwnPropDescs$c=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$i=Object.getOwnPropertySymbols,__hasOwnProp$i=Object.prototype.hasOwnProperty,__propIsEnum$i=Object.prototype.propertyIsEnumerable,__defNormalProp$i=function(n,r,a){return r in n?__defProp$i(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$i=function(n,r){for(var a in r||(r={}))__hasOwnProp$i.call(r,a)&&__defNormalProp$i(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$i)try{for(var l=__getOwnPropSymbols$i(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$i.call(r,a)&&__defNormalProp$i(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},__spreadProps$c=function(n,r){return __defProps$c(n,__getOwnPropDescs$c(r))},pushArray$e=CommonUtil$1._C,styleConf={grid:grid$1,hexagon:hexagon$1},GridsFusion=function(n){_inherits(a,n);var r=_create_super(a);function a(){return _class_call_check(this,a),r.apply(this,arguments)}return _create_class(a,[{key:"DC",value:function(i,o,s){for(var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"grid",u,c,f,h,p=[],d=0,v=i.length;d<v;d++)if(!(!i[d].features||!i[d].features.points)){var _=o.unit,m=o.radius,y=o.gap,g=i[d].features.points,C=m,b=y;_==="px"&&(C*=s.projection.getResolution((u=s.loca)==null?void 0:u.map.getZoom()),b*=s.projection.getResolution((c=s.loca)==null?void 0:c.map.getZoom()));for(var k=[],L=[],F=0,W=g.length;F<W;F++){var j=g[F];if(j.type==="MultiPoint"){for(var Y=geoUtils.ai(j),N=0,$=Y.length;N<$;N++){var w=Y[N];L.push({lnglat:w.coordinates,properties:w.properties})}pushArray$e(k,Y)}else L.push({lnglat:j.coordinates,properties:j.properties}),k.push(j)}var E=Bin[l].ri(L,C+b,(h=s.loca)==null?void 0:h.customCoords.lngLatToCoord.bind((f=s.loca)==null?void 0:f.customCoords));p.push(E)}return p}},{key:"buildStyle",value:function(i,o){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"grid",l,u=styleConf[s].style,c=[],f=o.value;if(f){for(var h=[1/0,-1/0],p=0,d=i.length;p<d;p++)for(var v=i[p],_=StyleInstance.parse(v,{value:f},{value:u.value}),m=_.attributes.value,y=0,g=v.length;y<g;y++){var C=+m[y];Number.isNaN(C)&&(C=0),v[y].value=C,h[0]=Math.min(C,h[0]),h[1]=Math.max(C,h[1])}for(var b=0,k=i.length;b<k;b++)for(var L=i[b],F=0,W=L.length;F<W;F++)L[F].min=h[0],L[F].max=h[1]}for(var j=0,Y=i.length;j<Y;j++){for(var N=i[j],$=StyleInstance.parse(N,o,u),w={},E=0,A=N.length;E<A;E++)if($)for(var R in $.attributes){var O=$.attributes[R];w[R]||(w[R]=[]),((l=O[E])==null?void 0:l.length)>0?pushArray$e(w[R],O[E]):w[R][w[R].length]=O[E]}c.push({attributes:w,uniforms:$.uniforms,si:$.si})}return c}},{key:"fusion",value:function(i,o,s){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"grid",u;if(!this.regl||!s.loca)return[];var c=s.projection.getResolution((u=s.loca)==null?void 0:u.map.getZoom()),f=[],h=this.DC(i,o,s,l),p=o.unit,d=o.radius,v=o.gap,_=d,m=v;p==="px"&&(_*=c,m*=c);for(var y=this.buildStyle(h,o,l),g=0,C=h.length;g<C;g++){for(var b=h[g],k=y[g],L={index:[],vertex:[],color:[],pickColor:[],normal:[],topOrBottom:[],labels:[]},F=[],W=[],j=[],Y=[],N=0,$=b.length;N<$;N++){var w=b[N],E=Bin[l].DC(w,{radius:_,gap:m}),A=s.colorPick.add(w),R=PolygonsFusionInstance.triangles([E],{style:k,index:N,pickColor:A,id:N},{lngLatToCoord:function(P){return P}},!0,s.hasSide,!1),O=L.vertex.length;F.push(O),W.push(O+R.Tw.Pw),j.push(O+R.Tw.top),GeoUtil.mergeTriangles(L,R,4),pushArray$e(L.color,R.color),pushArray$e(L.pickColor,R.pickColor),pushArray$e(L.normal,R.normal),pushArray$e(L.topOrBottom,R.topOrBottom),k.attributes.label[N]&&L.labels.push(__spreadValues$i({position:_to_consumable_array(w.center).concat([k.attributes.altitude[N]+k.attributes.height[N]+k.attributes.labelAltitude[N]])},k.attributes.label[N]))}Y[g]=L.vertex.length,f[g]={id:i[g].id,attributes:{color:{buffer:this.regl.buffer(L.color),offset:0,stride:4*4,td:!1,divisor:0},pickColor:{buffer:this.regl.buffer(L.pickColor),offset:0,stride:4*4,td:!1,divisor:0},position:{buffer:this.regl.buffer(L.vertex),offset:0,stride:4*4,td:!1,divisor:0},topOrBottom:{buffer:this.regl.buffer(L.topOrBottom),offset:0,stride:4*1,td:!1,divisor:0},normal:{buffer:this.regl.buffer(L.normal),offset:0,stride:4*3,td:!1,divisor:0},index:this.regl.elements({primitive:"triangles",type:"uint32",data:L.index})},uniforms:{},si:k.si,mf:{Tw:{bottom:F,Pw:W,top:j,jw:Y},origin:{position:L.vertex,color:L.color},labels:L.labels}}}return f}},{key:"updateStyle",value:function(i,o){for(var s=function(c,f){for(var h=i[c],p=o[c].attributes,d=p.altitude,v=p.height,_=p.topColor,m=p.sideBottomColor,y=p.sideTopColor,g=p.label,C=p.labelAltitude,b=h.mf.origin,k=b.position,L=b.color,F=h.mf.Tw,W=F.top,j=F.bottom,Y=F.Pw,N=F.jw,$=0,w=0,E=0,A=k.length;E<A;E+=3){var R=E/3*4,O=void 0;E>=N[$]&&$++;var P=$*4;E>=j[w+1]&&w++,E<Y[w]?(O=m,k[E+2]=d[$]):E>=Y[w]&&E<W[w]?(E-Y[w])/3%2===0?(k[E+2]=d[$],O=m):(k[E+2]=v[$],O=y):(O=_,k[E+2]=v[$]),L[R]=O[P],L[R+1]=O[P+1],L[R+2]=O[P+2],L[R+3]=O[P+3]}h.attributes.position.buffer({data:k}),h.attributes.color.buffer({data:L}),h.mf.labels=h.mf.labels.map(function(T,M){var U=T.position;return U[2]=v[M]+d[M]+C[M],__spreadProps$c(__spreadValues$i(__spreadValues$i({},T),g[M]),{position:U})})},l=0,u=i.length;l<u;l++)s(l,u)}},{key:"EC",value:function(){for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];throw new Error("Method not implemented.")}},{key:"destroy",value:function(){this.regl=null}}]),a}(GeometryFusion),__defProp$h=Object.defineProperty,__getOwnPropSymbols$h=Object.getOwnPropertySymbols,__hasOwnProp$h=Object.prototype.hasOwnProperty,__propIsEnum$h=Object.prototype.propertyIsEnumerable,__defNormalProp$h=function(n,r,a){return r in n?__defProp$h(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$h=function(n,r){for(var a in r||(r={}))__hasOwnProp$h.call(r,a)&&__defNormalProp$h(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$h)try{for(var l=__getOwnPropSymbols$h(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$h.call(r,a)&&__defNormalProp$h(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},GridShader={vertex:"\n        precision highp float;\n\n        attribute vec4 position;\n        attribute vec3 normal;\n        attribute vec4 color;\n        attribute float topOrBottom;\n\n        varying vec3 vNormal;\n        varying vec4 vColor;\n        varying vec3 vPosition;\n\n        uniform mat4 mvp;\n        ".concat(ColorGLSL.getColorShader().vertex,"\n        ").concat(RenderUtil.getBezier(),"\n        ").concat(RenderUtil.getScaleType("altitude"),"\n        ").concat(RenderUtil.getScaleType("height"),"\n\n        void main() {\n            float altitudeScale = altitudeScaleValue(position.w);\n            float heightScale = heightScaleValue(position.w);\n            // \u52A8\u753B\n            vec3 realPos = position.xyz;\n            if(topOrBottom == 0.0) {\n                realPos = vec3(position.xy, position.z * altitudeScale);\n            }\n            if(topOrBottom == 1.0) {\n                realPos = vec3(position.xy, position.z * heightScale);\n            }\n            vColor = color;\n            vNormal = normal;\n            vPosition = realPos;\n            gl_Position = mvp * vec4(realPos, 1.0);\n            ").concat(ColorGLSL.getColorShader().mainVert,"\n        } \n    "),fragment:"\n        precision highp float;\n        varying vec4 vColor;\n\n        // \u5982\u679C\u9700\u8981\u5149\u7167\uFF0C\u8FD9\u4E24\u4E2A\u53D8\u91CF\u662F\u5FC5\u987B\u7684\n        varying vec3 vNormal;\n        varying vec3 vPosition;\n\n        uniform float opacity;\n\n        uniform vec3 cameraPosition;\n        uniform float shininess;\n        #include <lightUniforms,lightFunctions>;\n\n        ".concat(ColorGLSL.getColorShader().fragment,"\n\n        void main() {\n            gl_FragColor = vColor;\n            #include <lightMainCompute>;\n            gl_FragColor.a *= opacity;\n            ").concat(ColorGLSL.getColorShader().mainFrag,"\n        }\n    "),includes:__spreadValues$h({},LightIncludes)},__defProp$g=Object.defineProperty,__defProps$b=Object.defineProperties,__getOwnPropDescs$b=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$g=Object.getOwnPropertySymbols,__hasOwnProp$g=Object.prototype.hasOwnProperty,__propIsEnum$g=Object.prototype.propertyIsEnumerable,__defNormalProp$g=function(n,r,a){return r in n?__defProp$g(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$g=function(n,r){for(var a in r||(r={}))__hasOwnProp$g.call(r,a)&&__defNormalProp$g(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$g)try{for(var l=__getOwnPropSymbols$g(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$g.call(r,a)&&__defNormalProp$g(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},__spreadProps$b=function(n,r){return __defProps$b(n,__getOwnPropDescs$b(r))},GridsRender=function(n){_inherits(a,n);var r=_create_super(a);function a(){_class_call_check(this,a);var i;return i=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))),i.v$=[new LabelsRender$1],i}return _create_class(a,[{key:"m$",value:function(i){if(!this.regl)return!1;this.v$.forEach(function(l){return l.m$(i)});var o=this.regl,s=RenderHelper._A(i,o);this.gA(GridShader,i,{attributes:__spreadValues$g({position:o.prop("position"),color:o.prop("color"),normal:o.prop("normal"),topOrBottom:o.prop("topOrBottom")},ColorGLSL.getColor(o).attribute),uniforms:__spreadValues$g(__spreadValues$g(__spreadValues$g(__spreadValues$g({mvp:o.prop("mvp"),opacity:o.prop("opacity"),shininess:o.prop("shininess"),cameraPosition:o.prop("cameraPosition")},RenderUtil.getScaleUniform("height",o)),RenderUtil.getScaleUniform("altitude",o)),ColorGLSL.getColor(o).uniform),s),blend:{enable:!0,func:RenderUtil.getBlend()},cull:{enable:o.prop("cullEnable"),face:o.prop("cullface")},depth:{enable:o.prop("depth"),func:"lequal"},frontFace:"cw",colorMask:o.prop("colorMask"),elements:o.prop("index")})}},{key:"render",value:function(i){var o=this.yA(GridShader);if(o){for(var s=i.meshes,l=i.mvp,u=i.depth,c=i.shininess,f=i.acceptLight,h=i.cull,p=i.opacity,d=i.cameraPosition,v=i.lights,_=i.vP,m=h!=="none",y=h==="front"?"front":"back",g=0;g<s.length;g++){var C=s[g],b=C.attributes;o(__spreadValues$g(__spreadProps$b(__spreadValues$g(__spreadValues$g({},b),v),{depth:u,shininess:c,acceptLight:f,cullEnable:m,cullface:y,opacity:p,cameraPosition:d,count:b.index.length,mvp:l,colorMask:[!1,!1,!1,!1],isPick:!1}),RenderUtil.getScaleProps(_)))}for(var k=0;k<s.length;k++){var L=s[k],F=L.attributes;o(__spreadValues$g(__spreadProps$b(__spreadValues$g(__spreadValues$g({},F),v),{depth:u,shininess:c,acceptLight:f,cullEnable:m,cullface:y,opacity:p,cameraPosition:d,count:F.index.length,mvp:l,colorMask:[!0,!0,!0,!0],isPick:!1}),RenderUtil.getScaleProps(_)))}for(var W=0;W<s.length;W++){var j=!0,Y=!1,N=void 0;try{for(var $=this.v$[Symbol.iterator](),w;!(j=(w=$.next()).done);j=!0){var E=w.value;E.render(s[W])}}catch(A){Y=!0,N=A}finally{try{!j&&$.return!=null&&$.return()}finally{if(Y)throw N}}}}}},{key:"pickRender",value:function(i){var o=this,s=this.yA(GridShader);if(s){var l=i.meshes,u=i.mvp,c=i.depth,f=i.shininess,h=i.acceptLight,p=i.cull,d=i.opacity,v=i.cameraPosition,_=i.lights,m=i.pickFbo,y=i.vP,g=p!=="none",C=p==="front"?"front":"back";m&&m.use(function(){o.regl.clear({color:[0,0,0,0],depth:1});for(var b=0;b<l.length;b++){var k=l[b],L=k.attributes;s(__spreadValues$g(__spreadProps$b(__spreadValues$g(__spreadValues$g({},L),_),{depth:c,shininess:f,acceptLight:h,cullEnable:g,cullface:C,opacity:d,cameraPosition:v,count:L.index.length,mvp:u,colorMask:[!0,!0,!0,!0],isPick:!0}),RenderUtil.getScaleProps(y)))}})}}}]),a}(Render),pushArray$d=CommonUtil$1._C,GridLayer=function(n){_inherits(a,n);var r=_create_super(a);function a(i){_class_call_check(this,a);var o;o=r.call(this,i),o.CLASS_NAME="Grid",o.fusion=new GridsFusion,o.ll=new GridsRender;var s=grid$1.Sw;return o.zooms=i.zooms===void 0?s.zooms:i.zooms,o.visible=i.visible===void 0?s.visible:i.visible,o.zIndex=i.zIndex===void 0?s.zIndex:i.zIndex,o.opacity=i.opacity===void 0?s.opacity:i.opacity,o.shininess=i.shininess===void 0?s.shininess:i.shininess,o.acceptLight=i.acceptLight===void 0?s.acceptLight:i.acceptLight,o.cullface=i.cullface||s.cullface,o.hasSide=i.hasSide===void 0?s.hasSide:i.hasSide,o.depth=i.depth===void 0?s.depth:i.depth,o.AC({zooms:o.zooms,visible:o.visible,zIndex:o.zIndex}),o.buryPoint.record(o.CLASS_NAME),o}return _create_class(a,[{key:"getLabelsLayer",value:function(){return this.ll.v$[0]._$||null}},{key:"receiveDataset",value:function(i){this.dataset=i,this.setStyle(this.styleOptions),this.onAdd()}},{key:"setStyle",value:function(i){if(i.unit=i.unit||"meter",_get(_get_prototype_of(a.prototype),"setStyle",this).call(this,i),this.dataset=this.source.LC(),this.colorPick.clear(),this.dataset&&this.dataset.length>0&&this.meshes){var o=this.WC(),s=o.didFusionDataset,l=this.fusion.fusion(s,this.styleOptions,this);this.meshes=l,this.vA.state|=MeshesDirty,this.loca&&this.loca.requestRender()}}},{key:"getInitialAnimateState",value:function(){return{altitude:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]},height:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]}}}},{key:"jC",value:function(){_get(_get_prototype_of(a.prototype),"jC",this).call(this),!(!this.loca||!this.loca.regl||this.ll.regl)&&(this.ll.regl=this.loca.regl,this.loca.rendererManager.addRenderer(this.ll))}},{key:"beforeRender",value:function(){if(_get(_get_prototype_of(a.prototype),"beforeRender",this).call(this),!this.fusion.regl&&this.loca&&(this.fusion.regl=this.loca.regl,this.loca.fusionManager.addFusion(this.fusion)),this.jC(),this.source&&(this.dataset=this.source.LC()),this.fusion){var i=this.WC(),o=i.willFusion;if(o.length>0){var s=this.fusion.fusion(o,this.styleOptions,this);this.meshes=pushArray$d(this.meshes,s),this.vA.state|=MeshesDirty}}}},{key:"render",value:function(){var i;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var o=(i=this.loca)==null?void 0:i.customCoords.getMVPMatrix(),s=RenderHelper.IA(this.loca.lights);if(this.ll&&this.meshes.length>0)return this.ll.render({meshes:this.meshes,mvp:o,lights:s,cameraPosition:this.loca.customCoords.getCameraParams().position,shininess:this.shininess,acceptLight:this.acceptLight,opacity:this._getOpacity(),depth:this.depth,cull:this.cullface,vP:this._animateLayerState}),!0}}},{key:"pickRender",value:function(){var i;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var o=(i=this.loca)==null?void 0:i.customCoords.getMVPMatrix(),s=RenderHelper.IA(this.loca.lights);this.ll&&this.ll.pickRender({meshes:this.meshes,mvp:o,lights:s,cameraPosition:this.loca.customCoords.getCameraParams().position,shininess:this.shininess,acceptLight:this.acceptLight,opacity:this._getOpacity(),depth:this.depth,cull:this.cullface,pickFbo:this._needPickFrame&&this._pickFbo,pickPos:this._pickPos,vP:this._animateLayerState})}}},{key:"afterRender",value:function(){}},{key:"PA",value:function(){return RenderHelper.SA(this.ll,this)}}]),a}(Layer),pushArray$c=CommonUtil$1._C,HexagonLayer=function(n){_inherits(a,n);var r=_create_super(a);function a(i){_class_call_check(this,a);var o;o=r.call(this,i),o.CLASS_NAME="Hexagon",o.fusion=new GridsFusion,o.ll=new GridsRender;var s=hexagon$1.Sw;return o.zooms=i.zooms===void 0?s.zooms:i.zooms,o.zIndex=i.zIndex===void 0?s.zIndex:i.zIndex,o.opacity=i.opacity===void 0?s.opacity:i.opacity,o.visible=i.visible===void 0?s.visible:i.visible,o.shininess=i.shininess===void 0?s.shininess:i.shininess,o.acceptLight=i.acceptLight===void 0?s.acceptLight:i.acceptLight,o.cullface=i.cullface||s.cullface,o.hasSide=i.hasSide===void 0?s.hasSide:i.hasSide,o.depth=i.depth===void 0?s.depth:i.depth,o.AC({zooms:o.zooms,visible:o.visible,zIndex:o.zIndex}),o.buryPoint.record(o.CLASS_NAME),o}return _create_class(a,[{key:"getLabelsLayer",value:function(){return this.ll.v$[0]._$||null}},{key:"receiveDataset",value:function(i){this.dataset=i,this.setStyle(this.styleOptions),this.onAdd()}},{key:"setStyle",value:function(i){if(i.unit=i.unit||"meter",_get(_get_prototype_of(a.prototype),"setStyle",this).call(this,i),this.dataset=this.source.LC(),this.colorPick.clear(),this.dataset&&this.dataset.length>0&&this.meshes){var o=this.WC(),s=o.didFusionDataset,l=this.fusion.fusion(s,this.styleOptions,this,"hexagon");this.meshes=l,this.vA.state|=MeshesDirty,this.loca&&this.loca.requestRender()}}},{key:"getInitialAnimateState",value:function(){return{altitude:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]},height:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]}}}},{key:"jC",value:function(){_get(_get_prototype_of(a.prototype),"jC",this).call(this),!(!this.loca||!this.loca.regl||this.ll.regl)&&(this.ll.regl=this.loca.regl,this.loca.rendererManager.addRenderer(this.ll))}},{key:"beforeRender",value:function(){if(_get(_get_prototype_of(a.prototype),"beforeRender",this).call(this),!this.fusion.regl&&this.loca&&(this.fusion.regl=this.loca.regl,this.loca.fusionManager.addFusion(this.fusion)),this.jC(),this.source&&(this.dataset=this.source.LC()),this.fusion){var i=this.WC(),o=i.willFusion;if(o.length>0){var s=this.fusion.fusion(o,this.styleOptions,this,"hexagon");this.meshes=pushArray$c(this.meshes,s),this.vA.state|=MeshesDirty}}}},{key:"render",value:function(){var i;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var o=(i=this.loca)==null?void 0:i.customCoords.getMVPMatrix(),s=RenderHelper.IA(this.loca.lights);if(this.ll&&this.meshes.length>0)return this.ll.render({meshes:this.meshes,mvp:o,lights:s,cameraPosition:this.loca.customCoords.getCameraParams().position,shininess:this.shininess,acceptLight:this.acceptLight,opacity:this._getOpacity(),depth:this.depth,cull:this.cullface,vP:this._animateLayerState}),!0}}},{key:"pickRender",value:function(){var i;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var o=(i=this.loca)==null?void 0:i.customCoords.getMVPMatrix(),s=RenderHelper.IA(this.loca.lights);this.ll&&this.ll.pickRender({meshes:this.meshes,mvp:o,lights:s,cameraPosition:this.loca.customCoords.getCameraParams().position,shininess:this.shininess,acceptLight:this.acceptLight,opacity:this._getOpacity(),depth:this.depth,cull:this.cullface,pickFbo:this._needPickFrame&&this._pickFbo,pickPos:this._pickPos,vP:this._animateLayerState})}}},{key:"afterRender",value:function(){}},{key:"PA",value:function(){return RenderHelper.SA(this.ll,this)}}]),a}(Layer),projections={},Projection=function(){function n(r,a,i,o){_class_call_check(this,n),this.project=a,this.unproject=i,this.getResolution=o,projections[r]=this}return _create_class(n,[{key:"J$",value:function(r,a,i){var o=this.getResolution(i),s=a[0]*o,l=a[1]*o,u=this.project(r[0],r[1]);return this.unproject(u[0]+s,u[1]+l)}},{key:"Q$",value:function(r,a){var i=this.project(r[0],r[1]),o=[i[0]+a[0],i[1]+a[1]];return this.unproject(o[0],o[1])}}]),n}(),ProjectionManager={Y$:function(n){return projections[n]}};(function(){var n=function(i,o){return[i,o]},r=function(i,o){return[i,o]},a=function(i){return .703125/Math.pow(2,i)};return new Projection("EPSG:4326",n,r,a)})(),function(){var n=Math.PI/180,r=180/Math.PI,a=6378137,i=85.0511287798,o=function(u,c){var f=i;c=Math.max(Math.min(f,c),-f);var h=u*n,p=c*n;return p=Math.log(Math.tan(Math.PI/4+p/2)),[h*a,p*a]},s=function(u,c){var f=u/a*r,h=(2*Math.atan(Math.exp(c/a))-Math.PI/2)*r;return[f,h]},l=function(u){return 20037508342789244e-9*2/256/Math.pow(2,u)};return new Projection("EPSG:3857",o,s,l)}();var LngLat=function(){function n(r,a){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(_class_call_check(this,n),this.className="AMap.LngLat",isNumberArray(r)?(r=parseFloat(r[0]),a=parseFloat(r[1])):(a=parseFloat(a),r=parseFloat(r)),isNaN(r)||isNaN(a))throw Error("Invalid Object: LngLat("+r+", "+a+")");i!==!0&&(a=Math.max(Math.min(a,90),-90),r=(r+180)%360+(r<-180||r===180?180:-180)),this.Z$=a,this.K$=r,this.cL=Math.round(r*1e6)/1e6,this.uL=Math.round(a*1e6)/1e6,this.Br=ProjectionManager.Y$("EPSG:3857").project(r,a)}return _create_class(n,null,[{key:"from",value:function(r){return isLngLat(r)?new n(r.K$,r.Z$):new n(r[0],r[1])}}]),n}(),__defProp$f=Object.defineProperty,__defProps$a=Object.defineProperties,__getOwnPropDescs$a=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$f=Object.getOwnPropertySymbols,__hasOwnProp$f=Object.prototype.hasOwnProperty,__propIsEnum$f=Object.prototype.propertyIsEnumerable,__defNormalProp$f=function(n,r,a){return r in n?__defProp$f(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$f=function(n,r){for(var a in r||(r={}))__hasOwnProp$f.call(r,a)&&__defNormalProp$f(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$f)try{for(var l=__getOwnPropSymbols$f(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$f.call(r,a)&&__defNormalProp$f(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},__spreadProps$a=function(n,r){return __defProps$a(n,__getOwnPropDescs$a(r))};function parseLngLatData(n){if(Array.isArray(n))if(Array.isArray(n[0]))for(var r=0;r<n.length;r+=1)n[r]=parseLngLatData(n[r]);else{var a=_type_of(n[0]);return a==="string"||a==="number"?new LngLat(n[0],n[1]):n}return n}var __defProp$e=Object.defineProperty,__defProps$9=Object.defineProperties,__getOwnPropDescs$9=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$e=Object.getOwnPropertySymbols,__hasOwnProp$e=Object.prototype.hasOwnProperty,__propIsEnum$e=Object.prototype.propertyIsEnumerable,__defNormalProp$e=function(n,r,a){return r in n?__defProp$e(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$e=function(n,r){for(var a in r||(r={}))__hasOwnProp$e.call(r,a)&&__defNormalProp$e(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$e)try{for(var l=__getOwnPropSymbols$e(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$e.call(r,a)&&__defNormalProp$e(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},__spreadProps$9=function(n,r){return __defProps$9(n,__getOwnPropDescs$9(r))},pushArray$b=CommonUtil$1._C,_CircleFusion=function(n){_inherits(a,n);var r=_create_super(a);function a(){return _class_call_check(this,a),r.apply(this,arguments)}return _create_class(a,[{key:"DC",value:function(){}},{key:"buildStyle",value:function(i,o){var s;o=transToPolygonStyle(o);for(var l=circle.style,u=[],c=0;c<i.length;c++)if(!(!i[c].features||!i[c].features.points)){for(var f=i[c].features.points,h=StyleInstance.parse(f,o,l),p={},d=0;d<f.length;d++)if(h)for(var v in h.attributes){var _=h.attributes[v];p[v]||(p[v]=[]),((s=_[d])==null?void 0:s.length)>0?pushArray$b(p[v],_[d]):p[v][p[v].length]=_[d]}u.push({attributes:p,uniforms:h.uniforms,si:h.si})}return u}},{key:"fusion",value:function(i,o,s,l){if(!this.regl||!s.loca)return[];var u=[];l=l||this.buildStyle(i,o);var c=s.loca.customCoords;l.length&&(i=transToPolygonData(i,l));for(var f=0;f<i.length;f++){var h=i[f];if(!(!h.features||!h.features.points||!l[f])){for(var p=h.features.points,d=l[f],v={index:[],vertex:[],color:[],normal:[],uv:[],textureSize:[],pickColor:[],labels:[],center:[],radius:[],borderColor:[],borderWidth:[],blurWidth:[]},_=[],m=0;m<p.length;m++){var y=p[m],g=s.colorPick.add(y),C=y.coordinates,b=y.center,k=y.radius;if(y.type==="MultiPoint"){for(var L=0,F=C.length;L<F;L++){var W=C[L],j=this.triangles(W,{style:d,index:m,pickColor:g,id:y.sr,center:b},c);GeoUtil.mergeTriangles(v,j,4),pushArray$b(v.color,j.color),pushArray$b(v.pickColor,j.pickColor),pushArray$b(v.normal,j.normal),pushArray$b(v.uv,j.uv),pushArray$b(v.textureSize,j.textureSize),pushArray$b(v.center,j.center),pushArray$b(v.borderColor,j.borderColor),pushArray$b(v.borderWidth,j.borderWidth),pushArray$b(v.blurWidth,j.blurWidth)}d.attributes.label[m]&&v.labels.push(__spreadValues$e({position:_to_consumable_array(GeometryUtil.a$(C))},d.attributes.label[m]))}else{var Y=this.triangles(C,{style:d,index:m,pickColor:g,id:y.sr,center:b,radius:k},c);GeoUtil.mergeTriangles(v,Y,4),pushArray$b(v.color,Y.color),pushArray$b(v.pickColor,Y.pickColor),pushArray$b(v.normal,Y.normal),pushArray$b(v.uv,Y.uv),pushArray$b(v.textureSize,Y.textureSize),pushArray$b(v.center,Y.center),pushArray$b(v.radius,Y.radius),pushArray$b(v.borderColor,Y.borderColor),pushArray$b(v.borderWidth,Y.borderWidth),pushArray$b(v.blurWidth,Y.blurWidth),d.attributes.label[m]&&v.labels.push(__spreadValues$e({position:_to_consumable_array(GeometryUtil.a$(C))},d.attributes.label[m]))}_[m]=v.vertex.length}u[f]={id:h.id,attributes:{position:{buffer:this.regl.buffer(v.vertex),offset:0,stride:4*4,td:!1,divisor:0},color:{buffer:this.regl.buffer(v.color),offset:0,stride:4*4,td:!1,divisor:0},pickColor:{buffer:this.regl.buffer(v.pickColor),offset:0,stride:4*4,td:!1,divisor:0},normal:{buffer:this.regl.buffer(v.normal),offset:0,stride:4*3,td:!1,divisor:0},uv:{buffer:this.regl.buffer(v.uv),offset:0,stride:4*2,td:!1,divisor:0},textureSize:{buffer:this.regl.buffer(v.textureSize),offset:0,stride:4*2,td:!1,divisor:0},center:{buffer:this.regl.buffer(v.center),offset:0,stride:4*2,td:!1,divisor:0},radius:{buffer:this.regl.buffer(v.radius),offset:0,stride:4*1,td:!1,divisor:0},borderColor:{buffer:this.regl.buffer(v.borderColor),offset:0,stride:4*4,td:!1,divisor:0},borderWidth:{buffer:this.regl.buffer(v.borderWidth),offset:0,stride:4*1,td:!1,divisor:0},blurWidth:{buffer:this.regl.buffer(v.blurWidth),offset:0,stride:4*1,td:!1,divisor:0},index:this.regl.elements({primitive:"triangles",type:"uint32",data:v.index})},uniforms:__spreadValues$e({},d.uniforms),si:d.si,mf:{Tw:{jw:_},origin:{position:v.vertex,color:v.color,blurWidth:v.blurWidth,borderColor:v.borderColor,borderWidth:v.borderWidth},labels:v.labels}}}}return u}},{key:"triangles",value:function(i,o,s){for(var l=GeoUtil.triangle(i),u=l.vertex,c=l.index,f=o.index,h=o.pickColor,p=s.lngLatToCoord(o.center),d=o.radius,v=o.style.attributes,_=v.color,m=v.textureSize,y=v.borderColor,g=v.borderWidth,C=v.blurWidth,b=f*4,k=_.slice(b,b+4),L=m&&m.slice(f*2,f*2+2),F=y.slice(b,b+4),W=g.slice(f*1,f*1+1),j=C.slice(f*1,f*1+1),Y=[],N=[],$=[],w=[],E=[],A=[],R=[],O=[],P=[],T=[],M=[],U=0,Q=u.length;U<Q;U+=2){var K=u[U],te=u[U+1],ve=s.lngLatToCoord([K,te]),de=Y.length;if(Y[de]=ve[0],Y[de+1]=ve[1],Y[de+2]=o.id,Y[de+3]=1,N[de]=k[0],N[de+1]=k[1],N[de+2]=k[2],N[de+3]=k[3],R&&F){var be=R.length;R[be]=F[0],R[be+1]=F[1],R[be+2]=F[2],R[be+3]=F[3]}if(O&&W){var et=O.length;O[et]=W[0]}if(P&&j){var qe=P.length;P[qe]=j[0]}var Ne=T.length;T[Ne]=p[0],T[Ne+1]=p[1];var Ge=M.length;M[Ge]=d;var ft=$.length;$[ft]=0,$[ft+1]=0,$[ft+2]=-1;var Ze=w.length;if(w[Ze]=-1,w[Ze+1]=-1,E&&L&&(E[Ze]=L[0],E[Ze+1]=L[1]),A&&h){var pt=A.length;A[pt]=h[0],A[pt+1]=h[1],A[pt+2]=h[2],A[pt+3]=h[3]}}return{index:c,vertex:Y,color:N,normal:$,uv:w,textureSize:E,pickColor:A,borderColor:R,borderWidth:O,blurWidth:P,center:T,radius:M}}},{key:"updateStyle",value:function(i,o){for(var s=function(c,f){for(var h=i[c],p=o[c].attributes,d=p.color,v=p.borderColor,_=p.borderWidth,m=p.blurWidth,y=p.label,g=h.mf.origin,C=g.position,b=g.color,k=g.borderColor,L=g.borderWidth,F=g.blurWidth,W=h.mf.Tw.jw,j=C.length/W.length/4,Y=0;Y<W.length;Y++)for(var N=0;N<j;N++){var $=(Y*j+N)*4,w=Y*4;b[$]=d[w],b[$+1]=d[w+1],b[$+2]=d[w+2],b[$+3]=d[w+3];var E=(Y*j+N)*4,A=Y*4;k[E]=v[A],k[E+1]=v[A+1],k[E+2]=v[A+2],k[E+3]=v[A+3];var R=Y*j+N;L[R]=_[Y];var O=Y*j+N;F[O]=m[Y]}h.attributes.position.buffer({data:C}),h.attributes.color.buffer({data:b}),h.attributes.borderColor.buffer({data:k}),h.attributes.borderWidth.buffer({data:L}),h.attributes.blurWidth.buffer({data:F}),h.uniforms=o[c].uniforms,h.mf.labels=h.mf.labels.map(function(P,T){var M=P.position;return __spreadProps$9(__spreadValues$e(__spreadValues$e({},P),y[T]),{position:M})})},l=0,u=i.length;l<u;l++)s(l,u)}},{key:"EC",value:function(){return[]}},{key:"destroy",value:function(){this.regl=null}}],[{key:"getInstance",value:function(){return this.ui}}]),a}(GeometryFusion),CircleFusion=_CircleFusion;CircleFusion.ui=new _CircleFusion,CircleFusion.getInstance();var CircleShader={vertex:"\n        precision highp float;\n\n        attribute vec4 position;\n        attribute vec3 normal;\n        attribute vec4 color;\n        attribute vec2 uv;\n        attribute vec2 textureSize;\n        attribute vec2 center;\n        attribute float radius;\n        attribute vec4 borderColor;\n        attribute float borderWidth;\n        attribute float blurWidth;\n\n        varying vec3 vNormal;\n        varying vec4 vColor;\n        varying vec3 vPosition;\n        varying vec2 vUv;\n        varying vec2 vTexSize;\n        varying vec2 vCenter;\n        varying float vRadius;\n        varying vec4 vBorderColor;\n        varying float vBorderWidth;\n        varying float vBlurWidth;\n        ".concat(ColorGLSL.getColorShader().vertex,"\n        ").concat(RenderUtil.getBezier(),"\n        ").concat(RenderUtil.getScaleType("radius"),"\n\n        uniform float resolution;\n        uniform float unit;\n        uniform float ratio;\n        uniform mat4 mvp;\n        uniform float pit;\n        uniform float rot;\n\n        mat4 rotatePit(float rad) {\n            float s = sin(rad);\n            float c = cos(rad);\n            mat4 rotate = mat4(\n                1, 0, 0, 0,\n                0, c, s, 0,\n                0, -s, c, 0,\n                0, 0, 0, 1\n            );\n            return rotate;\n        }\n\n        mat4 rotateRot(float rad) {\n            float s = sin(rad);\n            float c = cos(rad);\n            mat4 rotate = mat4(\n                c, -s, 0, 0,\n                s, c, 0, 0,\n                0, 0, 1, 0,\n                0, 0, 0, 1\n            );\n            return rotate;\n        }\n\n        vec4 getPos(vec4 scalePos, float apit,float arot, vec2 centerPos) {\n            vec4 result = scalePos;\n            result.xy -= centerPos.xy;\n            result = rotateRot(-arot) * rotatePit(apit) * result;\n            result.xy += centerPos.xy;\n            return result;\n        }\n\n        void main() {\n            vec3 realPos = vec3(position.xy,0.0);\n            float radiusScale = radiusScaleValue(position.z);\n\n            vec2 centerPos = center;\n            float dis = distance(centerPos,realPos.xy);\n\n            if(unit == 1.0){\n                vBlurWidth = blurWidth * radiusScale;\n                vBorderWidth = borderWidth * radiusScale;\n                vRadius = dis * radiusScale;\n            } else {\n                vBlurWidth = blurWidth * radiusScale * resolution;\n                vBorderWidth = borderWidth * radiusScale * resolution;\n                vRadius = radius * radiusScale * resolution + vBorderWidth;\n            }\n            \n            float dx = 0.0;\n            float dy = 0.0;\n            if(realPos.x == centerPos.x) {\n                if(realPos.y >= centerPos.y) {\n                    dx = 0.0;\n                    dy = vRadius;\n                } else{\n                    dx = 0.0;\n                    dy = - vRadius;\n                }\n            } else {\n                float k = (realPos.y - centerPos.y) / (realPos.x - centerPos.x);\n                float radion = atan(k);\n                if(realPos.x > centerPos.x) {\n                    dx = cos(radion) * vRadius;\n                    dy = sin(radion) * vRadius;\n                } else {\n                    dx = - cos(radion) * vRadius;\n                    dy = - sin(radion) * vRadius;\n                }\n            } \n            float finalX = centerPos.x + dx;\n            float finalY = centerPos.y + dy;\n            vec4 scalePos = vec4(finalX, finalY, realPos.z, 1.0);\n\n            gl_Position =  mvp * getPos(scalePos,pit,rot,centerPos);\n            \n            vColor = color;\n            vNormal = normal;\n            vPosition = scalePos.xyz;\n            vCenter = centerPos;\n            vBorderColor = borderColor;\n            vUv = vec2(uv.x / textureSize.x, uv.y / textureSize.y);\n            vTexSize = textureSize;\n            ").concat(ColorGLSL.getColorShader().mainVert,"\n        }\n    "),fragment:"\n        precision highp float;\n        varying vec4 vColor;\n\n        varying vec3 vNormal;\n        varying vec3 vPosition;\n        varying vec2 vUv;\n        varying vec2 vTexSize;\n\n        varying vec2 vCenter;\n        varying float vRadius;\n        varying vec4 vBorderColor;\n        varying float vBorderWidth;\n        varying float vBlurWidth;\n\n        uniform float opacity;\n        uniform sampler2D texture;\n        uniform bool useTexture;\n\n        ".concat(ColorGLSL.getColorShader().fragment,"\n\n        void main() {\n            if(useTexture && vTexSize.x >= 0.0) {\n                gl_FragColor = texture2D(texture, vUv);\n            } else {\n                gl_FragColor = vColor;\n            }\n\n            // \u6709-\u6297\u952F\u9F7F\u50CF\u7D20\u4F4D\n            float realRadius = vRadius;\n            float len = distance(vPosition.xy, vCenter);\n            if(len > realRadius) {\n                discard;\n            } else if(vBorderWidth > 0.0 && len > realRadius - vBorderWidth) {\n                gl_FragColor = vBorderColor;\n            }\n            if(vBlurWidth > 0.0 && len > realRadius - vBlurWidth) {\n                gl_FragColor.a = smoothstep(1.0, 0.0, (len - (realRadius - vBlurWidth)) / vBlurWidth);\n            }\n            // \u589E\u52A0\u900F\u660E\u5EA6\n            gl_FragColor.a *= opacity;\n\n            ").concat(ColorGLSL.getColorShader().mainFrag,"\n        }\n    ")},__defProp$d=Object.defineProperty,__defProps$8=Object.defineProperties,__getOwnPropDescs$8=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$d=Object.getOwnPropertySymbols,__hasOwnProp$d=Object.prototype.hasOwnProperty,__propIsEnum$d=Object.prototype.propertyIsEnumerable,__defNormalProp$d=function(n,r,a){return r in n?__defProp$d(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$d=function(n,r){for(var a in r||(r={}))__hasOwnProp$d.call(r,a)&&__defNormalProp$d(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$d)try{for(var l=__getOwnPropSymbols$d(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$d.call(r,a)&&__defNormalProp$d(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},__spreadProps$8=function(n,r){return __defProps$8(n,__getOwnPropDescs$8(r))},CircleRender=function(n){_inherits(a,n);var r=_create_super(a);function a(){_class_call_check(this,a);var i;return i=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))),i.v$=[new LabelsRender$1],i}return _create_class(a,[{key:"m$",value:function(i){if(!this.regl)return!1;this.v$.forEach(function(s){return s.m$(i)});var o=this.regl;this.gA(CircleShader,i,{attributes:__spreadValues$d({position:o.prop("position"),color:o.prop("color"),borderColor:o.prop("borderColor"),borderWidth:o.prop("borderWidth"),blurWidth:o.prop("blurWidth"),center:o.prop("center"),radius:o.prop("radius"),normal:o.prop("normal"),uv:o.prop("uv"),textureSize:o.prop("textureSize")},ColorGLSL.getColor(o).attribute),uniforms:__spreadValues$d(__spreadValues$d({resolution:o.prop("resolution"),unit:o.prop("unit"),ratio:window.AMap.Browser.retina?2:1,mvp:o.prop("mvp"),pit:o.prop("pit"),rot:o.prop("rot"),opacity:o.prop("opacity"),texture:o.prop("texture"),useTexture:o.prop("useTexture")},ColorGLSL.getColor(o).uniform),RenderUtil.getScaleUniform("radius",o)),blend:{enable:!0,func:o.prop("blend")},cull:{enable:o.prop("cullEnable"),face:o.prop("cullface")},frontFace:"cw",depth:{enable:o.prop("depth"),func:"lequal"},colorMask:o.prop("colorMask"),elements:o.prop("index")})}},{key:"fL",value:function(i){var o=i.regl.texture({data:[[[0,255,0,0],[255,0,0,0]],[[0,0,255,0],[255,255,0,0]]],flipY:!0}),s=!1,l=!1,u=!1,c="front";return{texture:o,useTexture:s,depth:l,cullEnable:u,face:c}}},{key:"render",value:function(i){var o=this.yA(CircleShader);if(o){for(var s=i.loca,l=i.meshes,u=i.mvp,c=i.opacity,f=c===void 0?1:c,h=i.blend,p=h===void 0?"normal":h,d=i.resolution,v=i.pit,_=i.rot,m=i.vP,y=this.fL(s),g=y.texture,C=y.useTexture,b=y.depth,k=y.cullEnable,L=y.face,F=0;F<l.length;F++){var W=l[F],j=W.attributes,Y=W.uniforms;o(__spreadValues$d(__spreadProps$8(__spreadValues$d(__spreadValues$d({},j),Y),{resolution:d,unit:Y.unit==="px"?0:1,blend:RenderUtil.getBlend(p),mvp:u,pit:v,rot:_,colorMask:[!0,!0,!0,!0],opacity:f,cullEnable:k,cullface:L,depth:b,texture:g,useTexture:C,isPick:!1}),RenderUtil.getScaleProps(m)))}for(var N=0;N<l.length;N++){var $=!0,w=!1,E=void 0;try{for(var A=this.v$[Symbol.iterator](),R;!($=(R=A.next()).done);$=!0){var O=R.value;O.render(l[N])}}catch(P){w=!0,E=P}finally{try{!$&&A.return!=null&&A.return()}finally{if(w)throw E}}}}}},{key:"pickRender",value:function(i){var o=this,s=this.yA(CircleShader);if(s){var l=i.loca,u=i.meshes,c=i.mvp,f=i.opacity,h=f===void 0?1:f,p=i.blend,d=p===void 0?"normal":p,v=i.resolution,_=i.pit,m=i.rot,y=i.pickFbo,g=i.pickPos,C=i.vP,b=this.fL(l),k=b.texture,L=b.depth,F=b.cullEnable,W=b.face;y&&g&&y.use(function(){o.regl.clear({color:[0,0,0,0],depth:1});for(var j=0;j<u.length;j++){var Y=u[j],N=Y.attributes,$=Y.uniforms;s(__spreadValues$d(__spreadProps$8(__spreadValues$d(__spreadValues$d({},N),$),{resolution:v,unit:$.unit==="px"?0:1,blend:RenderUtil.getBlend(d),mvp:c,pit:_,rot:m,colorMask:[!0,!0,!0,!0],opacity:h,cullEnable:F,cullface:W,depth:L,texture:k,useTexture:!1,isPick:!0}),RenderUtil.getScaleProps(C)))}})}}}]),a}(Render),pushArray$a=CommonUtil$1._C,PointLayer=function(n){_inherits(a,n);var r=_create_super(a);function a(i){_class_call_check(this,a);var o;o=r.call(this,i),o.CLASS_NAME="Point",o.fusion=new CircleFusion,o.ll=new CircleRender;var s=circle.Sw;return o.zooms=i.zooms===void 0?s.zooms:i.zooms,o.visible=i.visible===void 0?s.visible:i.visible,o.zIndex=i.zIndex===void 0?s.zIndex:i.zIndex,o.opacity=i.opacity===void 0?s.opacity:i.opacity,o.blend=i.blend===void 0?s.blend:i.blend,o.AC({zooms:o.zooms,visible:o.visible,zIndex:o.zIndex}),o.buryPoint.record(o.CLASS_NAME),o}return _create_class(a,[{key:"getLabelsLayer",value:function(){return this.ll.v$[0]._$||null}},{key:"setStyle",value:function(i){if(_get(_get_prototype_of(a.prototype),"setStyle",this).call(this,i),!!i&&(this.dataset=this.source.LC(),this.dataset&&this.dataset.length>0)){var o=this.WC(),s=o.didFusion,l=this.fusion.buildStyle(this.dataset,this.styleOptions);this.fusion.updateStyle(s,l),this.vA.state|=MeshDirty,this.loca&&this.loca.requestRender()}}},{key:"getInitialAnimateState",value:function(){return{radius:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]}}}},{key:"receiveDataset",value:function(i){this.dataset=i,this.setStyle(this.styleOptions),this.onAdd()}},{key:"jC",value:function(){_get(_get_prototype_of(a.prototype),"jC",this).call(this),!(!this.loca||!this.loca.regl||this.ll.regl)&&(this.ll.regl=this.loca.regl,this.loca.rendererManager.addRenderer(this.ll))}},{key:"beforeRender",value:function(){if(_get(_get_prototype_of(a.prototype),"beforeRender",this).call(this),!this.fusion.regl&&this.loca&&(this.fusion.regl=this.loca.regl,this.loca.fusionManager.addFusion(this.fusion)),this.jC(),this.source&&(this.dataset=this.source.LC()),this.fusion){var i=this.WC(),o=i.willFusion;if(o.length>0){var s=this.fusion.fusion(o,this.styleOptions,this);this.meshes=pushArray$a(this.meshes,s),this.vA.state|=MeshesDirty}}}},{key:"render",value:function(){var i,o,s,l;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var u=(i=this.loca)==null?void 0:i.customCoords.getMVPMatrix(),c=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom()),f=((s=this.loca)==null?void 0:s.map.getPitch())/180*Math.PI,h=((l=this.loca)==null?void 0:l.map.getRotation())/180*Math.PI;if(this.ll&&this.meshes.length)return this.ll.render({loca:this.loca,meshes:this.meshes,mvp:u,resolution:c,pit:f,rot:h,opacity:this._getOpacity(),blend:this.blend,vP:this._animateLayerState}),!0}}},{key:"pickRender",value:function(){var i,o,s,l;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var u=this.projection.getResolution((i=this.loca)==null?void 0:i.map.getZoom()),c=(o=this.loca)==null?void 0:o.customCoords.getMVPMatrix(),f=((s=this.loca)==null?void 0:s.map.getPitch())/180*Math.PI,h=((l=this.loca)==null?void 0:l.map.getRotation())/180*Math.PI;this.ll&&this.meshes.length>0&&this.ll.pickRender({loca:this.loca,meshes:this.meshes,resolution:u,pit:f,rot:h,opacity:this._getOpacity(),pickFbo:this._needPickFrame&&this._pickFbo,pickPos:this._pickPos,mvp:c,vP:this._animateLayerState})}}},{key:"afterRender",value:function(){}},{key:"destroy",value:function(){_get(_get_prototype_of(a.prototype),"destroy",this).call(this)}},{key:"PA",value:function(){return RenderHelper.SA(this.ll,this)}}]),a}(Layer),__defProp$c=Object.defineProperty,__getOwnPropSymbols$c=Object.getOwnPropertySymbols,__hasOwnProp$c=Object.prototype.hasOwnProperty,__propIsEnum$c=Object.prototype.propertyIsEnumerable,__defNormalProp$c=function(n,r,a){return r in n?__defProp$c(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$c=function(n,r){for(var a in r||(r={}))__hasOwnProp$c.call(r,a)&&__defNormalProp$c(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$c)try{for(var l=__getOwnPropSymbols$c(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$c.call(r,a)&&__defNormalProp$c(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},pushArray$9=CommonUtil$1._C,_IconFusion=function(n){_inherits(a,n);var r=_create_super(a);function a(){_class_call_check(this,a);var i;return i=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))),i.kx={},i}return _create_class(a,[{key:"buildStyle",value:function(i,o){for(var s,l=icon.style,u=[],c=0;c<i.length;c++)if(!(!i[c].features||!i[c].features.points)){for(var f=i[c].features.points,h=StyleInstance.parse(f,o,l),p={},d=0;d<f.length;d++)if(h)for(var v in h.attributes){var _=h.attributes[v];p[v]||(p[v]=[]),typeof _[d]=="string"?pushArray$9(p[v],[_[d]]):((s=_[d])==null?void 0:s.length)>0?pushArray$9(p[v],_[d]):p[v][p[v].length]=_[d]}u.push({attributes:p,uniforms:h.uniforms,si:h.si})}return u}},{key:"DC",value:function(){}},{key:"fusion",value:function(i,o,s,l){return!this.regl||!s.loca?[]:(l=l||this.buildStyle(i,o),o&&i&&i.length?this.Cx({dataset:i,styleOptions:o,Sw:s,Ax:l}):[])}},{key:"Ox",value:function(i,o){var s=o.zx(),l=s._x,u=s.Sx,c=null,f=i;if(u.has(f))c=u.get(f);else{if(_instanceof(i,SVGSVGElement)){var h=new XMLSerializer;f=h.serializeToString(i)}else _instanceof(i,Image)?f=i.src:typeof i=="string"&&(f=i);u.has(f)?c=u.get(f):(l.push(i),c=l.length-1,u.set(f,c))}return c}},{key:"Cx",value:function(i){for(var o=i.dataset,s=i.Ax,l=i.Sw,u=this,c,f=[],h=(c=l==null?void 0:l.loca)==null?void 0:c.customCoords,p=function(W){var j=W.mesh,Y=W.style,N=W.lnglat,$=W.pickColor,w=W.id,E=h.lngLatToCoord(N);pushArray$9(j.position,[E[0],E[1],w]),pushArray$9(j.iconSize,Y.iconSize),pushArray$9(j.offset,Y.offset);var A=Y.rotation/180*Math.PI;pushArray$9(j.rotation,[A]),pushArray$9(j.opacity,[Y.opacity]);var R=u.Ox(Y.icon,l);pushArray$9(j.iconIndex,[R]),pushArray$9(j.pickColor,$),Y.label&&j.labels.push(__spreadValues$c({position:N},Y.label))},d=0;d<o.length;d++){var v=o[d];if(!(!v.features||!v.features.points)){for(var _=v.features.points,m=s[d],y={position:[],iconIndex:[],iconSize:[],offset:[],rotation:[],opacity:[],pickColor:[],labels:[]},g=0;g<_.length;g++){var C=_[g],b=C==null?void 0:C.coordinates,k=l.colorPick.add(C),L={icon:m.attributes.icon[g],iconSize:m.attributes.iconSize.slice(g*2,g*2+2),rotation:m.attributes.rotation[g],opacity:m.attributes.opacity[g],offset:m.attributes.offset.slice(g*2,g*2+2),label:m.attributes.label[g]};if(b&&b.length)if(C.type=="MultiPoint")for(var F=0;F<b.length;F++)p({mesh:y,style:L,lnglat:b[F],pickColor:k,id:C.sr});else p({mesh:y,style:L,lnglat:b,pickColor:k,id:C.sr})}f[d]={id:v.id,attributes:{position:{buffer:this.regl.buffer(y.position),offset:0,stride:4*3,td:!1,divisor:0},iconIndex:{buffer:this.regl.buffer(y.iconIndex),offset:0,stride:4*1,td:!1,divisor:0},iconSize:{buffer:this.regl.buffer(y.iconSize),offset:0,stride:4*2,td:!1,divisor:0},offset:{buffer:this.regl.buffer(y.offset),offset:0,stride:4*2,td:!1,divisor:0},rotation:{buffer:this.regl.buffer(y.rotation),offset:0,stride:4*1,td:!1,divisor:0},opacity:{buffer:this.regl.buffer(y.opacity),offset:0,stride:4*1,td:!1,divisor:0},pickColor:{buffer:this.regl.buffer(y.pickColor),offset:0,stride:4*4,td:!1,divisor:0}},uniforms:m.uniforms,si:m.si,mf:{count:y.position.length/3,labels:y.labels}}}}return f}},{key:"EC",value:function(){return[]}},{key:"destroy",value:function(){this.regl=null}}],[{key:"getInstance",value:function(){return this.ui}}]),a}(GeometryFusion),IconFusion=_IconFusion;IconFusion.ui=new _IconFusion,IconFusion.getInstance();var IconShader={vertex:"\n        precision highp float;\n\n        uniform mat4 mvp;\n        uniform float iconCount;\n        uniform float resolution;\n        // unit: px=0, meter=1\n        uniform float unit;\n        uniform float ratio;\n\n        attribute vec3 position;\n        attribute vec2 iconSize;\n        attribute vec2 offset;\n        attribute float rotation;\n        attribute float opacity;\n        attribute float iconIndex;\n\n        varying vec2 v_size;\n        varying float v_rotation;\n        varying float v_opacity;\n        varying vec2 v_texture_coord;\n        ".concat(ColorGLSL.getColorShader().vertex,"\n        ").concat(RenderUtil.getBezier(),"\n        ").concat(RenderUtil.getScaleType("iconSize"),"\n        ").concat(RenderUtil.getScaleType("offset"),"\n\n        void main() {\n            float res = unit == 1.0 ? 1.0 : resolution;\n\n            gl_Position = mvp * vec4(position.xy + offset * res * offsetScaleValue(position.z), 0, 1);\n            v_texture_coord = vec2(1.0 / iconCount * iconIndex, 0.0);\n\n            // \u8BA1\u7B97 xy \u7684\u76F8\u5BF9\u503C\n            res = unit == 1.0 ? resolution : 1.0;\n            v_size = iconSize.xy / res * ratio * iconSizeScaleValue(position.z);\n            float dist = sqrt(v_size.x * v_size.x + v_size.y * v_size.y);\n            // v_size.x = v_size.x / dist * v_size.x;\n            // v_size.y = v_size.y / dist * v_size.y;\n\n            v_rotation = rotation;\n            v_opacity = opacity;\n            gl_PointSize = dist;\n            ").concat(ColorGLSL.getColorShader().mainVert,"\n        }\n    "),fragment:"\n        precision highp float;\n        uniform sampler2D texture;\n        // uniform float resolution;\n        uniform float layerOpacity;\n        uniform float iconCount;\n\n        varying vec2 v_size;\n        varying float v_rotation;\n        varying float v_opacity;\n        varying vec2 v_texture_coord;\n        ".concat(ColorGLSL.getColorShader().fragment,"\n\n        vec2 rotateUV(vec2 uv, float arc, vec2 mid){\n            mat2 rotn =  mat2(cos(arc), sin(arc),\n                             -sin(arc), cos(arc));\n            return rotn * (uv - mid) + mid;\n        }\n\n        void main() {\n            vec2 txture_partial_size = vec2(1.0 / iconCount, 1);\n            gl_FragColor = vec4(0,0,0,1.0);\n\n            float maxSize = sqrt(v_size.x * v_size.x + v_size.y * v_size.y);\n\n            // \u65CB\u8F6C\uFF1A\u65CB\u8F6C\u5FC5\u987B\u5728\u653E\u7F29\u4E4B\u524D\n            vec2 uv = rotateUV(gl_PointCoord.xy, -v_rotation, vec2(0.5,0.5));\n\n            // \u653E\u7F29\uFF1A\u5750\u6807\u7A7A\u95F4\u653E\u5927\uFF0C\u4F7F\u539F\u672C\u7684[0, 1]\u53D8\u4E3A[0, 1*scale]\n            uv = vec2(\n                uv.x / v_size.x * maxSize,\n                uv.y / v_size.y * maxSize\n            );\n\n            // \u4FEE\u6B63\uFF1A\u4F7F[0, 1*scale]\u53D8\u4E3A[-1*scale/2, 0) [0, 1] (1, 1*scale/2]\u7684\u90E8\u5206\u6765\u753B\u56FE\u5F62\uFF0C\u4E24\u4FA7\u5176\u4F59\u90E8\u5206\u753B\u7A7A\u767D\n            uv = vec2(\n                uv.x - ((maxSize/v_size.x - 1.0) / 2.0),\n                uv.y - ((maxSize/v_size.y - 1.0) / 2.0)\n            );\n\n            float flag1 = step(float(uv.x), 0.0);\n            float flag2 = step(1.0, float(uv.x));\n            float flag3 = step(1.0, float(uv.y));\n            float flag4 = step(float(uv.y), 0.0);\n            float invalid = flag1 + flag2 + flag3 + flag4;\n            vec2 _uv = txture_partial_size * uv;\n            vec2 coord = v_texture_coord + _uv;\n            vec4 t_clr = texture2D(texture, coord);\n            gl_FragColor = (1.0 - invalid) * t_clr;\n            gl_FragColor.a *= v_opacity * layerOpacity;\n            ").concat(ColorGLSL.getColorShader().mainFrag,"\n        }\n    ")},__defProp$b=Object.defineProperty,__defProps$7=Object.defineProperties,__getOwnPropDescs$7=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$b=Object.getOwnPropertySymbols,__hasOwnProp$b=Object.prototype.hasOwnProperty,__propIsEnum$b=Object.prototype.propertyIsEnumerable,__defNormalProp$b=function(n,r,a){return r in n?__defProp$b(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$b=function(n,r){for(var a in r||(r={}))__hasOwnProp$b.call(r,a)&&__defNormalProp$b(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$b)try{for(var l=__getOwnPropSymbols$b(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$b.call(r,a)&&__defNormalProp$b(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},__spreadProps$7=function(n,r){return __defProps$7(n,__getOwnPropDescs$7(r))},IconRender=function(n){_inherits(a,n);var r=_create_super(a);function a(){_class_call_check(this,a);var i;return i=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))),i.v$=[new LabelsRender$1],i}return _create_class(a,[{key:"m$",value:function(i){if(!this.regl)return!1;this.v$.forEach(function(s){return s.m$(i)});var o=this.regl;this.gA(IconShader,i,{attributes:__spreadValues$b({position:o.prop("position"),iconIndex:o.prop("iconIndex"),iconSize:o.prop("iconSize"),offset:o.prop("offset"),rotation:o.prop("rotation"),opacity:o.prop("opacity")},ColorGLSL.getColor(o).attribute),uniforms:__spreadValues$b(__spreadValues$b(__spreadValues$b({mvp:o.prop("mvp"),resolution:o.prop("resolution"),texture:o.prop("texture"),iconCount:o.prop("iconCount"),layerOpacity:o.prop("layerOpacity"),unit:o.prop("unit"),ratio:window.AMap.Browser.retina?2:1},ColorGLSL.getColor(o).uniform),RenderUtil.getScaleUniform("iconSize",o)),RenderUtil.getScaleUniform("offset",o)),depth:{enable:!1},blend:{enable:!0,func:RenderUtil.getBlend("normal")},count:o.prop("count"),primitive:"points"})}},{key:"render",value:function(i){var o=this.yA(IconShader);if(o){var s=i.meshes,l=i.mvp,u=i.opacity,c=i.resolution,f=i.texture,h=i.iconCount,p=i.vP;if(!(s.length<1)){for(var d=0;d<s.length;d++){var v=s[d],_=v.attributes,m=v.uniforms,y=v.mf,g=y.count;o(__spreadValues$b(__spreadProps$7(__spreadValues$b(__spreadValues$b({},_),m),{unit:m.unit==="px"?0:1,count:g,resolution:c,layerOpacity:u,iconCount:h,texture:f,mvp:l,isPick:!1}),RenderUtil.getScaleProps(p)))}for(var C=0;C<s.length;C++){var b=!0,k=!1,L=void 0;try{for(var F=this.v$[Symbol.iterator](),W;!(b=(W=F.next()).done);b=!0){var j=W.value;j.render(s[C])}}catch(Y){k=!0,L=Y}finally{try{!b&&F.return!=null&&F.return()}finally{if(k)throw L}}}}}}},{key:"pickRender",value:function(i){var o=this,s=this.yA(IconShader);if(s){var l=i.meshes,u=i.mvp,c=i.opacity,f=i.resolution,h=i.texture,p=i.iconCount,d=i.pickFbo,v=i.pickPos,_=i.vP;l.length<1||d&&v&&d.use(function(){o.regl.clear({color:[0,0,0,0],depth:1});for(var m=0;m<l.length;m++){var y=l[m],g=y.attributes,C=y.uniforms,b=y.mf,k=b.count,L=C.unit==="px"?0:1;s(__spreadValues$b(__spreadProps$7(__spreadValues$b(__spreadValues$b({},g),C),{unit:L,count:k,resolution:f,layerOpacity:c,iconCount:p,texture:h,mvp:u,isPick:!0}),RenderUtil.getScaleProps(_)))}})}}}]),a}(Render),IconLayer=function(n){_inherits(a,n);var r=_create_super(a);function a(i){_class_call_check(this,a);var o;o=r.call(this,i),o.CLASS_NAME="Icon",o.fusion=new IconFusion,o.ll=new IconRender,o.Tx=!1,o.jx=[],o.Bx=0,o.Dx=new Map,o.Vx=[];var s=icon.Sw;return o.zooms=i.zooms===void 0?s.zooms:i.zooms,o.visible=i.visible===void 0?s.visible:i.visible,o.zIndex=i.zIndex===void 0?s.zIndex:i.zIndex,o.opacity=i.opacity===void 0?s.opacity:i.opacity,o.AC({zooms:o.zooms,visible:o.visible,zIndex:o.zIndex}),o.buryPoint.record(o.CLASS_NAME),o}return _create_class(a,[{key:"getLabelsLayer",value:function(){return this.ll.v$[0]._$||null}},{key:"setStyle",value:function(i){if(_get(_get_prototype_of(a.prototype),"setStyle",this).call(this,i),this.dataset=this.source.LC(),this.colorPick.clear(),this.Ex=null,this.jx=[],this.Dx.clear(),this.dataset&&this.dataset.length>0){this.Vx=this.meshes;var o=this.WC(),s=o.didFusionDataset,l=this.fusion.fusion(s,this.styleOptions,this);this.meshes=l;for(var u=0;u<this.meshes.length;u++)this.Vx[u].mf=this.meshes[u].mf;this.vA.state|=MeshesDirty,this.loca&&this.loca.requestRender()}}},{key:"getInitialAnimateState",value:function(){return{iconSize:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]},offset:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]}}}},{key:"receiveDataset",value:function(i){this.dataset=i,this.setStyle(this.styleOptions),this.onAdd()}},{key:"jC",value:function(){_get(_get_prototype_of(a.prototype),"jC",this).call(this),!(!this.loca||!this.loca.regl||this.ll.regl)&&(this.ll.regl=this.loca.regl,this.loca.rendererManager.addRenderer(this.ll))}},{key:"beforeRender",value:function(){if(_get(_get_prototype_of(a.prototype),"beforeRender",this).call(this),!this.fusion.regl&&this.loca&&(this.fusion.regl=this.loca.regl,this.loca.fusionManager.addFusion(this.fusion)),this.jC(),this.source&&(this.dataset=this.source.LC()),this.fusion){var i=this.WC(),o=i.willFusion;if(o.length>0){var s=this.fusion.fusion(o,this.styleOptions,this);this.meshes=s,this.vA.state|=MeshesDirty}}}},{key:"render",value:function(){var i=this,o,s;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var l=this.meshes;if(!this.Ex&&this.meshes.length>0&&(l=this.Vx),this.Kf){var u=(o=this.loca)==null?void 0:o.customCoords.getMVPMatrix(),c=this.projection.getResolution((s=this.loca)==null?void 0:s.map.getZoom());this.ll&&l.length>0&&this.ll.render({texture:this.Kf,iconCount:this.Bx,meshes:l,mvp:u,resolution:c,opacity:this._getOpacity(),vP:this._animateLayerState})}if(!this.Ex){var f=this.jx;f&&f.length&&!this.Tx&&(this.Tx=!0,mergeImages({images:_to_consumable_array(f).concat(_to_consumable_array(f),_to_consumable_array(f)),wx:[256,256]},function(h){var p,d;i.Tx=!1,h&&(i.Ex=h.xx,h.xx&&(i.Kf&&i.Kf.destroy(),i.Kf=(p=i==null?void 0:i.loca)==null?void 0:p.regl.texture({format:"rgba",width:i.Ex.width,Rx:i.Ex.height,data:i.Ex}),i.Bx=f.length,(d=i.loca)==null||d.requestRender()))},function(h){console.log("mergeImage error",h)}))}if(this.Kf&&this.ll&&l.length>0)return!0}}},{key:"pickRender",value:function(){var i,o;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var s=(i=this.loca)==null?void 0:i.customCoords.getMVPMatrix(),l=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom());this.ll&&this.Kf&&this.ll.pickRender({texture:this.Kf,iconCount:this.jx.length,meshes:this.meshes,mvp:s,resolution:l,opacity:this._getOpacity(),pickFbo:this._needPickFrame&&this._pickFbo,pickPos:this._pickPos,vP:this._animateLayerState})}}},{key:"destroy",value:function(){_get(_get_prototype_of(a.prototype),"destroy",this).call(this),this.Ex=null,this.Kf&&this.Kf.destroy&&this.Kf.destroy(),this.Kf=null}},{key:"afterRender",value:function(){}},{key:"zx",value:function(){return{Sx:this.Dx,_x:this.jx}}},{key:"PA",value:function(){return RenderHelper.SA(this.ll,this)}}]),a}(Layer),__defProp$a=Object.defineProperty,__defProps$6=Object.defineProperties,__getOwnPropDescs$6=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$a=Object.getOwnPropertySymbols,__hasOwnProp$a=Object.prototype.hasOwnProperty,__propIsEnum$a=Object.prototype.propertyIsEnumerable,__defNormalProp$a=function(n,r,a){return r in n?__defProp$a(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$a=function(n,r){for(var a in r||(r={}))__hasOwnProp$a.call(r,a)&&__defNormalProp$a(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$a)try{for(var l=__getOwnPropSymbols$a(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$a.call(r,a)&&__defNormalProp$a(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},__spreadProps$6=function(n,r){return __defProps$6(n,__getOwnPropDescs$6(r))},pushArray$8=CommonUtil$1._C,_PrismFusion=function(n){_inherits(a,n);var r=_create_super(a);function a(){return _class_call_check(this,a),r.apply(this,arguments)}return _create_class(a,[{key:"DC",value:function(){}},{key:"buildStyle",value:function(i,o){for(var s,l=prism.style,u=[],c=0;c<i.length;c++)if(!(!i[c].features||!i[c].features.points)){for(var f=i[c].features.points,h=StyleInstance.parse(f,o,l),p={},d=0;d<f.length;d++)if(h)for(var v in h.attributes){var _=h.attributes[v];p[v]||(p[v]=[]),((s=_[d])==null?void 0:s.length)>0?pushArray$8(p[v],_[d]):p[v][p[v].length]=_[d]}u.push({attributes:p,uniforms:h.uniforms,si:h.si})}return u}},{key:"fusion",value:function(i,o,s,l){var u;if(!s.loca||!s.loca.regl)return[];var c=s.loca.regl,f=s.loca.customCoords,h=[];this.j$=s,l=l||this.buildStyle(i,o);for(var p=0;p<i.length;p++){var d=i[p];if(!(!d.features||!d.features.points||!l[p])){var v=d.features.points,_=l[p],m=_.uniforms.unit,y=1;m==="px"&&(y=s.projection.getResolution((u=s.loca)==null?void 0:u.map.getZoom()));for(var g={index:[],vertex:[],radius:[],sideNo:[],id:[],color:[],rotation:[],pickColor:[],labels:[]},C=_.attributes,b=C.altitude,k=C.height,L=C.radius,F=C.rotation,W=C.topColor,j=C.sideTopColor,Y=C.sideBottomColor,N=C.label,$=C.labelAltitude,w=_.uniforms,E=w.sideNumber,A=0;A<v.length;A++){var R=v[A],O=A*4,P=s.colorPick.add(R),T=R.coordinates;if(R.type==="MultiPoint")for(var M=0,U=T.length;M<U;M++){var Q=T[M],K=this.Fx({vertex:[Q[0],Q[1],Q[2]||b[A]],Lx:f,height:k[A],pickColor:P,Wx:E,topColor:W.slice(O,O+4),sideTopColor:j.slice(O,O+4),sideBottomColor:Y.slice(O,O+4),radius:L[A],rotation:F[A],hasSide:s.hasSide,id:R.sr});GeoUtil.mergeTriangles(g,K,4),pushArray$8(g.color,K.Gh),pushArray$8(g.sideNo,K.Nx),pushArray$8(g.radius,K.radius),pushArray$8(g.id,K.id),pushArray$8(g.rotation,K.Ux),pushArray$8(g.pickColor,K.Qw),N[A]&&g.labels.push(__spreadValues$a({position:[Q[0],Q[1],((Q[2]||b[A])+k[A]+$[A])*y]},N[A]))}else{var te=this.Fx({vertex:[T[0],T[1],T[2]||b[A]],Lx:f,height:k[A],pickColor:P,Wx:E,topColor:W.slice(O,O+4),sideTopColor:j.slice(O,O+4),sideBottomColor:Y.slice(O,O+4),radius:L[A],rotation:F[A],hasSide:s.hasSide,id:R.sr});GeoUtil.mergeTriangles(g,te,4),pushArray$8(g.color,te.Gh),pushArray$8(g.sideNo,te.Nx),pushArray$8(g.radius,te.radius),pushArray$8(g.id,te.id),pushArray$8(g.rotation,te.Ux),pushArray$8(g.pickColor,te.Qw),N[A]&&g.labels.push(__spreadValues$a({position:[T[0],T[1],((T[2]||b[A])+k[A]+$[A])*y]},N[A]))}}h[p]={id:d.id,attributes:{position:{buffer:c.buffer(g.vertex),offset:0,stride:4*4,td:!1,divisor:0},color:{buffer:c.buffer(g.color),offset:0,stride:4*4,td:!1,divisor:0},sideNo:{buffer:c.buffer(g.sideNo),offset:0,stride:4,td:!1,divisor:0},id:{buffer:c.buffer(g.id),offset:0,stride:4,td:!1,divisor:0},radius:{buffer:c.buffer(g.radius),offset:0,stride:4,td:!1,divisor:0},rotation:{buffer:c.buffer(g.rotation),offset:0,stride:4,td:!1,divisor:0},pickColor:{buffer:c.buffer(g.pickColor),offset:0,stride:4*4,td:!1,divisor:0},index:c.elements({primitive:"triangles",type:"uint32",data:g.index})},uniforms:_.uniforms,si:_.si,mf:{labels:g.labels}}}}return h}},{key:"updateStyle",value:function(i,o){for(var s=this,l=function(h,p){var d=i[h],v=o[h].attributes,_=v.altitude,m=v.height,y=v.topColor,g=v.bottomColor,C=v.sideColor,b=v.textureSize,k=v.label,L=v.labelAltitude,F=d.mf.origin,W=F.position,j=F.color,Y=d.mf.Tw,N=Y.top,$=Y.bottom,w=Y.Pw,E=Y.jw,A=o[h].uniforms.unit,R=1;A==="px"&&s.j$&&(R=s.j$.projection.getResolution((u=s.j$.loca)==null?void 0:u.map.getZoom()));for(var O=new Float32Array(j.length/2),P=0,T=0,M=0,U=W.length;M<U;M+=4){var Q=M/4*4,K=void 0,te=[-1,-1];M>=E[P]&&P++;var ve=P*4;M>=$[T+1]&&T++,M<w[T]?(K=g,W[M+2]=_[P]):M>=w[T]&&M<N[T]?((M-w[T])/4%2===0?W[M+2]=_[P]:W[M+2]=m[P]+_[P],K=C,te=b.slice(P*2,P*2+2)):(K=y,W[M+2]=m[P]+_[P]),j[Q]=K[ve],j[Q+1]=K[ve+1],j[Q+2]=K[ve+2],j[Q+3]=K[ve+3],O[Q/2]=te[0],O[Q/2+1]=te[1]}d.attributes.position.buffer({data:W}),d.attributes.color.buffer({data:j}),d.attributes.textureSize.buffer({data:O}),d.uniforms=o[h].uniforms,d.mf.labels=d.mf.labels.map(function(de,be){var et=_sliced_to_array(de.position,2),qe=et[0],Ne=et[1];return __spreadProps$6(__spreadValues$a(__spreadValues$a({},de),k[be]),{position:[qe,Ne,(m[be]+_[be]+L[be])*R]})})},u,c=0,f=i.length;c<f;c++)l(c,f)}},{key:"EC",value:function(){return[]}},{key:"destroy",value:function(){delete this.j$}},{key:"Fx",value:function(i){var o=i.Wx,s=i.height,l=i.Lx,u=i.vertex,c=i.topColor,f=i.sideTopColor,h=i.sideBottomColor,p=i.pickColor,d=i.radius,v=i.rotation,_=i.hasSide,m=i.id,y=[],g=[],C=[],b=[],k=[],L=[],F=[],W=[];this.qx(W,o,k.length);for(var j=0;j<o;j++){var Y=l.lngLatToCoord(u);this.Gx(g,C,[Y[0],Y[1],u[2]+s,1],c,y,p),b.push(j),L.push(d),k.push(v),F.push(m)}if(_)for(var N=0;N<o;N++){var $=l.lngLatToCoord(u),w=k.length;W.push(w+1,w,w+3,w+3,w,w+2);for(var E=0;E<4;E++){var A=!!(E%2),R=A?f:h;this.Gx(g,C,[$[0],$[1],u[2]+(A?s:0),A?.5:0],R,y,p),b.push(E<2?N:N+.5),L.push(d),k.push(v),F.push(m)}}return{Qw:y,Gh:C,vertex:g,Nx:b,Ux:k,radius:L,id:F,index:W}}},{key:"Gx",value:function(i,o,s,l,u,c){var f=i.length,h=o.length;if(i[f]=s[0],i[f+1]=s[1],i[f+2]=s[2],i[f+3]=s[3],o[h]=l[0],o[h+1]=l[1],o[h+2]=l[2],o[h+3]=l[3],u&&c){var p=u.length;u[p]=c[0],u[p+1]=c[1],u[p+2]=c[2],u[p+3]=c[3]}}},{key:"qx",value:function(i,o,s){for(var l=0;l<o-2;l++)i.push(0,s+l+1,s+l+2);return i}}],[{key:"getInstance",value:function(){return this.ui}}]),a}(GeometryFusion),PrismFusion=_PrismFusion;PrismFusion.ui=new _PrismFusion;var PrismFusionInstance=PrismFusion.getInstance(),__defProp$9=Object.defineProperty,__getOwnPropSymbols$9=Object.getOwnPropertySymbols,__hasOwnProp$9=Object.prototype.hasOwnProperty,__propIsEnum$9=Object.prototype.propertyIsEnumerable,__defNormalProp$9=function(n,r,a){return r in n?__defProp$9(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$9=function(n,r){for(var a in r||(r={}))__hasOwnProp$9.call(r,a)&&__defNormalProp$9(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$9)try{for(var l=__getOwnPropSymbols$9(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$9.call(r,a)&&__defNormalProp$9(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},PrismShader={vertex:"\n        precision highp float;\n\n        attribute vec4 position;\n        attribute vec4 color;\n        attribute float radius;\n        attribute float rotation;\n        attribute float id;\n        // \u8FB9\u7684\u5E8F\u53F7, \u4EE3\u8868\u5F53\u524D\u7684\u9876\u70B9\u5E8F\u53F7\n        // \u5E8F\u53F7\u4ECE\u6B63\u5317\u65B9\u5411\u5F00\u59CB\uFF0C\u987A\u65F6\u9488\u6570\n        attribute float sideNo;\n\n        varying vec3 vNormal;\n        varying vec4 vColor;\n        varying vec3 vPosition;\n        ".concat(ColorGLSL.getColorShader().vertex,"\n\n        uniform mat4 mvp;\n        // unit: px=0, meter=1\n        uniform float unit;\n        uniform float resolution;\n        // uniform float heightScale;\n        // uniform float altitudeScale;\n        // uniform float rotationScale;\n        // uniform float radiusScale;\n        uniform float sideNumber;\n        ").concat(RenderUtil.getBezier(),"\n        ").concat(RenderUtil.getScaleType("radius"),"\n        ").concat(RenderUtil.getScaleType("height"),"\n        ").concat(RenderUtil.getScaleType("altitude"),"\n        ").concat(RenderUtil.getScaleType("rotation"),"\n\n        // z \u8F74\u65CB\u8F6C\n        vec2 rotateZ(vec2 a, float rad) {\n            float s = sin(rad);\n            float c = cos(rad);\n            float x = a.x;\n            float y = a.y;\n\n            // x = x * c - y * s;\n            // y = y * c + x * s;\n            // return vec2(x, y);\n            mat2 rotate = mat2(\n                c, -s,\n                s, c\n            );\n            return a * rotate;\n        }\n        // \u6839\u636E\u5E8F\u53F7\uFF0C\u8BA1\u7B97 normal \u548C\u9876\u70B9\u4F4D\u7F6E\n        struct vecInfo {\n            vec3 position;\n            vec3 normal;\n        };\n        vecInfo getVec(float rotationScale, float radiusScale) {\n            vec2 ori = vec2(0, 1);\n            float PI = 3.14159265;\n            float rot = rotation / 180.0 * PI * rotationScale;\n            float angle = PI * 2.0 / sideNumber;\n            // \u5982\u679C\u662F\u50CF\u7D20\uFF0C\u9700\u8981\u8BA1\u7B97\u4E3A\u7C73\n            float r = unit == 1.0 ? 1.0 : resolution;\n            vec2 pos = rotateZ(ori, -angle * ceil(sideNo) - rot) * radius * radiusScale * r;\n            vec3 normal = vec3(0,0,1);\n\n            // \u9876\u9762 normal \u5C31\u662F (0,0,1)\n            // \u5426\u5219\u5C31\u662F\u4FA7\u9762\uFF0C\u6211\u4EEC\u9700\u8981\u6839\u636E\u9762\u5B9A\u4E49\u4FA7\u9762\u5411\u91CF\n            // w \u5206\u91CF =1.0\uFF0C\u8BF4\u660E\u662F\u9876\u9762\n            // w = 0.5 \u8BF4\u660E\u662F\u4FA7\u9762\u7684\u9876\u70B9\n            // w = 0.0 \u8BF4\u660E\u662F\u4FA7\u9762\u7684\u5E95\u9762\n            if(position.w != 1.0) {\n                normal = vec3(rotateZ(ori, -angle * (floor(sideNo) + 0.5) - rot), 0);\n            }\n            vecInfo result;\n            result.position =vec3(pos + position.xy, position.z);\n            result.normal = normal;\n            return result;\n        }\n\n        void main() {\n            float radiusScale = radiusScaleValue(id);\n            float rotationScale = rotationScaleValue(id);\n            float heightScale = heightScaleValue(id);\n            float altitudeScale = altitudeScaleValue(id);\n            vecInfo info = getVec(rotationScale, radiusScale);\n            float r = unit == 1.0 ? 1.0 : resolution;\n            vec3 realPos = info.position.xyz;\n            // \u5E95\u90E8\n            if(position.w == 0.0) {\n                realPos = vec3(realPos.xy, realPos.z * r * altitudeScale);\n            }\n            // \u9876\u90E8\n            if(position.w > 0.0) {\n                realPos = vec3(realPos.xy, realPos.z * r * heightScale);\n            }\n            vColor = color;\n            vNormal = info.normal;\n            vPosition = realPos;\n            gl_Position = mvp * vec4(realPos, 1.0);\n            ").concat(ColorGLSL.getColorShader().mainVert,"\n        }\n    "),fragment:"\n        precision highp float;\n        varying vec4 vColor;\n\n        // \u5982\u679C\u9700\u8981\u5149\u7167\uFF0C\u8FD9\u4E24\u4E2A\u53D8\u91CF\u662F\u5FC5\u987B\u7684\n        varying vec3 vNormal;\n        varying vec3 vPosition;\n\n        uniform float opacity;\n\n        uniform vec3 cameraPosition;\n        uniform float shininess;\n        #include <lightUniforms,lightFunctions>;\n\n        ".concat(ColorGLSL.getColorShader().fragment,"\n\n        void main() {\n            gl_FragColor = vColor;\n\n            #include <lightMainCompute>;\n\n            gl_FragColor.a *= opacity;\n            ").concat(ColorGLSL.getColorShader().mainFrag,"\n        }\n    "),includes:__spreadValues$9({},LightIncludes)},__defProp$8=Object.defineProperty,__defProps$5=Object.defineProperties,__getOwnPropDescs$5=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$8=Object.getOwnPropertySymbols,__hasOwnProp$8=Object.prototype.hasOwnProperty,__propIsEnum$8=Object.prototype.propertyIsEnumerable,__defNormalProp$8=function(n,r,a){return r in n?__defProp$8(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$8=function(n,r){for(var a in r||(r={}))__hasOwnProp$8.call(r,a)&&__defNormalProp$8(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$8)try{for(var l=__getOwnPropSymbols$8(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$8.call(r,a)&&__defNormalProp$8(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},__spreadProps$5=function(n,r){return __defProps$5(n,__getOwnPropDescs$5(r))},PrismRender=function(n){_inherits(a,n);var r=_create_super(a);function a(){_class_call_check(this,a);var i;return i=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))),i.v$=[new LabelsRender$1],i}return _create_class(a,[{key:"m$",value:function(i){if(!this.regl)return!1;this.v$.forEach(function(l){return l.m$(i)});var o=this.regl,s=RenderHelper._A(i,o);this.gA(PrismShader,i,{attributes:__spreadValues$8({position:o.prop("position"),color:o.prop("color"),sideNo:o.prop("sideNo"),radius:o.prop("radius"),rotation:o.prop("rotation"),id:o.prop("id")},ColorGLSL.getColor(o).attribute),uniforms:__spreadValues$8(__spreadValues$8(__spreadValues$8(__spreadValues$8(__spreadValues$8(__spreadValues$8({mvp:o.prop("mvp"),resolution:o.prop("resolution"),unit:o.prop("unit"),opacity:o.prop("layerOpacity"),sideNumber:o.prop("sideNumber"),shininess:o.prop("shininess"),cameraPosition:o.prop("cameraPosition")},ColorGLSL.getColor(o).uniform),RenderUtil.getScaleUniform("height",o)),RenderUtil.getScaleUniform("radius",o)),RenderUtil.getScaleUniform("rotation",o)),RenderUtil.getScaleUniform("altitude",o)),s),blend:{enable:!0,func:RenderUtil.getBlend("normal")},cull:{enable:o.prop("cullEnable"),face:o.prop("cullface")},frontFace:"cw",depth:{enable:!0,func:"lequal"},elements:o.prop("index")})}},{key:"render",value:function(i){var o=this.yA(PrismShader);if(o){var s=i.meshes,l=i.mvp,u=i.lights,c=i.opacity,f=i.cull,h=i.cameraPosition,p=i.shininess,d=i.acceptLight,v=i.vP,_=i.resolution,m=i.isPick,y=m===void 0?!1:m;if(!(s.length<1)){for(var g=0;g<s.length;g++){var C=s[g],b=C.attributes,k=C.uniforms,L=f!=="none",F=f==="front"?"front":"back";o(__spreadValues$8(__spreadProps$5(__spreadValues$8(__spreadValues$8({},b),u),{unit:k.unit==="px"?0:1,layerOpacity:c,mvp:l,cullEnable:L,cullface:F,cameraPosition:h,shininess:p,acceptLight:d,isPick:y,resolution:_,sideNumber:k.sideNumber}),RenderUtil.getScaleProps(v)))}for(var W=0;W<s.length;W++){var j=!0,Y=!1,N=void 0;try{for(var $=this.v$[Symbol.iterator](),w;!(j=(w=$.next()).done);j=!0){var E=w.value;E.render(s[W])}}catch(A){Y=!0,N=A}finally{try{!j&&$.return!=null&&$.return()}finally{if(Y)throw N}}}}}}},{key:"pickRender",value:function(i){var o=this,s=this.yA(PrismShader);!s||i.pickFbo&&i.pickPos&&i.pickFbo.use(function(){o.regl.clear({color:[0,0,0,0],depth:1}),o.render(__spreadProps$5(__spreadValues$8({},i),{isPick:!0}))})}}]),a}(Render),pushArray$7=CommonUtil$1._C,PrismLayer=function(n){_inherits(a,n);var r=_create_super(a);function a(i){_class_call_check(this,a);var o;o=r.call(this,i),o.CLASS_NAME="Prism",o.fusion=new PrismFusion,o.ll=new PrismRender;var s=prism.Sw;return o.zooms=i.zooms===void 0?s.zooms:i.zooms,o.visible=i.visible===void 0?s.visible:i.visible,o.zIndex=i.zIndex===void 0?s.zIndex:i.zIndex,o.opacity=i.opacity===void 0?s.opacity:i.opacity,o.shininess=i.shininess===void 0?s.shininess:i.shininess,o.acceptLight=i.acceptLight===void 0?s.acceptLight:i.acceptLight,o.hasSide=i.hasSide===void 0?s.hasSide:i.hasSide,o.cullface=i.cullface||s.cullface,o.fusion=PrismFusionInstance,o.AC({zooms:o.zooms,visible:o.visible,zIndex:o.zIndex}),o.buryPoint.record(o.CLASS_NAME),o}return _create_class(a,[{key:"getLabelsLayer",value:function(){return this.ll.v$[0]._$||null}},{key:"setStyle",value:function(i){if(_get(_get_prototype_of(a.prototype),"setStyle",this).call(this,i),this.dataset=this.source.LC(),this.colorPick.clear(),this.loca&&this.dataset&&this.dataset.length>0){var o=this.WC(),s=o.didFusionDataset,l=this.fusion.fusion(s,this.styleOptions,this);this.meshes=l,this.vA.state|=MeshesDirty,this.loca.requestRender()}}},{key:"receiveDataset",value:function(i){this.dataset=i,this.setStyle(this.styleOptions),this.onAdd()}},{key:"jC",value:function(){_get(_get_prototype_of(a.prototype),"jC",this).call(this),!(!this.loca||!this.loca.regl||this.ll.regl)&&(this.ll.regl=this.loca.regl,this.loca.rendererManager.addRenderer(this.ll))}},{key:"beforeRender",value:function(){if(_get(_get_prototype_of(a.prototype),"beforeRender",this).call(this),this.loca&&this.loca.fusionManager.addFusion(this.fusion),this.jC(),this.source&&(this.dataset=this.source.LC()),this.fusion){var i=this.WC(),o=i.willFusion;if(o.length>0){var s=this.fusion.fusion(o,this.styleOptions,this);this.meshes=pushArray$7(this.meshes,s),this.vA.state|=MeshesDirty}}}},{key:"render",value:function(){var i,o;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var s=(i=this.loca)==null?void 0:i.customCoords.getMVPMatrix(),l=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom()),u=this.loca.customCoords.getCameraParams().position,c=RenderHelper.IA(this.loca.lights);if(this.ll&&this.meshes.length>0)return this.ll.render({meshes:this.meshes,mvp:s,resolution:l,opacity:this._getOpacity(),vP:this._animateLayerState,lights:c,cull:this.cullface,cameraPosition:u,shininess:this.shininess,acceptLight:this.acceptLight,isPick:!1}),!0}}},{key:"pickRender",value:function(){var i,o;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var s=(i=this.loca)==null?void 0:i.customCoords.getMVPMatrix(),l=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom()),u=this.loca.customCoords.getCameraParams().position,c=RenderHelper.IA(this.loca.lights);this.ll&&this.meshes.length>0&&this.ll.pickRender({meshes:this.meshes,mvp:s,resolution:l,opacity:this._getOpacity(),vP:this._animateLayerState,lights:c,cull:this.cullface,cameraPosition:u,shininess:this.shininess,acceptLight:this.acceptLight,isPick:!0,pickFbo:this._needPickFrame&&this._pickFbo,pickPos:this._pickPos})}}},{key:"afterRender",value:function(){}},{key:"destroy",value:function(){_get(_get_prototype_of(a.prototype),"destroy",this).call(this),this.ll=null}},{key:"getInitialAnimateState",value:function(){return{height:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]},radius:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]},altitude:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]},rotation:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]}}}},{key:"PA",value:function(){return RenderHelper.SA(this.ll,this)}}]),a}(Layer),pushArray$6=CommonUtil$1._C,PulseLinkFusion=function(n){_inherits(a,n);var r=_create_super(a);function a(){return _class_call_check(this,a),r.apply(this,arguments)}return _create_class(a,[{key:"DC",value:function(){}},{key:"buildStyle",value:function(i,o,s){var l=pulselink.style,u=[];if(!s.loca)return{};for(var c=s.loca.customCoords,f=0;f<i.length;f++)if(!(!i[f].features||!i[f].features.lines)){var h=i[f].features.lines,p=[],d=!0,v=!1,_=void 0;try{for(var m=h[Symbol.iterator](),y;!(d=(y=m.next()).done);d=!0){var g=y.value,C=g.coordinates,b=g.type;if(b==="LineString"){var k=C[0],L=C[C.length-1],F=c.lngLatToCoord(k),W=c.lngLatToCoord(L),j=glMatrix.vec2.distance(F,W);p.push({distance:j,link:g})}if(b==="MultiLineString")for(var Y=0;Y<C.length;Y++){var N=C[Y],$=[N[0],N[N.length-1]],w=$[0],E=$[1],A=c.lngLatToCoord(w),R=c.lngLatToCoord(E),O=glMatrix.vec2.distance(A,R);p.push({distance:O,link:{coordinates:g.coordinates[Y],properties:g.properties}})}}}catch(T){v=!0,_=T}finally{try{!d&&m.return!=null&&m.return()}finally{if(v)throw _}}var P=StyleInstance.parse(p,o,l);u.push(P)}return u}},{key:"fusion",value:function(i,o,s,l){if(!this.regl||!s.loca)return[];var u=[];l=l||this.buildStyle(i,o,s);for(var c=s.loca.customCoords,f=0;f<i.length;f++){var h=i[f];if(!(!h.features||!h.features.lines)){for(var p=h.features.lines,d=l[f],v=d.attributes,_=d.uniforms,m={vertex:[],color:[],pickColor:[],lineWidth:[],distance:[],speed:[],lineDir:[],dash:[],index:[]},y=0;y<p.length;y++){var g=p[y],C=g.coordinates,b=v.lineColors,k=v.height,L=v.lineWidth,F=v.dash,W=v.speed,j=_.smoothSteps,Y=_.maxHeightScale,N=F[y],$=W[y],w=L[y],E=(w[1]-w[0])/(j-1),A=s.colorPick.add(g),R=k[y],O=b[y],P=Math.max(O.length,2),T=(w[1]-w[0])/(P-1);if(g.type==="MultiLineString")for(var M=0,U=C.length;M<U;M++){var Q=C[M],K=[],te=[Q[0],Q[Q.length-1]],ve=_sliced_to_array(te[0],2),de=ve[0],be=ve[1],et=_sliced_to_array(te[1],2),qe=et[0],Ne=et[1],Ge={x:de,y:be,z:0},ft={x:qe,y:Ne,z:0},Ze=[qe-de,Ne-be,0],pt=[de-qe,be-Ne,0],dt=glMatrix.vec3.cross(new Float32Array(3),Ze,[0,0,-1]),Ot=glMatrix.vec3.cross(new Float32Array(3),Ze,[0,0,1]);if(R===0)K=LinearSplit(Ge,ft,P),this.Qx(K,m,c,{Hx:O,Yx:w,Xx:dt,pickColor:A,lineDir:Ze,Jx:pt,Zx:T,$x:Ot,dash:N,speed:$});else{var mt={x:de-(de-qe)/2,y:be-(be-Ne)/2,z:R};K=cubicBezier(Ge,mt,ft,.5,j),this.Qx(K,m,c,{Hx:O,Yx:w,Xx:dt,pickColor:A,lineDir:Ze,Jx:pt,Zx:E,$x:Ot,dash:N,speed:$})}}else{var at=[C[0],C[C.length-1]],St=_sliced_to_array(at[0],2),Tt=St[0],Dt=St[1],Lt=_sliced_to_array(at[1],2),Rt=Lt[0],It=Lt[1],Bt=[Rt-Tt,It-Dt,0],Ft=[Tt-Rt,Dt-It,0],ot=glMatrix.vec3.cross(new Float32Array(3),Bt,[0,0,-1]),bt=glMatrix.vec3.cross(new Float32Array(3),Bt,[0,0,1]),rt={x:Tt,y:Dt,z:0},Pt={x:Rt,y:It,z:0},st=[];if(R===0)st=LinearSplit(rt,Pt,P),this.Qx(st,m,c,{Hx:O,Yx:w,Xx:ot,pickColor:A,lineDir:Bt,Jx:Ft,Zx:T,$x:bt,dash:N,speed:$});else{var $t={x:Tt-(Tt-Rt)*Y,y:Dt-(Dt-It)*Y,z:R};st=cubicBezier(rt,$t,Pt,.5,j),this.Qx(st,m,c,{Hx:O,Yx:w,Xx:ot,pickColor:A,lineDir:Bt,Jx:Ft,Zx:E,$x:bt,dash:N,speed:$})}}}u[f]={id:h.id,attributes:{color:{buffer:this.regl.buffer(m.color),offset:0,stride:4*4,td:!1,divisor:0},dash:{buffer:this.regl.buffer(m.dash),offset:0,stride:4*4,td:!1,divisor:0},speed:{buffer:this.regl.buffer(m.speed),offset:0,stride:4*1,td:!1,divisor:0},lineDir:{buffer:this.regl.buffer(m.lineDir),offset:0,stride:4*3,td:!1,divisor:0},lineWidth:{buffer:this.regl.buffer(m.lineWidth),offset:0,stride:4*1,td:!1,divisor:0},distance:{buffer:this.regl.buffer(m.distance),offset:0,stride:4*2,td:!1,divisor:0},pickColor:{buffer:this.regl.buffer(m.pickColor),offset:0,stride:4*4,td:!1,divisor:0},position:{buffer:this.regl.buffer(m.vertex),offset:0,stride:4*3,td:!1,divisor:0},index:this.regl.elements({primitive:"triangles",type:"uint32",data:m.index})},uniforms:d.uniforms,si:d.si}}}return u}},{key:"updateStyle",value:function(i,o,s,l){if(!s.loca)return[];var u=s.dataset;return this.fusion(u,o,s,l)}},{key:"EC",value:function(){return[]}},{key:"destroy",value:function(){this.regl=null}},{key:"Qx",value:function(i,o,s,l){for(var u=l.Hx,c=l.speed,f=l.Yx,h=l.dash,p=l.Xx,d=l.pickColor,v=l.Zx,_=l.$x,m=0,y=!1,g=0,C={Kx:[],tM:[],coords:[]},b=0,k=i.length;b<k-1;b++){var L=i[b],F=i[b+1],W=y||s.lngLatToCoord([L.x,L.y]),j=s.lngLatToCoord([F.x,F.y]),Y=[j[0]-W[0],j[1]-W[1],F.z-L.z],N=glMatrix.vec2.len(Y);y||C.coords.push(W),C.coords.push(j),C.tM.push(Y),C.Kx.push(m),g+=N,m=N+m,y=j}for(var $=C.Kx,w=C.tM,E=C.coords,A=0,R=i.length;A<R-1;A++){var O=i[A],P=i[A+1],T=E[A],M=E[A+1],U=w[A],Q=linearGradient(u,O.t),K=linearGradient(u,P.t),te=$[A],ve=$[A+1]||g,de=w[A-1]||U,be=this.nM({Br:[T[0],T[1],O.z],color:Q,Xx:p,lineDir:de,width:f[0]+v*A,distance:[te,g],pickColor:d,dash:h,speed:c},{Br:[M[0],M[1],P.z],color:K,Xx:_,lineDir:U,width:f[0]+v*(A+1),distance:[ve,g],pickColor:d,dash:h,speed:c});GeoUtil.mergeTriangles(o,be,3),pushArray$6(o.color,be.color),pushArray$6(o.lineWidth,be.width),pushArray$6(o.distance,be.distance),pushArray$6(o.lineDir,be.lineDir),pushArray$6(o.pickColor,be.pickColor),pushArray$6(o.dash,be.dash),pushArray$6(o.speed,be.speed)}}},{key:"nM",value:function(i,o){var s=i.Br,l=i.color,u=i.width,c=i.pickColor,f=i.lineDir,h=i.distance,p=i.dash,d=i.speed,v=o.Br,_=o.color,m=o.width,y=o.pickColor,g=o.lineDir,C=o.distance,b=o.dash,k=o.speed,L=_to_consumable_array(s).concat(_to_consumable_array(s),_to_consumable_array(v),_to_consumable_array(v)),F=_to_consumable_array(l).concat(_to_consumable_array(l),_to_consumable_array(_),_to_consumable_array(_)),W=[u,u,m,m],j=_to_consumable_array(h).concat(_to_consumable_array(h),_to_consumable_array(C),_to_consumable_array(C)),Y=_to_consumable_array(c).concat(_to_consumable_array(c),_to_consumable_array(y),_to_consumable_array(y)),N=[-f[0],-f[1],-f[2]],$=[-g[0],-g[1],-g[2]],w=_to_consumable_array(f).concat(_to_consumable_array(N),_to_consumable_array(g),_to_consumable_array($)),E=_to_consumable_array(p).concat(_to_consumable_array(p),_to_consumable_array(b),_to_consumable_array(b)),A=[d,d,k,k];return{vertex:L,distance:j,speed:A,color:F,width:W,pickColor:Y,lineDir:w,dash:E,index:[1,0,2,2,3,1]}}}]),a}(GeometryFusion),PulseLinkShader={vertex:"\n        precision highp float;\n        attribute vec3 position;\n        attribute vec4 color;\n        // attribute vec3 normal;\n        attribute vec3 lineDir;\n        attribute vec3 vertexNext;\n        attribute float lineWidth;\n        attribute vec2 distance;\n        attribute vec4 dash;\n        attribute float speed;\n        varying vec4 vColor;\n        varying vec4 vDash;\n        varying vec2 vDistance;\n        varying float vSpeed;\n        uniform mat4 mvp;\n        uniform vec3 cameraPosition;\n        uniform float unit; // 0: px; 1: meter;\n        uniform float resolution;\n        ".concat(ColorGLSL.getColorShader().vertex,"\n\n        void main() {\n            float res = unit == 0.0 ? resolution : 1.0;\n            // \u8BA1\u7B97\u5F53\u524D\u9876\u70B9\u5230\u76F8\u673A\u7684\u5411\u91CF\n            vec3 cameraDir = vec3(cameraPosition - position);\n            vec3 cameraNor = cross(cameraDir, lineDir);\n\n            vColor = color;\n            vDash = dash;\n            vSpeed = speed;\n            vDistance = distance;\n            vec3 pos = position + normalize(cameraNor) * (lineWidth / 2.0) * res;\n            gl_Position = mvp * vec4(pos, 1.0);\n            ").concat(ColorGLSL.getColorShader().mainVert,"\n        }\n    "),fragment:"\n        precision highp float;\n        varying vec4 vColor;\n        varying vec4 vDash;\n        varying vec2 vDistance;\n        varying float vSpeed;\n        uniform float opacity;\n        uniform float animateCounter;\n        uniform float resolution;\n        uniform float flowLength;\n        uniform vec4 headColor;\n        uniform vec4 trailColor;\n        uniform float unit;\n        ".concat(ColorGLSL.getColorShader().fragment,"\n\n        void main() {\n            float res = unit == 0.0 ? resolution : 1.0;\n            float curDist = vDistance.x;\n            float distPixel = vDistance.x / res;\n            float offset = mod(distPixel, vDash.r + vDash.g + vDash.b + vDash.a);\n            if(offset > vDash.r && offset < vDash.r + vDash.g) {\n                discard;\n            } else if(offset > vDash.r + vDash.g + vDash.b) {\n                discard;\n            }\n            float op = offset / (vDash.r + vDash.g + vDash.b + vDash.a);\n            gl_FragColor = vColor;\n\n            // \u8109\u51B2\u7C92\u5B50\n            float ligLen = flowLength * res;\n            float curTop = animateCounter * vSpeed * res / 1000.0 * 60.0;\n            float realCurTop = mod(curTop, vDistance.y);\n            float realCurBottom = mod(curTop - ligLen, vDistance.y);\n            float delta = 1.0 - (curDist - realCurBottom) / ligLen;\n            vec4 resultColor = vColor;\n\n            // \u8BF4\u660E\u662F\u5728\u672B\u7AEF\uFF0C\u5934\u90E8\u5DF2\u7ECF\u51FA\u4E86\u7AEF\u70B9\n            if(realCurTop < realCurBottom) {\n                // \u672B\u7AEF\n                if(curDist > realCurBottom) {\n                    resultColor = mix(headColor, trailColor, delta);\n                }\n                // \u59CB\u7AEF\n                if(curDist < realCurTop) {\n                    float delta = 1.0 - (vDistance.y - realCurBottom + curDist) / ligLen;\n                    resultColor = mix(headColor, trailColor, delta);\n                }\n                gl_FragColor = mix(vColor, resultColor, resultColor.a);\n            } else {\n                if(curDist < realCurTop && curDist > realCurBottom) {\n                    resultColor = mix(headColor, trailColor, delta);\n                }\n                gl_FragColor = mix(vColor, resultColor, resultColor.a);\n            }\n            gl_FragColor.a *= opacity;\n            ").concat(ColorGLSL.getColorShader().mainFrag,"\n        }\n    ")},__defProp$7=Object.defineProperty,__defProps$4=Object.defineProperties,__getOwnPropDescs$4=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$7=Object.getOwnPropertySymbols,__hasOwnProp$7=Object.prototype.hasOwnProperty,__propIsEnum$7=Object.prototype.propertyIsEnumerable,__defNormalProp$7=function(n,r,a){return r in n?__defProp$7(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$7=function(n,r){for(var a in r||(r={}))__hasOwnProp$7.call(r,a)&&__defNormalProp$7(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$7)try{for(var l=__getOwnPropSymbols$7(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$7.call(r,a)&&__defNormalProp$7(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},__spreadProps$4=function(n,r){return __defProps$4(n,__getOwnPropDescs$4(r))},PulseLinkRender=function(n){_inherits(a,n);var r=_create_super(a);function a(){return _class_call_check(this,a),r.apply(this,arguments)}return _create_class(a,[{key:"m$",value:function(i){if(!this.regl)return!1;var o=this.regl;this.gA(PulseLinkShader,i,{frag:PulseLinkShader.fragment,vert:PulseLinkShader.vertex,attributes:__spreadValues$7({position:o.prop("position"),color:o.prop("color"),lineDir:o.prop("lineDir"),lineWidth:o.prop("lineWidth"),distance:o.prop("distance"),dash:o.prop("dash"),speed:o.prop("speed")},ColorGLSL.getColor(o).attribute),uniforms:__spreadValues$7({mvp:o.prop("mvp"),opacity:o.prop("opacity"),resolution:o.prop("resolution"),flowLength:o.prop("flowLength"),unit:o.prop("unit"),cameraPosition:o.prop("cameraPosition"),animateCounter:o.prop("animateCounter"),trailColor:o.prop("trailColor"),headColor:o.prop("headColor")},ColorGLSL.getColor(o).uniform),cull:{enable:!1},depth:{enable:o.prop("depth")},blend:{enable:!0,func:RenderUtil.getBlend()},elements:o.prop("index")})}},{key:"render",value:function(i){var o=this.yA(PulseLinkShader);if(o)for(var s=i.meshes,l=i.mvp,u=i.animateCounter,c=i.opacity,f=i.resolution,h=i.depth,p=i.cameraPosition,d=0;d<s.length;d++){var v=s[d],_=v.attributes,m=v.uniforms,y=m.unit,g=m.flowLength,C=m.trailColor,b=m.headColor;o(__spreadProps$4(__spreadValues$7({},_),{cameraPosition:p,mvp:l,animateCounter:u,unit:y==="px"?0:1,resolution:f,opacity:c,depth:h,trailColor:C,headColor:b,flowLength:g,isPick:!1}))}}},{key:"pickRender",value:function(i){var o=this,s=this.yA(PulseLinkShader);if(s){var l=i.meshes,u=i.animateCounter,c=i.mvp,f=i.opacity,h=i.pickFbo,p=i.pickPos,d=i.resolution,v=i.cameraPosition,_=i.depth;h&&p&&h.use(function(){o.regl.clear({color:[0,0,0,0],depth:1});for(var m=0;m<l.length;m++){var y=l[m],g=y.attributes,C=y.uniforms,b=C.unit,k=C.flowLength,L=C.trailColor,F=C.headColor;s(__spreadProps$4(__spreadValues$7({blendFun:RenderUtil.getBlend()},g),{cameraPosition:v,mvp:c,animateCounter:u,unit:b==="px"?0:1,resolution:d,opacity:f,depth:_,trailColor:L,headColor:F,flowLength:k,isPick:!0}))}})}}}]),a}(Render),pushArray$5=CommonUtil$1._C,PulseLinkLayer=function(n){_inherits(a,n);var r=_create_super(a);function a(i){_class_call_check(this,a);var o;o=r.call(this,i),o.CLASS_NAME="PulseLink",o.fusion=new PulseLinkFusion,o.ll=new PulseLinkRender,o.depth=!0;var s=pulselink.Sw;return o.zooms=i.zooms===void 0?s.zooms:i.zooms,o.zIndex=i.zIndex===void 0?s.zIndex:i.zIndex,o.opacity=i.opacity===void 0?s.opacity:i.opacity,o.visible=i.visible===void 0?s.visible:i.visible,o.depth=i.depth===void 0?s.depth:i.depth,o.AC({zooms:o.zooms,visible:o.visible,zIndex:o.zIndex}),o.buryPoint.record(o.CLASS_NAME),o}return _create_class(a,[{key:"receiveDataset",value:function(i){this.dataset=i,this.setStyle(this.styleOptions),this.onAdd()}},{key:"setStyle",value:function(i){if(_get(_get_prototype_of(a.prototype),"setStyle",this).call(this,i),this.dataset=this.source.LC(),this.meshes=[],this.dataset&&this.dataset.length>0&&this.meshes){var o=this.WC(),s=o.didFusion,l=this.fusion.buildStyle(this.dataset,this.styleOptions,this),u=this.fusion.updateStyle(s,this.styleOptions,this,l);this.meshes=u,this.loca&&this.loca.requestRender()}}},{key:"jC",value:function(){_get(_get_prototype_of(a.prototype),"jC",this).call(this),!(!this.loca||!this.loca.regl||this.ll.regl)&&(this.ll.regl=this.loca.regl,this.loca.rendererManager.addRenderer(this.ll))}},{key:"beforeRender",value:function(){if(_get(_get_prototype_of(a.prototype),"beforeRender",this).call(this),!this.fusion.regl&&this.loca&&(this.fusion.regl=this.loca.regl,this.loca.fusionManager.addFusion(this.fusion)),this.jC(),this.source&&(this.dataset=this.source.LC()),this.fusion){var i=this.WC(),o=i.willFusion,s=i.didFusion;if(this.fusion.EC(),o.length>0){var l=this.fusion.fusion(o,this.styleOptions,this);this.meshes=pushArray$5(s,l)}}}},{key:"render",value:function(){var i,o;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var s=(i=this.loca)==null?void 0:i.customCoords.getMVPMatrix(),l=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom()),u=this.loca.customCoords.getCameraParams().position;if(this.ll&&this.meshes.length>0){var c=this.hP();return this.ll.render({meshes:this.meshes,mvp:s,depth:this.depth,resolution:l,opacity:this._getOpacity(),animateCounter:c,cameraPosition:u}),!0}}}},{key:"pickRender",value:function(){var i,o;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var s=(i=this.loca)==null?void 0:i.customCoords.getMVPMatrix(),l=this.loca.customCoords.getCameraParams().position,u=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom());if(this.ll){var c=this.hP();this.ll.pickRender({depth:this.depth,meshes:this.meshes,mvp:s,resolution:u,cameraPosition:l,animateCounter:c,opacity:this._getOpacity(),pickFbo:this._needPickFrame&&this._pickFbo,pickPos:this._pickPos})}}}},{key:"afterRender",value:function(){}},{key:"PA",value:function(){return RenderHelper.SA(this.ll,this)}}]),a}(Layer),util=newUtil(),inliner=newInliner(),fontFaces=newFontFaces(),images=newImages(),defaultOptions={iM:void 0,rM:!1},domtoimage={eM:toSvg,oM:toPng,aM:toJpeg,pP:toCanvas,toBlob:toBlob,uM:toPixelData,sM:{fM:fontFaces,images:images,cM:util,lM:inliner,options:{}}};function cloneNode(n,r,a){if(!a&&r&&!r(n))return Promise.resolve();return Promise.resolve(n).then(i).then(function(l){return o(n,l,r)}).then(function(l){return s(n,l)});function i(l){return _instanceof(l,HTMLCanvasElement)?util.pM(l.toDataURL()):l.cloneNode(!1)}function o(l,u,c){var f=l.childNodes;if(f.length===0)return Promise.resolve(u);return h(u,util.mM(f),c).then(function(){return u});function h(p,d,v){var _=Promise.resolve();return d.forEach(function(m){_=_.then(function(){return cloneNode(m,v)}).then(function(y){y&&p.appendChild(y)})}),_}}function s(l,u){if(!_instanceof(u,Element))return u;return Promise.resolve().then(c).then(f).then(h).then(p).then(function(){return u});function c(){d(window.getComputedStyle(l),u.style);function d(v,_){m(v,_);function m(y,g){util.mM(y).forEach(function(C){g.setProperty(C,y.getPropertyValue(C),y.getPropertyPriority(C))})}}}function f(){[":before",":after"].forEach(function(v){d(v)});function d(v){var _=window.getComputedStyle(l,v),m=_.getPropertyValue("content");if(m===""||m==="none")return;var y=util.bM();u.className=u.className+" "+y;var g=document.createElement("style");g.appendChild(C(y,v,_)),u.appendChild(g);function C(b,k,L){var F="."+b+":"+k,W=L.cssText?j(L):Y(L);return document.createTextNode(F+"{"+W+"}");function j(N){var $=N.getPropertyValue("content");return N.cssText+" content: "+$+";"}function Y(N){return util.mM(N).map($).join("; ")+";";function $(w){return w+": "+N.getPropertyValue(w)+(N.getPropertyPriority(w)?" !important":"")}}}}}function h(){_instanceof(l,HTMLTextAreaElement)&&(u.innerHTML=l.value),_instanceof(l,HTMLInputElement)&&u.setAttribute("value",l.value)}function p(){!_instanceof(u,SVGElement)||(u.setAttribute("xmlns","http://www.w3.org/2000/svg"),_instanceof(u,SVGRectElement)&&["width","height"].forEach(function(d){var v=u.getAttribute(d);!v||u.style.setProperty(d,v)}))}}}var pushArray$4=CommonUtil$1._C,ZMarkerFusion=function(n){_inherits(a,n);var r=_create_super(a);function a(){_class_call_check(this,a);var i;return i=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))),i.kx={},i.PM=new Map,i}return _create_class(a,[{key:"buildStyle",value:function(i,o,s){for(var l,u=zmarker.style,c=[],f=0;f<i.length;f++)if(!(!i[f].features||!i[f].features.points)){for(var h=i[f].features.points,p=StyleInstance.parse(h,o,u),d={},v=0;v<h.length;v++)if(p)for(var _ in p.attributes){var m=p.attributes[_];d[_]||(d[_]=[]),typeof m[v]=="string"?_==="content"?d[_].push(this.TM(m[v])):pushArray$4(d[_],[m[v]]):((l=m[v])==null?void 0:l.length)>0?pushArray$4(d[_],m[v]):d[_][d[_].length]=m[v]}c.push({attributes:d,uniforms:p.uniforms,si:p.si}),this.jM(s)}return c}},{key:"DC",value:function(){}},{key:"fusion",value:function(i,o,s,l){if(!this.regl||!s.loca)return[];l=l||this.buildStyle(i,o,s);var u=[];return o&&i&&i.length&&(u=this.Cx({dataset:i,styleOptions:o,Sw:s,Ax:l})),u}},{key:"Cx",value:function(i){for(var o=i.dataset,s=i.Ax,l=i.Sw,u,c=[],f=(u=l==null?void 0:l.loca)==null?void 0:u.customCoords,h=function(W){var j=W.mesh,Y=W.style,N=W.lnglat,$=W.id,w=W.pickColor,E=f.lngLatToCoord(N);pushArray$4(j.position,[E[0],E[1],E[2]||Y.altitude,$]),pushArray$4(j.size,Y.size),pushArray$4(j.uv,Y.uv),j.rotation.push(Y.rotation/180*Math.PI),pushArray$4(j.pickColor,w)},p=0;p<o.length;p++){var d=o[p];if(!(!d.features||!d.features.points)){for(var v=d.features.points,_=s[p],m={position:[],size:[],uv:[],rotation:[],pickColor:[]},y=l.zx().BM,g=0;g<v.length;g++){var C=v[g],b=C==null?void 0:C.coordinates,k=l.colorPick.add(C),L={uv:y.get(""+_.attributes.content[g]),size:_.attributes.size.slice(g*2,g*2+2),rotation:_.attributes.rotation[g],altitude:_.attributes.altitude[g]};if(b&&b.length)if(C.type=="MultiPoint")for(var F=0;F<b.length;F++)h({mesh:m,style:L,lnglat:b[F],pickColor:k,id:C.sr});else h({mesh:m,style:L,lnglat:b,pickColor:k,id:C.sr})}m.rect=[0,0,0,0,0,1,1,0,0,1,0,0,0,0,1,1,0,1],c[p]={id:d.id,attributes:{rect:{buffer:this.regl.buffer(m.rect),offset:0,stride:4*3,td:!1,divisor:0},position:{buffer:this.regl.buffer(m.position),offset:0,stride:4*4,td:!1,divisor:1},uv:{buffer:this.regl.buffer(m.uv),offset:0,stride:4*4,td:!1,divisor:1},size:{buffer:this.regl.buffer(m.size),offset:0,stride:4*2,td:!1,divisor:1},rotation:{buffer:this.regl.buffer(m.rotation),offset:0,stride:4*1,td:!1,divisor:1},pickColor:{buffer:this.regl.buffer(m.pickColor),offset:0,stride:4*4,td:!1,divisor:1}},uniforms:_.uniforms,mf:{count:m.rotation.length}}}}return c}},{key:"EC",value:function(){return[]}},{key:"destroy",value:function(){this.regl=null}},{key:"TM",value:function(i){var o=this.PM.has(i);if(o)return this.PM.get(i);var s=this.PM.size;return this.PM.set(i,s),s}},{key:"jM",value:function(i){var o=this,s=i.zx().BM,l=this.PM,u=document.createElement("div");u.setAttribute("style","position: fixed; z-index: 999999; top: 0; left: 0; opacity: 0; poinert-events: none; width: 4096px;"),document.body.appendChild(u);var c="";l.forEach(function(p,d){c+='<div data-index="'+p+'" style="float: left; padding: 2px;">'+d+"</div>"}),u.innerHTML=c;var f=u.scrollWidth,h=u.scrollHeight;u.querySelectorAll("div").forEach(function(p){s.set(p.dataset.index,[p.offsetLeft/f,p.offsetTop/h,(p.offsetLeft+p.scrollWidth)/f,(p.offsetTop+p.scrollHeight)/h])}),document.body.removeChild(u),u.setAttribute("style","position: fixed; z-index: 999999; top: 0; left: 0; poinert-events: none; width: 4096px;"),domtoimage.pP(u,{width:f,height:h,dM:1}).then(function(p){i.DM(o==null?void 0:o.regl.texture({format:"rgba",width:f,height:h,data:p}))})}}]),a}(GeometryFusion),ZMarkerShader={vertex:"\n        precision highp float;\n\n        uniform mat4 mvp;\n        uniform float resolution;\n        // unit: px=0, meter=1\n        uniform float unit;\n        uniform bool alwaysFront;\n        uniform float rot;\n\n        attribute vec3 rect;\n        attribute vec4 position;\n        attribute vec2 size;\n        attribute vec4 uv;\n        attribute float rotation;\n\n        varying vec2 vSize;\n        varying float vRotation;\n        varying vec2 vTextureCoord;\n        ".concat(ColorGLSL.getColorShader().vertex,"\n        ").concat(RenderUtil.getBezier(),"\n        ").concat(RenderUtil.getScaleType("altitude"),"\n        ").concat(RenderUtil.getScaleType("rotation"),"\n\n        // z \u8F74\u65CB\u8F6C\n        mat4 rotateZ(mat4 a, float rad) {\n            float s = sin(rad);\n            float c = cos(rad);\n\n            // \u7B2C\u4E8C\u79CD\n            mat4 rotate = mat4(\n                c, -s, 0, 0,\n                s, c, 0, 0,\n                0, 0, 1, 0,\n                0, 0, 0, 1\n            );\n            return a * rotate;\n        }\n\n        // \u901A\u8FC7\u9876\u70B9\u8BA1\u7B97\u51FA uv\n        vec2 getUV() {\n            vec2 result = vec2(0);\n            if(rect == vec3(0, 0, 1)) {\n                // \u5DE6\u4E0B\n                result = vec2(uv);\n            } else if(rect == vec3(0, 0, 0)) {\n                // \u5DE6\u4E0A\n                result = vec2(uv.x, uv.w);\n            } else if(rect == vec3(1, 0, 1)) {\n                // \u53F3\u4E0B\n                result = vec2(uv.z, uv.y);\n            } else if(rect == vec3(1, 0, 0)) {\n                // \u53F3\u4E0A\n                result = vec2(uv.z, uv.w);\n            }\n            return result;\n        }\n\n        // \u6839\u636E rect \u83B7\u53D6\u771F\u5B9E\u7684\u5750\u6807\n        vec4 getPos(float rotationScale, float altitudeScale) {\n            float res = unit == 1.0 ? 1.0 : resolution;\n            vec4 result = vec4(position.xyz, 1);\n            result.z *= altitudeScale;\n            if(rect == vec3(0, 0, 1)) {\n                // \u5DE6\u4E0A\n                result.x = result.x - size.x * res / 2.0;\n                result.z = result.z + size.y * res;\n            } else if(rect == vec3(0, 0, 0)) {\n                // \u5DE6\u4E0B\n                result.x = result.x - size.x * res / 2.0;\n            } else if(rect == vec3(1, 0, 1)) {\n                // \u53F3\u4E0A\n                result.x = result.x + size.x * res / 2.0;\n                result.z = result.z + size.y * res;\n            } else if(rect == vec3(1, 0, 0)) {\n                // \u53F3\u4E0B\n                result.x = result.x + size.x * res / 2.0;\n            }\n\n            // \u65CB\u8F6C\n            mat4 matrix = mat4(0);\n            matrix[0].x = 1.0;\n            matrix[1].y = 1.0;\n            matrix[2].z = 1.0;\n            matrix[3].w = 1.0;\n            float r = alwaysFront ? rot : rotation * rotationScale;\n            result.xy -= position.xy;\n            result = rotateZ(matrix, r) * result;\n            result.xy += position.xy;\n            return result;\n        }\n\n        void main() {\n            float rotationScale = rotationScaleValue(position.w);\n            float altitudeScale = altitudeScaleValue(position.w);\n            gl_Position = mvp * getPos(rotationScale, altitudeScale);\n            vTextureCoord = getUV();\n            ").concat(ColorGLSL.getColorShader().mainVert,"\n        }\n    "),fragment:"\n        precision highp float;\n        uniform sampler2D texture;\n        uniform float layerOpacity;\n\n        varying vec2 vTextureCoord;\n        ".concat(ColorGLSL.getColorShader().fragment,"\n\n        void main() {\n            gl_FragColor = texture2D(texture, vTextureCoord);\n            gl_FragColor.a *= layerOpacity;\n            ").concat(ColorGLSL.getColorShader().mainFrag,"\n        }\n    ")},__defProp$6=Object.defineProperty,__defProps$3=Object.defineProperties,__getOwnPropDescs$3=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$6=Object.getOwnPropertySymbols,__hasOwnProp$6=Object.prototype.hasOwnProperty,__propIsEnum$6=Object.prototype.propertyIsEnumerable,__defNormalProp$6=function(n,r,a){return r in n?__defProp$6(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$6=function(n,r){for(var a in r||(r={}))__hasOwnProp$6.call(r,a)&&__defNormalProp$6(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$6)try{for(var l=__getOwnPropSymbols$6(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$6.call(r,a)&&__defNormalProp$6(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},__spreadProps$3=function(n,r){return __defProps$3(n,__getOwnPropDescs$3(r))},ZMarkerRender=function(n){_inherits(a,n);var r=_create_super(a);function a(){return _class_call_check(this,a),r.apply(this,arguments)}return _create_class(a,[{key:"m$",value:function(i){if(!this.regl)return!1;var o=this.regl;this.gA(ZMarkerShader,i,{attributes:__spreadValues$6({rect:o.prop("rect"),position:o.prop("position"),size:o.prop("size"),uv:o.prop("uv"),rotation:o.prop("rotation")},ColorGLSL.getColor(o).attribute),uniforms:__spreadValues$6(__spreadValues$6(__spreadValues$6({mvp:o.prop("mvp"),resolution:o.prop("resolution"),rot:o.prop("rot"),texture:o.prop("texture"),layerOpacity:o.prop("layerOpacity"),unit:o.prop("unit"),alwaysFront:o.prop("alwaysFront")},RenderUtil.getScaleUniform("rotation",o)),RenderUtil.getScaleUniform("altitude",o)),ColorGLSL.getColor(o).uniform),depth:{enable:o.prop("depth"),mask:!0,func:"less",range:[0,1]},blend:{enable:!0,func:RenderUtil.getBlend("normal")},count:6,instances:o.prop("count")})}},{key:"render",value:function(i){var o=this.yA(ZMarkerShader);if(o){var s=i.meshes,l=i.mvp,u=i.opacity,c=i.resolution,f=i.texture,h=i.vP,p=i.rot,d=i.depth;if(!(s.length<1))for(var v=0;v<s.length;v++){var _=s[v],m=_.attributes,y=_.uniforms,g=_.mf,C=g.count;o(__spreadValues$6(__spreadProps$3(__spreadValues$6(__spreadValues$6({},m),y),{unit:y.unit==="px"?0:1,resolution:c,layerOpacity:u,rot:p,texture:f,count:C,depth:d,mvp:l,isPick:!1}),RenderUtil.getScaleProps(h)))}}}},{key:"pickRender",value:function(i){var o=this,s=this.yA(ZMarkerShader);if(s){var l=i.meshes,u=i.mvp,c=i.opacity,f=i.resolution,h=i.texture,p=i.vP,d=i.rot,v=i.depth,_=i.pickFbo,m=i.pickPos;l.length<1||_&&m&&_.use(function(){o.regl.clear({color:[0,0,0,0],depth:1});for(var y=0;y<l.length;y++){var g=l[y],C=g.attributes,b=g.uniforms,k=g.mf,L=k.count;s(__spreadValues$6(__spreadProps$3(__spreadValues$6(__spreadValues$6({},C),b),{unit:b.unit==="px"?0:1,resolution:f,layerOpacity:c,rot:d,depth:v,texture:h,count:L,mvp:u,isPick:!0}),RenderUtil.getScaleProps(p)))}})}}}]),a}(Render),pushArray$3=CommonUtil$1._C,ZMarkerLayer=function(n){_inherits(a,n);var r=_create_super(a);function a(i){_class_call_check(this,a);var o;o=r.call(this,i),o.CLASS_NAME="ZMarker",o.fusion=new ZMarkerFusion,o.ll=new ZMarkerRender,o.jx=[],o.EM=new Map;var s=zmarker.Sw;return o.zooms=i.zooms===void 0?s.zooms:i.zooms,o.visible=i.visible===void 0?s.visible:i.visible,o.zIndex=i.zIndex===void 0?s.zIndex:i.zIndex,o.opacity=i.opacity===void 0?s.opacity:i.opacity,o.depth=i.depth===void 0?s.depth:i.depth,o.AC({zooms:o.zooms,visible:o.visible,zIndex:o.zIndex}),o.buryPoint.record(o.CLASS_NAME),o}return _create_class(a,[{key:"setStyle",value:function(i){if(_get(_get_prototype_of(a.prototype),"setStyle",this).call(this,i),this.dataset=this.source.LC(),this.colorPick.clear(),this.Kf=null,this.jx=[],this.EM.clear(),this.dataset&&this.dataset.length>0){var o=this.WC(),s=o.didFusionDataset,l=this.fusion.fusion(s,this.styleOptions,this);this.meshes=l,this.vA.state|=MeshesDirty,this.loca&&this.loca.requestRender()}}},{key:"getInitialAnimateState",value:function(){return{altitude:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]},rotation:{time:[1,0,0,0],type:[-1,1,0,0],value:[0,1]}}}},{key:"receiveDataset",value:function(i){this.dataset=i,this.setStyle(this.styleOptions),this.onAdd()}},{key:"jC",value:function(){_get(_get_prototype_of(a.prototype),"jC",this).call(this),!(!this.loca||!this.loca.regl||this.ll.regl)&&(this.ll.regl=this.loca.regl,this.loca.rendererManager.addRenderer(this.ll))}},{key:"beforeRender",value:function(){if(_get(_get_prototype_of(a.prototype),"beforeRender",this).call(this),!this.fusion.regl&&this.loca&&(this.fusion.regl=this.loca.regl,this.loca.fusionManager.addFusion(this.fusion)),this.jC(),this.source&&(this.dataset=this.source.LC()),this.fusion){var i=this.WC(),o=i.willFusion;if(o.length>0){var s=this.fusion.fusion(o,this.styleOptions,this);this.meshes=pushArray$3(this.meshes,s),this.vA.state|=MeshesDirty}}}},{key:"render",value:function(){var i,o,s;if(!!this.loca&&!!this.PA()&&(this.loca.regl._refresh(),this.Kf)){var l=(i=this.loca)==null?void 0:i.customCoords.getMVPMatrix(),u=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom()),c=-(((s=this.loca)==null?void 0:s.map.getRotation())/180)*Math.PI,f=this.Kf?this.meshes:this.Vx;if(this.ll&&f.length>0)return this.ll.render({texture:this.Kf||this.VM,meshes:f,depth:this.depth,mvp:l,rot:c,resolution:u,opacity:this._getOpacity(),vP:this._animateLayerState}),!0}}},{key:"pickRender",value:function(){var i,o,s;if(!!this.loca&&!!this.PA()&&(this.loca.regl._refresh(),this.Kf)){var l=(i=this.loca)==null?void 0:i.customCoords.getMVPMatrix(),u=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom()),c=-(((s=this.loca)==null?void 0:s.map.getRotation())/180)*Math.PI,f=this.Kf?this.meshes:this.Vx;this.ll&&f.length>0&&this.ll.pickRender({texture:this.Kf||this.VM,meshes:f,mvp:l,rot:c,depth:this.depth,resolution:u,pickFbo:this._needPickFrame&&this._pickFbo,pickPos:this._pickPos,opacity:this._getOpacity(),vP:this._animateLayerState})}}},{key:"destroy",value:function(){_get(_get_prototype_of(a.prototype),"destroy",this).call(this),this.Kf&&this.Kf.destroy&&this.Kf.destroy(),this.Kf=null}},{key:"afterRender",value:function(){}},{key:"zx",value:function(){return{BM:this.EM,_x:this.jx}}},{key:"DM",value:function(i){this.Kf=i,this.loca&&this.loca.requestRender()}},{key:"PA",value:function(){return RenderHelper.SA(this.ll,this)}}]),a}(Layer),BINARY_EXTENSION_HEADER_MAGIC="glTF",BINARY_EXTENSION_HEADER_LENGTH=12,BINARY_EXTENSION_CHUNK_TYPES={JSON:1313821514,mP:5130562},KHR_BINARY_GLTF="KHR_binary_glTF",LoaderUtils=function(){function n(){_class_call_check(this,n)}return _create_class(n,null,[{key:"gP",value:function(r){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(r);for(var a="",i=0,o=r.length;i<o;i++)a+=String.fromCharCode(r[i]);try{return decodeURIComponent(escape(a))}catch(s){return a}}},{key:"bP",value:function(r){var a=r.lastIndexOf("/");return a===-1?"./":r.substr(0,a+1)}},{key:"yP",value:function(r,a){return typeof r!="string"||r===""?"":(/^https?:\/\//i.test(a)&&/^\//.test(r)&&(a=a.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(r)||/^data:.*,.*$/i.test(r)||/^blob:.*$/i.test(r)?r:a+r)}}]),n}(),GLTFBinaryExtension=function n(r){_class_call_check(this,n),this.name=KHR_BINARY_GLTF,this.content=null,this.body=null;var a=new DataView(r,0,BINARY_EXTENSION_HEADER_LENGTH);if(this.xP={wP:"glTF",version:a.getUint32(4,!0),length:a.getUint32(8,!0)},this.xP.wP!==BINARY_EXTENSION_HEADER_MAGIC)throw new Error("error magic");if(this.xP.version<2)throw new Error("error version");for(var i=this.xP.length-BINARY_EXTENSION_HEADER_LENGTH,o=new DataView(r,BINARY_EXTENSION_HEADER_LENGTH),s=0;s<i;){var l=o.getUint32(s,!0);s+=4;var u=o.getUint32(s,!0);if(s+=4,u===BINARY_EXTENSION_CHUNK_TYPES.JSON){var c=new Uint8Array(r,BINARY_EXTENSION_HEADER_LENGTH+s,l);this.content=LoaderUtils.gP(c)}else if(u===BINARY_EXTENSION_CHUNK_TYPES.mP){var f=BINARY_EXTENSION_HEADER_LENGTH+s;this.body=r.slice(f,f+l)}s+=l}if(this.content===null)throw new Error("JSON content not found.")},__async$1=function(n,r,a){return new Promise(function(i,o){var s=function(c){try{u(a.next(c))}catch(f){o(f)}},l=function(c){try{u(a.LA(c))}catch(f){o(f)}},u=function(c){return c.done?i(c.value):Promise.resolve(c.value).then(s,l)};u((a=a.apply(n,r)).next())})},globalUniformBlockID=0,curLoader=null,NUM_MAX_JOINTS=65,Scene=function n(r,a){this.name=a.name!==void 0?a.name:null,this.nodes=new Array(a.nodes.length);for(var i=0,o=a.nodes.length;i<o;i++)this.nodes[i]=r.nodes[a.nodes[i]];this.extensions=a.extensions!==void 0?a.extensions:null,this.CP=a.CP!==void 0?a.CP:null,this.kP=null},BoundingBox=function n(r,a,i){r=r||glMatrix.vec3.fromValues(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),a=a||glMatrix.vec3.fromValues(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),i===void 0||i===!0?(this.min=glMatrix.vec3.clone(r),this.max=glMatrix.vec3.clone(a)):(this.min=r,this.max=a),this.transform=glMatrix.mat4.create()};BoundingBox.prototype.zP=function(n){glMatrix.vec3.min(this.min,this.min,n.min),glMatrix.vec3.max(this.max,this.max,n.max)},BoundingBox.prototype.PP=function(){this.transform[0]=this.max[0]-this.min[0],this.transform[5]=this.max[1]-this.min[1],this.transform[10]=this.max[2]-this.min[2],this.transform[12]=this.min[0],this.transform[13]=this.min[1],this.transform[14]=this.min[2]},BoundingBox.SP=function(){var n=glMatrix.vec3.create(),r=glMatrix.vec3.create(),a=glMatrix.vec3.create(),i=glMatrix.vec3.create(),o=glMatrix.vec3.create();return function(s,l){glMatrix.vec3.set(n,l[0],l[1],l[2]),glMatrix.vec3.set(r,l[4],l[5],l[6]),glMatrix.vec3.set(a,l[8],l[9],l[10]);var u=glMatrix.vec3.fromValues(l[12],l[13],l[14]),c=glMatrix.vec3.clone(u);glMatrix.vec3.scale(i,n,s.min[0]),glMatrix.vec3.scale(o,n,s.max[0]),glMatrix.vec3.min(n,i,o),glMatrix.vec3.add(u,u,n),glMatrix.vec3.max(n,i,o),glMatrix.vec3.add(c,c,n),glMatrix.vec3.scale(i,r,s.min[1]),glMatrix.vec3.scale(o,r,s.max[1]),glMatrix.vec3.min(r,i,o),glMatrix.vec3.add(u,u,r),glMatrix.vec3.max(r,i,o),glMatrix.vec3.add(c,c,r),glMatrix.vec3.scale(i,a,s.min[2]),glMatrix.vec3.scale(o,a,s.max[2]),glMatrix.vec3.min(a,i,o),glMatrix.vec3.add(u,u,a),glMatrix.vec3.max(a,i,o),glMatrix.vec3.add(c,c,a);var f=new BoundingBox(u,c,!1);return f.PP(),f}}();var Accessor=function n(r,a){this.bufferView=a,this.componentType=r.componentType,this.byteOffset=r.byteOffset!==void 0?r.byteOffset:0,this.byteStride=a.byteStride,this.td=r.td!==void 0?r.td:!1,this.count=r.count,this.type=r.type,this.size=Type2NumOfComponent[this.type],this.min=r.min,this.max=r.max,this.extensions=r.extensions!==void 0?r.extensions:null,this.CP=r.CP!==void 0?r.CP:null};Accessor.prototype.MP=function(n,r){r.vertexAttribPointer(n,this.size,this.componentType,this.td,this.byteStride,this.byteOffset),r.enableVertexAttribArray(n)};var BufferView=function n(r,a){this.byteLength=r.byteLength,this.byteOffset=r.byteOffset!==void 0?r.byteOffset:0,this.byteStride=r.byteStride!==void 0?r.byteStride:0,this.target=r.target!==void 0?r.target:null,this.data=a&&a.slice(this.byteOffset,this.byteOffset+this.byteLength),this.extensions=r.extensions!==void 0?r.extensions:null,this.CP=r.CP!==void 0?r.CP:null,this.buffer=null};BufferView.prototype.createBuffer=function(n){this.buffer=n.createBuffer()},BufferView.prototype._P=function(n){return this.target?(n.bindBuffer(this.target,this.buffer),n.bufferData(this.target,this.data,n.STATIC_DRAW),n.bindBuffer(this.target,null),!0):!1};var Camera=function n(r){this.name=r.name!==void 0?r.name:null,this.type=r.type,this.IP=r.IP===void 0?null:r.IP,this.perspective=r.perspective===void 0?null:{VP:r.perspective.VP,DP:r.perspective.DP,LP:r.perspective.LP!==void 0?r.perspective.LP:null,FP:r.perspective.FP!==void 0?r.perspective.FP:null},this.extensions=r.extensions!==void 0?r.extensions:null,this.CP=r.CP!==void 0?r.CP:null},Node=function n(r,a){if(this.name=r.name!==void 0?r.name:null,this.nodeID=a,this.Np=r.Np!==void 0?r.Np:null,this.matrix=glMatrix.mat4.create(),r.hasOwnProperty("matrix")){for(var i=0;i<16;++i)this.matrix[i]=r.matrix[i];this.translation=glMatrix.vec3.create(),glMatrix.mat4.getTranslation(this.translation,this.matrix),this.rotation=glMatrix.quat.create(),glMatrix.mat4.getRotation(this.rotation,this.matrix),this.scale=glMatrix.vec3.create(),glMatrix.mat4.getScaling(this.scale,this.matrix)}else this.RP(r.translation,r.rotation,r.scale);if(this.children=r.children||[],this.mesh=r.mesh!==void 0?curLoader.TP.meshes[r.mesh]:null,this.OP=r.OP!==void 0?r.OP:null,r.extensions!==void 0&&r.extensions.BP!==void 0&&curLoader.AP===!0){var o=curLoader.NP.json.extensions.BP.WP[r.extensions.BP.OP.name],s=curLoader.NP.WP[o];this.OP=new SkinLink(curLoader.TP,s,r.extensions.BP.OP.EP)}this.jP=r.jP!==void 0?r.jP:null,this.extensions=r.extensions!==void 0?r.extensions:null,this.CP=r.CP!==void 0?r.CP:null,this.UP=null,this.GP=new BoundingBox};Node.prototype.HP=function(n,r){r(this,n);for(var a=0,i=this.children.length;a<i;a++)this.children[a].HP(this,r)},Node.prototype.qP=function(n,r){for(var a=0,i=this.children.length;a<i;a++)this.children[a].qP(this,r);r(this,n)},Node.prototype.QP=function(n,r,a){r(this,n);for(var i=0,o=this.children.length;i<o;i++)this.children[i].QP(this,r,a);a(this,n)};var TRSMatrix=glMatrix.mat4.create();Node.prototype.RP=function(n,r,a){this.translation=n!==void 0?glMatrix.vec3.fromValues(n[0],n[1],n[2]):glMatrix.vec3.fromValues(0,0,0),this.rotation=r!==void 0?glMatrix.vec4.fromValues(r[0],r[1],r[2],r[3]):glMatrix.vec4.fromValues(0,0,0,1),this.scale=a!==void 0?glMatrix.vec3.fromValues(a[0],a[1],a[2]):glMatrix.vec3.fromValues(1,1,1),this.XP()},Node.prototype.XP=function(){glMatrix.mat4.fromRotationTranslation(TRSMatrix,this.rotation,this.translation),glMatrix.mat4.scale(this.matrix,TRSMatrix,this.scale)};var Mesh=function n(r,a){this.JP=a,this.name=r.name!==void 0?r.name:null,this.primitives=[],this.kP=null;for(var i,o,s=0,l=r.primitives.length;s<l;++s)i=r.primitives[s],o=new Primitive(curLoader.TP,i),this.primitives.push(o),o.kP&&(this.kP||(this.kP=new BoundingBox),this.kP.zP(o.kP));this.kP&&this.kP.PP(),this.jP=r.jP!==void 0?r.jP:null,this.extensions=r.extensions!==void 0?r.extensions:null,this.CP=r.CP!==void 0?r.CP:null},Primitive=function n(r,a){this.attributes=a.attributes,this.indices=a.indices!==void 0?a.indices:null;var i;if(a.extensions!==void 0&&a.extensions.BP!==void 0&&curLoader.AP===!0&&a.extensions.BP.attributes)for(i in a.extensions.BP.attributes)this.attributes[i]=a.extensions.BP.attributes[i];this.indices!==null?(this.YP=r.json.accessors[this.indices].componentType,this.$P=r.json.accessors[this.indices].count,this.ZP=r.json.accessors[this.indices].byteOffset||0):(this.KP=r.json.accessors[this.attributes.POSITION].count,this.tS=r.json.accessors[this.attributes.POSITION].byteOffset||0);for(i in this.attributes)this.attributes[i]=r.accessors[this.attributes[i]];if(this.material=a.material!==void 0?r.materials[a.material]:null,this.mode=a.mode!==void 0?a.mode:4,this.iS=a.iS,this.extensions=a.extensions!==void 0?a.extensions:null,this.CP=a.CP!==void 0?a.CP:null,this.Lw=null,this.nS=null,this.eS=null,this.Sd=null,this.kP=null,this.attributes.POSITION!==void 0){var o=this.attributes.POSITION;o.max&&o.type==="VEC3"&&(this.kP=new BoundingBox(glMatrix.vec3.fromValues(o.min[0],o.min[1],o.min[2]),glMatrix.vec3.fromValues(o.max[0],o.max[1],o.max[2]),!1),this.kP.PP())}},Texture=function n(r){this.name=r.name!==void 0?r.name:null,this.sampler=r.sampler!==void 0?curLoader.TP.samplers[r.sampler]:null,this.source=r.source!==void 0?curLoader.TP.images[r.source]:null,this.extensions=r.extensions!==void 0?r.extensions:null,this.CP=r.CP!==void 0?r.CP:null,this.texture=null};Texture.prototype.createTexture=function(n){this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,this.source),n.generateMipmap(n.TEXTURE_2D),n.bindTexture(n.TEXTURE_2D,null)};var magFilters={9728:"nearest",9729:"linear"},minFilters={9728:"nearest",9729:"linear",9987:"linear mipmap linear",9986:"nearest mipmap linear",9985:"linear mipmap nearest",9984:"nearest mipmap nearest"},wrapMode={10497:"repeat",33071:"clamp",33648:"mirror"},Sampler=function n(r){this.name=r.name!==void 0?r.name:null,this.mag=r.ac!==void 0?magFilters[r.ac]:"linear",this.min=r.oc!==void 0?minFilters[r.oc]:"linear",this.wrapS=r.wrapS!==void 0?wrapMode[r.wrapS]:"repeat",this.wrapT=r.wrapT!==void 0?wrapMode[r.wrapT]:"repeat"},TextureInfo=function n(r){this.index=r.index,this.rS=r.rS!==void 0?r.rS:0,this.extensions=r.extensions!==void 0?r.extensions:null,this.CP=r.CP!==void 0?r.CP:null},PbrMetallicRoughness=function n(r){this.baseColorFactor=r.baseColorFactor!==void 0?r.baseColorFactor:[1,1,1,1],this.baseColorTexture=r.baseColorTexture!==void 0?new TextureInfo(r.baseColorTexture):null,this.metallicFactor=r.metallicFactor!==void 0?r.metallicFactor:1,this.roughnessFactor=r.roughnessFactor!==void 0?r.roughnessFactor:1,this.oS=r.oS!==void 0?new TextureInfo(r.oS):null,this.extensions=r.extensions!==void 0?r.extensions:null,this.CP=r.CP!==void 0?r.CP:null},NormalTextureInfo=function n(r){this.index=r.index,this.rS=r.rS!==void 0?r.rS:0,this.scale=r.scale!==void 0?r.scale:1,this.extensions=r.extensions!==void 0?r.extensions:null,this.CP=r.CP!==void 0?r.CP:null},OcclusionTextureInfo=function n(r){this.index=r.index,this.rS=r.rS!==void 0?r.rS:0,this.sS=r.sS!==void 0?r.sS:1,this.extensions=r.extensions!==void 0?r.extensions:null,this.CP=r.CP!==void 0?r.CP:null},Material=function n(r){this.name=r.name!==void 0?r.name:null,this.pbrMetallicRoughness=r.pbrMetallicRoughness!==void 0?new PbrMetallicRoughness(r.pbrMetallicRoughness):new PbrMetallicRoughness({baseColorFactor:[1,1,1,1],metallicFactor:1,oS:1}),this.aS=r.aS!==void 0?new NormalTextureInfo(r.aS):null,this.uS=r.uS!==void 0?new OcclusionTextureInfo(r.uS):null,this.emissiveTexture=r.emissiveTexture!==void 0?new TextureInfo(r.emissiveTexture):null,this.hS=r.hS!==void 0?r.hS:[0,0,0],this.lS=r.lS!==void 0?r.lS:"OPAQUE",this.fS=r.fS!==void 0?r.fS:.5,this.cS=r.cS||!1,this.extensions=r.extensions!==void 0?r.extensions:null,this.CP=r.CP!==void 0?r.CP:null},Skin=function n(r,a,i){this.name=a.name!==void 0?a.name:null,this.vS=i,this.dS=new Array(a.dS.length);var o,s;for(o=0,s=this.dS.length;o<s;o++)this.dS[o]=r.nodes[a.dS[o]];if(this.pS=a.pS!==void 0?r.nodes[a.pS]:null,this.EP=a.EP!==void 0?r.accessors[a.EP]:null,this.extensions=a.extensions!==void 0?a.extensions:null,this.CP=a.CP!==void 0?a.CP:null,this.mS=globalUniformBlockID++,this.EP)for(this.gS=_getAccessorData(this.EP),this.bS=[],this.yS=null,this.xS=new Float32Array(NUM_MAX_JOINTS*16),o=0,s=this.gS.length;o<s;o+=16)this.bS.push(glMatrix.mat4.fromValues(this.gS[o],this.gS[o+1],this.gS[o+2],this.gS[o+3],this.gS[o+4],this.gS[o+5],this.gS[o+6],this.gS[o+7],this.gS[o+8],this.gS[o+9],this.gS[o+10],this.gS[o+11],this.gS[o+12],this.gS[o+13],this.gS[o+14],this.gS[o+15]))},SkinLink=function n(r,a,i){if(this.wS=!0,r.WP||(r.WP=[]),r.WP.push(this),this.name=a.name,this.vS=r.WP.length-1,this.dS=a.dS,this.pS=a.pS,this.EP=i!==void 0?r.accessors[i]:null,this.mS=globalUniformBlockID++,this.EP){this.gS=_getAccessorData(this.EP),this.bS=[],this.yS=null,this.xS=new Float32Array(NUM_MAX_JOINTS*16);for(var o=0,s=this.gS.length;o<s;o+=16)this.bS.push(glMatrix.mat4.fromValues(this.gS[o],this.gS[o+1],this.gS[o+2],this.gS[o+3],this.gS[o+4],this.gS[o+5],this.gS[o+6],this.gS[o+7],this.gS[o+8],this.gS[o+9],this.gS[o+10],this.gS[o+11],this.gS[o+12],this.gS[o+13],this.gS[o+14],this.gS[o+15]))}},Target=function n(r){this.nodeID=r.node!==void 0?r.node:null,this.path=r.path,this.extensions=r.extensions!==void 0?r.extensions:null,this.CP=r.CP!==void 0?r.CP:null},Channel=function n(r,a){this.sampler=a.samplers[r.sampler],this.target=new Target(r.target),this.extensions=r.extensions!==void 0?r.extensions:null,this.CP=r.CP!==void 0?r.CP:null},AnimationSampler=function n(r,a){this.input=r.accessors[a.input],this.CS=r.accessors[a.CS],this.kS=_getAccessorData(this.input),this.zS=_getAccessorData(this.CS),this.PS=a.PS!==void 0?a.PS:"LINEAR",this.extensions=a.extensions!==void 0?a.extensions:null,this.CP=a.CP!==void 0?a.CP:null,this.SS=0,this.MS=glMatrix.vec4.create(),this._S=this.kS[this.kS.length-1],this.IS=this._S-this.kS[0]},animationOutputValueVec4a=glMatrix.vec4.create(),animationOutputValueVec4b=glMatrix.vec4.create();AnimationSampler.prototype.jf=function(n){n>this._S&&(n-=this.IS*Math.ceil((n-this._S)/this.IS),this.SS=0);for(var r=this.kS.length;this.SS<=r-2&&n>=this.kS[this.SS+1];)this.SS++;this.SS>=r-1&&(n-=this.IS,this.SS=0);for(var a=Type2NumOfComponent[this.CS.type],i=a===4?glMatrix.quat.lb:glMatrix.vec4.Ia,o=this.SS,s=o*a,l=s+a,u=Math.max(0,n-this.kS[o])/(this.kS[o+1]-this.kS[o]),c=0;c<a;c++)animationOutputValueVec4a[c]=this.zS[s+c],animationOutputValueVec4b[c]=this.zS[l+c];switch(this.PS){case"LINEAR":i(this.MS,animationOutputValueVec4a,animationOutputValueVec4b,u);break}};var Animation=function n(r,a){this.name=a.name!==void 0?a.name:null;var i,o;for(this.samplers=[],i=0,o=a.samplers.length;i<o;i++)this.samplers[i]=new AnimationSampler(r,a.samplers[i]);for(this.ic=[],i=0,o=a.ic.length;i<o;i++)this.ic[i]=new Channel(a.ic[i],this);this.extensions=a.extensions!==void 0?a.extensions:null,this.CP=a.CP!==void 0?a.CP:null},glTFModel=function n(r){this.json=r,this.VS=r.scene!==void 0?r.scene:0,this.version=Number(r.asset.version),r.accessors&&(this.accessors=new Array(r.accessors.length)),r.bufferViews&&(this.bufferViews=new Array(r.bufferViews.length)),r.scenes&&(this.scenes=new Array(r.scenes.length)),r.nodes&&(this.nodes=new Array(r.nodes.length)),r.meshes&&(this.meshes=new Array(r.meshes.length)),r.materials&&(this.materials=new Array(r.materials.length)),r.textures&&(this.textures=new Array(r.textures.length)),r.samplers&&(this.samplers=new Array(r.samplers.length)),r.images&&(this.images=new Array(r.images.length)),r.WP&&(this.WP=new Array(r.WP.length)),r.DS&&(this.DS=new Array(r.DS.length)),r.cameras&&(this.cameras=new Array(r.cameras.length)),this.extensions=r.extensions!==void 0?r.extensions:null,this.CP=r.CP!==void 0?r.CP:null},glTFLoader=function n(){this.LS(),this.TP=null,this.AP=!1,this.FS=null};glTFLoader.prototype.LS=function(){this.RS=!1,this.TS=0,this.OS=0,this.BS=[],this.AS={},this.WS=0,this.NS=0,this.ES=0,this.jS=0,this.US=0,this.GS=0,this.onload=null,curLoader=this},glTFLoader.prototype.HS=function(){this.TS==this.OS&&this.ES==this.jS&&(this.RS=!0),this.RS&&this.US==this.GS&&(this.qS(),this.onload(this.TP))},glTFLoader.prototype.QS=function(n,r,a){this.AP=!0,this.NP=r,this.XS(n,a)},glTFLoader.prototype.JS=function(n){var r=0,a=0;if(this.TP.bufferViews)for(r=0,a=this.TP.bufferViews.length;r<a;r++)this.TP.bufferViews[r]=new BufferView(this.TP.json.bufferViews[r],this.BS[this.TP.json.bufferViews[r].buffer]);var i=this,o=function(f,h){i.jS++,i.TP.images[h]=f,i.HS()},s;if(n.images){for(s in n.images)if(i.ES++,n.images[s].uri)if(n.images[s].uri.indexOf("data:")>-1){var l=n.images[s].uri;_loadImage(l,s,o)}else _loadImage(i.YS+n.images[s].uri,s,o);else if(n.images[s].bufferView!==void 0){var u=new Blob([this.TP.bufferViews[this.TP.json.images[s].bufferView].data],{type:n.images[s].mimeType}),c=URL.createObjectURL(u);_loadImage(c,s,o)}}else i.HS()},glTFLoader.prototype.XS=function(n,r){n.indexOf("glb")>-1?this.$S(n,r):this.ZS(n,r)},glTFLoader.prototype.ZS=function(n,r){this.LS(),this.onload=r||function(i){console.log("glTF model loaded.")},this.YS=_getBaseUri(n);var a=this;_loadJSON(n,function(i){var o=JSON.parse(i);a.TP=new glTFModel(o);var s,l=function(h,p){var d=parseInt(p);a.BS[d]=h,a.OS++,a.OS===a.TS&&a.JS(o)};if(o.buffers)for(s in o.buffers){var u=s;if(a.TS++,o.buffers[u].uri.indexOf("data:")>-1){var c=function(h){for(var p=h.split("base64,")[1],d=window.atob(p),v=d.length,_=new Uint8Array(v),m=0;m<v;m++)_[m]=d.charCodeAt(m);return _.buffer},f=c(o.buffers[u].uri);l(f,u)}else _loadArrayBuffer(a.YS+o.buffers[u].uri,l,u)}else a.JS(o)})},glTFLoader.prototype.$S=function(n,r){this.LS(),this.onload=r||function(i){console.log("glTF model loaded.")},this.YS=_getBaseUri(n);var a=this;_loadGlb(n,function(i){var o=JSON.parse(i.content);debugger;a.TP=new glTFModel(o);var s,l=function(c,f){var h=parseInt(f);a.BS[h]=c,a.OS++,a.OS===a.TS&&a.JS(o)};if(o.buffers)for(s in o.buffers){var u=s;a.TS++,l(i.body,u)}else a.JS(o)})},glTFLoader.prototype.qS=function(){var n=function(p,d){var v=f[p.nodeID];d!==null?glMatrix.mat4.mul(v,f[d.nodeID],p.matrix):glMatrix.mat4.copy(v,p.matrix)},r=function(p,d){var v=f[p.nodeID],_;d!==null?_=d.GP:_=l.kP,p.mesh&&(c=p.mesh,c.kP&&(p.UP=BoundingBox.SP(c.kP,v),p.children.length===0&&(glMatrix.vec3.copy(p.GP.min,p.UP.min),glMatrix.vec3.copy(p.GP.max,p.UP.max)))),glMatrix.vec3.min(_.min,_.min,p.GP.min),glMatrix.vec3.max(_.max,_.max,p.GP.max)};curLoader=this;var a,i,o,s,l,u,c;if(this.TP.cameras)for(a=0,i=this.TP.cameras.length;a<i;a++)this.TP.cameras[a]=new Camera(this.TP.json.cameras[a]);if(this.TP.accessors)for(a=0,i=this.TP.accessors.length;a<i;a++)this.TP.accessors[a]=new Accessor(this.TP.json.accessors[a],this.TP.bufferViews[this.TP.json.accessors[a].bufferView]);if(this.TP.materials)for(a=0,i=this.TP.materials.length;a<i;a++)this.TP.materials[a]=new Material(this.TP.json.materials[a]);if(this.TP.samplers)for(a=0,i=this.TP.samplers.length;a<i;a++)this.TP.samplers[a]=new Sampler(this.TP.json.samplers[a]);if(this.TP.textures)for(a=0,i=this.TP.textures.length;a<i;a++)this.TP.textures[a]=new Texture(this.TP.json.textures[a]);for(a=0,i=this.TP.meshes.length;a<i;a++)this.TP.meshes[a]=new Mesh(this.TP.json.meshes[a],a);for(a=0,i=this.TP.nodes.length;a<i;a++)this.TP.nodes[a]=new Node(this.TP.json.nodes[a],a);for(a=0,i=this.TP.nodes.length;a<i;a++)for(u=this.TP.nodes[a],o=0,s=u.children.length;o<s;o++)u.children[o]=this.TP.nodes[u.children[o]];var f=new Array(this.TP.nodes.length);for(a=0,i=f.length;a<i;a++)f[a]=glMatrix.mat4.create();for(a=0,i=this.TP.scenes.length;a<i;a++){for(l=this.TP.scenes[a]=new Scene(this.TP,this.TP.json.scenes[a]),l.kP=new BoundingBox,o=0,s=l.nodes.length;o<s;o++)u=l.nodes[o],u.QP(null,n,r);l.kP.PP()}for(o=0,s=this.TP.nodes.length;o<s;o++)u=this.TP.nodes[o],u.GP!==null&&u.GP.PP();if(this.TP.DS)for(a=0,i=this.TP.DS.length;a<i;a++)this.TP.DS[a]=new Animation(this.TP,this.TP.json.DS[a]);var h;if(this.TP.json.WP)for(a=0,i=this.TP.WP.length;a<i;a++)for(this.TP.WP[a]=new Skin(this.TP,this.TP.json.WP[a],a),h=this.TP.WP[a].dS,o=0,s=h.length;o<s;o++)h[o].KS=o;for(a=0,i=this.TP.nodes.length;a<i;a++)u=this.TP.nodes[a],u.OP!==null&&typeof u.OP=="number"&&(u.OP=this.TP.WP[u.OP])};var Type2NumOfComponent={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},canvas=document.createElement("canvas"),context=canvas.getContext("2d"),__defProp$5=Object.defineProperty,__getOwnPropSymbols$5=Object.getOwnPropertySymbols,__hasOwnProp$5=Object.prototype.hasOwnProperty,__propIsEnum$5=Object.prototype.propertyIsEnumerable,__defNormalProp$5=function(n,r,a){return r in n?__defProp$5(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$5=function(n,r){for(var a in r||(r={}))__hasOwnProp$5.call(r,a)&&__defNormalProp$5(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$5)try{for(var l=__getOwnPropSymbols$5(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$5.call(r,a)&&__defNormalProp$5(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},__async=function(n,r,a){return new Promise(function(i,o){var s=function(c){try{u(a.next(c))}catch(f){o(f)}},l=function(c){try{u(a.LA(c))}catch(f){o(f)}},u=function(c){return c.done?i(c.value):Promise.resolve(c.value).then(s,l)};u((a=a.apply(n,r)).next())})},GLTF=function(){function n(r,a){_class_call_check(this,n),this.nodes=[],this.meshes=[],this.t_=[],this.i_=[],this.materials=[],this.textures=[],this.accessors=[],this.bufferViews=[],this.samplers=[],this.DS=[],this.scene={},this.n_={},this.url=r,this.regl=a,this.i_=[]}return _create_class(n,[{key:"e_",value:function(){return __async(this,null,function(){var r;return _ts_generator(this,function(a){switch(a.label){case 0:return[4,this.r_()];case 1:return r=a.sent(),[2,r]}})})}},{key:"r_",value:function(){return __async(this,null,function(){var r;return _ts_generator(this,function(a){switch(a.label){case 0:return r=this,[4,new Promise(function(i,o){var s=new glTFLoader;s.XS(r.url,function(l){!l||!l.json?o({s_:"no gltf"}):(r.o_=l,r.parseData(l),i(r))})})];case 1:return[2,a.sent()]}})})}},{key:"parseData",value:function(r){var a=r.scenes,i=r.nodes,o=r.json,s=r.accessors;this.accessors=s;for(var l=o.scene||0,u=a[l].nodes,c=0;c<u.length;c++){var f=i[u[c].nodeID];this.a_(f)}var h=this.u_();this.h_(h),this.l_()}},{key:"l_",value:function(){this.i_.sort(function(r,a){return r.parseData.f_.length-a.parseData.f_.length})}},{key:"a_",value:function(r,a){var i=glMatrix.mat4.create();if(r.matrix&&glMatrix.mat4.multiply(i,r.matrix,i),a&&glMatrix.mat4.multiply(i,a,i),r.mesh)this.t_.push({mesh:r.mesh,finalMatrix:i});else if(r.children)for(var o=r.children,s=o.length,l=0;l<s;l++)i?this.a_(o[l],i):this.a_(o[l])}},{key:"u_",value:function(){for(var r=this.t_.length,a={},i=0;i<r;i++){var o=this.t_[i],s=o.mesh,l=s.JP;a[l]||(a[l]={finalMatrix:[],mesh:o.mesh}),a[l].finalMatrix.push(o.finalMatrix)}return a}},{key:"h_",value:function(r){for(var a=Object.keys(r),i=a.length,o=0;o<i;o++)for(var s=a[o],l=r[s],u=l.mesh,c=l.finalMatrix,f=u.primitives,h=0;h<f.length;h++){var p=f[h],d=p.attributes,v=p.indices,_=p.material,m={array:this.regl.elements()},y={array:this.regl.buffer(),offset:0,stride:0},g={array:this.regl.buffer(),offset:0,stride:0,HAS:0},C={array:this.regl.buffer(),offset:0,stride:0},b={color:[0,0,0,1],texture:this.regl.texture(),MRtexture:this.regl.texture(),emissiveTexture:this.regl.texture(),HAS_TEXTURE:0,metallicFactor:1,roughnessFactor:1},k={};if(_&&_.pbrMetallicRoughness){if(_.pbrMetallicRoughness.baseColorFactor&&(b.color=_.pbrMetallicRoughness.baseColorFactor),_.pbrMetallicRoughness.baseColorTexture){var L=_.pbrMetallicRoughness.baseColorTexture.index,F=this.o_.textures[L],W=F.source;b.texture=this.regl.texture(__spreadValues$5({data:W.data||W,width:W.width,height:W.height},F.sampler)),k.HAS_BASE_TEXTURE=1}if(_.pbrMetallicRoughness.roughnessFactor&&(b.roughnessFactor=_.pbrMetallicRoughness.roughnessFactor),_.pbrMetallicRoughness.metallicFactor&&(b.metallicFactor=_.pbrMetallicRoughness.metallicFactor),_.pbrMetallicRoughness.oS){var j=_.pbrMetallicRoughness.oS.index,Y=this.o_.textures[j],N=Y.source;b.MRtexture=this.regl.texture(__spreadValues$5({data:N.data||N,width:N.width,height:N.height},Y.sampler)),k.HAS_MR_TEXTURE=1}if(_.emissiveTexture){var $=_.emissiveTexture.index,w=this.o_.textures[$],E=w.source;b.emissiveTexture=this.regl.texture(__spreadValues$5({data:E.data||E,width:E.width,height:E.height},w.sampler)),k.HAS_EMIS_TEXTURE=1}}if(v!==void 0){var A=this.accessors[v];m=formatArray(A,this.regl,"element")}var R=d.POSITION,O=d.NORMAL,P=d.TEXCOORD_0;R&&(y=formatArray(d.POSITION,this.regl,"buffer")),O&&(g=formatArray(d.NORMAL,this.regl,"buffer"),k.HAS_NORMAL=1),P&&(C=formatArray(d.TEXCOORD_0,this.regl,"buffer"));var T={c_:this.accessors[v||0],v_:y,d_:g,p_:C,m_:m,g_:b,b_:k,f_:JSON.stringify(k)};this.i_.push({parseData:T,finalMatrix:c,finalMatrixCount:c.length})}}}]),n}(),GLTFFusion=function(n){_inherits(a,n);var r=_create_super(a);function a(){return _class_call_check(this,a),r.apply(this,arguments)}return _create_class(a,[{key:"buildStyle",value:function(i,o){for(var s=gltf.style,l=[],u=0;u<i.length;u++)if(!(!i[u].features||!i[u].features.points)){var c=i[u].features.points,f=StyleInstance.parse(c,o,s);l.push(f)}return l}},{key:"fusion",value:function(i,o,s,l){var u=this,c=function(g,C){for(var b=u,k=function(j){var Y=F[j],N=Y.coordinates,$=Y.properties,w=(h=s.loca)==null?void 0:h.customCoords,E=w.lngLatToCoord(N),A=v[g].attributes,R=A.rotateX,O=A.rotateY,P=A.rotateZ,T=A.visible,M=A.height,U=A.scale,Q=[R[j],O[j],P[j]],K=T[j],te=M[j],ve=U[j];if($&&$.url){var de=$.url,be=new GLTF(de,(p=s.loca)==null?void 0:p.regl),et=s.x_.y_(de);if(et)et.status==="loaded"?b.w_(et.data,{properties:$,C_:Q,k_:K,z_:te,P_:ve,position:E,coordinates:N},s):(s.S_[de]||(s.S_[de]=[]),s.S_[de].push({style:{properties:$,C_:Q,k_:K,z_:te,P_:ve,position:E,coordinates:N}}));else{s.x_.M_(de);var qe=be.e_().then(function(Ne){if(s.x_.__(de,Ne),f.w_(Ne,{properties:$,C_:Q,k_:K,z_:te,P_:ve,position:E,coordinates:N},s),s.S_[de]&&s.S_[de].length>0)for(var Ge=s.S_[de].length;Ge>0;Ge--)f.w_(Ne,s.S_[de][Ge-1].style,s),s.S_[de].pop()});_.push(qe)}}},L=i[g],F=L.features.points,W=0;W<F.length;W++)k(W);d[g]={id:L.id,attributes:{},uniforms:{},si:{},mf:{},status:"buffered"}},f=this,h,p;if(!this.regl||!s.loca)return[];for(var d=[],v=this.buildStyle(i,o),_=[],m=0,y=i.length;m<y;m++)c(m);return Promise.all(_).then(function(){return l(d)}),d}},{key:"w_",value:function(i,o,s){var l=o.C_,u=o.k_,c=o.z_,f=o.P_,h=o.position,p=o.coordinates,d=o.properties,v=JSON.parse(JSON.stringify(i.o_.scenes[0].kP||{}));v.scale=f,v.height=c,v.position={lnglat:p,locaPos:h};for(var _=i.i_,m=[],y=0;y<_.length;y++){var g=_[y],C={id:y.toString(),status:"buffered",attributes:{Iw:g,I_:h,C_:l,k_:u,z_:c,P_:f},uniforms:{color:[1,0,0,1]},si:{}};m.push(C)}s.V_.push({sceneBBox:v,meshes:m,D_:d.url}),this.L_(s),s.loca.requestRender()}},{key:"L_",value:function(i){for(var o,s={},l=0;l<i.V_.length;l++){var u=i.V_[l],c=u.D_,f=u.sceneBBox,h=u.meshes,p=f.position.locaPos,d=f.height;s[c]||(s[c]={F_:h,position:[]}),s[c].position.push([p[0],p[1],d]),s[c].sceneBBox=f}for(var v in s)s[v].positionBuffer=(o=i.loca)==null?void 0:o.regl.buffer(s[v].position.map(function(_){return _}));i.R_=s}},{key:"DC",value:function(){}},{key:"EC",value:function(){return[]}},{key:"destroy",value:function(){this.regl=null}}]),a}(GeometryFusion),__defProp$4=Object.defineProperty,__getOwnPropSymbols$4=Object.getOwnPropertySymbols,__hasOwnProp$4=Object.prototype.hasOwnProperty,__propIsEnum$4=Object.prototype.propertyIsEnumerable,__defNormalProp$4=function(n,r,a){return r in n?__defProp$4(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$4=function(n,r){for(var a in r||(r={}))__hasOwnProp$4.call(r,a)&&__defNormalProp$4(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$4)try{for(var l=__getOwnPropSymbols$4(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$4.call(r,a)&&__defNormalProp$4(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},GLTFShader={vertex:"\n        precision mediump float;\n        attribute vec3 model_pos;\n        \n        #ifdef HAS_BASE_TEXTURE\n            attribute vec2 uvs;\n            varying vec2 vUv;\n        #endif\n\n        attribute vec3 normal_pos;\n        // attribute mat4 model_matrix;\n        uniform mat4 model_matrix;\n\n\n        varying vec3 vNormal;\n        varying vec3 vPosition;\n\n\n        uniform mat4 mvp;\n        uniform mat4 rotateMatrix;\n        // uniform vec3 point_pos;\n        attribute vec3 point_pos;\n\n        void main () {\n\n            #ifdef HAS_BASE_TEXTURE\n                vUv = uvs;\n            #endif\n\n            vNormal = normalize(normal_pos.xzy);\n            vec4 tmpPos = rotateMatrix * model_matrix * vec4(model_pos.xyz,1.);\n            \n            // vPosition \u5C40\u90E8\u58A8\u5361\u6258\u5750\u6807\n            vPosition = vec3(tmpPos.xy + point_pos.xy, tmpPos.z + point_pos.z);\n\n            vec4 pos =  mvp * vec4(tmpPos.xy + point_pos.xy, tmpPos.z + point_pos.z,1);\n            gl_Position = pos;\n\n        }\n    ",fragment:"\n            precision mediump float;\n            // precision highp float;\n\n            uniform vec4 model_texture_color;\n            uniform sampler2D texture; \n\n            uniform sampler2D MRtexture; \n\n            uniform sampler2D emissiveTexture; \n\n            uniform float roughnessFactor;\n            uniform float metallicFactor;\n\n            // uniform float ambIntensity;\n\n                \n            uniform vec3 lightDir;\n            #ifdef HAS_BASE_TEXTURE\n                varying vec2 vUv;\n            #endif\n\n            varying vec3 vNormal;\n            varying vec3 vPosition;\n\n            // uniform float shininess;\n\n            const float c_MinRoughness = 0.04;\n\n            struct PBRInfo\n            {\n                float NdotL;                  // cos angle between normal and light direction\n                float NdotV;                  // cos angle between normal and view direction\n                float NdotH;                  // cos angle between normal and half vector\n                float LdotH;                  // cos angle between light direction and half vector\n                float VdotH;                  // cos angle between view direction and half vector\n                float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)\n                float metalness;              // metallic value at the surface\n                vec3 reflectance0;            // full reflectance color (normal incidence angle)\n                vec3 reflectance90;           // reflectance color at grazing angle\n                float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])\n                vec3 diffuseColor;            // color contribution from diffuse lighting\n                vec3 specularColor;           // color contribution from specular lighting\n            };\n\n            uniform vec3 cameraPosition;\n            uniform float shininess;\n            #include <lightUniforms>;\n\n            // vec3 lightDir = normalize(lightPosition - position);\n            // vec3 cameraDirection = normalize(cameraPosition - position);\n\n\n            const float PI = 3.14159265359;\n            const float M_PI = 3.141592653589793;\n\n\n\n            // http://chilliant.blogspot.com/2012/08/srgb-approximations-for-hlsl.html\n            vec3 linearTosRGB(vec3 color)\n            {\n                const float GAMMA = 2.2;\n                const float INV_GAMMA = 1.0 / GAMMA;    \n                return pow(color, vec3(INV_GAMMA));\n            }\n\n            float DistributionGGX(vec3 N, vec3 H, float roughness)\n            {\n                float a = roughness * roughness;\n                float a2 = a * a;\n                float NdotH = max(dot(N, H), 0.0);\n                float NdotH2 = NdotH * NdotH;\n\n                float nom = a2;\n                float denom = (NdotH2 * (a2 - 1.0) + 1.0);\n                denom = PI * denom * denom;\n\n                return nom / max(denom, 0.001);\n            }\n            float GeometrySchlickGGX(float NdotV, float roughness)\n            {\n                float r = (roughness + 1.0);\n                float k = (r*r) / 8.0;\n\n                float nom   = NdotV;\n                float denom = NdotV * (1.0 - k) + k;\n\n                return nom / denom;\n            }\n            float GeometrySmith(vec3 N, vec3 V, vec3 L, float roughness)\n            {\n                float NdotV = max(dot(N, V), 0.0);\n                float NdotL = max(dot(N, L), 0.0);\n                float ggx2 = GeometrySchlickGGX(NdotV, roughness);\n                float ggx1 = GeometrySchlickGGX(NdotL, roughness);\n\n                return ggx1 * ggx2;\n            }\n            vec3 fresnelSchlick(float cosTheta, vec3 F0)\n            {\n                return F0 + (1.0 - F0) * pow(1.0 - cosTheta, 5.0);\n            }\n\n            vec3 specularReflection(PBRInfo pbrInputs)\n            {\n                return pbrInputs.reflectance0 + (pbrInputs.reflectance90 - pbrInputs.reflectance0) * pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);\n            }\n\n            float visibilityOcclusion(PBRInfo pbrInputs)\n            {\n                float NdotL = pbrInputs.NdotL;\n                float NdotV = pbrInputs.NdotV;\n                float alphaRoughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;\n\n                float GGXV = NdotL * sqrt(NdotV * NdotV * (1.0 - alphaRoughnessSq) + alphaRoughnessSq);\n                float GGXL = NdotV * sqrt(NdotL * NdotL * (1.0 - alphaRoughnessSq) + alphaRoughnessSq);\n                return 0.5 / (GGXV + GGXL);\n            }\n\n            float microfacetDistribution(PBRInfo pbrInputs)\n            {\n                float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;\n                float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;\n                return roughnessSq / (M_PI * f * f);\n            }\n            vec3 diffuse(PBRInfo pbrInputs)\n            {\n                return pbrInputs.diffuseColor / M_PI;\n            }\n\n            vec3 gammaCorrection(vec3 color) {\n                return pow(color, vec3(1.0 / 2.2));\n            }\n\n\n           \n\n\n            void main () {\n                // \u57FA\u8272\n                vec4 baseColor = model_texture_color;\n\n                #ifdef HAS_BASE_TEXTURE\n                    baseColor = texture2D(texture, vUv);\n                #endif\n\n                // \u8BA1\u7B97 \u7C97\u7CD9\u5EA6 \u548C \u91D1\u5C5E\u5EA6\n           \n                float perceptualRoughness = roughnessFactor;\n                float metallic = metallicFactor;\n\n                #ifdef HAS_MR_TEXTURE\n                    vec4 MRtextureColor = texture2D(MRtexture, vUv);\n                    perceptualRoughness = MRtextureColor.g;\n                    metallic = MRtextureColor.b;\n                #endif\n \n                // c_MinRoughness = 0.04 \u7ECF\u9A8C\u503C\n                perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);\n                metallic = clamp(metallic, 0.0, 1.0);\n                float alphaRoughness = perceptualRoughness * perceptualRoughness;\n                \n\n                vec3 f0 = vec3(0.04);\n                vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);\n                diffuseColor *= 1.0 - metallic;\n                vec3 specularColor = mix(f0, baseColor.rgb, metallic);\n\n                // \u8BA1\u7B97\u53CD\u5C04\u7387 reflectance.\n                float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);\n                float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);\n                vec3 specularEnvironmentR0 = specularColor.rgb;\n                vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;\n\n                vec3 n = normalize(vNormal);\n                vec3 v = normalize(cameraPosition - vPosition);  \n                // vec3 l = normalize(u_LightDirection);             \n                // Vector from surface point to light\n\n                // \u70B9\u3001\u5E73\u884C\u5149\u3001\u73AF\u5883\u5149\n                // vec3 color = baseColor.rgb;\n                vec3 color = vec3(0.0);\n\n\n                vec3 diffuseContrib = vec3(0.0);\n                vec3 specContrib = vec3(0.0);\n\n                for (int i = 0; i < NUMBER_OF_POINT_LIGHTS; i++) {\n                    PointLight pointLight = pointLights[i];\n                    // vec3 lightPosition = vec3(1.,1.,100.);\n                    vec3 l = normalize(pointLight.position - vPosition);\n\n                    // \u8BA1\u7B97\u534A\u89D2\u5411\u91CF h \n                    vec3 h = normalize(l + v);                         \n                    vec3 reflection = -normalize(reflect(v, n));\n\n                    float NdotL = clamp(dot(n, l), 0.001, 1.0);\n                    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);\n                    float NdotH = clamp(dot(n, h), 0.0, 1.0);\n                    float LdotH = clamp(dot(l, h), 0.0, 1.0);\n                    float VdotH = clamp(dot(v, h), 0.0, 1.0);\n\n                    PBRInfo pbrInputs = PBRInfo(\n                        NdotL,\n                        NdotV,\n                        NdotH,\n                        LdotH,\n                        VdotH,\n                        perceptualRoughness,\n                        metallic,\n                        specularEnvironmentR0,\n                        specularEnvironmentR90,\n                        alphaRoughness,\n                        diffuseColor,\n                        specularColor\n                    );\n\n                    vec3 F = specularReflection(pbrInputs);\n                    float Vis = visibilityOcclusion(pbrInputs);\n                    float D = microfacetDistribution(pbrInputs);\n\n                    // Calculation of analytical lighting contribution\n                    diffuseContrib = (1.0 - F) * diffuse(pbrInputs);\n                    specContrib = F * Vis * D;\n\n\n                    // vec3 lightColor = vec3(1.,0.,1.);\n\n\n                    color =  NdotL * pointLight.lightColor * (diffuseContrib + specContrib);\n\n                }\n\n\n                // color = mix(color, baseColor.rgb, 1.);\n\n                // \u574F\u5883\u5149\n                // vec4 ambLightColor = vec4(1.,1.,1.,1.);\n\n                // float ambintensityFactor = 0.6;\n                // if(ambIntensity) {\n                //     ambintensityFactor = ambIntensity;\n                // }\n\n\n                vec4 amb = vec4(ambientLight.lightColor, 1.) * baseColor * ambientLight.intensity;\n\n                gl_FragColor = amb + vec4(gammaCorrection(color), baseColor.a);\n                // gl_FragColor = baseColor;\n\n\n                return;\n\n              \n            }\n        ",includes:__spreadValues$4({},LightIncludes)},__defProp$3=Object.defineProperty,__defProps$2=Object.defineProperties,__getOwnPropDescs$2=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$3=Object.getOwnPropertySymbols,__hasOwnProp$3=Object.prototype.hasOwnProperty,__propIsEnum$3=Object.prototype.propertyIsEnumerable,__defNormalProp$3=function(n,r,a){return r in n?__defProp$3(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$3=function(n,r){for(var a in r||(r={}))__hasOwnProp$3.call(r,a)&&__defNormalProp$3(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$3)try{for(var l=__getOwnPropSymbols$3(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$3.call(r,a)&&__defNormalProp$3(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},__spreadProps$2=function(n,r){return __defProps$2(n,__getOwnPropDescs$2(r))},__objRest=function(n,r){var a={};for(var i in n)__hasOwnProp$3.call(n,i)&&r.indexOf(i)<0&&(a[i]=n[i]);var o=!0,s=!1,l=void 0;if(n!=null&&__getOwnPropSymbols$3)try{for(var u=__getOwnPropSymbols$3(n)[Symbol.iterator](),c;!(o=(c=u.next()).done);o=!0){var i=c.value;r.indexOf(i)<0&&__propIsEnum$3.call(n,i)&&(a[i]=n[i])}}catch(f){s=!0,l=f}finally{try{!o&&u.return!=null&&u.return()}finally{if(s)throw l}}return a},GLTFRender=function(n){_inherits(a,n);var r=_create_super(a);function a(){return _class_call_check(this,a),r.apply(this,arguments)}return _create_class(a,[_define_property({key:"m$"},"value",function(i){if(!this.regl)return!1;for(var o=this.regl,s=RenderHelper._A(i,o),l=i,u=l.GLTF_PARAMS,c=__objRest(l,["GLTF_PARAMS"]),f=0;f<u.length;f++)this.gA(GLTFShader,__spreadValues$3(__spreadValues$3({},u[f]),c),{attributes:{model_pos:o.prop("model_pos"),uvs:o.prop("model_uvs"),normal_pos:o.prop("normal_pos"),point_pos:o.prop("point_pos")},uniforms:__spreadValues$3({mvp:o.prop("mvp"),rotateMatrix:o.prop("rotateMatrix"),shininess:o.prop("shininess"),cameraPosition:o.prop("cameraPosition"),texture:o.prop("model_texture"),MRtexture:o.prop("model_MRtexture"),emissiveTexture:o.prop("model_emissiveTexture"),lightColor:[1,1,1],lightDir:[1,1,1],HAS_TEXTURE:o.prop("HAS_TEXTURE"),metallicFactor:o.prop("metallicFactor"),roughnessFactor:o.prop("roughnessFactor"),model_texture_color:o.prop("model_texture_color"),model_matrix:o.prop("model_matrix")},s),elements:o.prop("element"),blend:{enable:!0,func:RenderUtil.getBlend("normal")},cull:{enable:!0},instances:o.prop("instances_count")},f)}),{key:"render",value:function(i){var o=i.B_,s=i.mvp,l=i.cameraPosition,u=i.lights;if(this.regl)for(var c=Object.keys(o),f=c.length,h=-1,p=0;p<f;p++)for(var d=o[c[p]].F_,v=d.length,_=0;_<v;_++){h+=1;var m=d[_],y=m.attributes,g=y.C_,C=y.P_,b=y.Iw,k=b.finalMatrix,L=b.parseData,F=L.v_,W=L.m_,j=L.p_,Y=L.g_,N=L.d_;L.b_;var $=glMatrix.mat4.create();if(g&&g[0]){var w=g[0]*Math.PI/180;glMatrix.mat4.rotateX($,$,w)}if(g&&g[1]){var E=g[1]*Math.PI/180;glMatrix.mat4.rotateY($,$,E)}if(g&&g[2]){var A=g[2]*Math.PI/180;glMatrix.mat4.rotateZ($,$,A)}C&&glMatrix.mat4.scale($,$,C);var R=o[c[p]].position.length;y={model_pos:{buffer:F.array,offset:F.offset,divisor:0,stride:F.stride},model_uvs:{buffer:j.array,offset:j.offset,divisor:0,stride:j.stride},normal_pos:{buffer:N.array,offset:N.offset,divisor:0,stride:N.stride},model_texture:Y.texture,model_MRtexture:Y.MRtexture,model_emissiveTexture:Y.emissiveTexture,model_texture_color:Y.color,point_pos:{buffer:o[c[p]].positionBuffer,divisor:1},element:W.array,rotateMatrix:$,roughnessFactor:Y.roughnessFactor,metallicFactor:Y.metallicFactor,instances_count:R};var O=this.yA(GLTFShader,h);if(!O)throw new Error("Missing shader cmd at ".concat(h,"(").concat(p,", ").concat(_,")."));for(var P=0;P<k.length;P++)y.model_matrix=k[P],O(__spreadProps$2(__spreadValues$3(__spreadProps$2(__spreadValues$3({},y),{isPick:!1,mvp:s,cameraPosition:l}),u),{acceptLight:!0,shininess:5,HAS_TEXTURE:Y.HAS_TEXTURE}))}}},{key:"pickRender",value:function(i){}}]),a}(Render),ModelCache=function(){function n(r){_class_call_check(this,n),this.N_=[],this.E_=6,this.N_=[],r&&r.E_&&(this.E_=r.E_)}return _create_class(n,[{key:"M_",value:function(r){var a=this.N_.length;a>=this.E_&&this.N_.splice(0,1),this.N_.push({key:r,status:"loading"})}},{key:"__",value:function(r,a){var i=this.y_(r);i.status="loaded",i.data=a}},{key:"y_",value:function(r){for(var a=this.N_.length,i=0;i<a;i++){var o=this.N_[i];if(o.key===r)return o}return!1}}]),n}(),GLTFLayer=function(n){_inherits(a,n);var r=_create_super(a);function a(i){_class_call_check(this,a);var o;return o=r.call(this,i),o.CLASS_NAME="GLTF",o.fusion=new GLTFFusion,o.ll=new GLTFRender,o.j_={},o.V_=[],o.R_={},o.S_={},o.acceptLight=!0,o.AC(i),o.x_=new ModelCache,o}return _create_class(a,[{key:"setStyle",value:function(i){_get(_get_prototype_of(a.prototype),"setStyle",this).call(this,i),this.dataset=this.source.LC(),this.dataset&&this.dataset.length>0&&this.meshes&&this.loca&&this.loca.requestRender()}},{key:"buildStyle",value:function(i,o){for(var s=gltf.style,l=[],u=0;u<i.length;u++)if(!(!i[u].features||!i[u].features.points)){var c=i[u].features.points,f=StyleInstance.parse(c,o,s);l.push(f)}return l}},{key:"receiveDataset",value:function(i){this.V_=[],this.R_={},this.dataset=i,this.setStyle(this.styleOptions),this.onAdd()}},{key:"jC",value:function(){_get(_get_prototype_of(a.prototype),"jC",this).call(this),!(!this.loca||!this.loca.regl||this.ll.regl)&&(this.ll.regl=this.loca.regl,this.loca.rendererManager.addRenderer(this.ll))}},{key:"beforeRender",value:function(){var i=this;if(_get(_get_prototype_of(a.prototype),"beforeRender",this).call(this),!this.fusion.regl&&this.loca&&(this.fusion.regl=this.loca.regl,this.loca.fusionManager.addFusion(this.fusion)),this.jC(),this.source&&(this.dataset=this.source.LC()),this.fusion){var o=this.WC(),s=o.willFusion,l=o.didFusion,u=this.fusion.EC();if(this.styleOptions.unit==="px"?this.meshes=u||[]:this.meshes=l||[],s.length>0){var c=this.fusion.fusion(s,this.styleOptions,this,function(){i.vA.state|=MeshesDirty});this.meshes=c}}}},{key:"U_",value:function(i,o,s){var l=i.min,u=i.max,c=i.scale;c||(c=[1,1,1]);var f=[l[0]*c[0]+o[0],u[0]*c[0]+o[0]].sort(),h=[l[1]*c[1]+o[1],u[1]*c[1]+o[1]].sort(),p=[s[0][0],s[1][0]].sort(),d=[s[0][1],s[1][1]].sort();return f[0]>p[0]&&f[1]<p[1]&&h[0]>d[0]&&h[1]<d[1]}},{key:"G_",value:function(){if(!this.loca)return{};for(var i=this.loca.map.getBounds(),o=this.loca.customCoords.lngLatToCoord(i.northEast.toArray()),s=this.loca.customCoords.lngLatToCoord(i.southWest.toArray()),l=Object.keys(this.R_),u=0;u<l.length;u++){for(var c=l[u],f=this.R_[c],h=f.position,p=f.sceneBBox,d=!1,v=0;v<h.length;v++){var _=this.U_(p,h[v],[o,s]);if(_){d=!0;break}}this.R_[c].isinmap=d}return this.R_}},{key:"render",value:function(){var i,o;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var s=(i=this.loca)==null?void 0:i.customCoords.getMVPMatrix(),l=RenderHelper.IA(this.loca.lights);if(this.ll&&this.V_&&this.V_.length>0)return this.ll.render({B_:this.R_,cameraPosition:(o=this.loca)==null?void 0:o.customCoords.getCameraParams().position,mvp:s,lights:l}),!0}}},{key:"pickRender",value:function(){}},{key:"afterRender",value:function(){}},{key:"destroy",value:function(){_get(_get_prototype_of(a.prototype),"destroy",this).call(this)}},{key:"PA",value:function(){var i=this;this.R_=this.G_();var o=function(){var s=i.R_,l=i.vA;l.GLTF_PARAMS=[];for(var u=Object.keys(s),c=u.length,f=0;f<c;f++)for(var h=s[u[f]].F_,p=h.length,d=0;d<p;d++){var v=h[d],_=v.attributes,m=_.Iw,y=m.parseData,g=y.b_;l.GLTF_PARAMS.push(g)}};return RenderHelper.SA(this.ll,this,function(s){switch(s){case"onFirstRendering":case"meshes":o();break;case"light":RenderHelper.MA(i.vA,i.loca.lights);break}})}}]),a}(Layer),__defProp$2=Object.defineProperty,__getOwnPropSymbols$2=Object.getOwnPropertySymbols,__hasOwnProp$2=Object.prototype.hasOwnProperty,__propIsEnum$2=Object.prototype.propertyIsEnumerable,__defNormalProp$2=function(n,r,a){return r in n?__defProp$2(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$2=function(n,r){for(var a in r||(r={}))__hasOwnProp$2.call(r,a)&&__defNormalProp$2(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$2)try{for(var l=__getOwnPropSymbols$2(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$2.call(r,a)&&__defNormalProp$2(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},pushArray$2=CommonUtil$1._C,LabelsFusion=function(n){_inherits(a,n);var r=_create_super(a);function a(){return _class_call_check(this,a),r.apply(this,arguments)}return _create_class(a,[{key:"DC",value:function(){}},{key:"buildStyle",value:function(i,o){for(var s,l=labels.style,u=[],c=0;c<i.length;c++)if(!(!i[c].features||!i[c].features.points)){for(var f=i[c].features.points,h=StyleInstance.parse(f,{label:o},l),p={},d=0;d<f.length;d++)if(h)for(var v in h.attributes){var _=h.attributes[v];p[v]||(p[v]=[]),((s=_[d])==null?void 0:s.length)>0?pushArray$2(p[v],_[d]):p[v][p[v].length]=_[d]}u.push({attributes:p,uniforms:h.uniforms,si:h.si})}return u}},{key:"fusion",value:function(i,o,s){if(!s.loca)return[];for(var l=this.buildStyle(i,o),u=[],c=0,f=i.length;c<f;c++){var h=i[c];if(!(!h.features||!h.features.points)){for(var p=l[c].attributes,d=h.features.points,v={labels:[]},_=0;_<d.length;_++){var m=d[_],y=m.coordinates;if(m.type==="MultiPoint"){if(p.label[_])for(var g=0,C=y.length;g<C;g++){var b=y[g];v.labels.push(__spreadValues$2({position:b},p.label[_]))}}else p.label[_]&&v.labels.push(__spreadValues$2({position:y},p.label[_]))}u[c]={id:h.id,attributes:{},uniforms:{},si:{},mf:{labels:v.labels}}}}return u}},{key:"updateStyle",value:function(i,o){for(var s=0,l=i.length;s<l;s++)for(var u=i[s],c=o[s].attributes,f=c.label,h=u.mf.labels,p=0;p<h.length;p++)h[p]=__spreadValues$2(__spreadValues$2({},h[p]),f[p])}},{key:"EC",value:function(){return[]}}]),a}(GeometryFusion),LabelsRender=function(n){_inherits(a,n);var r=_create_super(a);function a(){_class_call_check(this,a);var i;return i=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))),i.v$=[new LabelsRender$1],i}return _create_class(a,[{key:"m$",value:function(i){this.v$.forEach(function(o){return o.m$(i)})}},{key:"render",value:function(i){for(var o=i.meshes,s=0;s<o.length;s++){var l=!0,u=!1,c=void 0;try{for(var f=this.v$[Symbol.iterator](),h;!(l=(h=f.next()).done);l=!0){var p=h.value;p.render(o[s])}}catch(d){u=!0,c=d}finally{try{!l&&f.return!=null&&f.return()}finally{if(u)throw c}}}}},{key:"pickRender",value:function(i){}}]),a}(Render),__defProp$1=Object.defineProperty,__defProps$1=Object.defineProperties,__getOwnPropDescs$1=Object.getOwnPropertyDescriptors,__getOwnPropSymbols$1=Object.getOwnPropertySymbols,__hasOwnProp$1=Object.prototype.hasOwnProperty,__propIsEnum$1=Object.prototype.propertyIsEnumerable,__defNormalProp$1=function(n,r,a){return r in n?__defProp$1(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues$1=function(n,r){for(var a in r||(r={}))__hasOwnProp$1.call(r,a)&&__defNormalProp$1(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols$1)try{for(var l=__getOwnPropSymbols$1(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum$1.call(r,a)&&__defNormalProp$1(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},__spreadProps$1=function(n,r){return __defProps$1(n,__getOwnPropDescs$1(r))},LabelsLayer=function(n){_inherits(a,n);var r=_create_super(a);function a(i){_class_call_check(this,a);var o;o=r.call(this,__spreadProps$1(__spreadValues$1({},i),{labelsLayerOptions:i})),o.CLASS_NAME="Labels",o.fusion=new LabelsFusion,o.ll=new LabelsRender;var s=labels.Sw;return o.zooms=i.zooms===void 0?s.zooms:i.zooms,o.visible=i.visible===void 0?s.visible:i.visible,o.zIndex=i.zIndex===void 0?s.zIndex:i.zIndex,o.opacity=i.opacity===void 0?s.opacity:i.opacity,o.z$=i.z$===void 0?s.z$:i.z$,o.A$=i.A$===void 0?s.A$:i.A$,o.AC({}),o.buryPoint.record(o.CLASS_NAME),o}return _create_class(a,[{key:"getLabelsLayer",value:function(){return this.ll.v$[0]._$||null}},{key:"setStyle",value:function(i){if(_get(_get_prototype_of(a.prototype),"setStyle",this).call(this,i),this.dataset=this.source.LC(),this.dataset&&this.dataset.length>0){var o=this.WC(),s=o.didFusion,l=this.fusion.buildStyle(this.dataset,this.styleOptions);this.fusion.updateStyle(s,l),this.vA.state|=MeshDirty}this.loca&&this.loca.requestRender()}},{key:"getCollision",value:function(){return this.z$}},{key:"setCollision",value:function(i){this.z$=i;var o=this.getLabelsLayer();o&&o.setCollision(i)}},{key:"getAllowCollision",value:function(){return this.A$}},{key:"setAllowCollision",value:function(i){this.A$=i;var o=this.getLabelsLayer();o&&o.setAllowCollision(i)}},{key:"receiveDataset",value:function(i){this.dataset=i,this.setStyle(this.styleOptions),this.onAdd()}},{key:"beforeRender",value:function(){if(_get(_get_prototype_of(a.prototype),"beforeRender",this).call(this),this.loca&&this.loca.fusionManager.addFusion(this.fusion),this.source&&(this.dataset=this.source.LC()),this.fusion){var i=this.WC(),o=i.willFusion;if(o.length>0){var s=this.fusion.fusion(o,this.styleOptions,this);this.meshes=s,this.vA.state|=MeshesDirty}}}},{key:"render",value:function(){var i;if(!!this.loca&&!!this.PA()){var o=(i=this.loca)==null?void 0:i.customCoords.getMVPMatrix();if(this.ll&&this.meshes.length>0)return this.ll.render({meshes:this.meshes,mvp:o}),!0}}},{key:"pickRender",value:function(){}},{key:"afterRender",value:function(){}},{key:"PA",value:function(){return RenderHelper.SA(this.ll,this)}}]),a}(Layer),pushArray$1=CommonUtil$1._C,LaserFusion=function(n){_inherits(a,n);var r=_create_super(a);function a(){return _class_call_check(this,a),r.apply(this,arguments)}return _create_class(a,[{key:"DC",value:function(){}},{key:"buildStyle",value:function(i,o){for(var s=laser.style,l=[],u=0;u<i.length;u++)if(!(!i[u].features||!i[u].features.points)){var c=i[u].features.points,f=StyleInstance.parse(c,o,s);l.push(f)}return l}},{key:"updateStyle",value:function(i,o,s,l){if(!s.loca)return[];var u=s.dataset;return this.fusion(u,o,s,l)}},{key:"fusion",value:function(i,o,s,l){var u=this,c=function(v){var _=i[v];if(!_.features||!_.features.points||!l[v])return"continue";var m=_.features.points,y=l[v],g={vertex:[],color:[],pickColor:[],height:[],duration:[],interval:[],delay:[],dir:[],index:[]};m.forEach(function(C,b){var k=C.type,L=C.coordinates,F=s.colorPick.add(C);k==="MultiPoint"?L.forEach(function(W){f.B$(h(W),g,{style:y,index:b,pickColor:F})}):f.B$(h(L),g,{style:y,index:b,pickColor:F})}),p[v]={id:_.id,attributes:{position:{buffer:u.regl.buffer(g.vertex),offset:0,stride:4*3,td:!1,divisor:0},dir:{buffer:u.regl.buffer(g.dir),offset:0,stride:4*1,td:!1,divisor:0},color:{buffer:u.regl.buffer(g.color),offset:0,stride:4*4,td:!1,divisor:0},pickColor:{buffer:u.regl.buffer(g.pickColor),offset:0,stride:4*4,td:!1,divisor:0},height:{buffer:u.regl.buffer(g.height),offset:0,stride:4*1,td:!1,divisor:0},duration:{buffer:u.regl.buffer(g.duration),offset:0,stride:4*1,td:!1,divisor:0},interval:{buffer:u.regl.buffer(g.interval),offset:0,stride:4*1,td:!1,divisor:0},delay:{buffer:u.regl.buffer(g.delay),offset:0,stride:4*1,td:!1,divisor:0},index:u.regl.elements({primitive:"triangles",type:"uint32",data:g.index})},uniforms:y.uniforms,si:y.si}},f=this;if(!this.regl||!s.loca)return[];l=l||this.buildStyle(i,o);for(var h=s.loca.customCoords.lngLatToCoord.bind(s.loca.customCoords),p=[],d=0;d<i.length;d++)c(d);return p}},{key:"EC",value:function(){return[]}},{key:"destroy",value:function(){this.regl=null}},{key:"B$",value:function(i,o,s){var l=s.style,u=l.attributes,c=s.index,f=s.pickColor,h=_sliced_to_array(i,2),p=h[0],d=h[1],v=u.height,_=u.color,m=u.duration,y=u.interval,g=u.delay,C=v[c],b=this.nM([p,d,0],[p,d,C],{color:_[c],pickColor:f,height:C,duration:m[c],interval:y[c],delay:g[c]});GeoUtil.mergeTriangles(o,b,3),pushArray$1(o.dir,b.dir),pushArray$1(o.color,b.color),pushArray$1(o.pickColor,b.pickColor),pushArray$1(o.height,b.height),pushArray$1(o.duration,b.duration),pushArray$1(o.interval,b.interval),pushArray$1(o.delay,b.delay)}},{key:"nM",value:function(i,o,s){var l=_to_consumable_array(o).concat(_to_consumable_array(i),_to_consumable_array(o),_to_consumable_array(i)),u=s.color,c=s.pickColor,f=s.height,h=s.duration,p=s.interval,d=s.delay;return{vertex:l,dir:[-1,-1,1,1],color:_to_consumable_array(u).concat(_to_consumable_array(u),_to_consumable_array(u),_to_consumable_array(u)),pickColor:_to_consumable_array(c).concat(_to_consumable_array(c),_to_consumable_array(c),_to_consumable_array(c)),height:[f,f,f,f],duration:[h,h,h,h],interval:[p,p,p,p],delay:[d,d,d,d],index:[1,0,2,2,3,1]}}}]),a}(GeometryFusion),LaserShader={vertex:"\n        precision highp float;\n        attribute vec3 position;\n        attribute float dir;\n        attribute vec4 color;\n        attribute float height;\n        attribute float duration;\n        attribute float interval;\n        attribute float delay;\n        uniform float lineWidth;\n        uniform float angle;\n        uniform mat4 mvp;\n        uniform float unit;\n        uniform float resolution;\n        uniform vec3 cameraPosition;\n        varying float vRad;\n        varying vec4 vColor;\n        varying float vDistance;\n        varying float vTotalDistance;\n        varying float vDuration;\n        varying float vInterval;\n        varying float vDelay;\n        ".concat(ColorGLSL.getColorShader().vertex,"\n\n        void main() {\n          vRad = radians(angle);\n          float res = unit == 0.0 ? resolution : 1.0;\n          float halfWidth = (lineWidth / 2.0) * res;\n          vec3 pos = vec3(position.xy, position.z * res);\n          vec3 cameraNor = normalize(cross(cameraPosition - pos, vec3(0, 0, -1)));\n          // \u503E\u659C\n          if (pos.z > 0.0) {\n            pos += cameraNor * pos.z * tan(vRad);\n          }\n          // \u7EBF\u5BBD\n          pos += cameraNor * dir * halfWidth * cos(vRad) + vec3(0, 0, -dir * halfWidth * sin(vRad));\n          gl_Position = mvp * vec4(pos, 1.0);\n          vDistance = position.z / abs(cos(vRad));\n          vTotalDistance = height / abs(cos(vRad));\n          vColor = color;\n          vDuration = duration;\n          vInterval = interval;\n          vDelay = delay;\n          ").concat(ColorGLSL.getColorShader().mainVert,"\n        }\n    "),fragment:"\n        precision mediump float;\n        uniform float opacity;\n        uniform float time;\n        uniform float trailLength;\n        uniform float repeat;\n        uniform float fadeOpacity;\n        varying float vRad;\n        varying vec4 vColor;\n        varying float vDistance;\n        varying float vTotalDistance;\n        varying float vDuration;\n        varying float vInterval;\n        varying float vDelay;\n        float ratio;\n        float distance;\n        ".concat(ColorGLSL.getColorShader().fragment,"\n\n        void main(){\n          float now = time * 1000.0 - vDelay;\n          if(now < 0.0) {\n            discard;\n          }\n          float count = ceil(now / (vDuration + vInterval));\n          float timeOffset = mod(now, vDuration + vInterval);\n          float fade;\n          if (count > repeat) {\n            distance = vTotalDistance;\n          } else if (count == repeat) {\n            distance = vTotalDistance * min(timeOffset / vDuration, 1.0);\n          } else {\n            distance = (vTotalDistance + trailLength) * timeOffset / vDuration;\n          }\n          if (cos(vRad) < 0.0) { // \u5411\u4E0B\n            float remain = vTotalDistance - distance;\n            if(vDistance < remain || vDistance > remain + trailLength) {\n              discard;\n            }\n            ratio = (vDistance - remain) / trailLength;\n            // \u4ECE\u8D77\u70B9\u9732\u51FA\u65F6\u989C\u8272\u8870\u51CF\n            fade = min(distance / trailLength + fadeOpacity, 1.0);\n          } else {\n            if(vDistance > distance || vDistance < distance - trailLength) {\n              discard;\n            }\n            ratio = (distance - vDistance) / trailLength;\n            // \u63A5\u8FD1\u7EC8\u70B9\u6D88\u5931\u524D\u989C\u8272\u8870\u51CF\n            fade = count >= repeat ? 1.0 : min(max((vTotalDistance - distance) / trailLength, 0.0) + fadeOpacity, 1.0);\n          }\n          gl_FragColor = vColor;\n          gl_FragColor.a *= opacity * fade * (1.0 - ratio);\n          ").concat(ColorGLSL.getColorShader().mainFrag,"\n        }\n    ")},__defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=function(n,r,a){return r in n?__defProp(n,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[r]=a},__spreadValues=function(n,r){for(var a in r||(r={}))__hasOwnProp.call(r,a)&&__defNormalProp(n,a,r[a]);var i=!0,o=!1,s=void 0;if(__getOwnPropSymbols)try{for(var l=__getOwnPropSymbols(r)[Symbol.iterator](),u;!(i=(u=l.next()).done);i=!0){var a=u.value;__propIsEnum.call(r,a)&&__defNormalProp(n,a,r[a])}}catch(c){o=!0,s=c}finally{try{!i&&l.return!=null&&l.return()}finally{if(o)throw s}}return n},__spreadProps=function(n,r){return __defProps(n,__getOwnPropDescs(r))},LaserRender=function(n){_inherits(a,n);var r=_create_super(a);function a(){return _class_call_check(this,a),r.apply(this,arguments)}return _create_class(a,[{key:"m$",value:function(i){if(!this.regl)return!1;var o=this.regl;this.gA(LaserShader,i,{frag:LaserShader.fragment,vert:LaserShader.vertex,attributes:__spreadValues({position:o.prop("position"),color:o.prop("color"),height:o.prop("height"),duration:o.prop("duration"),interval:o.prop("interval"),delay:o.prop("delay"),dir:o.prop("dir")},ColorGLSL.getColor(o).attribute),uniforms:__spreadValues({mvp:o.prop("mvp"),opacity:o.prop("opacity"),resolution:o.prop("resolution"),angle:o.prop("angle"),trailLength:o.prop("trailLength"),lineWidth:o.prop("lineWidth"),repeat:o.prop("repeat"),fadeOpacity:o.prop("fadeOpacity"),unit:o.prop("unit"),time:o.prop("time"),cameraPosition:o.prop("cameraPosition")},ColorGLSL.getColor(o).uniform),depth:{enable:o.prop("depth")},blend:{enable:!0,func:RenderUtil.getBlend(),equation:{rgb:"add",alpha:"add"}},primitive:"triangles",elements:o.prop("index")})}},{key:"render",value:function(i){var o=this.yA(LaserShader);if(o)for(var s=i.meshes,l=i.mvp,u=i.animateCounter,c=i.cameraPosition,f=i.opacity,h=i.resolution,p=i.depth,d=0;d<s.length;d++){var v=s[d],_=v.attributes,m=v.uniforms,y=m.unit,g=m.trailLength,C=m.lineWidth,b=m.repeat,k=m.angle,L=m.fadeOpacity,F=60,W=u/F;o(__spreadProps(__spreadValues({},_),{mvp:l,unit:y==="px"?0:1,resolution:h,cameraPosition:c,opacity:f,time:W,trailLength:g,lineWidth:C,angle:k,depth:p,repeat:b,fadeOpacity:L,isPick:!1}))}}},{key:"pickRender",value:function(i){var o=this,s=this.yA(LaserShader);if(s){var l=i.meshes,u=i.animateCounter,c=i.mvp,f=i.opacity,h=i.pickFbo,p=i.pickPos,d=i.resolution,v=i.cameraPosition,_=i.depth;h&&p&&h.use(function(){o.regl.clear({color:[0,0,0,0],depth:1});for(var m=0;m<l.length;m++){var y=l[m],g=y.attributes,C=y.uniforms,b=C.unit,k=C.trailLength,L=C.lineWidth,F=C.repeat,W=C.angle,j=C.fadeOpacity,Y=60,N=u/Y;s(__spreadProps(__spreadValues({},g),{mvp:c,time:N,unit:b==="px"?0:1,resolution:d,cameraPosition:v,opacity:f,trailLength:k,lineWidth:L,angle:W,depth:_,repeat:F,fadeOpacity:j,isPick:!0}))}})}}}]),a}(Render),pushArray=CommonUtil$1._C,LaserLayer=function(n){_inherits(a,n);var r=_create_super(a);function a(i){_class_call_check(this,a);var o;o=r.call(this,i),o.CLASS_NAME="Laser",o.fusion=new LaserFusion,o.ll=new LaserRender,o.depth=!0;var s=laser.Sw;return o.zooms=i.zooms===void 0?s.zooms:i.zooms,o.visible=i.visible===void 0?s.visible:i.visible,o.zIndex=i.zIndex===void 0?s.zIndex:i.zIndex,o.opacity=i.opacity===void 0?s.opacity:i.opacity,o.depth=i.depth===void 0?s.depth:i.depth,o.AC({zooms:o.zooms,visible:o.visible,zIndex:o.zIndex}),o.buryPoint.record(o.CLASS_NAME),o}return _create_class(a,[{key:"receiveDataset",value:function(i){this.dataset=i,this.setStyle(this.styleOptions),this.onAdd()}},{key:"setStyle",value:function(i){if(_get(_get_prototype_of(a.prototype),"setStyle",this).call(this,i),this.dataset=this.source.LC(),this.dataset&&this.dataset.length>0){var o=this.WC(),s=o.didFusion,l=this.fusion.buildStyle(this.dataset,this.styleOptions),u=this.fusion.updateStyle(s,this.styleOptions,this,l);this.meshes=u,this.loca&&this.loca.requestRender()}}},{key:"jC",value:function(){_get(_get_prototype_of(a.prototype),"jC",this).call(this),!(!this.loca||!this.loca.regl||this.ll.regl)&&(this.ll.regl=this.loca.regl,this.loca.rendererManager.addRenderer(this.ll))}},{key:"beforeRender",value:function(){if(_get(_get_prototype_of(a.prototype),"beforeRender",this).call(this),!this.fusion.regl&&this.loca&&(this.fusion.regl=this.loca.regl,this.loca.fusionManager.addFusion(this.fusion)),this.jC(),this.source&&(this.dataset=this.source.LC()),this.fusion){var i=this.WC(),o=i.willFusion,s=i.didFusion;if(this.fusion.EC(),o.length>0){var l=this.fusion.fusion(o,this.styleOptions,this);this.meshes=pushArray(s,l)}}}},{key:"render",value:function(){var i,o;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var s=(i=this.loca)==null?void 0:i.customCoords.getMVPMatrix(),l=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom()),u=this.loca.customCoords.getCameraParams().position;if(this.ll&&this.meshes.length){var c=this.hP();return this.ll.render({meshes:this.meshes,mvp:s,depth:this.depth,resolution:l,opacity:this._getOpacity(),animateCounter:c,cameraPosition:u}),!0}}}},{key:"pickRender",value:function(){var i,o;if(!!this.loca&&!!this.PA()){this.loca.regl._refresh();var s=(i=this.loca)==null?void 0:i.customCoords.getMVPMatrix(),l=this.projection.getResolution((o=this.loca)==null?void 0:o.map.getZoom()),u=this.loca.customCoords.getCameraParams().position;if(this.ll&&this.meshes.length>0){var c=this.hP();this.ll.pickRender({meshes:this.meshes,mvp:s,depth:this.depth,resolution:l,opacity:this._getOpacity(),animateCounter:c,pickFbo:this._needPickFrame&&this._pickFbo,pickPos:this._pickPos,cameraPosition:u})}}}},{key:"afterRender",value:function(){}},{key:"PA",value:function(){return RenderHelper.SA(this.ll,this)}}]),a}(Layer),version="2.0.0";Object.defineProperty(exports,"Bezier",{enumerable:!0,get:function n(){return bezierJs.Bezier}}),exports.AmbientLight=AmbientLight,exports.Animation=Animation$1,exports.$$=AttributesDirty,exports.Clip=Clip,exports.ColorGLSL=ColorGLSL,exports.Df=ColorPick,exports.VC=ColorUtil$1,exports.CommonUtil=CommonUtil$1,exports.Container=Loca,exports.Ef=Context,exports.Dat=Dat,exports.Vf=DataSource,exports.tL=DefaultLight,exports.wA=Defines,exports.DirectionalLight=DirectionalLight,exports.IC=DomUtil,exports.Rf=Earth,exports.Event=Event,exports.H_=GLTFLayer,exports.GeoBufferSource=GeoBufferSource,exports.GeoJSONSource=GeoJSONSource,exports.lL=GeoUtil,exports.TC=GeometryFusion,exports.GeometryUtil=GeometryUtil,exports.GltfLayer=GLTFLayer,exports.GridLayer=GridLayer,exports.HeatMapLayer=HeatMapLayer,exports.HexagonLayer=HexagonLayer,exports.IconLayer=IconLayer,exports.w$=LabelsDirty,exports.LabelsLayer=LabelsLayer,exports.iL=LagacyLight,exports.S$=LangUtil,exports.LaserLayer=LaserLayer,exports.Layer=Layer,exports.Legend=Legend,exports.Light=Light,exports.xA=LightDirty,exports.kA=LightGLSL,exports.LineLayer=LineLayer,exports.LinkLayer=LinkLayer,exports.Map=Map$1,exports.OC=MathUtil,exports.Ff=Mercator,exports.L$=MeshDirty,exports.C$=MeshesDirty,exports.eL=NewLight,exports.CA=NotDirty,exports.PointLayer=PointLayer,exports.PointLight=PointLight,exports.PolygonLayer=PolygonLayer,exports.PrismLayer=PrismLayer,exports.UC=Project,exports.aL=ProjectInstance,exports.Lf=Projection$1,exports.PulseLineLayer=PulseLineLayer,exports.PulseLinkLayer=PulseLinkLayer,exports.AA=Render,exports.RenderUtil=RenderUtil,exports.ScatterLayer=Scatter,exports.OA=Shader,exports.FC=Style,exports.RC=StyleInstance,exports.M$=SubRender,exports.ViewControl=ViewControl$1,exports.ZMarkerLayer=ZMarkerLayer,exports.buryPoint=buryPoint,exports.version=version,Object.defineProperty(exports,"i",{value:!0})})})(lbsLocaLayers_umd_tmp$1,lbsLocaLayers_umd_tmp$1.exports);var lbsLocaLayers_umd_tmp=lbsLocaLayers_umd_tmp$1.exports;return lbsLocaLayers_umd_tmp});
